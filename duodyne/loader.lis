loader.asm:
     1                          ;________________________________________________________________________________________________________________________________
     2                          ;
     3                          ;	Duodyne CUBIX CP/M loader program
     4                          ;
     5                          ;  DWERNER 04/24/2022 	Initial
     6                          ;  PSUMMERS 8/7/2022    Accept a command line argument for CPU to switch to (0-9)
     7                          ;  DWERNER 10/15/2023   MODIFY CODE FOR CUBIX09
     8                          ;  DWERNER 01/21/2024 	Duodyne conversion
     9                          
    10                          ;________________________________________________________________________________________________________________________________
    11                          BDOS:           EQU $0005                         ; BDOS invocation vector
    12                          DEFFCB:         EQU $5C                           ; Location of default FCB
    13                          
    14                                  SECTION ADDR0100
    15                                  ORG     0100H
    16                          ; TODO:  RE-ENABLE THIS CODE
    17                          ; Check for cpu unit
    18  0000  3a5d00                    LD      A,(DEFFCB+1)                      ; Get first char of filename
    19                          
    20  0003  fe3a                      CP      '9' + 1                           ; > '9'
    21  0005  3009                      JR      NC,go                             ; YES, NOT 0-9, Invalid argument
    22                          
    23  0007  d630                      SUB     '0'                               ; < '0'?
    24  0009  3805                      JR      C,go                              ; YES, NOT 0-9, Invalid argument
    25                          
    26  000b  c690                      ADD     $90
    27  000d  322700                    LD      (CPUunit),A                       ; Unit 0 = FFH, 1 = FEH etc
    28                          ;
    29                          go:
    30  0010  0e09                      LD      C,9
    31  0012  112800                    LD      DE,MSGFIL
    32  0015  cd0500                    CALL    BDOS                              ; Do it
    33  0018  f3                        DI                                        ; DISABLE INTERRUPTS
    34  0019  3a2700                    LD      A,(CPUunit)                       ; GET CPU PORT
    35  001c  0e95                      LD      C,$95
    36  001e  ed78                      IN      A,(C)                             ; ENABLE 6502
    37                          ; should never get here
    38  0020  00                        NOP
    39  0021  00                        NOP
    40  0022  00                        NOP
    41  0023  00                        NOP
    42  0024  00                        NOP
    43  0025  00                        NOP
    44  0026  76                        HALT
    45                          
    46                          ;
    47                          CPUunit:
    48  0027  95                        DB      095h                              ; Default CPU unit port
    49                          ;
    50                          
    51                          MSGFIL:
    52  0028  0a0d                      DB      0AH,0DH
    53  002a  4355424958204c4f          DM      "CUBIX LOADED INTO RAM, TO START CUBIX TYPE:"
              4144454420494e54  
              4f2052414d2c2054  
              4f20535441525420  
              4355424958205459  
              50453a            
    54  0055  0a0d                      DB      0AH,0DH
    55  0057  0a0d                      DB      0AH,0DH
    56  0059  5720444635302039          DM      "W DF50 9C"
              43                
    57  0062  0a0d                      DB      0AH,0DH
    58  0064  5720444635312039          DM      "W DF51 9D"
              44                
    59  006d  0a0d                      DB      0AH,0DH
    60  006f  472031303030              DM      "G 1000"
    61  0075  0a0d                      DB      0AH,0DH
    62  0077  0a0d                      DB      0AH,0DH
    63  0079  494e544f20363830          DM      "INTO 6809 MONITOR"
              39204d4f4e49544f  
              52                
    64  008a  24                        DM      "$"
    65                          
    66                          .END
    67                          
