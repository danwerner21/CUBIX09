                      (     cubixzip.asm):00001         ;TITLE   "ZIP/6809-C INFOCOM, INC. --- INITIALIZATION"
                      (     cubixzip.asm):00002         
                      (     cubixzip.asm):00003         ; -------------------------------
                      (     cubixzip.asm):00004         ; ZIP/6809 VERSION C
                      (     cubixzip.asm):00005         ; Z-CODE INTERPRETER PROGRAM
                      (     cubixzip.asm):00006         ; FOR CUBIX
                      (     cubixzip.asm):00007         ; -------------------------------
                      (     cubixzip.asm):00008         
                      (     cubixzip.asm):00009         ; COMPANY PRIVATE -- NOT FOR DISTRIBUTION
                      (     cubixzip.asm):00010         
     0000             (     cubixzip.asm):00011         DEBUG           = 0                               ; ASSEMBLY FLAG
                      (     cubixzip.asm):00012         
                      (     cubixzip.asm):00013         ; -----------
                      (     cubixzip.asm):00014         ; ERROR CODES
                      (     cubixzip.asm):00015         ; -----------
                      (     cubixzip.asm):00016         
                      (     cubixzip.asm):00017         ; 00 -- INSUFFICIENT RAM
                      (     cubixzip.asm):00018         ; 01 -- ILLEGAL X-OP
                      (     cubixzip.asm):00019         ; 02 -- ILLEGAL 0-OP
                      (     cubixzip.asm):00020         ; 03 -- ILLEGAL 1-OP
                      (     cubixzip.asm):00021         ; 04 -- ILLEGAL 2-OP
                      (     cubixzip.asm):00022         ; 05 -- Z-STACK UNDERFLOW
                      (     cubixzip.asm):00023         ; 06 -- Z-STACK OVERFLOW
                      (     cubixzip.asm):00024         ; 07 -- ILLEGAL PROPERTY LENGTH (GETP)
                      (     cubixzip.asm):00025         ; 08 -- DIVISION BY ZERO
                      (     cubixzip.asm):00026         ; 09 -- ILLEGAL ARGUMENT COUNT (EQUAL?)
                      (     cubixzip.asm):00027         ; 10 -- ILLEGAL PROPERTY ID (PUTP)
                      (     cubixzip.asm):00028         ; 11 -- ILLEGAL PROPERTY LENGTH (PUTP)
                      (     cubixzip.asm):00029         ; 12 -- DISK ADDRESS OUT OF RANGE
                      (     cubixzip.asm):00030         ; 13 -- PARSER OVERFLOW
                      (     cubixzip.asm):00031         ; 14 -- DRIVE ACCESS
                      (     cubixzip.asm):00032         ; 15 -- Z-STACK DESTROYED
                      (     cubixzip.asm):00033         ; 16 -- ZIP NOT FULLY LOADED
                      (     cubixzip.asm):00034         
                      (     cubixzip.asm):00035                 ORG     $2000
                      (     cubixzip.asm):00036         
2000                  (     cubixzip.asm):00037         RS1:
2000 4F               (     cubixzip.asm):00038                 CLRA                                      ; USE PAGE ZERO
2001 1F8B             (     cubixzip.asm):00039                 TFR     A,DP                              ; AS THE DIRECT PAGE
2003 10CE21FE         (     cubixzip.asm):00040                 LDS     #MSTACK                           ; GIVE THE STACK A NEW HOME
2007 7E3621           (     cubixzip.asm):00041                 JMP     COLD                              ; PERFORM ONE-TIME INITIALIZATION
200A                  (     cubixzip.asm):00042         RS1E:
200A                  (     cubixzip.asm):00043                 RMB     $100-(RS1E-RS1)
                      (     cubixzip.asm):00044         
                      (     cubixzip.asm):00045         
2100                  (     cubixzip.asm):00046         MSTART: ; START OF FREE PROGRAM RAM
                      (     cubixzip.asm):00047         
                      (     cubixzip.asm):00048                 INCLUDE eq.asm
                      (           eq.asm):00001         ;PAGE
                      (           eq.asm):00002         ;SBTTL "--- MEMORY ORGANIZATION ---"
                      (           eq.asm):00003         
     0100             (           eq.asm):00004         CFREQ           = $100
     1000             (           eq.asm):00005         BFREQ           = $1000
                      (           eq.asm):00006         
                      (           eq.asm):00007         
     00FF             (           eq.asm):00008         TRUE            = $FF
     0000             (           eq.asm):00009         FALSE           = 0
                      (           eq.asm):00010         
     0000             (           eq.asm):00011         DSTART          = 0                               ; START OF DIRECT-PAGE RAM
                      (           eq.asm):00012         
     21FE             (           eq.asm):00013         MSTACK          = MSTART+$FE                      ; TOP OF MACHINE STACK (254 BYTES)
     2200             (           eq.asm):00014         IOBUFF          = MSTART+$100                     ; 256-BYTE DISK I/O BUFFER
     2300             (           eq.asm):00015         ZSTACK          = MSTART+$200                     ; Z-STACK (255 WORDS)
     00FF             (           eq.asm):00016         ZSTAKL          = 255                             ; LENGTH OF Z-STACK IN WORDS
     24FE             (           eq.asm):00017         TOPSTA          = (2*ZSTAKL)+ZSTACK               ; TOP OF Z-STACK
     2500             (           eq.asm):00018         PTABLE          = MSTART+$400                     ; PAGING TABLE ($140 BYTES/$A0 WORDS)
     2650             (           eq.asm):00019         LRUMAP          = MSTART+$550                     ; TIMESTAMP MAP ($A0 BYTES)
     2700             (           eq.asm):00020         LOCALS          = MSTART+$600                     ; LOCAL VARIABLE STORAGE (32 BYTES)
     2740             (           eq.asm):00021         BUFSAV          = MSTART+$640                     ; I/O AUX BUFFER (32 BYTES)
     2800             (           eq.asm):00022         ZIP             = MSTART+$700                     ; START OF EXECUTABLE CODE
     3F00             (           eq.asm):00023         ZCODE           = ZIP+$1700                       ; START OF Z-CODE (ASSUME 5.75K ZIP)
     003F             (           eq.asm):00024         ZCODEHIGH       = (ZIP+$1700)/256                 ; START OF Z-CODE (ASSUME 5.75K ZIP)
     00CF             (           eq.asm):00025         MEMTOP          = $CF                             ; TOP PAGE OF AVAILABLE RAM
     D000             (           eq.asm):00026         SAVFCB          = $D000
     DC00             (           eq.asm):00027         INFCB           = $DC00
                      (           eq.asm):00028         
                      (           eq.asm):00029         ; Z-CODE HEADER OFFSETS
                      (           eq.asm):00030         
     0000             (           eq.asm):00031         ZVERS           = 0                               ; VERSION BYTE
     0001             (           eq.asm):00032         ZMODE           = 1                               ; MODE SELECT BYTE
     0002             (           eq.asm):00033         ZID             = 2                               ; GAME ID WORD
     0004             (           eq.asm):00034         ZENDLD          = 4                               ; START OF NON-PRELOADED Z-CODE
     0006             (           eq.asm):00035         ZBEGIN          = 6                               ; EXECUTION ADDRESS
     0008             (           eq.asm):00036         ZVOCAB          = 8                               ; START OF VOCABULARY TABLE
     000A             (           eq.asm):00037         ZOBJEC          = 10                              ; START OF OBJECT TABLE
     000C             (           eq.asm):00038         ZGLOBA          = 12                              ; START OF GLOBAL VARIABLE TABLE
     000E             (           eq.asm):00039         ZPURBT          = 14                              ; START OF "PURE" Z-CODE
     0010             (           eq.asm):00040         ZSCRIP          = 16                              ; FLAG WORD
     0012             (           eq.asm):00041         ZSERIA          = 18                              ; 3-WORD ASCII SERIAL NUMBER
     0018             (           eq.asm):00042         ZFWORD          = 24                              ; START OF FWORDS TABLE
     001A             (           eq.asm):00043         ZLENTH          = 26                              ; LENGTH OF Z-PROGRAM IN WORDS
     001C             (           eq.asm):00044         ZCHKSM          = 28                              ; Z-CODE CHECKSUM WORD
                      (           eq.asm):00045         
                      (           eq.asm):00046         ;       SBTTL "--- ZIP D-PAGE VARIABLES ---"
                      (           eq.asm):00047         
     0000             (           eq.asm):00048         OPCODE          = DSTART                          ; CURRENT OPCODE
     0001             (           eq.asm):00049         ARGCNT          = OPCODE+1                        ; # ARGUMENTS
     0002             (           eq.asm):00050         ARG1            = OPCODE+2                        ; ARGUMENT #1 (WORD)
     0004             (           eq.asm):00051         ARG2            = OPCODE+4                        ; ARGUMENT #2 (WORD)
     0006             (           eq.asm):00052         ARG3            = OPCODE+6                        ; ARGUMENT #3 (WORD)
     0008             (           eq.asm):00053         ARG4            = OPCODE+8                        ; ARGUMENT #4 (WORD)
                      (           eq.asm):00054         
     000A             (           eq.asm):00055         LRU             = OPCODE+10                       ; (BYTE) LEAST RECENTLY USED PAGE INDEX
     000B             (           eq.asm):00056         ZPURE           = LRU+1                           ; (BYTE) 1ST VIRTUAL PAGE OF PURE Z-CODE
     000C             (           eq.asm):00057         PMAX            = LRU+2                           ; (BYTE) MAXIMUM # SWAPPING PAGES
     000D             (           eq.asm):00058         ZPAGE           = LRU+3                           ; (BYTE) CURRENT SWAPPING PAGE
     000E             (           eq.asm):00059         PAGE0           = LRU+4                           ; (BYTE) 1ST ABS PAGE OF SWAPPING SPACE
     000F             (           eq.asm):00060         TABTOP          = LRU+5                           ; (WORD) ADDRESS OF LAST P-TABLE ENTRY
     0011             (           eq.asm):00061         STAMP           = LRU+7                           ; (BYTE) CURRENT TIMESTAMP (BM 11/24/84)
     0012             (           eq.asm):00062         SWAP            = LRU+8                           ; (BYTE) EARLIEST BUFFER (BM 11/24/84)
                      (           eq.asm):00063         
     0013             (           eq.asm):00064         ZPCH            = LRU+9                           ; HIGHEST-ORDER BIT OF PC
     0014             (           eq.asm):00065         ZPCM            = ZPCH+1                          ; MIDDLE 8 BITS OF PC
     0015             (           eq.asm):00066         ZPCL            = ZPCH+2                          ; LOWER 8 BITS OF PC
     0016             (           eq.asm):00067         ZPCPNT          = ZPCH+3                          ; POINTER TO ACTUAL PC PAGE (WORD)
     0018             (           eq.asm):00068         ZPCFLG          = ZPCH+5                          ; FLAG: "TRUE" IF ZPCPNT VALID
                      (           eq.asm):00069         
     001A             (           eq.asm):00070         MPCH            = ZPCH+7                          ; HIGHEST-ORDER BIT OF MEM POINTER
     001B             (           eq.asm):00071         MPCM            = MPCH+1                          ; MIDDLE 8 BITS OF MEM POINTER
     001C             (           eq.asm):00072         MPCL            = MPCH+2                          ; LOW-ORDER 8 BITS OF MEMORY POINTER
     001D             (           eq.asm):00073         MPCPNT          = MPCH+3                          ; ACTUAL POINTER TO MEMORY (WORD)
     001F             (           eq.asm):00074         MPCFLG          = MPCH+5                          ; FLAG: "TRUE" IF MPCPNT VALID
                      (           eq.asm):00075         
     0021             (           eq.asm):00076         GLOBAL          = MPCH+7                          ; GLOBAL VARIABLE POINTER (WORD)
     0023             (           eq.asm):00077         VOCAB           = GLOBAL+2                        ; VOCAB TABLE POINTER (WORD)
     0025             (           eq.asm):00078         FWORDS          = GLOBAL+4                        ; FWORDS TABLE POINTER (WORD)
                      (           eq.asm):00079         
     0027             (           eq.asm):00080         OZSTAK          = GLOBAL+6                        ; ZSP SAVE REGISTER (FOR ZCALL)
                      (           eq.asm):00081         
     0029             (           eq.asm):00082         CSTEMP          = OZSTAK+2                        ; SET IF TEMP CHARSET IN EFFECT
     002A             (           eq.asm):00083         CSPERM          = CSTEMP+1                        ; CURRENT PERM CHARSET
     002B             (           eq.asm):00084         STBYTF          = CSTEMP+2                        ; 0=1ST, 1=2ND, 2=3RD, 0=LAST
                      (           eq.asm):00085         
     002C             (           eq.asm):00086         ZSTWRD          = CSTEMP+3                        ; WORD STORAGE (WORD)
     002E             (           eq.asm):00087         ZSTBUI          = ZSTWRD+2                        ; Z-STRING INPUT BUFFER (6 BYTES)
     0034             (           eq.asm):00088         ZSTBUO          = ZSTWRD+8                        ; Z-STRING OUTPUT BUFFER (6 BYTES)
     003A             (           eq.asm):00089         RTABP           = ZSTWRD+14                       ; RESULT TABLE POINTER
     003B             (           eq.asm):00090         STABP           = ZSTWRD+15                       ; SOURCE TABLE POINTER
     003C             (           eq.asm):00091         PZSTFO          = ZSTWRD+16                       ; FWORD TABLE BLOCK OFFSET
                      (           eq.asm):00092         
     003D             (           eq.asm):00093         VAL             = ZSTWRD+17                       ; VALUE RETURN REGISTER (WORD)
     003F             (           eq.asm):00094         TEMP            = VAL+2                           ; TEMPORARY REGISTER (WORD)
     0041             (           eq.asm):00095         TEMP2           = VAL+4                           ; ANOTHER TEMPORARY REGISTER (WORD)
     0043             (           eq.asm):00096         MASK            = VAL+6                           ; BIT-MASK REGISTER (WORD)
     0045             (           eq.asm):00097         SQUOT           = VAL+8                           ; SIGN OF QUOTIENT
     0046             (           eq.asm):00098         SREM            = VAL+9                           ; SIGN OF REMAINDER
     0047             (           eq.asm):00099         MTEMP           = VAL+10                          ; MATH TEMP REGISTER (WORD)
                      (           eq.asm):00100         
     0049             (           eq.asm):00101         DRIVE           = VAL+12                          ; DRIVE NUMBER
     004A             (           eq.asm):00102         DBUFF           = DRIVE+1                         ; DISK I/O BUFFER POINTER (WORD)
     004C             (           eq.asm):00103         DBLOCK          = DRIVE+3                         ; Z-BLOCK # (WORD)
     004E             (           eq.asm):00104         TRACK           = DRIVE+5                         ; TRACK/SECTOR ADDRESS (WORD)
                      (           eq.asm):00105         
     0050             (           eq.asm):00106         TIMEFL          = DRIVE+7                         ; "TRUE" IF TIME MODE
                      (           eq.asm):00107         
     0051             (           eq.asm):00108         CHRPNT          = TIMEFL+1                        ; I/O BUFFER INDEX
     0052             (           eq.asm):00109         CPSAV           = CHRPNT+1                        ; SAVE REGISTER FOR [CHRPNT]
     0053             (           eq.asm):00110         BINDEX          = CHRPNT+2                        ; BUFFER DISPLAY INDEX
     0054             (           eq.asm):00111         LINCNT          = CHRPNT+3                        ; # LINES DISPLAYED SINCE LAST USL
     0055             (           eq.asm):00112         IOCHAR          = CHRPNT+4                        ; CURRENT I/O CHARACTER
     0056             (           eq.asm):00113         GDRIVE          = CHRPNT+5                        ; GAME-SAVE DEFAULT DRIVE #
     0057             (           eq.asm):00114         GPOSIT          = CHRPNT+6                        ; GAME-SAVE DEFAULT POSITION
     0058             (           eq.asm):00115         RAND1           = CHRPNT+7                        ; RANDOM NUMBER REGISTER
     0059             (           eq.asm):00116         RAND2           = CHRPNT+8                        ; DITTO
     005A             (           eq.asm):00117         CYCLE           = CHRPNT+9                        ; TIMER FOR CURSOR BLINK (WORD)
     005C             (           eq.asm):00118         BLINK           = CHRPNT+11                       ; MASK FOR CURSOR BLINK
     005D             (           eq.asm):00119         CFLAG           = CHRPNT+12                       ; CURSOR ENABLE FLAG
     005E             (           eq.asm):00120         SCRIPT          = CHRPNT+13                       ; SCRIPTING ENABLE FLAG
     005F             (           eq.asm):00121         IHOLD           = CHRPNT+14                       ; INTERRUPT HOLD
     0060             (           eq.asm):00122         TPOSIT          = CHRPNT+15                       ; TEMP GAME POSITION
     0061             (           eq.asm):00123         TDRIVE          = CHRPNT+16                       ; TEMP GAME DRIVE
                      (           eq.asm):00124         
     0060             (           eq.asm):00125         ZPGTOP          = CHRPNT+15                       ; END OF DIRECT-PAGE VARIABLES
                      (     cubixzip.asm):00049                 INCLUDE warm.asm
                      (         warm.asm):00001         ;       PAGE
                      (         warm.asm):00002         ;       SBTTL "--- WARMSTART ROUTINE ---"
                      (         warm.asm):00003         
     00               (         warm.asm):00004                 SETDP   0
                      (         warm.asm):00005                 ORG     ZIP                               ; START OF EXECUTABLE CODE
                      (         warm.asm):00006         
                      (         warm.asm):00007         ; WARMSTART ENTRY
                      (         warm.asm):00008         
2800                  (         warm.asm):00009         START:
2800 10CE21FE         (         warm.asm):00010                 LDS     #MSTACK                           ; RESET MACHINE STACK
                      (         warm.asm):00011         
                      (         warm.asm):00012         
                      (         warm.asm):00013         ; TEST TO SEE IF ZIP IS ALL LOADED
                      (         warm.asm):00014         
2804 8E0003           (         warm.asm):00015                 LDX     #3
2807                  (         warm.asm):00016         TSTEND:
2807 A6893A29         (         warm.asm):00017                 LDA     ENDTST-1,X
280B A189281B         (         warm.asm):00018                 CMPA    ENDCMP-1,X
280F 2606             (         warm.asm):00019                 BNE     ENDERR
2811 301F             (         warm.asm):00020                 LEAX    -1,X
2813 26F2             (         warm.asm):00021                 BNE     TSTEND
2815 2009             (         warm.asm):00022                 BRA     ENDOK
2817                  (         warm.asm):00023         ENDERR:
2817 8610             (         warm.asm):00024                 LDA     #16
2819 7E366C           (         warm.asm):00025                 JMP     ZERROR                            ;
                      (         warm.asm):00026         
281C                  (         warm.asm):00027         ENDCMP:
281C 454E4400         (         warm.asm):00028                 FCN     'END'
                      (         warm.asm):00029         
                      (         warm.asm):00030         ; CLEAR ALL DIRECT-PAGE VARIABLES
                      (         warm.asm):00031         
2820                  (         warm.asm):00032         ENDOK:
2820 8E0000           (         warm.asm):00033                 LDX     #DSTART
2823                  (         warm.asm):00034         ST0:
2823 6F80             (         warm.asm):00035                 CLR     ,X+
2825 8C0060           (         warm.asm):00036                 CMPX    #ZPGTOP
2828 25F9             (         warm.asm):00037                 BLO     ST0
                      (         warm.asm):00038         
282A 0C11             (         warm.asm):00039                 INC     STAMP                             ; INIT TIMESTAMP TO 1 (BM 11/24/84)
                      (         warm.asm):00040         
                      (         warm.asm):00041         ; RESET THE PAGING TABLE
                      (         warm.asm):00042         
282C 8E2500           (         warm.asm):00043                 LDX     #PTABLE
282F 86FF             (         warm.asm):00044                 LDA     #$FF
2831                  (         warm.asm):00045         ST1A:
2831 A780             (         warm.asm):00046                 STA     ,X+
2833 8C2640           (         warm.asm):00047                 CMPX    #PTABLE+$140
2836 25F9             (         warm.asm):00048                 BLO     ST1A
                      (         warm.asm):00049         
                      (         warm.asm):00050         ; CLEAR THE TIMESTAMP MAP (BM 11/24/84)
                      (         warm.asm):00051         
2838 8E2650           (         warm.asm):00052                 LDX     #LRUMAP
283B                  (         warm.asm):00053         ST1B:
283B 6F80             (         warm.asm):00054                 CLR     ,X+
283D 8C26F0           (         warm.asm):00055                 CMPX    #LRUMAP+$A0
2840 25F9             (         warm.asm):00056                 BLO     ST1B
                      (         warm.asm):00057         
2842 BD37CD           (         warm.asm):00058                 JSR     OPENGAMEDSK                       ; open the game file -- needs to be selected by now
2845 CC0000           (         warm.asm):00059                 LDD     #0
2848 DD4C             (         warm.asm):00060                 STD     DBLOCK
                      (         warm.asm):00061         
                      (         warm.asm):00062         ; GET THE FIRST SECTOR OF Z-CODE
                      (         warm.asm):00063         
284A CC3F00           (         warm.asm):00064                 LDD     #ZCODE                            ; POINT TO 1ST
284D DD4A             (         warm.asm):00065                 STD     DBUFF                             ; Z-CODE LOCATION
284F BD37D9           (         warm.asm):00066                 JSR     GETDSK                            ; FETCH BLOCK #0 FROM DRIVE 0
                      (         warm.asm):00067         
                      (         warm.asm):00068         ; EXTRACT GAME DATA FROM Z-CODE HEADER
                      (         warm.asm):00069         
2852 B63F04           (         warm.asm):00070                 LDA     ZCODE+ZENDLD                      ; GET MSB OF ENDLOAD POINTER
2855 4C               (         warm.asm):00071                 INCA                                      ; ADD ONE TO GET
2856 970B             (         warm.asm):00072                 STA     ZPURE                             ; 1ST PAGE IN "PURE" CODE
2858 8B3F             (         warm.asm):00073                 ADDA    #ZCODEHIGH                        ; ADD BASE ADDRESS TO GET
285A 970E             (         warm.asm):00074                 STA     PAGE0                             ; 1ST PAGE OF SWAPPING SPACE
                      (         warm.asm):00075         
285C C6CF             (         warm.asm):00076                 LDB     #MEMTOP                           ; TOP PAGE OF MEMORY
285E D00E             (         warm.asm):00077                 SUBB    PAGE0                             ; SUBTRACT ADDRESS OF PAGING BUFFER
2860 2304             (         warm.asm):00078                 BLS     NORAM
2862 C108             (         warm.asm):00079                 CMPB    #8
2864 2404             (         warm.asm):00080                 BHS     SETNP                             ; MUST HAVE AT LEAST 8 SWAPPING PAGES
                      (         warm.asm):00081         
                      (         warm.asm):00082         ; *** ERROR #0 -- INSUFFICIENT RAM ***
                      (         warm.asm):00083         
2866                  (         warm.asm):00084         NORAM:
2866 4F               (         warm.asm):00085                 CLRA
2867 BD366C           (         warm.asm):00086                 JSR     ZERROR
                      (         warm.asm):00087         
                      (         warm.asm):00088         ; [B] HAS # FREE SWAPPING PAGES
                      (         warm.asm):00089         
286A                  (         warm.asm):00090         SETNP:
286A C190             (         warm.asm):00091                 CMPB    #$90                              ; MAKE SURE # PAGES
286C 2502             (         warm.asm):00092                 BLO     SETA0                             ; DOESN'T EXCEED
286E C690             (         warm.asm):00093                 LDB     #$90                              ; $90
2870                  (         warm.asm):00094         SETA0:
2870 D70C             (         warm.asm):00095                 STB     PMAX                              ; SET MAXIMUM # FREE PAGES
2872 8E2500           (         warm.asm):00096                 LDX     #PTABLE                           ; ADD BASE ADDR OF P-TABLE
2875 3A               (         warm.asm):00097                 ABX                                       ; TO PAGING LIMIT
2876 3A               (         warm.asm):00098                 ABX                                       ; TWICE (FOR WORD-ALIGNMENT)
2877 9F0F             (         warm.asm):00099                 STX     TABTOP                            ; TO GET ADDR OF HIGHEST TABLE ENTRY
                      (         warm.asm):00100         
2879 B63F01           (         warm.asm):00101                 LDA     ZCODE+ZMODE                       ; GET MODE BYTE
287C 8A08             (         warm.asm):00102                 ORA     #%00001000                        ;
287E B73F01           (         warm.asm):00103                 STA     ZCODE+ZMODE                       ; (WE DON'T WANT ANY DIRTY WORDS)
2881 8402             (         warm.asm):00104                 ANDA    #%00000010                        ; ISOLATE STAT-LINE FORMAT BIT
2883 9750             (         warm.asm):00105                 STA     TIMEFL                            ; 0=SCORE/MOVES, NZ=HOURS/MINUTES
                      (         warm.asm):00106         
2885 FC3F06           (         warm.asm):00107                 LDD     ZCODE+ZBEGIN                      ; GET START ADDRESS OF Z-CODE
2888 DD14             (         warm.asm):00108                 STD     ZPCM                              ; HIGH BITS AT ZPCH ALREADY CLEARED
                      (         warm.asm):00109         
288A FC3F0C           (         warm.asm):00110                 LDD     ZCODE+ZGLOBA                      ; GET RELATIVE ADDR OF GLOBAL TABLE
288D C33F00           (         warm.asm):00111                 ADDD    #ZCODE                            ; CONVERT TO ABSOLUTE ADDRESS
2890 DD21             (         warm.asm):00112                 STD     GLOBAL
                      (         warm.asm):00113         
2892 FC3F18           (         warm.asm):00114                 LDD     ZCODE+ZFWORD                      ; DO SAME FOR FWORDS TABLE
2895 C33F00           (         warm.asm):00115                 ADDD    #ZCODE
2898 DD25             (         warm.asm):00116                 STD     FWORDS
                      (         warm.asm):00117         
289A FC3F08           (         warm.asm):00118                 LDD     ZCODE+ZVOCAB                      ; AND VOCABULARY TABLE
289D C33F00           (         warm.asm):00119                 ADDD    #ZCODE
28A0 DD23             (         warm.asm):00120                 STD     VOCAB
                      (         warm.asm):00121         
                      (         warm.asm):00122         ; GRAB THE REST OF THE PRELOAD
                      (         warm.asm):00123         
28A2 960B             (         warm.asm):00124                 LDA     ZPURE                             ; GET # PAGES IN PRELOAD + 1
28A4 973F             (         warm.asm):00125                 STA     TEMP                              ; USE AS AN INDEX
28A6                  (         warm.asm):00126         LDPRE:
28A6 BD37D9           (         warm.asm):00127                 JSR     GETDSK                            ; GRAB THE BLOCK
28A9 0A3F             (         warm.asm):00128                 DEC     TEMP
28AB 26F9             (         warm.asm):00129                 BNE     LDPRE                             ; KEEP READING TILL DONE
                      (         warm.asm):00130         
28AD CE24FE           (         warm.asm):00131                 LDU     #TOPSTA                           ; INIT THE ZSP
28B0 DF27             (         warm.asm):00132                 STU     OZSTAK                            ; REMEMBER ITS POSITION
                      (         warm.asm):00133         
28B2 035E             (         warm.asm):00134                 COM     SCRIPT                            ; ENABLE SCRIPTING
                      (         warm.asm):00135         
28B4 B63590           (         warm.asm):00136                 LDA     SFLAG                             ; SCRIPTING FLAG
28B7 B73F11           (         warm.asm):00137                 STA     ZCODE+ZSCRIP+1
                      (         warm.asm):00138         
                      (         warm.asm):00139         ; FALL INTO MAIN LOOP
                      (     cubixzip.asm):00050         
                      (     cubixzip.asm):00051         ;TITLE "ZIP/6809-B INFOCOM, INC. --- MAINLINE"
                      (     cubixzip.asm):00052                 INCLUDE MAIN.ASM
                      (         MAIN.ASM):00001         ;       PAGE
                      (         MAIN.ASM):00002         ;       SBTTL "--- MAIN LOOP ---"
                      (         MAIN.ASM):00003         
28BA                  (         MAIN.ASM):00004         MLOOP:
28BA 0A59             (         MAIN.ASM):00005                 DEC     RAND2                             ; RANDOMNESS
28BC 0A59             (         MAIN.ASM):00006                 DEC     RAND2
                      (         MAIN.ASM):00007         
28BE 0F01             (         MAIN.ASM):00008                 CLR     ARGCNT                            ; RESET # ARGUMENTS
28C0 BD318E           (         MAIN.ASM):00009                 JSR     NEXTPC                            ; GET NEXT Z-BYTE
28C3 9700             (         MAIN.ASM):00010                 STA     OPCODE                            ; SAVE OPCODE
                      (         MAIN.ASM):00011         
                      (         MAIN.ASM):00012                 IF      DEBUG = 1
                      (         MAIN.ASM):00013                     LDB     #'0'
                      (         MAIN.ASM):00014                     JSR     DOBUG
                      (         MAIN.ASM):00015                     LDA     OPCODE
                      (         MAIN.ASM):00016                 ENDIF
                      (         MAIN.ASM):00017         
28C5 102A00A4         (         MAIN.ASM):00018                 LBPL    OP2                               ; 2-OP IF POSITIVE
28C9 81B0             (         MAIN.ASM):00019                 CMPA    #176
28CB 256F             (         MAIN.ASM):00020                 BLO     OP1                               ; IT'S A 1-OP
28CD 81C0             (         MAIN.ASM):00021                 CMPA    #192
28CF 255B             (         MAIN.ASM):00022                 BLO     OP0                               ; IF NOT A 0-OP ...
                      (         MAIN.ASM):00023         
                      (         MAIN.ASM):00024         ; HANDLE AN X-OP
                      (         MAIN.ASM):00025         
28D1                  (         MAIN.ASM):00026         OPEXT:
28D1 BD318E           (         MAIN.ASM):00027                 JSR     NEXTPC                            ; GET ARGUMENT BYTE
28D4 9741             (         MAIN.ASM):00028                 STA     TEMP2                             ; HOLD IT HERE
28D6 0F42             (         MAIN.ASM):00029                 CLR     TEMP2+1                           ; INIT LOOP INDEX
28D8 2006             (         MAIN.ASM):00030                 BRA     OPX1
                      (         MAIN.ASM):00031         
28DA                  (         MAIN.ASM):00032         OPX0:
28DA 9641             (         MAIN.ASM):00033                 LDA     TEMP2                             ; GRAB ARG BYTE
28DC 48               (         MAIN.ASM):00034                 ASLA                                      ; SHIFT TO BITS 7 & 6
28DD 48               (         MAIN.ASM):00035                 ASLA
28DE 9741             (         MAIN.ASM):00036                 STA     TEMP2                             ; SAVE RESULT
                      (         MAIN.ASM):00037         
28E0                  (         MAIN.ASM):00038         OPX1:
28E0 84C0             (         MAIN.ASM):00039                 ANDA    #%11000000                        ; MASK OUT GARBAGE
28E2 2605             (         MAIN.ASM):00040                 BNE     OPX2
28E4 BD29AD           (         MAIN.ASM):00041                 JSR     GETLNG                            ; 00 = LONG IMMEDIATE
28E7 2010             (         MAIN.ASM):00042                 BRA     OPXNXT
                      (         MAIN.ASM):00043         
28E9                  (         MAIN.ASM):00044         OPX2:
28E9 8140             (         MAIN.ASM):00045                 CMPA    #%01000000
28EB 2605             (         MAIN.ASM):00046                 BNE     OPX3
28ED BD29A5           (         MAIN.ASM):00047                 JSR     GETSHT                            ; 01 = SHORT IMMEDIATE
28F0 2007             (         MAIN.ASM):00048                 BRA     OPXNXT
                      (         MAIN.ASM):00049         
28F2                  (         MAIN.ASM):00050         OPX3:
28F2 8180             (         MAIN.ASM):00051                 CMPA    #%10000000
28F4 2619             (         MAIN.ASM):00052                 BNE     OPX4                              ; 11 = NO MORE VARIABLES
28F6 BD29C4           (         MAIN.ASM):00053                 JSR     GETVAR                            ; 10 = VARIABLE
                      (         MAIN.ASM):00054         
28F9                  (         MAIN.ASM):00055         OPXNXT:
28F9 D642             (         MAIN.ASM):00056                 LDB     TEMP2+1                           ; GET INDEX
28FB 8E0002           (         MAIN.ASM):00057                 LDX     #ARG1                             ; BASE ADDR OF ARGS
28FE 3A               (         MAIN.ASM):00058                 ABX                                       ; ADD OFFSET IN B
28FF DC3F             (         MAIN.ASM):00059                 LDD     TEMP                              ; GRAB THE ARGUMENT'S VALUE
2901 ED84             (         MAIN.ASM):00060                 STD     ,X                                ; AND SAVE IT
2903 0C01             (         MAIN.ASM):00061                 INC     ARGCNT                            ; KEEP TRACK
2905 0C42             (         MAIN.ASM):00062                 INC     TEMP2+1                           ; UPDATE
2907 0C42             (         MAIN.ASM):00063                 INC     TEMP2+1                           ; ARGUMENT INDEX
2909 9642             (         MAIN.ASM):00064                 LDA     TEMP2+1                           ; DONE 4 ARGS YET?
290B 8108             (         MAIN.ASM):00065                 CMPA    #8
290D 25CB             (         MAIN.ASM):00066                 BLO     OPX0                              ; NO, KEEP GRABBING
                      (         MAIN.ASM):00067         
                      (         MAIN.ASM):00068         ; DISPATCH THE X-OP
                      (         MAIN.ASM):00069         
290F                  (         MAIN.ASM):00070         OPX4:
290F D600             (         MAIN.ASM):00071                 LDB     OPCODE                            ; RETRIEVE THE OPCODE
2911 C1E0             (         MAIN.ASM):00072                 CMPB    #224                              ; IS IT AN EXTENDED 2-OP?
2913 1025007C         (         MAIN.ASM):00073                 LBLO    OP2EX                             ; YES, HANDLE LIKE A 2-OP
2917 C41F             (         MAIN.ASM):00074                 ANDB    #%00011111                        ; ELSE ISOLATE OP BITS
2919 C10C             (         MAIN.ASM):00075                 CMPB    #NOPSX                            ; COMPARE TO LEGAL # OF X-OPS
291B 2505             (         MAIN.ASM):00076                 BLO     DISPX                             ; CONTINUE IF OKAY
                      (         MAIN.ASM):00077         
                      (         MAIN.ASM):00078         ; *** ERROR #1 -- ILLEGAL X-OP ***
                      (         MAIN.ASM):00079         
291D 8601             (         MAIN.ASM):00080                 LDA     #1
291F BD366C           (         MAIN.ASM):00081                 JSR     ZERROR
                      (         MAIN.ASM):00082         
2922                  (         MAIN.ASM):00083         DISPX:
2922 8E2B1F           (         MAIN.ASM):00084                 LDX     #OPTX                             ; X-OP DISPATCH TABLE
2925                  (         MAIN.ASM):00085         DODIS:
2925 58               (         MAIN.ASM):00086                 ASLB                                      ; FORM A WORD-OFFSET INTO IT
2926 3A               (         MAIN.ASM):00087                 ABX                                       ; ADD THE OFFSET
                      (         MAIN.ASM):00088         
                      (         MAIN.ASM):00089                 IF      DEBUG
                      (         MAIN.ASM):00090                     PSHS    X
                      (         MAIN.ASM):00091                     LDB     #'1'
                      (         MAIN.ASM):00092                     JSR     DOBUG
                      (         MAIN.ASM):00093                     PULS    X
                      (         MAIN.ASM):00094                 ENDIF
                      (         MAIN.ASM):00095         
2927 AD94             (         MAIN.ASM):00096                 JSR     [,X]                              ; HANDLE THE OPCODE
2929 7E28BA           (         MAIN.ASM):00097                 JMP     MLOOP                             ; AND GO BACK FOR ANOTHER
                      (         MAIN.ASM):00098         
                      (         MAIN.ASM):00099         ; HANDLE A 0-OP
                      (         MAIN.ASM):00100         
292C                  (         MAIN.ASM):00101         OP0:
292C 8E2AB1           (         MAIN.ASM):00102                 LDX     #OPT0                             ; 0-OP DISPATCH TABLE
292F D600             (         MAIN.ASM):00103                 LDB     OPCODE                            ; FETCH OPCODE
2931 C40F             (         MAIN.ASM):00104                 ANDB    #%00001111                        ; ISOLATE OP BITS
2933 C10E             (         MAIN.ASM):00105                 CMPB    #NOPS0                            ; OPCODE OUT OF RANGE?
2935 25EE             (         MAIN.ASM):00106                 BLO     DODIS                             ; NO, GO DISPATCH IT
                      (         MAIN.ASM):00107         
                      (         MAIN.ASM):00108         ; *** ERROR #2 -- ILLEGAL 0-OP ***
                      (         MAIN.ASM):00109         
2937 8602             (         MAIN.ASM):00110                 LDA     #2
2939 BD366C           (         MAIN.ASM):00111                 JSR     ZERROR
                      (         MAIN.ASM):00112         
                      (         MAIN.ASM):00113         ; HANDLE A 1-OP
                      (         MAIN.ASM):00114         
293C                  (         MAIN.ASM):00115         OP1:
293C 8430             (         MAIN.ASM):00116                 ANDA    #%00110000                        ; ISOLATE ARG BITS
293E 2605             (         MAIN.ASM):00117                 BNE     OP1A
2940 BD29AD           (         MAIN.ASM):00118                 JSR     GETLNG                            ; 00 = LONG IMMEDIATE
2943 2015             (         MAIN.ASM):00119                 BRA     OP1EX
                      (         MAIN.ASM):00120         
2945                  (         MAIN.ASM):00121         OP1A:
2945 8110             (         MAIN.ASM):00122                 CMPA    #%00010000
2947 2605             (         MAIN.ASM):00123                 BNE     OP1B
2949 BD29A5           (         MAIN.ASM):00124                 JSR     GETSHT                            ; 01 = SHORT IMMEDIATE
294C 200C             (         MAIN.ASM):00125                 BRA     OP1EX
                      (         MAIN.ASM):00126         
294E                  (         MAIN.ASM):00127         OP1B:
294E 8120             (         MAIN.ASM):00128                 CMPA    #%00100000
2950 2705             (         MAIN.ASM):00129                 BEQ     OP1C
                      (         MAIN.ASM):00130         
                      (         MAIN.ASM):00131         ; *** ERROR #3 -- ILLEGAL 1-OP ***
                      (         MAIN.ASM):00132         
2952                  (         MAIN.ASM):00133         BADOP1:
2952 8603             (         MAIN.ASM):00134                 LDA     #3
2954 BD366C           (         MAIN.ASM):00135                 JSR     ZERROR
                      (         MAIN.ASM):00136         
2957                  (         MAIN.ASM):00137         OP1C:
2957 BD29C4           (         MAIN.ASM):00138                 JSR     GETVAR                            ; 10 = VARIABLE
                      (         MAIN.ASM):00139         
295A                  (         MAIN.ASM):00140         OP1EX:
295A DC3F             (         MAIN.ASM):00141                 LDD     TEMP
295C DD02             (         MAIN.ASM):00142                 STD     ARG1                              ; GRAB THE ARGUMENT
295E 0C01             (         MAIN.ASM):00143                 INC     ARGCNT                            ; ONE ARGUMENT
2960 8E2ACD           (         MAIN.ASM):00144                 LDX     #OPT1                             ; ADDR OF 1-OP DISPATCH TABLE
2963 D600             (         MAIN.ASM):00145                 LDB     OPCODE                            ; RESTORE OPCODE
2965 C40F             (         MAIN.ASM):00146                 ANDB    #%00001111                        ; ISOLATE OP BITS
2967 C110             (         MAIN.ASM):00147                 CMPB    #NOPS1                            ; IF OPCODE OUT OF RANGE,
2969 24E7             (         MAIN.ASM):00148                 BHS     BADOP1                            ; REPORT IT
296B 20B8             (         MAIN.ASM):00149                 BRA     DODIS                             ; ELSE DISPATCH THE 1-OP
                      (         MAIN.ASM):00150         
                      (         MAIN.ASM):00151         ; HANDLE A 2-OP
                      (         MAIN.ASM):00152         
296D                  (         MAIN.ASM):00153         OP2:
296D 8440             (         MAIN.ASM):00154                 ANDA    #%01000000                        ; ISOLATE 1ST ARG BIT
296F 2605             (         MAIN.ASM):00155                 BNE     OP2A
2971 BD29A5           (         MAIN.ASM):00156                 JSR     GETSHT                            ; 0 = SHORT IMMEDIATE
2974 2003             (         MAIN.ASM):00157                 BRA     OP2B
                      (         MAIN.ASM):00158         
2976                  (         MAIN.ASM):00159         OP2A:
2976 BD29C4           (         MAIN.ASM):00160                 JSR     GETVAR                            ; 1 = VARIABLE
                      (         MAIN.ASM):00161         
2979                  (         MAIN.ASM):00162         OP2B:
2979 DC3F             (         MAIN.ASM):00163                 LDD     TEMP                              ; GRAB VALUE
297B DD02             (         MAIN.ASM):00164                 STD     ARG1                              ; SAVE IN ARG1
297D 0C01             (         MAIN.ASM):00165                 INC     ARGCNT
                      (         MAIN.ASM):00166         
297F 9600             (         MAIN.ASM):00167                 LDA     OPCODE                            ; RESTORE OPCODE
2981 8420             (         MAIN.ASM):00168                 ANDA    #%00100000                        ; ISOLATE 2ND ARG BIT
2983 2605             (         MAIN.ASM):00169                 BNE     OP2C
2985 BD29A5           (         MAIN.ASM):00170                 JSR     GETSHT                            ; 0 = SHORT IMMEDIATE
2988 2003             (         MAIN.ASM):00171                 BRA     OP2D
                      (         MAIN.ASM):00172         
298A                  (         MAIN.ASM):00173         OP2C:
298A BD29C4           (         MAIN.ASM):00174                 JSR     GETVAR                            ; 1 = VARIABLE
                      (         MAIN.ASM):00175         
298D                  (         MAIN.ASM):00176         OP2D:
298D DC3F             (         MAIN.ASM):00177                 LDD     TEMP                              ; GRAB 2ND VALUE
298F DD04             (         MAIN.ASM):00178                 STD     ARG2                              ; STORE AS ARG2
2991 0C01             (         MAIN.ASM):00179                 INC     ARGCNT
                      (         MAIN.ASM):00180         
2993                  (         MAIN.ASM):00181         OP2EX:
2993 8E2AED           (         MAIN.ASM):00182                 LDX     #OPT2                             ; ADDR OF 2-OP DISPATCH TABLE
2996 D600             (         MAIN.ASM):00183                 LDB     OPCODE                            ; RESTORE YET AGAIN
2998 C41F             (         MAIN.ASM):00184                 ANDB    #%00011111                        ; ISOLATE OP BITS
299A C119             (         MAIN.ASM):00185                 CMPB    #NOPS2                            ; OPCODE IN RANGE?
299C 1025FF85         (         MAIN.ASM):00186                 LBLO    DODIS                             ; YES, GO DISPATCH IT
                      (         MAIN.ASM):00187         
                      (         MAIN.ASM):00188         ; *** ERROR #4 -- ILLEGAL 2-OP ***
                      (         MAIN.ASM):00189         
29A0                  (         MAIN.ASM):00190         BADOP2:
29A0 8604             (         MAIN.ASM):00191                 LDA     #4
29A2 BD366C           (         MAIN.ASM):00192                 JSR     ZERROR
                      (     cubixzip.asm):00053                 INCLUDE SUBS.ASM
                      (         SUBS.ASM):00001         ;       PAGE
                      (         SUBS.ASM):00002         ;       SBTTL "--- MAIN LOOP SUPPORT ---"
                      (         SUBS.ASM):00003         
                      (         SUBS.ASM):00004         ; -----------------------
                      (         SUBS.ASM):00005         ; FETCH A SHORT IMMEDIATE
                      (         SUBS.ASM):00006         ; -----------------------
                      (         SUBS.ASM):00007         
29A5                  (         SUBS.ASM):00008         GETSHT:
29A5 BD318E           (         SUBS.ASM):00009                 JSR     NEXTPC                            ; NEXT Z-BYTE IS
29A8 9740             (         SUBS.ASM):00010                 STA     TEMP+1                            ; THE LSB OF ARGUMENT
29AA 0F3F             (         SUBS.ASM):00011                 CLR     TEMP                              ; MSB IS ZERO
29AC 39               (         SUBS.ASM):00012                 RTS
                      (         SUBS.ASM):00013         
                      (         SUBS.ASM):00014         ; ----------------------
                      (         SUBS.ASM):00015         ; FETCH A LONG IMMEDIATE
                      (         SUBS.ASM):00016         ; ----------------------
                      (         SUBS.ASM):00017         
29AD                  (         SUBS.ASM):00018         GETLNG:
29AD BD318E           (         SUBS.ASM):00019                 JSR     NEXTPC                            ; NEXT Z-BYTE IS MSB
29B0 3402             (         SUBS.ASM):00020                 PSHS    A                                 ; SAVE ON STACK
29B2 BD318E           (         SUBS.ASM):00021                 JSR     NEXTPC                            ; NOW GRAB LSB
29B5 9740             (         SUBS.ASM):00022                 STA     TEMP+1                            ; STORE IT
29B7 3502             (         SUBS.ASM):00023                 PULS    A                                 ; RETRIEVE MSB
29B9 973F             (         SUBS.ASM):00024                 STA     TEMP                              ; AND STORE IT
29BB 39               (         SUBS.ASM):00025                 RTS
                      (         SUBS.ASM):00026         
                      (         SUBS.ASM):00027         ; ----------------
                      (         SUBS.ASM):00028         ; FETCH A VARIABLE
                      (         SUBS.ASM):00029         ; ----------------
                      (         SUBS.ASM):00030         
                      (         SUBS.ASM):00031         ; GET WITHIN AN OPCODE
                      (         SUBS.ASM):00032         
29BC                  (         SUBS.ASM):00033         VARGET:
29BC 4D               (         SUBS.ASM):00034                 TSTA                                      ; IF NON-ZERO,
29BD 260B             (         SUBS.ASM):00035                 BNE     GETVR1                            ; ACCESS A VARIABLE
29BF BD2A29           (         SUBS.ASM):00036                 JSR     POPSTK                            ; ELSE TAKE VAR OFF STACK
29C2 205A             (         SUBS.ASM):00037                 BRA     PSHSTK                            ; WITHOUT ALTERING STACK
                      (         SUBS.ASM):00038         
29C4                  (         SUBS.ASM):00039         GETVAR:
29C4 BD318E           (         SUBS.ASM):00040                 JSR     NEXTPC                            ; GRAB VAR-TYPE BYTE
29C7 4D               (         SUBS.ASM):00041                 TSTA                                      ; IF ZERO,
29C8 275F             (         SUBS.ASM):00042                 BEQ     POPSTK                            ; VALUE IS ON STACK
                      (         SUBS.ASM):00043         
                      (         SUBS.ASM):00044         ; IS VARIABLE LOCAL OR GLOBAL?
                      (         SUBS.ASM):00045         
29CA                  (         SUBS.ASM):00046         GETVR1:
29CA 8110             (         SUBS.ASM):00047                 CMPA    #16
29CC 240D             (         SUBS.ASM):00048                 BHS     GETVRG                            ; IT'S GLOBAL
                      (         SUBS.ASM):00049         
                      (         SUBS.ASM):00050         ; HANDLE A LOCAL VARIABLE
                      (         SUBS.ASM):00051         
29CE                  (         SUBS.ASM):00052         GETVRL:
29CE 4A               (         SUBS.ASM):00053                 DECA                                      ; FORM A ZERO-ALIGNED INDEX
29CF 48               (         SUBS.ASM):00054                 ASLA                                      ; WORD INDEX
29D0 8E2700           (         SUBS.ASM):00055                 LDX     #LOCALS                           ; INTO LOCAL VAR TABLE
29D3 1F89             (         SUBS.ASM):00056                 TFR     A,B                               ; MOVE AND
29D5                  (         SUBS.ASM):00057         GTVX:
29D5 3A               (         SUBS.ASM):00058                 ABX                                       ; ADD INDEXING OFFSET
29D6 EC84             (         SUBS.ASM):00059                 LDD     ,X                                ; FETCH VALUE
29D8 DD3F             (         SUBS.ASM):00060                 STD     TEMP                              ; AND RETURN IT
29DA 39               (         SUBS.ASM):00061                 RTS
                      (         SUBS.ASM):00062         
                      (         SUBS.ASM):00063         ; HANDLE A GLOBAL VARIABLE
                      (         SUBS.ASM):00064         
29DB                  (         SUBS.ASM):00065         GETVRG:
29DB 8010             (         SUBS.ASM):00066                 SUBA    #16                               ; ZERO-ALIGN
29DD 9E21             (         SUBS.ASM):00067                 LDX     GLOBAL                            ; BASE OF GLOBAL VAR TABLE
29DF 1F89             (         SUBS.ASM):00068                 TFR     A,B                               ; CONVERT TO WORD-ALIGNED INDEX
29E1 3A               (         SUBS.ASM):00069                 ABX                                       ; BY ADDING OFFSET TWICE (CLEVER, EH?)
29E2 20F1             (         SUBS.ASM):00070                 BRA     GTVX                              ; 2ND ADD ABOVE
                      (         SUBS.ASM):00071         
                      (         SUBS.ASM):00072         ; --------------
                      (         SUBS.ASM):00073         ; RETURN A VALUE
                      (         SUBS.ASM):00074         ; --------------
                      (         SUBS.ASM):00075         
                      (         SUBS.ASM):00076         ; RETURN FROM WITHIN OPCODE
                      (         SUBS.ASM):00077         
29E4                  (         SUBS.ASM):00078         VARPUT:
29E4 4D               (         SUBS.ASM):00079                 TSTA                                      ; IF NON-ZERO
29E5 261D             (         SUBS.ASM):00080                 BNE     PUTVR1                            ; ACCESS A VARIABLE
29E7 3706             (         SUBS.ASM):00081                 PULU    D                                 ; ELSE FLUSH TOP ITEM OFF STACK
29E9 118324FE         (         SUBS.ASM):00082                 CMPU    #TOPSTA
29ED 2245             (         SUBS.ASM):00083                 BHI     UNDER                             ; WATCH FOR UNDERFLOW!
29EF 202D             (         SUBS.ASM):00084                 BRA     PSHSTK                            ; AND PUSH [TEMP] ONTO STACK
                      (         SUBS.ASM):00085         
                      (         SUBS.ASM):00086         ; RETURN A ZERO
                      (         SUBS.ASM):00087         
29F1                  (         SUBS.ASM):00088         RET0:
29F1 4F               (         SUBS.ASM):00089                 CLRA                                      ; CLEAR MSB
                      (         SUBS.ASM):00090         
                      (         SUBS.ASM):00091         ; RETURN BYTE IN [A]
                      (         SUBS.ASM):00092         
29F2                  (         SUBS.ASM):00093         PUTBYT:
29F2 9740             (         SUBS.ASM):00094                 STA     TEMP+1                            ; USE [A] AS LSB
29F4 0F3F             (         SUBS.ASM):00095                 CLR     TEMP                              ; ZERO MSB
                      (         SUBS.ASM):00096         
                      (         SUBS.ASM):00097         ; RETURN VALUE IN [TEMP]
                      (         SUBS.ASM):00098         
29F6                  (         SUBS.ASM):00099         PUTVAL:
29F6 9E3F             (         SUBS.ASM):00100                 LDX     TEMP                              ; GET VALUE IN [TEMP]
29F8 3410             (         SUBS.ASM):00101                 PSHS    X                                 ; AND HOLD ON TO IT
29FA BD318E           (         SUBS.ASM):00102                 JSR     NEXTPC                            ; GET VAR-TYPE BYTE
29FD 3510             (         SUBS.ASM):00103                 PULS    X                                 ; RETRIEVE VALUE
29FF 9F3F             (         SUBS.ASM):00104                 STX     TEMP                              ; PUT IT BACK IN [TEMP]
2A01 4D               (         SUBS.ASM):00105                 TSTA                                      ; IF TYPE-BYTE IS ZERO,
2A02 271A             (         SUBS.ASM):00106                 BEQ     PSHSTK                            ; VALUE GOES TO THE STACK
                      (         SUBS.ASM):00107         
                      (         SUBS.ASM):00108         ; LOCAL OR GLOBAL?
                      (         SUBS.ASM):00109         
2A04                  (         SUBS.ASM):00110         PUTVR1:
2A04 8110             (         SUBS.ASM):00111                 CMPA    #16
2A06 240D             (         SUBS.ASM):00112                 BHS     PUTVLG                            ; IT'S GLOBAL
                      (         SUBS.ASM):00113         
                      (         SUBS.ASM):00114         ; HANDLE A LOCAL VARIABLE
                      (         SUBS.ASM):00115         
2A08                  (         SUBS.ASM):00116         PUTVLL:
2A08 4A               (         SUBS.ASM):00117                 DECA
2A09 48               (         SUBS.ASM):00118                 ASLA
2A0A 1F89             (         SUBS.ASM):00119                 TFR     A,B
2A0C 8E2700           (         SUBS.ASM):00120                 LDX     #LOCALS                           ; INTO LOCAL VARIABLE TABLE
2A0F                  (         SUBS.ASM):00121         PTVX:
2A0F 3A               (         SUBS.ASM):00122                 ABX
2A10 DC3F             (         SUBS.ASM):00123                 LDD     TEMP
2A12 ED84             (         SUBS.ASM):00124                 STD     ,X
2A14 39               (         SUBS.ASM):00125                 RTS
                      (         SUBS.ASM):00126         
                      (         SUBS.ASM):00127         ; HANDLE A GLOBAL VARIABLE
                      (         SUBS.ASM):00128         
2A15                  (         SUBS.ASM):00129         PUTVLG:
2A15 8010             (         SUBS.ASM):00130                 SUBA    #16                               ; ZERO-ALIGN
2A17 9E21             (         SUBS.ASM):00131                 LDX     GLOBAL                            ; BASE OF GLOBAL VAR TABLE
2A19 1F89             (         SUBS.ASM):00132                 TFR     A,B                               ; FORM WORD-ALIGNED INDEX
2A1B 3A               (         SUBS.ASM):00133                 ABX                                       ; BY ADDING OFFSET TO BASE
2A1C 20F1             (         SUBS.ASM):00134                 BRA     PTVX                              ; TWICE
                      (         SUBS.ASM):00135         
                      (         SUBS.ASM):00136         ; --------------------
                      (         SUBS.ASM):00137         ; PUSH [TEMP] TO STACK
                      (         SUBS.ASM):00138         ; --------------------
                      (         SUBS.ASM):00139         
2A1E                  (         SUBS.ASM):00140         PSHSTK:
2A1E DC3F             (         SUBS.ASM):00141                 LDD     TEMP
                      (         SUBS.ASM):00142         
                      (         SUBS.ASM):00143         ; PUSH [D] TO STACK
                      (         SUBS.ASM):00144         
2A20                  (         SUBS.ASM):00145         PSHDZ:
2A20 3606             (         SUBS.ASM):00146                 PSHU    D
2A22 11832300         (         SUBS.ASM):00147                 CMPU    #ZSTACK
2A26 2511             (         SUBS.ASM):00148                 BLO     OVER
2A28 39               (         SUBS.ASM):00149                 RTS
                      (         SUBS.ASM):00150         
                      (         SUBS.ASM):00151         ; -------------------------
                      (         SUBS.ASM):00152         ; POP STACK, SAVE IN [TEMP]
                      (         SUBS.ASM):00153         ; -------------------------
                      (         SUBS.ASM):00154         
2A29                  (         SUBS.ASM):00155         POPSTK:
2A29 3706             (         SUBS.ASM):00156                 PULU    D                                 ; PULL A WORD
2A2B DD3F             (         SUBS.ASM):00157                 STD     TEMP                              ; SAVE IT IN [TEMP]
2A2D 118324FE         (         SUBS.ASM):00158                 CMPU    #TOPSTA
2A31 2201             (         SUBS.ASM):00159                 BHI     UNDER
2A33 39               (         SUBS.ASM):00160                 RTS
                      (         SUBS.ASM):00161         
                      (         SUBS.ASM):00162         ; *** ERROR #5 -- Z-STACK UNDERFLOW ***
                      (         SUBS.ASM):00163         
2A34                  (         SUBS.ASM):00164         UNDER:
2A34 8605             (         SUBS.ASM):00165                 LDA     #5
2A36 7E366C           (         SUBS.ASM):00166                 JMP     ZERROR
                      (         SUBS.ASM):00167         
                      (         SUBS.ASM):00168         ; *** ERROR #6 -- Z-STACK OVERFLOW ***
                      (         SUBS.ASM):00169         
2A39                  (         SUBS.ASM):00170         OVER:
2A39 8606             (         SUBS.ASM):00171                 LDA     #6
2A3B 7E366C           (         SUBS.ASM):00172                 JMP     ZERROR
                      (         SUBS.ASM):00173         
                      (         SUBS.ASM):00174         ; ---------------
                      (         SUBS.ASM):00175         ; PREDICATE FAILS
                      (         SUBS.ASM):00176         ; ---------------
                      (         SUBS.ASM):00177         
2A3E                  (         SUBS.ASM):00178         PREDF:
2A3E BD318E           (         SUBS.ASM):00179                 JSR     NEXTPC                            ; GET 1ST BRANCH BYTE
2A41 4D               (         SUBS.ASM):00180                 TSTA                                      ; IF BIT 7 ISN'T SET,
2A42 2A0E             (         SUBS.ASM):00181                 BPL     PREDB                             ; DO THE BRANCH
                      (         SUBS.ASM):00182         
2A44                  (         SUBS.ASM):00183         PREDNB:
2A44 8440             (         SUBS.ASM):00184                 ANDA    #%01000000                        ; ELSE TEST BIT 6
2A46 2603             (         SUBS.ASM):00185                 BNE     PNBX                              ; ALL DONE IF SET
2A48 BD318E           (         SUBS.ASM):00186                 JSR     NEXTPC                            ; ELSE SKIP OVER 2ND BRANCH BYTE
2A4B                  (         SUBS.ASM):00187         PNBX:
2A4B 39               (         SUBS.ASM):00188                 RTS                                       ; BEFORE LEAVING
                      (         SUBS.ASM):00189         
                      (         SUBS.ASM):00190         ; ------------------
                      (         SUBS.ASM):00191         ; PREDICATE SUCCEEDS
                      (         SUBS.ASM):00192         ; ------------------
                      (         SUBS.ASM):00193         
2A4C                  (         SUBS.ASM):00194         PREDS:
2A4C BD318E           (         SUBS.ASM):00195                 JSR     NEXTPC
2A4F 4D               (         SUBS.ASM):00196                 TSTA                                      ; IF BIT 7 IS SET,
2A50 2AF2             (         SUBS.ASM):00197                 BPL     PREDNB                            ; BRANCH ON PREDICATE FAILURE
                      (         SUBS.ASM):00198         
                      (         SUBS.ASM):00199         ; ----------------
                      (         SUBS.ASM):00200         ; PERFORM A BRANCH
                      (         SUBS.ASM):00201         ; ----------------
                      (         SUBS.ASM):00202         
2A52                  (         SUBS.ASM):00203         PREDB:
2A52 8540             (         SUBS.ASM):00204                 BITA    #%01000000                        ; LONG OR SHORT BRANCH?
2A54 2708             (         SUBS.ASM):00205                 BEQ     PREDLB                            ; LONG IF BIT 6 IS OFF
2A56 843F             (         SUBS.ASM):00206                 ANDA    #%00111111                        ; ELSE FORM SHORT OFFSET
2A58 9740             (         SUBS.ASM):00207                 STA     TEMP+1                            ; USE AS LSB OF BRANCH OFFSET
2A5A 0F3F             (         SUBS.ASM):00208                 CLR     TEMP                              ; ZERO MSB OF OFFSET
2A5C 2013             (         SUBS.ASM):00209                 BRA     PREDB1                            ; AND DO THE BRANCH
                      (         SUBS.ASM):00210         
                      (         SUBS.ASM):00211         ; HANDLE A LONG BRANCH
                      (         SUBS.ASM):00212         
2A5E                  (         SUBS.ASM):00213         PREDLB:
2A5E 843F             (         SUBS.ASM):00214                 ANDA    #%00111111                        ; FORM MSB OF OFFSET
2A60 8520             (         SUBS.ASM):00215                 BITA    #%00100000                        ; CHECK SIGN OF 14-BIT VALUE
2A62 2702             (         SUBS.ASM):00216                 BEQ     DOB2                              ; IT'S POSITIVE
2A64 8AE0             (         SUBS.ASM):00217                 ORA     #%11100000                        ; ELSE EXTEND SIGN BITS
2A66                  (         SUBS.ASM):00218         DOB2:
2A66 3402             (         SUBS.ASM):00219                 PSHS    A                                 ; SAVE MSB OF BRANCH
2A68 BD318E           (         SUBS.ASM):00220                 JSR     NEXTPC                            ; GRAB NEXT Z-BYTE
2A6B 9740             (         SUBS.ASM):00221                 STA     TEMP+1                            ; USE AS LSB OF BRANCH
2A6D 3502             (         SUBS.ASM):00222                 PULS    A
2A6F 973F             (         SUBS.ASM):00223                 STA     TEMP                              ; RETRIEVE MSB
                      (         SUBS.ASM):00224         
                      (         SUBS.ASM):00225         ; BRANCH TO Z-ADDRESS IN [TEMP]
                      (         SUBS.ASM):00226         
2A71                  (         SUBS.ASM):00227         PREDB1:
2A71 DC3F             (         SUBS.ASM):00228                 LDD     TEMP                              ; IF OFFSET IS ZERO,
2A73 102700C8         (         SUBS.ASM):00229                 LBEQ    ZRFALS                            ; DO AN "RFALSE"
2A77 830001           (         SUBS.ASM):00230                 SUBD    #1                                ; IF OFFSET IS ONE,
2A7A 102700B9         (         SUBS.ASM):00231                 LBEQ    ZRTRUE                            ; DO AN "RTRUE"
                      (         SUBS.ASM):00232         
2A7E                  (         SUBS.ASM):00233         PREDB3:
2A7E 830001           (         SUBS.ASM):00234                 SUBD    #1                                ; D = OFFSET-2
2A81 DD3F             (         SUBS.ASM):00235                 STD     TEMP                              ; SAVE NEW OFFSET
                      (         SUBS.ASM):00236         
                      (         SUBS.ASM):00237         ; USE [VAL] TO HOLD TOP 9 BITS OF OFFSET
                      (         SUBS.ASM):00238         
2A83 973E             (         SUBS.ASM):00239                 STA     VAL+1
2A85 5F               (         SUBS.ASM):00240                 CLRB
2A86 48               (         SUBS.ASM):00241                 ASLA                                      ; EXTEND THE SIGN BIT
2A87 59               (         SUBS.ASM):00242                 ROLB                                      ; SHIFT CARRY TO BIT 0 OF [B]
2A88 D73D             (         SUBS.ASM):00243                 STB     VAL                               ; SAVE AS UPPER BYTE OF OFFSET
                      (         SUBS.ASM):00244         
2A8A 9640             (         SUBS.ASM):00245                 LDA     TEMP+1                            ; GET LOW BYTE OF OFFSET
2A8C 1CFE             (         SUBS.ASM):00246                 ANDCC   #%11111110                        ; CLEAR CARRY
2A8E 9915             (         SUBS.ASM):00247                 ADCA    ZPCL                              ; ADD LOW BYTE OF CURRENT ZPC
2A90 2406             (         SUBS.ASM):00248                 BCC     PDB0                              ; IF OVERFLOWED,
                      (         SUBS.ASM):00249         
2A92 0C3E             (         SUBS.ASM):00250                 INC     VAL+1                             ; UPDATE
2A94 2602             (         SUBS.ASM):00251                 BNE     PDB0                              ; UPPER
2A96 0C3D             (         SUBS.ASM):00252                 INC     VAL                               ; 9 BITS
                      (         SUBS.ASM):00253         
2A98                  (         SUBS.ASM):00254         PDB0:
2A98 9715             (         SUBS.ASM):00255                 STA     ZPCL                              ; LOW-BYTES CALCED
                      (         SUBS.ASM):00256         
2A9A DC3D             (         SUBS.ASM):00257                 LDD     VAL                               ; IF 9 UPPER BITS ARE ZERO,
2A9C 2712             (         SUBS.ASM):00258                 BEQ     PDB1                              ; NO NEED TO CHANGE PAGES
                      (         SUBS.ASM):00259         
2A9E 963E             (         SUBS.ASM):00260                 LDA     VAL+1                             ; ELSE ADD MIDDLE BYTES
2AA0 1CFE             (         SUBS.ASM):00261                 ANDCC   #%11111110                        ; CLEAR CARRY
2AA2 9914             (         SUBS.ASM):00262                 ADCA    ZPCM
2AA4 9714             (         SUBS.ASM):00263                 STA     ZPCM
2AA6 963D             (         SUBS.ASM):00264                 LDA     VAL                               ; NOW ADD THE TOP BITS
2AA8 9913             (         SUBS.ASM):00265                 ADCA    ZPCH                              ; USING PREVIOUS CARRY
2AAA 8401             (         SUBS.ASM):00266                 ANDA    #%00000001                        ; ISOLATE BIT 0
2AAC 9713             (         SUBS.ASM):00267                 STA     ZPCH
2AAE 0F18             (         SUBS.ASM):00268                 CLR     ZPCFLG                            ; CHANGED PAGES
2AB0                  (         SUBS.ASM):00269         PDB1:
2AB0 39               (         SUBS.ASM):00270                 RTS
                      (     cubixzip.asm):00054                 INCLUDE DISPATCH.ASM
                      (     DISPATCH.ASM):00001         ;       PAGE
                      (     DISPATCH.ASM):00002         ;       SBTTL "--- OPCODE DISPATCH TABLES ---"
                      (     DISPATCH.ASM):00003         
                      (     DISPATCH.ASM):00004         ; 0-OPS
                      (     DISPATCH.ASM):00005         
2AB1                  (     DISPATCH.ASM):00006         OPT0:
2AB1 2B37             (     DISPATCH.ASM):00007                 FDB     ZRTRUE                            ; 0
2AB3 2B3F             (     DISPATCH.ASM):00008                 FDB     ZRFALS                            ; 1
2AB5 2B42             (     DISPATCH.ASM):00009                 FDB     ZPRI                              ; 2
2AB7 2B60             (     DISPATCH.ASM):00010                 FDB     ZPRR                              ; 3
2AB9 2B5F             (     DISPATCH.ASM):00011                 FDB     ZNOOP                             ; 4
2ABB 3848             (     DISPATCH.ASM):00012                 FDB     ZSAVE                             ; 5
2ABD 38EE             (     DISPATCH.ASM):00013                 FDB     ZREST                             ; 6
2ABF 3613             (     DISPATCH.ASM):00014                 FDB     ZSTART                            ; 7
2AC1 2B67             (     DISPATCH.ASM):00015                 FDB     ZRSTAK                            ; 8
2AC3 2A29             (     DISPATCH.ASM):00016                 FDB     POPSTK                            ; 9
2AC5 3685             (     DISPATCH.ASM):00017                 FDB     ZQUIT                             ; 10
2AC7 36DA             (     DISPATCH.ASM):00018                 FDB     ZCRLF                             ; 11
2AC9 370A             (     DISPATCH.ASM):00019                 FDB     ZUSL                              ; 12
2ACB 2B6F             (     DISPATCH.ASM):00020                 FDB     ZVER                              ; 13
                      (     DISPATCH.ASM):00021         
     000E             (     DISPATCH.ASM):00022         NOPS0           EQU 14                            ; NUMBER OF 0-OPS
                      (     DISPATCH.ASM):00023         
                      (     DISPATCH.ASM):00024         ; 1-OPS
                      (     DISPATCH.ASM):00025         
2ACD                  (     DISPATCH.ASM):00026         OPT1:
2ACD 2BBC             (     DISPATCH.ASM):00027                 FDB     ZZERO                             ; 0
2ACF 2BC5             (     DISPATCH.ASM):00028                 FDB     ZNEXT                             ; 1
2AD1 2BCE             (     DISPATCH.ASM):00029                 FDB     ZFIRST                            ; 2
2AD3 2BEC             (     DISPATCH.ASM):00030                 FDB     ZLOC                              ; 3
2AD5 2BFC             (     DISPATCH.ASM):00031                 FDB     ZPTSIZ                            ; 4
2AD7 2C0E             (     DISPATCH.ASM):00032                 FDB     ZINC                              ; 5
2AD9 2C26             (     DISPATCH.ASM):00033                 FDB     ZDEC                              ; 6
2ADB 2C32             (     DISPATCH.ASM):00034                 FDB     ZPRB                              ; 7
2ADD 2952             (     DISPATCH.ASM):00035                 FDB     BADOP1                            ; 8 (UNDEFINED)
2ADF 2C3C             (     DISPATCH.ASM):00036                 FDB     ZREMOV                            ; 9
2AE1 2C7C             (     DISPATCH.ASM):00037                 FDB     ZPRD                              ; 10
2AE3 2C90             (     DISPATCH.ASM):00038                 FDB     ZRET                              ; 11
2AE5 2CCA             (     DISPATCH.ASM):00039                 FDB     ZJUMP                             ; 12
2AE7 2CD4             (     DISPATCH.ASM):00040                 FDB     ZPRINT                            ; 13
2AE9 2CDE             (     DISPATCH.ASM):00041                 FDB     ZVALUE                            ; 14
2AEB 2CE6             (     DISPATCH.ASM):00042                 FDB     ZBCOM                             ; 15
                      (     DISPATCH.ASM):00043         
     0010             (     DISPATCH.ASM):00044         NOPS1           EQU 16                            ; NUMBER OF 1-OPS
                      (     DISPATCH.ASM):00045         
                      (     DISPATCH.ASM):00046         ; 2-OPS
                      (     DISPATCH.ASM):00047         
2AED                  (     DISPATCH.ASM):00048         OPT2:
2AED 29A0             (     DISPATCH.ASM):00049                 FDB     BADOP2                            ; 0 (UNDEFINED)
2AEF 2F0B             (     DISPATCH.ASM):00050                 FDB     ZEQUAL                            ; 1
2AF1 2CEF             (     DISPATCH.ASM):00051                 FDB     ZLESS                             ; 2
2AF3 2CF9             (     DISPATCH.ASM):00052                 FDB     ZGRTR                             ; 3
2AF5 2D03             (     DISPATCH.ASM):00053                 FDB     ZDLESS                            ; 4
2AF7 2D0C             (     DISPATCH.ASM):00054                 FDB     ZIGRTR                            ; 5
2AF9 2D2F             (     DISPATCH.ASM):00055                 FDB     ZIN                               ; 6
2AFB 2D3F             (     DISPATCH.ASM):00056                 FDB     ZBTST                             ; 7
2AFD 2D4C             (     DISPATCH.ASM):00057                 FDB     ZBOR                              ; 8
2AFF 2D57             (     DISPATCH.ASM):00058                 FDB     ZBAND                             ; 9
2B01 2D5F             (     DISPATCH.ASM):00059                 FDB     ZFSETP                            ; 10
2B03 2D70             (     DISPATCH.ASM):00060                 FDB     ZFSET                             ; 11
2B05 2D7E             (     DISPATCH.ASM):00061                 FDB     ZFCLR                             ; 12
2B07 2D8E             (     DISPATCH.ASM):00062                 FDB     ZSET                              ; 13
2B09 2D97             (     DISPATCH.ASM):00063                 FDB     ZMOVE                             ; 14
2B0B 2DBD             (     DISPATCH.ASM):00064                 FDB     ZGET                              ; 15
2B0D 2DD0             (     DISPATCH.ASM):00065                 FDB     ZGETB                             ; 16
2B0F 2DE3             (     DISPATCH.ASM):00066                 FDB     ZGETP                             ; 17
2B11 2E27             (     DISPATCH.ASM):00067                 FDB     ZGETPT                            ; 18
2B13 2E4B             (     DISPATCH.ASM):00068                 FDB     ZNEXTP                            ; 19
2B15 2E6B             (     DISPATCH.ASM):00069                 FDB     ZADD                              ; 20
2B17 2E74             (     DISPATCH.ASM):00070                 FDB     ZSUB                              ; 21
2B19 2E7A             (     DISPATCH.ASM):00071                 FDB     ZMUL                              ; 22
2B1B 2E99             (     DISPATCH.ASM):00072                 FDB     ZDIV                              ; 23
2B1D 2E9E             (     DISPATCH.ASM):00073                 FDB     ZMOD                              ; 24
                      (     DISPATCH.ASM):00074         
     0019             (     DISPATCH.ASM):00075         NOPS2           EQU 25                            ; NUMBER OF 2-OPS
                      (     DISPATCH.ASM):00076         
                      (     DISPATCH.ASM):00077         ; X-OPS
                      (     DISPATCH.ASM):00078         
2B1F                  (     DISPATCH.ASM):00079         OPTX:
2B1F 2F33             (     DISPATCH.ASM):00080                 FDB     ZCALL                             ; 0
2B21 2FA4             (     DISPATCH.ASM):00081                 FDB     ZPUT                              ; 1
2B23 2FB6             (     DISPATCH.ASM):00082                 FDB     ZPUTB                             ; 2
2B25 2FC4             (     DISPATCH.ASM):00083                 FDB     ZPUTP                             ; 3
2B27 3063             (     DISPATCH.ASM):00084                 FDB     ZREAD                             ; 4
2B29 2FFA             (     DISPATCH.ASM):00085                 FDB     ZPRC                              ; 5
2B2B 2FFF             (     DISPATCH.ASM):00086                 FDB     ZPRN                              ; 6
2B2D 303A             (     DISPATCH.ASM):00087                 FDB     ZRAND                             ; 7
2B2F 3056             (     DISPATCH.ASM):00088                 FDB     ZPUSH                             ; 8
2B31 305B             (     DISPATCH.ASM):00089                 FDB     ZPOP                              ; 9
2B33 2B5F             (     DISPATCH.ASM):00090                 FDB     ZSPLIT                            ; 10
2B35 2B5F             (     DISPATCH.ASM):00091                 FDB     ZSCRN                             ; 11
                      (     DISPATCH.ASM):00092         
     000C             (     DISPATCH.ASM):00093         NOPSX           EQU 12                            ; NUMBER OF X-OPS
                      (     cubixzip.asm):00055         
                      (     cubixzip.asm):00056         ;TITLE "ZIP/6809-B INFOCOM, INC. --- OPCODE EXECUTORS"
                      (     cubixzip.asm):00057                 INCLUDE OPS0.ASM
                      (         OPS0.ASM):00001         ;       PAGE
                      (         OPS0.ASM):00002         ;       SBTTL "--- 0-OPS ---"
                      (         OPS0.ASM):00003         
                      (         OPS0.ASM):00004         ; -----
                      (         OPS0.ASM):00005         ; RTRUE
                      (         OPS0.ASM):00006         ; -----
                      (         OPS0.ASM):00007         
                      (         OPS0.ASM):00008         ; Simulate a RETURN 1
                      (         OPS0.ASM):00009         
2B37                  (         OPS0.ASM):00010         ZRTRUE:
2B37 C601             (         OPS0.ASM):00011                 LDB     #1
                      (         OPS0.ASM):00012         
2B39                  (         OPS0.ASM):00013         ZRT:
2B39 4F               (         OPS0.ASM):00014                 CLRA
2B3A DD02             (         OPS0.ASM):00015                 STD     ARG1                              ; SAVE VALUE HERE
2B3C 7E2C90           (         OPS0.ASM):00016                 JMP     ZRET
                      (         OPS0.ASM):00017         
                      (         OPS0.ASM):00018         ; ------
                      (         OPS0.ASM):00019         ; RFALSE
                      (         OPS0.ASM):00020         ; ------
                      (         OPS0.ASM):00021         
                      (         OPS0.ASM):00022         ; Simulate a RETURN 0
                      (         OPS0.ASM):00023         
2B3F                  (         OPS0.ASM):00024         ZRFALS:
2B3F 5F               (         OPS0.ASM):00025                 CLRB
2B40 20F7             (         OPS0.ASM):00026                 BRA     ZRT
                      (         OPS0.ASM):00027         
                      (         OPS0.ASM):00028         ; ------
                      (         OPS0.ASM):00029         ; PRINTI
                      (         OPS0.ASM):00030         ; ------
                      (         OPS0.ASM):00031         
                      (         OPS0.ASM):00032         ; Print the Z-string immediately following the opcode
                      (         OPS0.ASM):00033         
2B42                  (         OPS0.ASM):00034         ZPRI:
2B42 9613             (         OPS0.ASM):00035                 LDA     ZPCH                              ; MOVE ZPC INTO MPC
2B44 971A             (         OPS0.ASM):00036                 STA     MPCH
2B46 DC14             (         OPS0.ASM):00037                 LDD     ZPCM
2B48 DD1B             (         OPS0.ASM):00038                 STD     MPCM
2B4A 0F1F             (         OPS0.ASM):00039                 CLR     MPCFLG                            ; ZERO MPC FLAG
                      (         OPS0.ASM):00040         
2B4C BD328A           (         OPS0.ASM):00041                 JSR     PZSTR                             ; PRINT THE STRING AT [MPC]
                      (         OPS0.ASM):00042         
2B4F 961A             (         OPS0.ASM):00043                 LDA     MPCH                              ; UPDATE ZPC FROM MPC
2B51 9713             (         OPS0.ASM):00044                 STA     ZPCH
2B53 DC1B             (         OPS0.ASM):00045                 LDD     MPCM
2B55 DD14             (         OPS0.ASM):00046                 STD     ZPCM
2B57 961F             (         OPS0.ASM):00047                 LDA     MPCFLG                            ; ALSO UPDATE FLAG
2B59 9718             (         OPS0.ASM):00048                 STA     ZPCFLG
2B5B DC1D             (         OPS0.ASM):00049                 LDD     MPCPNT                            ; AND PAGE POINTER
2B5D DD16             (         OPS0.ASM):00050                 STD     ZPCPNT
                      (         OPS0.ASM):00051         
                      (         OPS0.ASM):00052         ; FALL THROUGH TO ...
                      (         OPS0.ASM):00053         
                      (         OPS0.ASM):00054         ; ----
                      (         OPS0.ASM):00055         ; NOOP
                      (         OPS0.ASM):00056         ; ----
                      (         OPS0.ASM):00057         
2B5F                  (         OPS0.ASM):00058         ZNOOP:
2B5F 39               (         OPS0.ASM):00059                 RTS
                      (         OPS0.ASM):00060         
                      (         OPS0.ASM):00061         ; ------
                      (         OPS0.ASM):00062         ; PRINTR
                      (         OPS0.ASM):00063         ; ------
                      (         OPS0.ASM):00064         
                      (         OPS0.ASM):00065         ; Execute a PRINTI, followed by CRLF and RTRUE
                      (         OPS0.ASM):00066         
2B60                  (         OPS0.ASM):00067         ZPRR:
2B60 8DE0             (         OPS0.ASM):00068                 BSR     ZPRI
2B62 BD36DA           (         OPS0.ASM):00069                 JSR     ZCRLF
2B65 20D0             (         OPS0.ASM):00070                 BRA     ZRTRUE
                      (         OPS0.ASM):00071         
                      (         OPS0.ASM):00072         ; ------
                      (         OPS0.ASM):00073         ; RSTACK
                      (         OPS0.ASM):00074         ; ------
                      (         OPS0.ASM):00075         
                      (         OPS0.ASM):00076         ; Execute a RETURN, with CALL value on top of the stack
                      (         OPS0.ASM):00077         
2B67                  (         OPS0.ASM):00078         ZRSTAK:
2B67 BD2A29           (         OPS0.ASM):00079                 JSR     POPSTK
2B6A DD02             (         OPS0.ASM):00080                 STD     ARG1                              ; TOS WAS LEFT IN [D]
2B6C 7E2C90           (         OPS0.ASM):00081                 JMP     ZRET
                      (         OPS0.ASM):00082         
                      (         OPS0.ASM):00083         ; ------
                      (         OPS0.ASM):00084         ; VERIFY
                      (         OPS0.ASM):00085         ; ------
                      (         OPS0.ASM):00086         
                      (         OPS0.ASM):00087         ; Verify the game code
                      (         OPS0.ASM):00088         
2B6F                  (         OPS0.ASM):00089         ZVER:
2B6F BD36B3           (         OPS0.ASM):00090                 JSR     VERNUM                            ; DISPLAY ZIP VERSION CODE
2B72 FC3F1A           (         OPS0.ASM):00091                 LDD     ZCODE+ZLENTH                      ; GET LENGTH OF Z-CODE
2B75 DD04             (         OPS0.ASM):00092                 STD     ARG2                              ; IN WORDS
                      (         OPS0.ASM):00093         
                      (         OPS0.ASM):00094         ; CLEAR VARIABLES
                      (         OPS0.ASM):00095         
2B77 4F               (         OPS0.ASM):00096                 CLRA
2B78 5F               (         OPS0.ASM):00097                 CLRB
2B79 DD02             (         OPS0.ASM):00098                 STD     ARG1
2B7B DD06             (         OPS0.ASM):00099                 STD     ARG3                              ; BIT 17 OF Z-CODE LENGTH
2B7D DD3F             (         OPS0.ASM):00100                 STD     TEMP                              ; BYTE COUNT
                      (         OPS0.ASM):00101         
                      (         OPS0.ASM):00102         ; CONVERT Z-CODE LENGTH TO BYTES
                      (         OPS0.ASM):00103         
2B7F 0805             (         OPS0.ASM):00104                 ASL     ARG2+1                            ; BOTTOM 8 BITS
2B81 0904             (         OPS0.ASM):00105                 ROL     ARG2                              ; MIDDLE 8 BITS
2B83 0907             (         OPS0.ASM):00106                 ROL     ARG3+1                            ; 17TH BIT OF LENGTH
                      (         OPS0.ASM):00107         
2B85 8640             (         OPS0.ASM):00108                 LDA     #$40                              ; 1ST 64 BYTES
2B87 9740             (         OPS0.ASM):00109                 STA     TEMP+1                            ; ARE NOT CHECKED
2B89 BD3272           (         OPS0.ASM):00110                 JSR     SETWRD                            ; [TEMP] POINTS TO FIRST BYTE
                      (         OPS0.ASM):00111         
2B8C 8606             (         OPS0.ASM):00112                 LDA     #ARG3                             ; PATCH [GETBYT] ROUTINE
2B8E B731C9           (         OPS0.ASM):00113                 STA     PATCH                             ; SO PRELOAD WILL BE READ FROM DISK
                      (         OPS0.ASM):00114         
2B91                  (         OPS0.ASM):00115         VSUM:
2B91 BD31BF           (         OPS0.ASM):00116                 JSR     GETBYT                            ; GET A BYTE
2B94 5F               (         OPS0.ASM):00117                 CLRB                                      ; CLEAR CARRY
2B95 9903             (         OPS0.ASM):00118                 ADCA    ARG1+1                            ; ADD TO SUM
2B97 9703             (         OPS0.ASM):00119                 STA     ARG1+1
2B99 2402             (         OPS0.ASM):00120                 BCC     VSUM0
2B9B 0C02             (         OPS0.ASM):00121                 INC     ARG1
                      (         OPS0.ASM):00122         
2B9D                  (         OPS0.ASM):00123         VSUM0:
2B9D DC1B             (         OPS0.ASM):00124                 LDD     MPCM                              ; END OF GAME YET?
2B9F 109304           (         OPS0.ASM):00125                 CMPD    ARG2
2BA2 26ED             (         OPS0.ASM):00126                 BNE     VSUM
                      (         OPS0.ASM):00127         
2BA4 961A             (         OPS0.ASM):00128                 LDA     MPCH                              ; ALSO CHECK TOP BIT
2BA6 9107             (         OPS0.ASM):00129                 CMPA    ARG3+1
2BA8 26E7             (         OPS0.ASM):00130                 BNE     VSUM
                      (         OPS0.ASM):00131         
2BAA 860B             (         OPS0.ASM):00132                 LDA     #ZPURE
2BAC B731C9           (         OPS0.ASM):00133                 STA     PATCH                             ; UNPATCH [GETBYT]
                      (         OPS0.ASM):00134         
2BAF FC3F1C           (         OPS0.ASM):00135                 LDD     ZCODE+ZCHKSM                      ; GET CHECKSUM
2BB2 109302           (         OPS0.ASM):00136                 CMPD    ARG1                              ; SAME AS CALCULATED?
2BB5 1027FE93         (         OPS0.ASM):00137                 LBEQ    PREDS                             ; YES, PREDICATE SUCCEEDS
2BB9 7E2A3E           (         OPS0.ASM):00138                 JMP     PREDF                             ; ELSE FAILURE ...
                      (     cubixzip.asm):00058                 INCLUDE OPS1.ASM
                      (         OPS1.ASM):00001         ;       PAGE
                      (         OPS1.ASM):00002         ;       SBTTL "--- 1-OPS ---"
                      (         OPS1.ASM):00003         
                      (         OPS1.ASM):00004         ; -----
                      (         OPS1.ASM):00005         ; ZERO?
                      (         OPS1.ASM):00006         ; -----
                      (         OPS1.ASM):00007         
                      (         OPS1.ASM):00008         ; Is arg1 equal to zero? [PRED]
                      (         OPS1.ASM):00009         
2BBC                  (         OPS1.ASM):00010         ZZERO:
2BBC DC02             (         OPS1.ASM):00011                 LDD     ARG1
2BBE 1027FE8A         (         OPS1.ASM):00012                 LBEQ    PREDS
2BC2 7E2A3E           (         OPS1.ASM):00013                 JMP     PREDF
                      (         OPS1.ASM):00014         
                      (         OPS1.ASM):00015         ; -----
                      (         OPS1.ASM):00016         ; NEXT?
                      (         OPS1.ASM):00017         ; -----
                      (         OPS1.ASM):00018         
                      (         OPS1.ASM):00019         ; Return the NEXT pointer in object "arg1"; fail if
                      (         OPS1.ASM):00020         ; none left, and return zero [VALUE][PRED]
                      (         OPS1.ASM):00021         
2BC5                  (         OPS1.ASM):00022         ZNEXT:
2BC5 9603             (         OPS1.ASM):00023                 LDA     ARG1+1
2BC7 BD34D4           (         OPS1.ASM):00024                 JSR     OBJLOC
2BCA C605             (         OPS1.ASM):00025                 LDB     #5                                ; SAME AS FIRST?
2BCC 2007             (         OPS1.ASM):00026                 BRA     FIRST1
                      (         OPS1.ASM):00027         
                      (         OPS1.ASM):00028         ; ------
                      (         OPS1.ASM):00029         ; FIRST?
                      (         OPS1.ASM):00030         ; ------
                      (         OPS1.ASM):00031         
                      (         OPS1.ASM):00032         ; Return the FIRST pointer in object "arg1"; fail if
                      (         OPS1.ASM):00033         ; none, and return zero [VALUE][PRED]
                      (         OPS1.ASM):00034         
2BCE                  (         OPS1.ASM):00035         ZFIRST:
2BCE 9603             (         OPS1.ASM):00036                 LDA     ARG1+1
2BD0 BD34D4           (         OPS1.ASM):00037                 JSR     OBJLOC
2BD3 C606             (         OPS1.ASM):00038                 LDB     #6
                      (         OPS1.ASM):00039         
2BD5                  (         OPS1.ASM):00040         FIRST1:
2BD5 9E3F             (         OPS1.ASM):00041                 LDX     TEMP
2BD7 A685             (         OPS1.ASM):00042                 LDA     B,X                               ; FETCH SLOT
2BD9 9740             (         OPS1.ASM):00043                 STA     TEMP+1                            ; SAVE HERE
2BDB 3402             (         OPS1.ASM):00044                 PSHS    A                                 ; AND ON STACK
2BDD 0F3F             (         OPS1.ASM):00045                 CLR     TEMP                              ; ZERO MSB
2BDF BD29F6           (         OPS1.ASM):00046                 JSR     PUTVAL
2BE2 3502             (         OPS1.ASM):00047                 PULS    A
2BE4 4D               (         OPS1.ASM):00048                 TSTA
2BE5 1027FE55         (         OPS1.ASM):00049                 LBEQ    PREDF                             ; FAILURE
2BE9 7E2A4C           (         OPS1.ASM):00050                 JMP     PREDS                             ; OR SUCCESS
                      (         OPS1.ASM):00051         
                      (         OPS1.ASM):00052         ; ---
                      (         OPS1.ASM):00053         ; LOC
                      (         OPS1.ASM):00054         ; ---
                      (         OPS1.ASM):00055         
                      (         OPS1.ASM):00056         ; Return the object containing object "arg1"; zero if none [VALUE]
                      (         OPS1.ASM):00057         
2BEC                  (         OPS1.ASM):00058         ZLOC:
2BEC 9603             (         OPS1.ASM):00059                 LDA     ARG1+1
2BEE BD34D4           (         OPS1.ASM):00060                 JSR     OBJLOC
2BF1 9E3F             (         OPS1.ASM):00061                 LDX     TEMP
2BF3 A604             (         OPS1.ASM):00062                 LDA     4,X
2BF5 9740             (         OPS1.ASM):00063                 STA     TEMP+1
2BF7 0F3F             (         OPS1.ASM):00064                 CLR     TEMP
2BF9 7E29F6           (         OPS1.ASM):00065                 JMP     PUTVAL
                      (         OPS1.ASM):00066         
                      (         OPS1.ASM):00067         ; ------
                      (         OPS1.ASM):00068         ; PTSIZE
                      (         OPS1.ASM):00069         ; ------
                      (         OPS1.ASM):00070         
                      (         OPS1.ASM):00071         ; Return length of prop table "arg1" in bytes [VALUE]
                      (         OPS1.ASM):00072         
2BFC                  (         OPS1.ASM):00073         ZPTSIZ:
2BFC DC02             (         OPS1.ASM):00074                 LDD     ARG1
2BFE C33F00           (         OPS1.ASM):00075                 ADDD    #ZCODE
2C01 830001           (         OPS1.ASM):00076                 SUBD    #1
2C04 DD3F             (         OPS1.ASM):00077                 STD     TEMP
2C06 5F               (         OPS1.ASM):00078                 CLRB
2C07 BD348E           (         OPS1.ASM):00079                 JSR     PROPL
2C0A 4C               (         OPS1.ASM):00080                 INCA
2C0B 7E29F2           (         OPS1.ASM):00081                 JMP     PUTBYT
                      (         OPS1.ASM):00082         
                      (         OPS1.ASM):00083         ; ---
                      (         OPS1.ASM):00084         ; INC
                      (         OPS1.ASM):00085         ; ---
                      (         OPS1.ASM):00086         
                      (         OPS1.ASM):00087         ; Increment arg1 [VALUE]
                      (         OPS1.ASM):00088         
2C0E                  (         OPS1.ASM):00089         ZINC:
2C0E 9603             (         OPS1.ASM):00090                 LDA     ARG1+1
2C10 BD29BC           (         OPS1.ASM):00091                 JSR     VARGET
2C13 DC3F             (         OPS1.ASM):00092                 LDD     TEMP
2C15 C30001           (         OPS1.ASM):00093                 ADDD    #1
2C18                  (         OPS1.ASM):00094         ZINC1:
2C18 DD3F             (         OPS1.ASM):00095                 STD     TEMP
2C1A 3406             (         OPS1.ASM):00096                 PSHS    D
2C1C 9603             (         OPS1.ASM):00097                 LDA     ARG1+1
2C1E BD29E4           (         OPS1.ASM):00098                 JSR     VARPUT
2C21 3506             (         OPS1.ASM):00099                 PULS    D
2C23 DD3F             (         OPS1.ASM):00100                 STD     TEMP
2C25 39               (         OPS1.ASM):00101                 RTS
                      (         OPS1.ASM):00102         
                      (         OPS1.ASM):00103         ; ---
                      (         OPS1.ASM):00104         ; DEC
                      (         OPS1.ASM):00105         ; ---
                      (         OPS1.ASM):00106         
                      (         OPS1.ASM):00107         ; Decrement arg1 [VALUE]
                      (         OPS1.ASM):00108         
2C26                  (         OPS1.ASM):00109         ZDEC:
2C26 9603             (         OPS1.ASM):00110                 LDA     ARG1+1
2C28 BD29BC           (         OPS1.ASM):00111                 JSR     VARGET
2C2B DC3F             (         OPS1.ASM):00112                 LDD     TEMP
2C2D 830001           (         OPS1.ASM):00113                 SUBD    #1
2C30 20E6             (         OPS1.ASM):00114                 BRA     ZINC1
                      (         OPS1.ASM):00115         
                      (         OPS1.ASM):00116         ; ------
                      (         OPS1.ASM):00117         ; PRINTB
                      (         OPS1.ASM):00118         ; ------
                      (         OPS1.ASM):00119         
                      (         OPS1.ASM):00120         ; PRINT the string pointed to by BYTE-pointer "arg1"
                      (         OPS1.ASM):00121         
2C32                  (         OPS1.ASM):00122         ZPRB:
2C32 DC02             (         OPS1.ASM):00123                 LDD     ARG1
2C34 DD3F             (         OPS1.ASM):00124                 STD     TEMP
2C36 BD3272           (         OPS1.ASM):00125                 JSR     SETWRD
2C39 7E328A           (         OPS1.ASM):00126                 JMP     PZSTR
                      (         OPS1.ASM):00127         
                      (         OPS1.ASM):00128         ; ------
                      (         OPS1.ASM):00129         ; REMOVE
                      (         OPS1.ASM):00130         ; ------
                      (         OPS1.ASM):00131         
                      (         OPS1.ASM):00132         ; Move object "arg1" to pseudo-object #0
                      (         OPS1.ASM):00133         
2C3C                  (         OPS1.ASM):00134         ZREMOV:
2C3C 9603             (         OPS1.ASM):00135                 LDA     ARG1+1
2C3E BD34D4           (         OPS1.ASM):00136                 JSR     OBJLOC
2C41 9E3F             (         OPS1.ASM):00137                 LDX     TEMP
2C43 A604             (         OPS1.ASM):00138                 LDA     4,X
2C45 2734             (         OPS1.ASM):00139                 BEQ     REMVEX                            ; NO OBJECT
                      (         OPS1.ASM):00140         
2C47 3410             (         OPS1.ASM):00141                 PSHS    X                                 ; SAVE [TEMP]
                      (         OPS1.ASM):00142         
2C49 BD34D4           (         OPS1.ASM):00143                 JSR     OBJLOC
2C4C 9E3F             (         OPS1.ASM):00144                 LDX     TEMP
2C4E A606             (         OPS1.ASM):00145                 LDA     6,X
2C50 9103             (         OPS1.ASM):00146                 CMPA    ARG1+1
2C52 260C             (         OPS1.ASM):00147                 BNE     REMVC1
                      (         OPS1.ASM):00148         
2C54 3510             (         OPS1.ASM):00149                 PULS    X                                 ; RETRIEVE FORMER [TEMP]
2C56 3410             (         OPS1.ASM):00150                 PSHS    X                                 ; SAVE COPY ON STACK
                      (         OPS1.ASM):00151         
2C58 A605             (         OPS1.ASM):00152                 LDA     5,X                               ; OLD [TEMP] IS IN [X]
2C5A 9E3F             (         OPS1.ASM):00153                 LDX     TEMP
2C5C A706             (         OPS1.ASM):00154                 STA     6,X
                      (         OPS1.ASM):00155         
2C5E 2015             (         OPS1.ASM):00156                 BRA     REMVC2
                      (         OPS1.ASM):00157         
2C60                  (         OPS1.ASM):00158         REMVC1:
2C60 BD34D4           (         OPS1.ASM):00159                 JSR     OBJLOC
2C63 9E3F             (         OPS1.ASM):00160                 LDX     TEMP
2C65 A605             (         OPS1.ASM):00161                 LDA     5,X
2C67 9103             (         OPS1.ASM):00162                 CMPA    ARG1+1
2C69 26F5             (         OPS1.ASM):00163                 BNE     REMVC1
                      (         OPS1.ASM):00164         
2C6B 3510             (         OPS1.ASM):00165                 PULS    X
2C6D 3410             (         OPS1.ASM):00166                 PSHS    X
                      (         OPS1.ASM):00167         
2C6F A605             (         OPS1.ASM):00168                 LDA     5,X
2C71 9E3F             (         OPS1.ASM):00169                 LDX     TEMP
2C73 A705             (         OPS1.ASM):00170                 STA     5,X
                      (         OPS1.ASM):00171         
2C75                  (         OPS1.ASM):00172         REMVC2:
2C75 3510             (         OPS1.ASM):00173                 PULS    X
2C77 6F04             (         OPS1.ASM):00174                 CLR     4,X
2C79 6F05             (         OPS1.ASM):00175                 CLR     5,X
                      (         OPS1.ASM):00176         
2C7B                  (         OPS1.ASM):00177         REMVEX:
2C7B 39               (         OPS1.ASM):00178                 RTS
                      (         OPS1.ASM):00179         
                      (         OPS1.ASM):00180         ; ------
                      (         OPS1.ASM):00181         ; PRINTD
                      (         OPS1.ASM):00182         ; ------
                      (         OPS1.ASM):00183         
                      (         OPS1.ASM):00184         ; Print short description of object "arg1"
                      (         OPS1.ASM):00185         
2C7C                  (         OPS1.ASM):00186         ZPRD:
2C7C 9603             (         OPS1.ASM):00187                 LDA     ARG1+1
                      (         OPS1.ASM):00188         
2C7E                  (         OPS1.ASM):00189         PRNTDC:
2C7E BD34D4           (         OPS1.ASM):00190                 JSR     OBJLOC
2C81 9E3F             (         OPS1.ASM):00191                 LDX     TEMP
2C83 EC07             (         OPS1.ASM):00192                 LDD     7,X
2C85 C30001           (         OPS1.ASM):00193                 ADDD    #1                                ; INCREMENT
2C88 DD3F             (         OPS1.ASM):00194                 STD     TEMP                              ; AND SAVE
2C8A BD3272           (         OPS1.ASM):00195                 JSR     SETWRD
2C8D 7E328A           (         OPS1.ASM):00196                 JMP     PZSTR
                      (         OPS1.ASM):00197         
                      (         OPS1.ASM):00198         ; ------
                      (         OPS1.ASM):00199         ; RETURN
                      (         OPS1.ASM):00200         ; ------
                      (         OPS1.ASM):00201         
                      (         OPS1.ASM):00202         ; Return from a CALL with value "arg1"
                      (         OPS1.ASM):00203         
2C90                  (         OPS1.ASM):00204         ZRET:
2C90 DE27             (         OPS1.ASM):00205                 LDU     OZSTAK                            ; STAY IN SYNC!
2C92 BD2A29           (         OPS1.ASM):00206                 JSR     POPSTK                            ; POP # LOCALS
2C95 D73D             (         OPS1.ASM):00207                 STB     VAL                               ; SAVE COUNT HERE
                      (         OPS1.ASM):00208         
2C97 43               (         OPS1.ASM):00209                 COMA                                      ; COMPLEMENT [A]
2C98 913D             (         OPS1.ASM):00210                 CMPA    VAL                               ; SHOULD BE OPPOSITE OF [B]
2C9A 2629             (         OPS1.ASM):00211                 BNE     RETERR                            ; IF NOT, STACK IS BAD (BM 11/24/84)
                      (         OPS1.ASM):00212         
2C9C 5D               (         OPS1.ASM):00213                 TSTB                                      ; CHECK # LOCALS
2C9D 270E             (         OPS1.ASM):00214                 BEQ     RET2                              ; SKIP IF NO LOCALS
                      (         OPS1.ASM):00215         
                      (         OPS1.ASM):00216         ; RESTORE LOCAL VARIABLES
                      (         OPS1.ASM):00217         
2C9F 8E2700           (         OPS1.ASM):00218                 LDX     #LOCALS                           ; SET UP A POINTER
2CA2 58               (         OPS1.ASM):00219                 ASLB                                      ; WORD-ALIGN THE INDEX
2CA3 3A               (         OPS1.ASM):00220                 ABX                                       ; [X] POINTS TO LAST LOCAL VAR
                      (         OPS1.ASM):00221         
2CA4                  (         OPS1.ASM):00222         RET1:
2CA4 BD2A29           (         OPS1.ASM):00223                 JSR     POPSTK                            ; POP A VALUE ([X] UNAFFECTED)
2CA7 ED83             (         OPS1.ASM):00224                 STD     ,--X                              ; SAVE IN [LOCALS], UPDATE INDEX
2CA9 0A3D             (         OPS1.ASM):00225                 DEC     VAL
2CAB 26F7             (         OPS1.ASM):00226                 BNE     RET1                              ; LOOP TILL ALL LOCALS POPPED
                      (         OPS1.ASM):00227         
                      (         OPS1.ASM):00228         ; RESTORE OTHER VARIABLES
                      (         OPS1.ASM):00229         
2CAD                  (         OPS1.ASM):00230         RET2:
2CAD BD2A29           (         OPS1.ASM):00231                 JSR     POPSTK
2CB0 DD13             (         OPS1.ASM):00232                 STD     ZPCH                              ; RESTORE TOP 9 BITS OF ZPC
2CB2 BD2A29           (         OPS1.ASM):00233                 JSR     POPSTK
2CB5 D715             (         OPS1.ASM):00234                 STB     ZPCL                              ; RESTORE LOWER 8 BITS OF ZPC
2CB7 BD2A29           (         OPS1.ASM):00235                 JSR     POPSTK
2CBA DD27             (         OPS1.ASM):00236                 STD     OZSTAK                            ; AND OLD ZSP
2CBC 0F18             (         OPS1.ASM):00237                 CLR     ZPCFLG                            ; PC NO LONGER VALID
                      (         OPS1.ASM):00238         
2CBE DC02             (         OPS1.ASM):00239                 LDD     ARG1
2CC0 DD3F             (         OPS1.ASM):00240                 STD     TEMP                              ; PASS THE RETURN VALUE
2CC2 7E29F6           (         OPS1.ASM):00241                 JMP     PUTVAL                            ; TO PUTVAL
                      (         OPS1.ASM):00242         
                      (         OPS1.ASM):00243         ; *** ERROR #15: Z-STACK DESTROYED ***
                      (         OPS1.ASM):00244         
2CC5                  (         OPS1.ASM):00245         RETERR:
2CC5 860F             (         OPS1.ASM):00246                 LDA     #15
2CC7 7E366C           (         OPS1.ASM):00247                 JMP     ZERROR
                      (         OPS1.ASM):00248         
                      (         OPS1.ASM):00249         ; ----
                      (         OPS1.ASM):00250         ; JUMP
                      (         OPS1.ASM):00251         ; ----
                      (         OPS1.ASM):00252         
                      (         OPS1.ASM):00253         ; Branch to location pointed to by 16-bit 2's-comp "arg1"
                      (         OPS1.ASM):00254         
2CCA                  (         OPS1.ASM):00255         ZJUMP:
2CCA DC02             (         OPS1.ASM):00256                 LDD     ARG1                              ; TREAT LIKE A BRANCH
2CCC 830001           (         OPS1.ASM):00257                 SUBD    #1                                ; THAT ALWAYS SUCCEEDS
2CCF DD3F             (         OPS1.ASM):00258                 STD     TEMP
2CD1 7E2A7E           (         OPS1.ASM):00259                 JMP     PREDB3
                      (         OPS1.ASM):00260         
                      (         OPS1.ASM):00261         ; -----
                      (         OPS1.ASM):00262         ; PRINT
                      (         OPS1.ASM):00263         ; -----
                      (         OPS1.ASM):00264         
                      (         OPS1.ASM):00265         ; Print the z-string pointed to by WORD-pointer "arg1"
                      (         OPS1.ASM):00266         
2CD4                  (         OPS1.ASM):00267         ZPRINT:
2CD4 DC02             (         OPS1.ASM):00268                 LDD     ARG1
2CD6 DD3F             (         OPS1.ASM):00269                 STD     TEMP                              ; TELL SETSTR
2CD8 BD327B           (         OPS1.ASM):00270                 JSR     SETSTR                            ; WHERE THE STRING RESIDES
2CDB 7E328A           (         OPS1.ASM):00271                 JMP     PZSTR                             ; AND PRINT IT
                      (         OPS1.ASM):00272         
                      (         OPS1.ASM):00273         ; -----
                      (         OPS1.ASM):00274         ; VALUE
                      (         OPS1.ASM):00275         ; -----
                      (         OPS1.ASM):00276         
                      (         OPS1.ASM):00277         ; Return value of arg1 [VALUE]
                      (         OPS1.ASM):00278         
2CDE                  (         OPS1.ASM):00279         ZVALUE:
2CDE 9603             (         OPS1.ASM):00280                 LDA     ARG1+1                            ; GRAB VARIABLE ID
2CE0 BD29BC           (         OPS1.ASM):00281                 JSR     VARGET                            ; FETCH ITS VALUE
2CE3 7E29F6           (         OPS1.ASM):00282                 JMP     PUTVAL                            ; AND RETURN IT
                      (         OPS1.ASM):00283         
                      (         OPS1.ASM):00284         ; ----
                      (         OPS1.ASM):00285         ; BCOM
                      (         OPS1.ASM):00286         ; ----
                      (         OPS1.ASM):00287         
                      (         OPS1.ASM):00288         ; Complement arg1 [VALUE]
                      (         OPS1.ASM):00289         
2CE6                  (         OPS1.ASM):00290         ZBCOM:
2CE6 DC02             (         OPS1.ASM):00291                 LDD     ARG1                              ; GRAB ARGUMENT
2CE8 43               (         OPS1.ASM):00292                 COMA                                      ; COMPLEMENT MSB
2CE9 53               (         OPS1.ASM):00293                 COMB                                      ; AND LSB
2CEA DD3F             (         OPS1.ASM):00294                 STD     TEMP                              ; AND PASS TO PUTVAL
2CEC 7E29F6           (         OPS1.ASM):00295                 JMP     PUTVAL
                      (     cubixzip.asm):00059                 INCLUDE OPS2.ASM
                      (         OPS2.ASM):00001         ;       PAGE
                      (         OPS2.ASM):00002         ;       SBTTL "--- 2-OPS ---"
                      (         OPS2.ASM):00003         
                      (         OPS2.ASM):00004         ; -----
                      (         OPS2.ASM):00005         ; LESS?
                      (         OPS2.ASM):00006         ; -----
                      (         OPS2.ASM):00007         
                      (         OPS2.ASM):00008         ; Is arg1 less than arg2? [PRED]
                      (         OPS2.ASM):00009         
2CEF                  (         OPS2.ASM):00010         ZLESS:
2CEF DC02             (         OPS2.ASM):00011                 LDD     ARG1
2CF1 DD3F             (         OPS2.ASM):00012                 STD     TEMP
2CF3 DC04             (         OPS2.ASM):00013                 LDD     ARG2
2CF5 DD3D             (         OPS2.ASM):00014                 STD     VAL
2CF7 201E             (         OPS2.ASM):00015                 BRA     CEXIT
                      (         OPS2.ASM):00016         
                      (         OPS2.ASM):00017         ; -----
                      (         OPS2.ASM):00018         ; GRTR?
                      (         OPS2.ASM):00019         ; -----
                      (         OPS2.ASM):00020         
                      (         OPS2.ASM):00021         ; Is arg1 greater than arg2? [PRED]
                      (         OPS2.ASM):00022         
2CF9                  (         OPS2.ASM):00023         ZGRTR:
2CF9 DC02             (         OPS2.ASM):00024                 LDD     ARG1
2CFB DD3D             (         OPS2.ASM):00025                 STD     VAL
2CFD DC04             (         OPS2.ASM):00026                 LDD     ARG2
2CFF DD3F             (         OPS2.ASM):00027                 STD     TEMP
2D01 2014             (         OPS2.ASM):00028                 BRA     CEXIT
                      (         OPS2.ASM):00029         
                      (         OPS2.ASM):00030         ; ------
                      (         OPS2.ASM):00031         ; DLESS?
                      (         OPS2.ASM):00032         ; ------
                      (         OPS2.ASM):00033         
                      (         OPS2.ASM):00034         ; Decrement variable "arg1"; succeed if new value
                      (         OPS2.ASM):00035         ; is less than arg2 [PRED]
                      (         OPS2.ASM):00036         
2D03                  (         OPS2.ASM):00037         ZDLESS:
2D03 BD2C26           (         OPS2.ASM):00038                 JSR     ZDEC                              ; DECREMENT THE VARIABLE
2D06 DC04             (         OPS2.ASM):00039                 LDD     ARG2
2D08 DD3D             (         OPS2.ASM):00040                 STD     VAL
2D0A 200B             (         OPS2.ASM):00041                 BRA     CEXIT                             ; AND COMPARE
                      (         OPS2.ASM):00042         
                      (         OPS2.ASM):00043         ; ------
                      (         OPS2.ASM):00044         ; IGRTR?
                      (         OPS2.ASM):00045         ; ------
                      (         OPS2.ASM):00046         
                      (         OPS2.ASM):00047         ; Increment variable "arg1"; succeed if new value is
                      (         OPS2.ASM):00048         ; greater than arg2 [PRED]
                      (         OPS2.ASM):00049         
2D0C                  (         OPS2.ASM):00050         ZIGRTR:
2D0C BD2C0E           (         OPS2.ASM):00051                 JSR     ZINC                              ; INCREMENT THE VARIABLE
2D0F DC3F             (         OPS2.ASM):00052                 LDD     TEMP
2D11 DD3D             (         OPS2.ASM):00053                 STD     VAL
2D13 DC04             (         OPS2.ASM):00054                 LDD     ARG2
2D15 DD3F             (         OPS2.ASM):00055                 STD     TEMP
                      (         OPS2.ASM):00056         
2D17                  (         OPS2.ASM):00057         CEXIT:
2D17 8D05             (         OPS2.ASM):00058                 BSR     SCOMP
2D19 2521             (         OPS2.ASM):00059                 BLO     POK
2D1B                  (         OPS2.ASM):00060         PBAD:
2D1B 7E2A3E           (         OPS2.ASM):00061                 JMP     PREDF
                      (         OPS2.ASM):00062         
                      (         OPS2.ASM):00063         ; -----------------
                      (         OPS2.ASM):00064         ; SIGNED COMPARISON
                      (         OPS2.ASM):00065         ; -----------------
                      (         OPS2.ASM):00066         
2D1E                  (         OPS2.ASM):00067         SCOMP:
2D1E 963D             (         OPS2.ASM):00068                 LDA     VAL                               ; ARE ARGUMENTS
2D20 983F             (         OPS2.ASM):00069                 EORA    TEMP                              ; SIGNED THE SAME?
2D22 2A05             (         OPS2.ASM):00070                 BPL     SCMP                              ; YES, DO ORDINARY COMPARE
2D24 963D             (         OPS2.ASM):00071                 LDA     VAL                               ; ELSE COMPARE
2D26 913F             (         OPS2.ASM):00072                 CMPA    TEMP                              ; ONLY THE HIGH BYTES
2D28 39               (         OPS2.ASM):00073                 RTS
                      (         OPS2.ASM):00074         
2D29                  (         OPS2.ASM):00075         SCMP:
2D29 DC3F             (         OPS2.ASM):00076                 LDD     TEMP
2D2B 10933D           (         OPS2.ASM):00077                 CMPD    VAL
2D2E 39               (         OPS2.ASM):00078                 RTS
                      (         OPS2.ASM):00079         
                      (         OPS2.ASM):00080         ; ---
                      (         OPS2.ASM):00081         ; IN?
                      (         OPS2.ASM):00082         ; ---
                      (         OPS2.ASM):00083         
                      (         OPS2.ASM):00084         ; Is object "arg1" contained in object "arg2?" [PRED]
                      (         OPS2.ASM):00085         
2D2F                  (         OPS2.ASM):00086         ZIN:
2D2F 9603             (         OPS2.ASM):00087                 LDA     ARG1+1
2D31 BD34D4           (         OPS2.ASM):00088                 JSR     OBJLOC
2D34 9E3F             (         OPS2.ASM):00089                 LDX     TEMP
2D36 9605             (         OPS2.ASM):00090                 LDA     ARG2+1
2D38 A104             (         OPS2.ASM):00091                 CMPA    4,X
2D3A 26DF             (         OPS2.ASM):00092                 BNE     PBAD
2D3C                  (         OPS2.ASM):00093         POK:
2D3C 7E2A4C           (         OPS2.ASM):00094                 JMP     PREDS
                      (         OPS2.ASM):00095         
                      (         OPS2.ASM):00096         ; ----
                      (         OPS2.ASM):00097         ; BTST
                      (         OPS2.ASM):00098         ; ----
                      (         OPS2.ASM):00099         
                      (         OPS2.ASM):00100         ; Is every "on" bit in arg1 also "on" in arg2? [PRED]
                      (         OPS2.ASM):00101         
2D3F                  (         OPS2.ASM):00102         ZBTST:
2D3F DC04             (         OPS2.ASM):00103                 LDD     ARG2
2D41 9402             (         OPS2.ASM):00104                 ANDA    ARG1
2D43 D403             (         OPS2.ASM):00105                 ANDB    ARG1+1
2D45 109304           (         OPS2.ASM):00106                 CMPD    ARG2
2D48 27F2             (         OPS2.ASM):00107                 BEQ     POK
2D4A 20CF             (         OPS2.ASM):00108                 BRA     PBAD
                      (         OPS2.ASM):00109         
                      (         OPS2.ASM):00110         ; ---
                      (         OPS2.ASM):00111         ; BOR
                      (         OPS2.ASM):00112         ; ---
                      (         OPS2.ASM):00113         
                      (         OPS2.ASM):00114         ; Return bitwise OR of arg1 and arg2 [VALUE]
                      (         OPS2.ASM):00115         
2D4C                  (         OPS2.ASM):00116         ZBOR:
2D4C DC02             (         OPS2.ASM):00117                 LDD     ARG1
2D4E 9A04             (         OPS2.ASM):00118                 ORA     ARG2
2D50 DA05             (         OPS2.ASM):00119                 ORB     ARG2+1
2D52                  (         OPS2.ASM):00120         ZB0:
2D52 DD3F             (         OPS2.ASM):00121                 STD     TEMP
2D54 7E29F6           (         OPS2.ASM):00122                 JMP     PUTVAL
                      (         OPS2.ASM):00123         
                      (         OPS2.ASM):00124         ; ----
                      (         OPS2.ASM):00125         ; BAND
                      (         OPS2.ASM):00126         ; ----
                      (         OPS2.ASM):00127         
                      (         OPS2.ASM):00128         ; Return bitwise AND of arg1 and arg2 [VALUE]
                      (         OPS2.ASM):00129         
2D57                  (         OPS2.ASM):00130         ZBAND:
2D57 DC02             (         OPS2.ASM):00131                 LDD     ARG1
2D59 9404             (         OPS2.ASM):00132                 ANDA    ARG2
2D5B D405             (         OPS2.ASM):00133                 ANDB    ARG2+1
2D5D 20F3             (         OPS2.ASM):00134                 BRA     ZB0
                      (         OPS2.ASM):00135         
                      (         OPS2.ASM):00136         ; -----
                      (         OPS2.ASM):00137         ; FSET?
                      (         OPS2.ASM):00138         ; -----
                      (         OPS2.ASM):00139         
                      (         OPS2.ASM):00140         ; Is flag "arg2" set in object "arg1?" [PRED]
                      (         OPS2.ASM):00141         
2D5F                  (         OPS2.ASM):00142         ZFSETP:
2D5F BD34A6           (         OPS2.ASM):00143                 JSR     FLAGSU                            ; GET BIT
2D62 DC3D             (         OPS2.ASM):00144                 LDD     VAL
2D64 9443             (         OPS2.ASM):00145                 ANDA    MASK
2D66 973D             (         OPS2.ASM):00146                 STA     VAL
2D68 D444             (         OPS2.ASM):00147                 ANDB    MASK+1
2D6A DA3D             (         OPS2.ASM):00148                 ORB     VAL
2D6C 26CE             (         OPS2.ASM):00149                 BNE     POK                               ; BIT IS ON
2D6E 20AB             (         OPS2.ASM):00150                 BRA     PBAD
                      (         OPS2.ASM):00151         
                      (         OPS2.ASM):00152         ; ----
                      (         OPS2.ASM):00153         ; FSET
                      (         OPS2.ASM):00154         ; ----
                      (         OPS2.ASM):00155         
                      (         OPS2.ASM):00156         ; Set flag "arg2" in object "arg1"
                      (         OPS2.ASM):00157         
2D70                  (         OPS2.ASM):00158         ZFSET:
2D70 BD34A6           (         OPS2.ASM):00159                 JSR     FLAGSU
2D73 9E3F             (         OPS2.ASM):00160                 LDX     TEMP                              ; ADDRESS OF FLAGS
2D75 DC3D             (         OPS2.ASM):00161                 LDD     VAL                               ; GRAB FLAGS
2D77 9A43             (         OPS2.ASM):00162                 ORA     MASK                              ; SUPERIMPOSE THE
2D79 DA44             (         OPS2.ASM):00163                 ORB     MASK+1                            ; MASKING PATTERN
2D7B ED84             (         OPS2.ASM):00164                 STD     ,X                                ; AND REPLACE FLAG
2D7D 39               (         OPS2.ASM):00165                 RTS
                      (         OPS2.ASM):00166         
                      (         OPS2.ASM):00167         ; ------
                      (         OPS2.ASM):00168         ; FCLEAR
                      (         OPS2.ASM):00169         ; ------
                      (         OPS2.ASM):00170         
                      (         OPS2.ASM):00171         ; Clear flag "arg2" in object "arg1"
                      (         OPS2.ASM):00172         
2D7E                  (         OPS2.ASM):00173         ZFCLR:
2D7E BD34A6           (         OPS2.ASM):00174                 JSR     FLAGSU
2D81 9E3F             (         OPS2.ASM):00175                 LDX     TEMP                              ; ADDRESS OF OBJECT
2D83 DC43             (         OPS2.ASM):00176                 LDD     MASK                              ; GRAB THE MASK
2D85 43               (         OPS2.ASM):00177                 COMA                                      ; COMPLEMENT IT
2D86 53               (         OPS2.ASM):00178                 COMB
2D87 943D             (         OPS2.ASM):00179                 ANDA    VAL                               ; SUPERIMPOSE FLAGS
2D89 D43E             (         OPS2.ASM):00180                 ANDB    VAL+1                             ; TO MASK OUT TARGET
2D8B ED84             (         OPS2.ASM):00181                 STD     ,X                                ; REPLACE THE FLAGS
2D8D 39               (         OPS2.ASM):00182                 RTS
                      (         OPS2.ASM):00183         
                      (         OPS2.ASM):00184         ; ---
                      (         OPS2.ASM):00185         ; SET
                      (         OPS2.ASM):00186         ; ---
                      (         OPS2.ASM):00187         
                      (         OPS2.ASM):00188         ; Set variable "arg1" equal to value "arg2"
                      (         OPS2.ASM):00189         
2D8E                  (         OPS2.ASM):00190         ZSET:
2D8E DC04             (         OPS2.ASM):00191                 LDD     ARG2
2D90 DD3F             (         OPS2.ASM):00192                 STD     TEMP
2D92 9603             (         OPS2.ASM):00193                 LDA     ARG1+1
2D94 7E29E4           (         OPS2.ASM):00194                 JMP     VARPUT
                      (         OPS2.ASM):00195         
                      (         OPS2.ASM):00196         ; ----
                      (         OPS2.ASM):00197         ; MOVE
                      (         OPS2.ASM):00198         ; ----
                      (         OPS2.ASM):00199         
                      (         OPS2.ASM):00200         ; Put object "arg1" into object "arg2"
                      (         OPS2.ASM):00201         
2D97                  (         OPS2.ASM):00202         ZMOVE:
2D97 BD2C3C           (         OPS2.ASM):00203                 JSR     ZREMOV                            ; REMOVE OBJECT FIRST
2D9A 9603             (         OPS2.ASM):00204                 LDA     ARG1+1
2D9C BD34D4           (         OPS2.ASM):00205                 JSR     OBJLOC                            ; GET ADDRESS OF OBJECT
2D9F 9E3F             (         OPS2.ASM):00206                 LDX     TEMP                              ; PUT ADDRESS IN X
2DA1 3410             (         OPS2.ASM):00207                 PSHS    X                                 ; SAVE IT HERE TOO
2DA3 9605             (         OPS2.ASM):00208                 LDA     ARG2+1
2DA5 A704             (         OPS2.ASM):00209                 STA     4,X
                      (         OPS2.ASM):00210         
2DA7 BD34D4           (         OPS2.ASM):00211                 JSR     OBJLOC
2DAA 9E3F             (         OPS2.ASM):00212                 LDX     TEMP
2DAC A606             (         OPS2.ASM):00213                 LDA     6,X
2DAE 973D             (         OPS2.ASM):00214                 STA     VAL                               ; HOLD HERE FOR A MOMENT
2DB0 9603             (         OPS2.ASM):00215                 LDA     ARG1+1
2DB2 A706             (         OPS2.ASM):00216                 STA     6,X
2DB4 3510             (         OPS2.ASM):00217                 PULS    X                                 ; RESTORE OLD [TEMP]
2DB6 963D             (         OPS2.ASM):00218                 LDA     VAL
2DB8 2702             (         OPS2.ASM):00219                 BEQ     ZMVEX
2DBA A705             (         OPS2.ASM):00220                 STA     5,X
2DBC                  (         OPS2.ASM):00221         ZMVEX:
2DBC 39               (         OPS2.ASM):00222                 RTS
                      (         OPS2.ASM):00223         
                      (         OPS2.ASM):00224         ; ---
                      (         OPS2.ASM):00225         ; GET
                      (         OPS2.ASM):00226         ; ---
                      (         OPS2.ASM):00227         
                      (         OPS2.ASM):00228         ; Return value of item "arg2" in WORD-table at "arg1" [VALUE]
                      (         OPS2.ASM):00229         
2DBD                  (         OPS2.ASM):00230         ZGET:
2DBD 0805             (         OPS2.ASM):00231                 ASL     ARG2+1
2DBF 0904             (         OPS2.ASM):00232                 ROL     ARG2                              ; WORD-ALIGN ARG2
2DC1 DC04             (         OPS2.ASM):00233                 LDD     ARG2
2DC3 D302             (         OPS2.ASM):00234                 ADDD    ARG1                              ; ADD OFFSET TO TABLE ADDRESS
2DC5 DD3F             (         OPS2.ASM):00235                 STD     TEMP
2DC7 BD3272           (         OPS2.ASM):00236                 JSR     SETWRD
2DCA BD3185           (         OPS2.ASM):00237                 JSR     GETWRD
2DCD 7E29F6           (         OPS2.ASM):00238                 JMP     PUTVAL
                      (         OPS2.ASM):00239         
                      (         OPS2.ASM):00240         ; ----
                      (         OPS2.ASM):00241         ; GETB
                      (         OPS2.ASM):00242         ; ----
                      (         OPS2.ASM):00243         
                      (         OPS2.ASM):00244         ; Return value of item "arg2" in BYTE-table at "arg1" [VALUE]
                      (         OPS2.ASM):00245         
2DD0                  (         OPS2.ASM):00246         ZGETB:
2DD0 DC02             (         OPS2.ASM):00247                 LDD     ARG1
2DD2 D304             (         OPS2.ASM):00248                 ADDD    ARG2
2DD4 DD3F             (         OPS2.ASM):00249                 STD     TEMP
2DD6 BD3272           (         OPS2.ASM):00250                 JSR     SETWRD
2DD9 BD31BF           (         OPS2.ASM):00251                 JSR     GETBYT
2DDC 9740             (         OPS2.ASM):00252                 STA     TEMP+1
2DDE 0F3F             (         OPS2.ASM):00253                 CLR     TEMP
2DE0 7E29F6           (         OPS2.ASM):00254                 JMP     PUTVAL
                      (         OPS2.ASM):00255         
                      (         OPS2.ASM):00256         ; ----
                      (         OPS2.ASM):00257         ; GETP
                      (         OPS2.ASM):00258         ; ----
                      (         OPS2.ASM):00259         
                      (         OPS2.ASM):00260         ; Return prop "arg2" of object "arg1"; if specified prop
                      (         OPS2.ASM):00261         ; doesn't exist, return prop'th element of default object [VALUE]
                      (         OPS2.ASM):00262         
2DE3                  (         OPS2.ASM):00263         ZGETP:
2DE3 BD3471           (         OPS2.ASM):00264                 JSR     PROPB                             ; GET POINTER TO PROPS
2DE6                  (         OPS2.ASM):00265         GETP1:
2DE6 BD3486           (         OPS2.ASM):00266                 JSR     PROPN
2DE9 9105             (         OPS2.ASM):00267                 CMPA    ARG2+1
2DEB 2718             (         OPS2.ASM):00268                 BEQ     GETP2
2DED 2505             (         OPS2.ASM):00269                 BLO     GETP3
                      (         OPS2.ASM):00270         
2DEF BD349B           (         OPS2.ASM):00271                 JSR     PROPNX
2DF2 20F2             (         OPS2.ASM):00272                 BRA     GETP1                             ; TRY AGAIN WITH NEXT PROP
                      (         OPS2.ASM):00273         
2DF4                  (         OPS2.ASM):00274         GETP3:
2DF4 FC3F0A           (         OPS2.ASM):00275                 LDD     ZCODE+ZOBJEC                      ; Z-ADDR OF OBJECT TABLE
2DF7 C33F00           (         OPS2.ASM):00276                 ADDD    #ZCODE                            ; FORM THE ABSOLUTE ADDRESS
2DFA 1F01             (         OPS2.ASM):00277                 TFR     D,X                               ; USE AS AN INDEX
2DFC D605             (         OPS2.ASM):00278                 LDB     ARG2+1                            ; GET PROPERTY #
2DFE 5A               (         OPS2.ASM):00279                 DECB
2DFF 58               (         OPS2.ASM):00280                 ASLB
2E00 3A               (         OPS2.ASM):00281                 ABX                                       ; ADD TO TABLE ADDRESS
2E01 EC84             (         OPS2.ASM):00282                 LDD     ,X                                ; FETCH THE PROPERTY
2E03 201D             (         OPS2.ASM):00283                 BRA     ETPEX                             ; AND PASS IT ON
                      (         OPS2.ASM):00284         
2E05                  (         OPS2.ASM):00285         GETP2:
2E05 BD348E           (         OPS2.ASM):00286                 JSR     PROPL
2E08 5C               (         OPS2.ASM):00287                 INCB                                      ; SOMETHING SHOULD BE IN B!
2E09 4D               (         OPS2.ASM):00288                 TSTA                                      ; AND IN A!
2E0A 2710             (         OPS2.ASM):00289                 BEQ     GETP2A
2E0C 8101             (         OPS2.ASM):00290                 CMPA    #1
2E0E 2705             (         OPS2.ASM):00291                 BEQ     GETP2B
                      (         OPS2.ASM):00292         
                      (         OPS2.ASM):00293         ; *** ERROR #7: PROPERTY LENGTH ***
                      (         OPS2.ASM):00294         
2E10 8607             (         OPS2.ASM):00295                 LDA     #7
2E12 BD366C           (         OPS2.ASM):00296                 JSR     ZERROR
                      (         OPS2.ASM):00297         
2E15                  (         OPS2.ASM):00298         GETP2B:
2E15 9E3F             (         OPS2.ASM):00299                 LDX     TEMP
2E17 3A               (         OPS2.ASM):00300                 ABX
2E18 EC84             (         OPS2.ASM):00301                 LDD     ,X
2E1A 2006             (         OPS2.ASM):00302                 BRA     ETPEX
                      (         OPS2.ASM):00303         
2E1C                  (         OPS2.ASM):00304         GETP2A:
2E1C 9E3F             (         OPS2.ASM):00305                 LDX     TEMP
2E1E 3A               (         OPS2.ASM):00306                 ABX
2E1F E684             (         OPS2.ASM):00307                 LDB     ,X
2E21 4F               (         OPS2.ASM):00308                 CLRA
2E22                  (         OPS2.ASM):00309         ETPEX:
2E22 DD3F             (         OPS2.ASM):00310                 STD     TEMP
2E24 7E29F6           (         OPS2.ASM):00311                 JMP     PUTVAL
                      (         OPS2.ASM):00312         
                      (         OPS2.ASM):00313         ; -----
                      (         OPS2.ASM):00314         ; GETPT
                      (         OPS2.ASM):00315         ; -----
                      (         OPS2.ASM):00316         
                      (         OPS2.ASM):00317         ; Return a POINTER to prop table "arg2" in object "arg1" [VALUE]
                      (         OPS2.ASM):00318         
2E27                  (         OPS2.ASM):00319         ZGETPT:
2E27 BD3471           (         OPS2.ASM):00320                 JSR     PROPB
2E2A                  (         OPS2.ASM):00321         GETPT1:
2E2A BD3486           (         OPS2.ASM):00322                 JSR     PROPN
2E2D 9105             (         OPS2.ASM):00323                 CMPA    ARG2+1
2E2F 2709             (         OPS2.ASM):00324                 BEQ     GETPT2
2E31 1025FBBC         (         OPS2.ASM):00325                 LBLO    RET0
2E35 BD349B           (         OPS2.ASM):00326                 JSR     PROPNX                            ; TRY NEXT ENTRY
2E38 20F0             (         OPS2.ASM):00327                 BRA     GETPT1
                      (         OPS2.ASM):00328         
2E3A                  (         OPS2.ASM):00329         GETPT2:
2E3A 0C40             (         OPS2.ASM):00330                 INC     TEMP+1
2E3C 2602             (         OPS2.ASM):00331                 BNE     GPT
2E3E 0C3F             (         OPS2.ASM):00332                 INC     TEMP
2E40                  (         OPS2.ASM):00333         GPT:
2E40 4F               (         OPS2.ASM):00334                 CLRA                                      ; ADD OFFSET IN [B]
2E41 D33F             (         OPS2.ASM):00335                 ADDD    TEMP
2E43 833F00           (         OPS2.ASM):00336                 SUBD    #ZCODE                            ; CHANGE TO RELATIVE POINTER
2E46 DD3F             (         OPS2.ASM):00337                 STD     TEMP
2E48 7E29F6           (         OPS2.ASM):00338                 JMP     PUTVAL
                      (         OPS2.ASM):00339         
                      (         OPS2.ASM):00340         ; -----
                      (         OPS2.ASM):00341         ; NEXTP
                      (         OPS2.ASM):00342         ; -----
                      (         OPS2.ASM):00343         
                      (         OPS2.ASM):00344         ; Return prop index number of the prop following prop "arg2"
                      (         OPS2.ASM):00345         ; in object "arg1"; return zero if last property; return
                      (         OPS2.ASM):00346         ; 1st prop # if arg2=0; error if no prop "arg2" in "arg1" [VALUE]
                      (         OPS2.ASM):00347         
2E4B                  (         OPS2.ASM):00348         ZNEXTP:
2E4B BD3471           (         OPS2.ASM):00349                 JSR     PROPB
2E4E 9605             (         OPS2.ASM):00350                 LDA     ARG2+1
2E50 2713             (         OPS2.ASM):00351                 BEQ     NXTP2
                      (         OPS2.ASM):00352         
2E52                  (         OPS2.ASM):00353         NXTP1:
2E52 BD3486           (         OPS2.ASM):00354                 JSR     PROPN
2E55 9105             (         OPS2.ASM):00355                 CMPA    ARG2+1
2E57 2709             (         OPS2.ASM):00356                 BEQ     NXTP3
2E59 1025FB94         (         OPS2.ASM):00357                 LBCS    RET0
2E5D BD349B           (         OPS2.ASM):00358                 JSR     PROPNX                            ; TRY NEXT ENTRY
2E60 20F0             (         OPS2.ASM):00359                 BRA     NXTP1
                      (         OPS2.ASM):00360         
2E62                  (         OPS2.ASM):00361         NXTP3:
2E62 BD349B           (         OPS2.ASM):00362                 JSR     PROPNX
                      (         OPS2.ASM):00363         
2E65                  (         OPS2.ASM):00364         NXTP2:
2E65 BD3486           (         OPS2.ASM):00365                 JSR     PROPN
2E68 7E29F2           (         OPS2.ASM):00366                 JMP     PUTBYT
                      (         OPS2.ASM):00367         
                      (         OPS2.ASM):00368         ; ---
                      (         OPS2.ASM):00369         ; ADD
                      (         OPS2.ASM):00370         ; ---
                      (         OPS2.ASM):00371         
                      (         OPS2.ASM):00372         ; Return (arg1+arg2) [VALUE]
                      (         OPS2.ASM):00373         
2E6B                  (         OPS2.ASM):00374         ZADD:
2E6B DC02             (         OPS2.ASM):00375                 LDD     ARG1
2E6D D304             (         OPS2.ASM):00376                 ADDD    ARG2
2E6F                  (         OPS2.ASM):00377         MATH:
2E6F DD3F             (         OPS2.ASM):00378                 STD     TEMP
2E71 7E29F6           (         OPS2.ASM):00379                 JMP     PUTVAL
                      (         OPS2.ASM):00380         
                      (         OPS2.ASM):00381         ; ---
                      (         OPS2.ASM):00382         ; SUB
                      (         OPS2.ASM):00383         ; ---
                      (         OPS2.ASM):00384         
                      (         OPS2.ASM):00385         ; Return (arg1-arg2) [VALUE]
                      (         OPS2.ASM):00386         
2E74                  (         OPS2.ASM):00387         ZSUB:
2E74 DC02             (         OPS2.ASM):00388                 LDD     ARG1
2E76 9304             (         OPS2.ASM):00389                 SUBD    ARG2
2E78 20F5             (         OPS2.ASM):00390                 BRA     MATH
                      (         OPS2.ASM):00391         
                      (         OPS2.ASM):00392         ; ---
                      (         OPS2.ASM):00393         ; MUL
                      (         OPS2.ASM):00394         ; ---
                      (         OPS2.ASM):00395         
                      (         OPS2.ASM):00396         ; Return (arg1*arg2) [VALUE]
                      (         OPS2.ASM):00397         
2E7A                  (         OPS2.ASM):00398         ZMUL:
2E7A 8E0011           (         OPS2.ASM):00399                 LDX     #17                               ; INIT LOOP INDEX
2E7D 4F               (         OPS2.ASM):00400                 CLRA                                      ; CLEAR THE
2E7E 5F               (         OPS2.ASM):00401                 CLRB                                      ; CARRY
2E7F DD47             (         OPS2.ASM):00402                 STD     MTEMP                             ; AND TEMP REGISTER
                      (         OPS2.ASM):00403         
2E81                  (         OPS2.ASM):00404         ZMLOOP:
2E81 0647             (         OPS2.ASM):00405                 ROR     MTEMP
2E83 0648             (         OPS2.ASM):00406                 ROR     MTEMP+1
2E85 0604             (         OPS2.ASM):00407                 ROR     ARG2                              ; SHIFT A BIT
2E87 0605             (         OPS2.ASM):00408                 ROR     ARG2+1                            ; INTO POSITION
2E89 2406             (         OPS2.ASM):00409                 BCC     ZMNEXT                            ; NO ADDITION IF BIT CLEAR
                      (         OPS2.ASM):00410         
2E8B DC02             (         OPS2.ASM):00411                 LDD     ARG1
2E8D D347             (         OPS2.ASM):00412                 ADDD    MTEMP
2E8F DD47             (         OPS2.ASM):00413                 STD     MTEMP
                      (         OPS2.ASM):00414         
2E91                  (         OPS2.ASM):00415         ZMNEXT:
2E91 301F             (         OPS2.ASM):00416                 LEAX    -1,X                              ; ALL BITS EXAMINED?
2E93 26EC             (         OPS2.ASM):00417                 BNE     ZMLOOP                            ; NO, KEEP SHIFTING
                      (         OPS2.ASM):00418         
2E95 DC04             (         OPS2.ASM):00419                 LDD     ARG2                              ; ELSE GRAB PRODUCT
2E97 20D6             (         OPS2.ASM):00420                 BRA     MATH                              ; AND RETURN
                      (         OPS2.ASM):00421         
                      (         OPS2.ASM):00422         ; ---------
                      (         OPS2.ASM):00423         ; DIV & MOD
                      (         OPS2.ASM):00424         ; ---------
                      (         OPS2.ASM):00425         
                      (         OPS2.ASM):00426         ; DIV: Return quotient of int(arg1/arg2) [VALUE]
                      (         OPS2.ASM):00427         ; MOD: Return remainder of int(arg1/arg2) [VALUE]
                      (         OPS2.ASM):00428         
2E99                  (         OPS2.ASM):00429         ZDIV:
2E99 8D09             (         OPS2.ASM):00430                 BSR     DVINIT
2E9B 7E29F6           (         OPS2.ASM):00431                 JMP     PUTVAL                            ; AND SHIP OUT [TEMP]
                      (         OPS2.ASM):00432         
2E9E                  (         OPS2.ASM):00433         ZMOD:
2E9E 8D04             (         OPS2.ASM):00434                 BSR     DVINIT
2EA0 DC3D             (         OPS2.ASM):00435                 LDD     VAL                               ; RETURN THE
2EA2 20CB             (         OPS2.ASM):00436                 BRA     MATH                              ; REMAINDER IN [VAL]
                      (         OPS2.ASM):00437         
                      (         OPS2.ASM):00438         ; -----------
                      (         OPS2.ASM):00439         ; DIVIDE INIT
                      (         OPS2.ASM):00440         ; -----------
                      (         OPS2.ASM):00441         
2EA4                  (         OPS2.ASM):00442         DVINIT:
2EA4 DC02             (         OPS2.ASM):00443                 LDD     ARG1
2EA6 DD3F             (         OPS2.ASM):00444                 STD     TEMP
2EA8 DC04             (         OPS2.ASM):00445                 LDD     ARG2
2EAA DD3D             (         OPS2.ASM):00446                 STD     VAL
                      (         OPS2.ASM):00447         
                      (         OPS2.ASM):00448         ; FALL THROUGH ...
                      (         OPS2.ASM):00449         
                      (         OPS2.ASM):00450         ; ---------------
                      (         OPS2.ASM):00451         ; SIGNED DIVISION
                      (         OPS2.ASM):00452         ; ---------------
                      (         OPS2.ASM):00453         
                      (         OPS2.ASM):00454         ; ENTRY: DIVIDEND IN [TEMP], DIVISOR IN [VAL]
                      (         OPS2.ASM):00455         ; EXIT: QUOTIENT IN [TEMP], REMAINDER IN [VAL]
                      (         OPS2.ASM):00456         
2EAC                  (         OPS2.ASM):00457         DIVIDE:
2EAC 963F             (         OPS2.ASM):00458                 LDA     TEMP                              ; SIGN OF REMAINDER
2EAE 9746             (         OPS2.ASM):00459                 STA     SREM                              ; IS ALWAYS SIGN OF DIVIDEND
2EB0 983D             (         OPS2.ASM):00460                 EORA    VAL                               ; SIGN OF QUOTIENT IS POSITIVE
2EB2 9745             (         OPS2.ASM):00461                 STA     SQUOT                             ; IF SIGNS OF TERMS ARE THE SAME
                      (         OPS2.ASM):00462         
2EB4 0D3F             (         OPS2.ASM):00463                 TST     TEMP                              ; IF DIVIDEND IS NEGATIVE,
2EB6 2A02             (         OPS2.ASM):00464                 BPL     TABS                              ; CALC ABSOLUTE VALUE
2EB8 8D19             (         OPS2.ASM):00465                 BSR     ABTEMP
                      (         OPS2.ASM):00466         
2EBA                  (         OPS2.ASM):00467         TABS:
2EBA 0D3D             (         OPS2.ASM):00468                 TST     VAL                               ; IF DIVISOR IS NEGATIVE,
2EBC 2A02             (         OPS2.ASM):00469                 BPL     DOUDIV                            ; DO THE SAME
2EBE 8D0C             (         OPS2.ASM):00470                 BSR     ABSVAL
                      (         OPS2.ASM):00471         
2EC0                  (         OPS2.ASM):00472         DOUDIV:
2EC0 8D18             (         OPS2.ASM):00473                 BSR     UDIV                              ; UNSIGNED DIVIDE
                      (         OPS2.ASM):00474         
2EC2 0D45             (         OPS2.ASM):00475                 TST     SQUOT
2EC4 2A02             (         OPS2.ASM):00476                 BPL     RFLIP
2EC6 8D0B             (         OPS2.ASM):00477                 BSR     ABTEMP
                      (         OPS2.ASM):00478         
2EC8                  (         OPS2.ASM):00479         RFLIP:
2EC8 0D46             (         OPS2.ASM):00480                 TST     SREM
2ECA 2A06             (         OPS2.ASM):00481                 BPL     DIVEX
                      (         OPS2.ASM):00482         
                      (         OPS2.ASM):00483         ; FALL THROUGH ...
                      (         OPS2.ASM):00484         
                      (         OPS2.ASM):00485         ; -------------
                      (         OPS2.ASM):00486         ; CALC ABS(VAL)
                      (         OPS2.ASM):00487         ; -------------
                      (         OPS2.ASM):00488         
2ECC                  (         OPS2.ASM):00489         ABSVAL:
2ECC 4F               (         OPS2.ASM):00490                 CLRA
2ECD 5F               (         OPS2.ASM):00491                 CLRB
2ECE 933D             (         OPS2.ASM):00492                 SUBD    VAL
2ED0 DD3D             (         OPS2.ASM):00493                 STD     VAL
                      (         OPS2.ASM):00494         
2ED2                  (         OPS2.ASM):00495         DIVEX:
2ED2 39               (         OPS2.ASM):00496                 RTS
                      (         OPS2.ASM):00497         
                      (         OPS2.ASM):00498         ; --------------
                      (         OPS2.ASM):00499         ; CALC ABS(TEMP)
                      (         OPS2.ASM):00500         ; --------------
                      (         OPS2.ASM):00501         
2ED3                  (         OPS2.ASM):00502         ABTEMP:
2ED3 4F               (         OPS2.ASM):00503                 CLRA
2ED4 5F               (         OPS2.ASM):00504                 CLRB
2ED5 933F             (         OPS2.ASM):00505                 SUBD    TEMP
2ED7 DD3F             (         OPS2.ASM):00506                 STD     TEMP
2ED9 39               (         OPS2.ASM):00507                 RTS
                      (         OPS2.ASM):00508         
                      (         OPS2.ASM):00509         ; -----------------
                      (         OPS2.ASM):00510         ; UNSIGNED DIVISION
                      (         OPS2.ASM):00511         ; -----------------
                      (         OPS2.ASM):00512         
                      (         OPS2.ASM):00513         ; ENTRY: DIVIDEND IN [TEMP], DIVISOR IN [VAL]
                      (         OPS2.ASM):00514         ; EXIT: QUOTIENT IN [TEMP], REMAINDER IN [VAL]
                      (         OPS2.ASM):00515         
2EDA                  (         OPS2.ASM):00516         UDIV:
2EDA DC3D             (         OPS2.ASM):00517                 LDD     VAL
2EDC 2728             (         OPS2.ASM):00518                 BEQ     DIVERR                            ; CAN'T DIVIDE BY ZERO!
                      (         OPS2.ASM):00519         
2EDE 8E0010           (         OPS2.ASM):00520                 LDX     #16                               ; INIT LOOP INDEX
2EE1 4F               (         OPS2.ASM):00521                 CLRA                                      ; CLEAR THE
2EE2 5F               (         OPS2.ASM):00522                 CLRB                                      ; CARRY
2EE3 DD47             (         OPS2.ASM):00523                 STD     MTEMP                             ; AND HI-DIVIDEND REGISTER
                      (         OPS2.ASM):00524         
2EE5                  (         OPS2.ASM):00525         UDLOOP:
2EE5 0940             (         OPS2.ASM):00526                 ROL     TEMP+1
2EE7 093F             (         OPS2.ASM):00527                 ROL     TEMP
2EE9 0948             (         OPS2.ASM):00528                 ROL     MTEMP+1
2EEB 0947             (         OPS2.ASM):00529                 ROL     MTEMP
                      (         OPS2.ASM):00530         
2EED DC47             (         OPS2.ASM):00531                 LDD     MTEMP                             ; IS DIVIDEND < DIVISOR?
2EEF 933D             (         OPS2.ASM):00532                 SUBD    VAL
2EF1 2505             (         OPS2.ASM):00533                 BCS     UDNEXT                            ; YES, CLEAR THE CARRY AND LOOP
2EF3 DD47             (         OPS2.ASM):00534                 STD     MTEMP                             ; ELSE UPDATE DIVIDEND
2EF5 43               (         OPS2.ASM):00535                 COMA                                      ; SET THE CARRY
2EF6 2001             (         OPS2.ASM):00536                 BRA     DECX                              ; AND LOOP
                      (         OPS2.ASM):00537         
2EF8                  (         OPS2.ASM):00538         UDNEXT:
2EF8 4F               (         OPS2.ASM):00539                 CLRA                                      ; CLEAR CARRY
                      (         OPS2.ASM):00540         
2EF9                  (         OPS2.ASM):00541         DECX:
2EF9 301F             (         OPS2.ASM):00542                 LEAX    -1,X
2EFB 26E8             (         OPS2.ASM):00543                 BNE     UDLOOP
                      (         OPS2.ASM):00544         
2EFD 0940             (         OPS2.ASM):00545                 ROL     TEMP+1                            ; SHIFT LAST CARRY INTO PLACE
2EFF 093F             (         OPS2.ASM):00546                 ROL     TEMP
2F01 DC47             (         OPS2.ASM):00547                 LDD     MTEMP                             ; MOVE REMAINDER INTO
2F03 DD3D             (         OPS2.ASM):00548                 STD     VAL                               ; ITS RIGHTFUL PLACE
2F05 39               (         OPS2.ASM):00549                 RTS
                      (         OPS2.ASM):00550         
                      (         OPS2.ASM):00551         ; *** ERROR #8: DIVISION ***
                      (         OPS2.ASM):00552         
2F06                  (         OPS2.ASM):00553         DIVERR:
2F06 8608             (         OPS2.ASM):00554                 LDA     #8
2F08 BD366C           (         OPS2.ASM):00555                 JSR     ZERROR
                      (     cubixzip.asm):00060                 INCLUDE OPSX.ASM
                      (         OPSX.ASM):00001         ;       PAGE
                      (         OPSX.ASM):00002         ;       SBTTL "--- X-OPS ---"
                      (         OPSX.ASM):00003         
                      (         OPSX.ASM):00004         ; ------
                      (         OPSX.ASM):00005         ; EQUAL?
                      (         OPSX.ASM):00006         ; ------
                      (         OPSX.ASM):00007         
2F0B                  (         OPSX.ASM):00008         ZEQUAL:
2F0B 0A01             (         OPSX.ASM):00009                 DEC     ARGCNT
2F0D 2605             (         OPSX.ASM):00010                 BNE     DOEQ
                      (         OPSX.ASM):00011         
                      (         OPSX.ASM):00012         ; *** ERROR #9: NOT ENOUGH "EQUAL?" ARGS ***
                      (         OPSX.ASM):00013         
2F0F 8609             (         OPSX.ASM):00014                 LDA     #9
2F11 BD366C           (         OPSX.ASM):00015                 JSR     ZERROR
                      (         OPSX.ASM):00016         
2F14                  (         OPSX.ASM):00017         DOEQ:
2F14 DC02             (         OPSX.ASM):00018                 LDD     ARG1
2F16 109304           (         OPSX.ASM):00019                 CMPD    ARG2
2F19 2715             (         OPSX.ASM):00020                 BEQ     EQOK
2F1B 0A01             (         OPSX.ASM):00021                 DEC     ARGCNT
2F1D 270E             (         OPSX.ASM):00022                 BEQ     EQBAD
                      (         OPSX.ASM):00023         
2F1F 109306           (         OPSX.ASM):00024                 CMPD    ARG3
2F22 270C             (         OPSX.ASM):00025                 BEQ     EQOK
2F24 0A01             (         OPSX.ASM):00026                 DEC     ARGCNT
2F26 2705             (         OPSX.ASM):00027                 BEQ     EQBAD
                      (         OPSX.ASM):00028         
2F28 109308           (         OPSX.ASM):00029                 CMPD    ARG4
2F2B 2703             (         OPSX.ASM):00030                 BEQ     EQOK
2F2D                  (         OPSX.ASM):00031         EQBAD:
2F2D 7E2A3E           (         OPSX.ASM):00032                 JMP     PREDF
                      (         OPSX.ASM):00033         
2F30                  (         OPSX.ASM):00034         EQOK:
2F30 7E2A4C           (         OPSX.ASM):00035                 JMP     PREDS
                      (         OPSX.ASM):00036         
                      (         OPSX.ASM):00037         ; ----
                      (         OPSX.ASM):00038         ; CALL
                      (         OPSX.ASM):00039         ; ----
                      (         OPSX.ASM):00040         
                      (         OPSX.ASM):00041         ; Branch to function pointed to by [arg1 * 2], passing
                      (         OPSX.ASM):00042         ; the optional parameters "arg2" thru "arg4" [VALUE]
                      (         OPSX.ASM):00043         
2F33                  (         OPSX.ASM):00044         ZCALL:
2F33 DC02             (         OPSX.ASM):00045                 LDD     ARG1                              ; DID FUNCTION = 0?
2F35 2603             (         OPSX.ASM):00046                 BNE     DOCALL                            ; NO, CONTINUE
2F37 7E2E6F           (         OPSX.ASM):00047                 JMP     MATH                              ; ELSE RETURN A ZERO
                      (         OPSX.ASM):00048         
2F3A                  (         OPSX.ASM):00049         DOCALL:
2F3A DC27             (         OPSX.ASM):00050                 LDD     OZSTAK                            ; ZSP FROM PREVIOUS ZCALL
2F3C BD2A20           (         OPSX.ASM):00051                 JSR     PSHDZ
2F3F D615             (         OPSX.ASM):00052                 LDB     ZPCL                              ; LOW 8 BITS OF ZPC
2F41 BD2A20           (         OPSX.ASM):00053                 JSR     PSHDZ                             ; SAVE TO Z-STACK
2F44 DC13             (         OPSX.ASM):00054                 LDD     ZPCH                              ; PUSH H & M PC
2F46 BD2A20           (         OPSX.ASM):00055                 JSR     PSHDZ
                      (         OPSX.ASM):00056         
                      (         OPSX.ASM):00057         ; MULTIPLY ARG1 BY 2; FORM 17-BIT ADDR
                      (         OPSX.ASM):00058         
2F49 4F               (         OPSX.ASM):00059                 CLRA
2F4A 0803             (         OPSX.ASM):00060                 ASL     ARG1+1                            ; BOTTOM 8 BITS
2F4C 0902             (         OPSX.ASM):00061                 ROL     ARG1                              ; MIDDLE 8
2F4E 49               (         OPSX.ASM):00062                 ROLA                                      ; TOP BIT
2F4F 9713             (         OPSX.ASM):00063                 STA     ZPCH
2F51 DC02             (         OPSX.ASM):00064                 LDD     ARG1
2F53 DD14             (         OPSX.ASM):00065                 STD     ZPCM
2F55 0F18             (         OPSX.ASM):00066                 CLR     ZPCFLG                            ; [ZPC] HAS CHANGED ...
                      (         OPSX.ASM):00067         
2F57 BD318E           (         OPSX.ASM):00068                 JSR     NEXTPC                            ; FETCH # NEW LOCALS
2F5A 9741             (         OPSX.ASM):00069                 STA     TEMP2                             ; SAVE IT HERE FOR INDEXING
2F5C 9742             (         OPSX.ASM):00070                 STA     TEMP2+1                           ; AND HERE FOR REFERENCE
2F5E 271E             (         OPSX.ASM):00071                 BEQ     ZCALL2                            ; NO LOCALS IN THIS FUNCTION
                      (         OPSX.ASM):00072         
                      (         OPSX.ASM):00073         ; SAVE OLD LOCALS, REPLACE WITH NEW
                      (         OPSX.ASM):00074         
2F60 8E2700           (         OPSX.ASM):00075                 LDX     #LOCALS                           ; INIT POINTER
2F63                  (         OPSX.ASM):00076         ZCALL1:
2F63 EC84             (         OPSX.ASM):00077                 LDD     ,X                                ; GRAB AN OLD LOCAL
2F65 3410             (         OPSX.ASM):00078                 PSHS    X                                 ; SAVE THE POINTER
2F67 BD2A20           (         OPSX.ASM):00079                 JSR     PSHDZ                             ; PUSH OLD LOCAL TO Z-STACK
2F6A BD318E           (         OPSX.ASM):00080                 JSR     NEXTPC                            ; GET MSB OF NEW LOCAL
2F6D 3402             (         OPSX.ASM):00081                 PSHS    A                                 ; SAVE HERE
2F6F BD318E           (         OPSX.ASM):00082                 JSR     NEXTPC                            ; NOW GET LSB
2F72 1F89             (         OPSX.ASM):00083                 TFR     A,B                               ; POSITION IT PROPERLY
2F74 3502             (         OPSX.ASM):00084                 PULS    A                                 ; RETRIEVE MSB
2F76 3510             (         OPSX.ASM):00085                 PULS    X                                 ; THIS IS WHERE IT GOES
2F78 ED81             (         OPSX.ASM):00086                 STD     ,X++                              ; STORE NEW LOCAL, UPDATE POINTER
2F7A 0A41             (         OPSX.ASM):00087                 DEC     TEMP2                             ; ANY MORE OLD LOCALS?
2F7C 26E5             (         OPSX.ASM):00088                 BNE     ZCALL1                            ; KEEP LOOPING TILL DONE
                      (         OPSX.ASM):00089         
2F7E                  (         OPSX.ASM):00090         ZCALL2:
2F7E 0A01             (         OPSX.ASM):00091                 DEC     ARGCNT                            ; EXTRA ARGUMENTS IN THIS CALL?
2F80 2717             (         OPSX.ASM):00092                 BEQ     ZCALL4                            ; NO ARGS TO PASS
                      (         OPSX.ASM):00093         
                      (         OPSX.ASM):00094         ; MOVE UP TO 3 ARGS TO LOCAL STORAGE
                      (         OPSX.ASM):00095         
2F82                  (         OPSX.ASM):00096         ZCALL3:
2F82 DC04             (         OPSX.ASM):00097                 LDD     ARG2
2F84 FD2700           (         OPSX.ASM):00098                 STD     LOCALS
2F87 0A01             (         OPSX.ASM):00099                 DEC     ARGCNT
2F89 270E             (         OPSX.ASM):00100                 BEQ     ZCALL4
2F8B DC06             (         OPSX.ASM):00101                 LDD     ARG3
2F8D FD2702           (         OPSX.ASM):00102                 STD     LOCALS+2
2F90 0A01             (         OPSX.ASM):00103                 DEC     ARGCNT
2F92 2705             (         OPSX.ASM):00104                 BEQ     ZCALL4
2F94 DC08             (         OPSX.ASM):00105                 LDD     ARG4
2F96 FD2704           (         OPSX.ASM):00106                 STD     LOCALS+4
                      (         OPSX.ASM):00107         
2F99                  (         OPSX.ASM):00108         ZCALL4:
2F99 D642             (         OPSX.ASM):00109                 LDB     TEMP2+1                           ; REMEMBER # LOCALS SAVED
2F9B 1F98             (         OPSX.ASM):00110                 TFR     B,A                               ; COPY INTO [A]
2F9D 43               (         OPSX.ASM):00111                 COMA                                      ; COMPLEMENT FOR ERROR CHECK (BM 11/24/84)
2F9E BD2A20           (         OPSX.ASM):00112                 JSR     PSHDZ                             ; AND RETURN
2FA1 DF27             (         OPSX.ASM):00113                 STU     OZSTAK                            ; "THE WAY WE WERE ..."
2FA3 39               (         OPSX.ASM):00114                 RTS
                      (         OPSX.ASM):00115         
                      (         OPSX.ASM):00116         ; ---
                      (         OPSX.ASM):00117         ; PUT
                      (         OPSX.ASM):00118         ; ---
                      (         OPSX.ASM):00119         
                      (         OPSX.ASM):00120         ; Set item "arg2" in WORD-table "arg1" equal to "arg3"
                      (         OPSX.ASM):00121         
2FA4                  (         OPSX.ASM):00122         ZPUT:
2FA4 0805             (         OPSX.ASM):00123                 ASL     ARG2+1                            ; WORD-ALIGN
2FA6 0904             (         OPSX.ASM):00124                 ROL     ARG2                              ; ARG2
2FA8 DC04             (         OPSX.ASM):00125                 LDD     ARG2
2FAA D302             (         OPSX.ASM):00126                 ADDD    ARG1                              ; ADD Z-ADDR OF TABLE
2FAC C33F00           (         OPSX.ASM):00127                 ADDD    #ZCODE                            ; FORM ABSOLUTE ADDRESS
2FAF 1F01             (         OPSX.ASM):00128                 TFR     D,X                               ; FOR USE AS AN INDEX
2FB1 DC06             (         OPSX.ASM):00129                 LDD     ARG3
2FB3 ED84             (         OPSX.ASM):00130                 STD     ,X
2FB5 39               (         OPSX.ASM):00131                 RTS
                      (         OPSX.ASM):00132         
                      (         OPSX.ASM):00133         ; ----
                      (         OPSX.ASM):00134         ; PUTB
                      (         OPSX.ASM):00135         ; ----
                      (         OPSX.ASM):00136         
                      (         OPSX.ASM):00137         ; Set item "arg2" in BYTE-table "arg1" equal to "arg3"
                      (         OPSX.ASM):00138         
2FB6                  (         OPSX.ASM):00139         ZPUTB:
2FB6 DC04             (         OPSX.ASM):00140                 LDD     ARG2
2FB8 D302             (         OPSX.ASM):00141                 ADDD    ARG1
2FBA C33F00           (         OPSX.ASM):00142                 ADDD    #ZCODE
2FBD 1F01             (         OPSX.ASM):00143                 TFR     D,X
2FBF 9607             (         OPSX.ASM):00144                 LDA     ARG3+1
2FC1 A784             (         OPSX.ASM):00145                 STA     ,X
2FC3 39               (         OPSX.ASM):00146                 RTS
                      (         OPSX.ASM):00147         
                      (         OPSX.ASM):00148         ; ----
                      (         OPSX.ASM):00149         ; PUTP
                      (         OPSX.ASM):00150         ; ----
                      (         OPSX.ASM):00151         
                      (         OPSX.ASM):00152         ; Set property "arg2" in object "arg1" equal to "arg3"
                      (         OPSX.ASM):00153         
2FC4                  (         OPSX.ASM):00154         ZPUTP:
2FC4 BD3471           (         OPSX.ASM):00155                 JSR     PROPB
2FC7                  (         OPSX.ASM):00156         PUTP1:
2FC7 BD3486           (         OPSX.ASM):00157                 JSR     PROPN
2FCA 9105             (         OPSX.ASM):00158                 CMPA    ARG2+1
2FCC 270C             (         OPSX.ASM):00159                 BEQ     PUTP2
2FCE 2405             (         OPSX.ASM):00160                 BHS     PTP
                      (         OPSX.ASM):00161         
                      (         OPSX.ASM):00162         ; *** ERROR #10: BAD PROPERTY NUMBER ***
                      (         OPSX.ASM):00163         
2FD0 860A             (         OPSX.ASM):00164                 LDA     #10
2FD2 BD366C           (         OPSX.ASM):00165                 JSR     ZERROR                            ; ERROR #7 (BAD PROPERTY #)
                      (         OPSX.ASM):00166         
2FD5                  (         OPSX.ASM):00167         PTP:
2FD5 BD349B           (         OPSX.ASM):00168                 JSR     PROPNX                            ; NEXT ITEM
2FD8 20ED             (         OPSX.ASM):00169                 BRA     PUTP1
                      (         OPSX.ASM):00170         
2FDA                  (         OPSX.ASM):00171         PUTP2:
2FDA BD348E           (         OPSX.ASM):00172                 JSR     PROPL
2FDD 5C               (         OPSX.ASM):00173                 INCB
2FDE 4D               (         OPSX.ASM):00174                 TSTA
2FDF 2711             (         OPSX.ASM):00175                 BEQ     PUTP2A
2FE1 8101             (         OPSX.ASM):00176                 CMPA    #1
2FE3 2705             (         OPSX.ASM):00177                 BEQ     PTP1
                      (         OPSX.ASM):00178         
                      (         OPSX.ASM):00179         ; *** ERROR #11: PROPERTY LENGTH ***
                      (         OPSX.ASM):00180         
2FE5 860B             (         OPSX.ASM):00181                 LDA     #11
2FE7 BD366C           (         OPSX.ASM):00182                 JSR     ZERROR                            ; ERROR #8 (PROP TOO LONG)
                      (         OPSX.ASM):00183         
2FEA                  (         OPSX.ASM):00184         PTP1:
2FEA 9E3F             (         OPSX.ASM):00185                 LDX     TEMP
2FEC 3A               (         OPSX.ASM):00186                 ABX
2FED DC06             (         OPSX.ASM):00187                 LDD     ARG3
2FEF ED84             (         OPSX.ASM):00188                 STD     ,X
2FF1 39               (         OPSX.ASM):00189                 RTS
                      (         OPSX.ASM):00190         
2FF2                  (         OPSX.ASM):00191         PUTP2A:
2FF2 9607             (         OPSX.ASM):00192                 LDA     ARG3+1
2FF4 9E3F             (         OPSX.ASM):00193                 LDX     TEMP
2FF6 3A               (         OPSX.ASM):00194                 ABX
2FF7 A784             (         OPSX.ASM):00195                 STA     ,X
2FF9 39               (         OPSX.ASM):00196                 RTS
                      (         OPSX.ASM):00197         
                      (         OPSX.ASM):00198         ; ------
                      (         OPSX.ASM):00199         ; PRINTC
                      (         OPSX.ASM):00200         ; ------
                      (         OPSX.ASM):00201         
                      (         OPSX.ASM):00202         ; Print the character with ASCII value "arg1"
                      (         OPSX.ASM):00203         
2FFA                  (         OPSX.ASM):00204         ZPRC:
2FFA 9603             (         OPSX.ASM):00205                 LDA     ARG1+1
2FFC 7E36BB           (         OPSX.ASM):00206                 JMP     COUT
                      (         OPSX.ASM):00207         
                      (         OPSX.ASM):00208         ; ------
                      (         OPSX.ASM):00209         ; PRINTN
                      (         OPSX.ASM):00210         ; ------
                      (         OPSX.ASM):00211         
                      (         OPSX.ASM):00212         ; Print "arg1" as a signed integer
                      (         OPSX.ASM):00213         
2FFF                  (         OPSX.ASM):00214         ZPRN:
2FFF DC02             (         OPSX.ASM):00215                 LDD     ARG1
3001 DD3F             (         OPSX.ASM):00216                 STD     TEMP
                      (         OPSX.ASM):00217         
                      (         OPSX.ASM):00218         ; PRINT THE SIGNED VALUE IN [TEMP]
                      (         OPSX.ASM):00219         
3003                  (         OPSX.ASM):00220         NUMBER:
3003 DC3F             (         OPSX.ASM):00221                 LDD     TEMP
3005 2A08             (         OPSX.ASM):00222                 BPL     DIGCNT                            ; IF NUMBER IS NEGATIVE,
3007 862D             (         OPSX.ASM):00223                 LDA     #$2D                              ; START WITH A MINUS SIGN
3009 BD36BB           (         OPSX.ASM):00224                 JSR     COUT
300C BD2ED3           (         OPSX.ASM):00225                 JSR     ABTEMP                            ; GET ABS(TEMP)
                      (         OPSX.ASM):00226         
                      (         OPSX.ASM):00227         ; COUNT # OF DECIMAL DIGITS
                      (         OPSX.ASM):00228         
300F                  (         OPSX.ASM):00229         DIGCNT:
300F 0F43             (         OPSX.ASM):00230                 CLR     MASK                              ; RESET INDEX
3011                  (         OPSX.ASM):00231         DGC:
3011 DC3F             (         OPSX.ASM):00232                 LDD     TEMP                              ; CHECK QUOTIENT
3013 2710             (         OPSX.ASM):00233                 BEQ     PRNTN3                            ; SKIP IF ZERO
3015 CC000A           (         OPSX.ASM):00234                 LDD     #10
3018 DD3D             (         OPSX.ASM):00235                 STD     VAL                               ; ELSE DIVIDE BY 10
301A BD2EDA           (         OPSX.ASM):00236                 JSR     UDIV                              ; UNSIGNED DIVIDE
301D 963E             (         OPSX.ASM):00237                 LDA     VAL+1                             ; GET LSB OF REMAINDER
301F 3402             (         OPSX.ASM):00238                 PSHS    A                                 ; SAVE ON STACK
3021 0C43             (         OPSX.ASM):00239                 INC     MASK                              ; INCREMENT CHAR COUNT
3023 20EC             (         OPSX.ASM):00240                 BRA     DGC                               ; LOOP TILL ARG1=0
                      (         OPSX.ASM):00241         
3025                  (         OPSX.ASM):00242         PRNTN3:
3025 9643             (         OPSX.ASM):00243                 LDA     MASK
3027 270C             (         OPSX.ASM):00244                 BEQ     PZERO                             ; PRINT AT LEAST A "0"
3029                  (         OPSX.ASM):00245         PRNTN4:
3029 3502             (         OPSX.ASM):00246                 PULS    A                                 ; GET A CHAR
302B 8B30             (         OPSX.ASM):00247                 ADDA    #$30                              ; CONVERT TO ASCII NUMBER
302D BD36BB           (         OPSX.ASM):00248                 JSR     COUT
3030 0A43             (         OPSX.ASM):00249                 DEC     MASK                              ; OUT OF CHARS?
3032 26F5             (         OPSX.ASM):00250                 BNE     PRNTN4                            ; KEEP PRINTING TILL
3034 39               (         OPSX.ASM):00251                 RTS                                       ; DONE
                      (         OPSX.ASM):00252         
                      (         OPSX.ASM):00253         ; PRINT A ZERO
                      (         OPSX.ASM):00254         
3035                  (         OPSX.ASM):00255         PZERO:
3035 8630             (         OPSX.ASM):00256                 LDA     #$30                              ; ASCII "0"
3037 7E36BB           (         OPSX.ASM):00257                 JMP     COUT
                      (         OPSX.ASM):00258         
                      (         OPSX.ASM):00259         ; ------
                      (         OPSX.ASM):00260         ; RANDOM
                      (         OPSX.ASM):00261         ; ------
                      (         OPSX.ASM):00262         
                      (         OPSX.ASM):00263         ; Return a random value between zero and "arg1" [VALUE]
                      (         OPSX.ASM):00264         
303A                  (         OPSX.ASM):00265         ZRAND:
303A DC02             (         OPSX.ASM):00266                 LDD     ARG1                              ; USE [ARG1]
303C DD3D             (         OPSX.ASM):00267                 STD     VAL                               ; AS THE DIVISOR
                      (         OPSX.ASM):00268         
303E DC58             (         OPSX.ASM):00269                 LDD     RAND1                             ; GET A RANDOM #
3040 C3AA55           (         OPSX.ASM):00270                 ADDD    #$AA55                            ; DO WEIRD THINGS
3043 9759             (         OPSX.ASM):00271                 STA     RAND2                             ; SAVE AS
3045 D758             (         OPSX.ASM):00272                 STB     RAND1                             ; NEW SEED
3047 847F             (         OPSX.ASM):00273                 ANDA    #%01111111                        ; MAKE POSITIVE
3049 DD3F             (         OPSX.ASM):00274                 STD     TEMP                              ; MAKE IT THE DIVIDEND
                      (         OPSX.ASM):00275         
304B BD2EAC           (         OPSX.ASM):00276                 JSR     DIVIDE                            ; UNSIGNED DIVIDE!
304E DC3D             (         OPSX.ASM):00277                 LDD     VAL                               ; GET REMAINDER
3050 C30001           (         OPSX.ASM):00278                 ADDD    #1                                ; AT LEAST 1
3053 7E2E6F           (         OPSX.ASM):00279                 JMP     MATH
                      (         OPSX.ASM):00280         
                      (         OPSX.ASM):00281         ; ----
                      (         OPSX.ASM):00282         ; PUSH
                      (         OPSX.ASM):00283         ; ----
                      (         OPSX.ASM):00284         
                      (         OPSX.ASM):00285         ; Push "arg1" onto the Z-stack
                      (         OPSX.ASM):00286         
3056                  (         OPSX.ASM):00287         ZPUSH:
3056 DC02             (         OPSX.ASM):00288                 LDD     ARG1
3058 7E2A20           (         OPSX.ASM):00289                 JMP     PSHDZ
                      (         OPSX.ASM):00290         
                      (         OPSX.ASM):00291         ; ---
                      (         OPSX.ASM):00292         ; POP
                      (         OPSX.ASM):00293         ; ---
                      (         OPSX.ASM):00294         
                      (         OPSX.ASM):00295         ; Pop a word off Z-stack and store in variable "arg1"
                      (         OPSX.ASM):00296         
305B                  (         OPSX.ASM):00297         ZPOP:
305B BD2A29           (         OPSX.ASM):00298                 JSR     POPSTK
305E 9603             (         OPSX.ASM):00299                 LDA     ARG1+1                            ; GET VARIABLE ID
3060 7E29E4           (         OPSX.ASM):00300                 JMP     VARPUT
                      (         OPSX.ASM):00301         
                      (         OPSX.ASM):00302         ; -----
                      (         OPSX.ASM):00303         ; SPLIT
                      (         OPSX.ASM):00304         ; -----
                      (         OPSX.ASM):00305         
     2B5F             (         OPSX.ASM):00306         ZSPLIT          EQU ZNOOP
                      (         OPSX.ASM):00307         
                      (         OPSX.ASM):00308         ; ------
                      (         OPSX.ASM):00309         ; SCREEN
                      (         OPSX.ASM):00310         ; ------
                      (         OPSX.ASM):00311         
     2B5F             (         OPSX.ASM):00312         ZSCRN           EQU ZNOOP
                      (     cubixzip.asm):00061                 INCLUDE READ.ASM
                      (         READ.ASM):00001         ;       PAGE
                      (         READ.ASM):00002         ;       SBTTL "--- READ HANDLER ---"
                      (         READ.ASM):00003         
3063                  (         READ.ASM):00004         ZREAD:
3063 BD370A           (         READ.ASM):00005                 JSR     ZUSL                              ; UPDATE STATUS LINE FIRST
                      (         READ.ASM):00006         
3066 DC02             (         READ.ASM):00007                 LDD     ARG1                              ; CALC ABSOLUTE ADDRESS
3068 C33F00           (         READ.ASM):00008                 ADDD    #ZCODE                            ; OF READ BUFFERS
306B DD02             (         READ.ASM):00009                 STD     ARG1
306D DC04             (         READ.ASM):00010                 LDD     ARG2
306F C33F00           (         READ.ASM):00011                 ADDD    #ZCODE
3072 DD04             (         READ.ASM):00012                 STD     ARG2
                      (         READ.ASM):00013         
3074 BD352A           (         READ.ASM):00014                 JSR     INPUT                             ; READ LINE; RETURN LENGTH IN A
3077 9743             (         READ.ASM):00015                 STA     MASK                              ; # CHARS IN LINE
3079 0F44             (         READ.ASM):00016                 CLR     MASK+1                            ; # CHARS IN CURRENT WORD
                      (         READ.ASM):00017         
307B 9E04             (         READ.ASM):00018                 LDX     ARG2                              ; SET # OF WORDS READ
307D 6F01             (         READ.ASM):00019                 CLR     1,X                               ; TO ZERO
                      (         READ.ASM):00020         
307F 8601             (         READ.ASM):00021                 LDA     #1                                ; = 1
3081 973B             (         READ.ASM):00022                 STA     STABP                             ; INIT SOURCE TABLE POINTER
3083 4C               (         READ.ASM):00023                 INCA                                      ; = 2
3084 973A             (         READ.ASM):00024                 STA     RTABP                             ; AND RESULT TABLE POINTER
                      (         READ.ASM):00025         
3086                  (         READ.ASM):00026         READL:
3086 9E04             (         READ.ASM):00027                 LDX     ARG2
3088 A680             (         READ.ASM):00028                 LDA     ,X+                               ; FETCH MAXIMUM # OF WORDS
308A A184             (         READ.ASM):00029                 CMPA    ,X                                ; COMPARE TO # WORDS READ
308C 2405             (         READ.ASM):00030                 BHS     RL1                               ; STILL ROOM
                      (         READ.ASM):00031         
                      (         READ.ASM):00032         ; *** ERROR #13 -- PARSER OVERFLOW ***
                      (         READ.ASM):00033         
308E 860D             (         READ.ASM):00034                 LDA     #13
3090 BD366C           (         READ.ASM):00035                 JSR     ZERROR
                      (         READ.ASM):00036         
3093                  (         READ.ASM):00037         RL1:
3093 DC43             (         READ.ASM):00038                 LDD     MASK                              ; OUT OF CHARS & WORDS?
3095 2601             (         READ.ASM):00039                 BNE     RL2                               ; NOT YET
3097                  (         READ.ASM):00040         RDEX:
3097 39               (         READ.ASM):00041                 RTS                                       ; ELSE SCRAM
                      (         READ.ASM):00042         
3098                  (         READ.ASM):00043         RL2:
3098 9644             (         READ.ASM):00044                 LDA     MASK+1                            ; GET CHAR COUNT
309A 8106             (         READ.ASM):00045                 CMPA    #6                                ; 6 CHARS DONE?
309C 2503             (         READ.ASM):00046                 BLO     RL3                               ; NOT YET
309E BD311E           (         READ.ASM):00047                 JSR     FLUSHW                            ; ELSE FLUSH WORD
                      (         READ.ASM):00048         
30A1                  (         READ.ASM):00049         RL3:
30A1 9644             (         READ.ASM):00050                 LDA     MASK+1                            ; FIRST CHAR IN WORD?
30A3 2624             (         READ.ASM):00051                 BNE     READL2                            ; NOPE
                      (         READ.ASM):00052         
                      (         READ.ASM):00053         ; CLEAR OUT WORD BUFFER [ZSTBUI]
                      (         READ.ASM):00054         
30A5 5F               (         READ.ASM):00055                 CLRB                                      ; [A] IS ALREADY ZERO
30A6 DD2E             (         READ.ASM):00056                 STD     ZSTBUI
30A8 DD30             (         READ.ASM):00057                 STD     ZSTBUI+2
30AA DD32             (         READ.ASM):00058                 STD     ZSTBUI+4
                      (         READ.ASM):00059         
30AC D63A             (         READ.ASM):00060                 LDB     RTABP
30AE 9E04             (         READ.ASM):00061                 LDX     ARG2
30B0 3A               (         READ.ASM):00062                 ABX
30B1 D63B             (         READ.ASM):00063                 LDB     STABP
30B3 E703             (         READ.ASM):00064                 STB     3,X                               ; STORE POSITION
                      (         READ.ASM):00065         
30B5 9E02             (         READ.ASM):00066                 LDX     ARG1
30B7 A685             (         READ.ASM):00067                 LDA     B,X                               ; GRAB A CHAR FROM SOURCE BUFFER
30B9 BD3140           (         READ.ASM):00068                 JSR     SIBRKP                            ; IS IT A SIB?
30BC 2529             (         READ.ASM):00069                 BCS     RSIBRK                            ; YES IF CARRY IS SET
30BE BD3139           (         READ.ASM):00070                 JSR     NBRKP                             ; IS IT A "NORMAL" BREAK CHAR?
30C1 2406             (         READ.ASM):00071                 BCC     READL2                            ; NO, KEEP SCANNING
30C3 0C3B             (         READ.ASM):00072                 INC     STABP                             ; ELSE FLUSH STRANDED BREAK
30C5 0A43             (         READ.ASM):00073                 DEC     MASK                              ; UPDATE # OF CHARS IN LINE
30C7 20BD             (         READ.ASM):00074                 BRA     READL                             ; AND LOOP BACK
                      (         READ.ASM):00075         
30C9                  (         READ.ASM):00076         READL2:
30C9 9643             (         READ.ASM):00077                 LDA     MASK                              ; OUT OF CHARS?
30CB 2722             (         READ.ASM):00078                 BEQ     READL3                            ; SURE ENOUGH
30CD D63B             (         READ.ASM):00079                 LDB     STABP
30CF 9E02             (         READ.ASM):00080                 LDX     ARG1
30D1 A685             (         READ.ASM):00081                 LDA     B,X                               ; ELSE GRAB NEXT CHAR
30D3 BD3135           (         READ.ASM):00082                 JSR     RBRKP                             ; IS IT A BREAK?
30D6 2517             (         READ.ASM):00083                 BCS     READL3                            ; YES IF CARRY SET
30D8 D644             (         READ.ASM):00084                 LDB     MASK+1                            ; ELSE POINT TO
30DA 8E002E           (         READ.ASM):00085                 LDX     #ZSTBUI                           ; WORD BUFFER
30DD A785             (         READ.ASM):00086                 STA     B,X                               ; STORE CHAR IN BUFFER
30DF 0A43             (         READ.ASM):00087                 DEC     MASK                              ; ONE LESS CHAR IN LINE
30E1 0C44             (         READ.ASM):00088                 INC     MASK+1                            ; ONE MORE IN RESULT
30E3 0C3B             (         READ.ASM):00089                 INC     STABP                             ; POINT TO NEXT CHAR
30E5 209F             (         READ.ASM):00090                 BRA     READL                             ; AND LOOP BACK
                      (         READ.ASM):00091         
30E7                  (         READ.ASM):00092         RSIBRK:
30E7 972E             (         READ.ASM):00093                 STA     ZSTBUI                            ; STORE THE SIB
30E9 0A43             (         READ.ASM):00094                 DEC     MASK                              ; UPDATE LINE-CHAR COUNT
30EB 0C44             (         READ.ASM):00095                 INC     MASK+1                            ; WORD-CHAR COUNT
30ED 0C3B             (         READ.ASM):00096                 INC     STABP                             ; AND # CHARS IN WORD
                      (         READ.ASM):00097         
30EF                  (         READ.ASM):00098         READL3:
30EF 9644             (         READ.ASM):00099                 LDA     MASK+1                            ; ANY CHARS IN WORD?
30F1 2793             (         READ.ASM):00100                 BEQ     READL                             ; APPARENTLY NOT
                      (         READ.ASM):00101         
30F3 D63A             (         READ.ASM):00102                 LDB     RTABP                             ; POINT TO
30F5 9E04             (         READ.ASM):00103                 LDX     ARG2                              ; IN THIS ENTRY
30F7 3A               (         READ.ASM):00104                 ABX
30F8 9644             (         READ.ASM):00105                 LDA     MASK+1                            ; FETCH ACTUAL WORD LENGTH
30FA A702             (         READ.ASM):00106                 STA     2,X                               ; AND STORE IN 3RD BYTE
                      (         READ.ASM):00107         
30FC 9643             (         READ.ASM):00108                 LDA     MASK
30FE 3402             (         READ.ASM):00109                 PSHS    A                                 ; SAVE THIS
3100 BD337C           (         READ.ASM):00110                 JSR     CONZST                            ; CONVERT TO Z-STRING
3103 BD3150           (         READ.ASM):00111                 JSR     FINDW                             ; LOOK UP IN VOCABULARY
3106 3502             (         READ.ASM):00112                 PULS    A
3108 9743             (         READ.ASM):00113                 STA     MASK                              ; RESTORE
                      (         READ.ASM):00114         
310A 9E04             (         READ.ASM):00115                 LDX     ARG2
310C 6C01             (         READ.ASM):00116                 INC     1,X                               ; UPDATE # WORDS READ
310E D63A             (         READ.ASM):00117                 LDB     RTABP                             ; POINT [X] TO 1ST BYTE
3110 3A               (         READ.ASM):00118                 ABX                                       ; IN CURRENT ENTRY
3111 CB04             (         READ.ASM):00119                 ADDB    #4
3113 D73A             (         READ.ASM):00120                 STB     RTABP                             ; POINT TO NEXT ENTRY
3115 DC3D             (         READ.ASM):00121                 LDD     VAL                               ; STORE [VAL] IN ENTRY
3117 ED84             (         READ.ASM):00122                 STD     ,X
3119 0F44             (         READ.ASM):00123                 CLR     MASK+1                            ; RESET WORD-CHAR COUNT
311B 7E3086           (         READ.ASM):00124                 JMP     READL                             ; AND CONTINUE
                      (         READ.ASM):00125         
                      (         READ.ASM):00126         ; ----------
                      (         READ.ASM):00127         ; FLUSH WORD
                      (         READ.ASM):00128         ; ----------
                      (         READ.ASM):00129         
311E                  (         READ.ASM):00130         FLUSHW:
311E 9643             (         READ.ASM):00131                 LDA     MASK
3120 2712             (         READ.ASM):00132                 BEQ     FLEX
3122 D63B             (         READ.ASM):00133                 LDB     STABP
3124 9E02             (         READ.ASM):00134                 LDX     ARG1
3126 A685             (         READ.ASM):00135                 LDA     B,X
3128 8D0B             (         READ.ASM):00136                 BSR     RBRKP                             ; WORD BREAK?
312A 2508             (         READ.ASM):00137                 BCS     FLEX                              ; EXIT IF SO
312C 0A43             (         READ.ASM):00138                 DEC     MASK
312E 0C44             (         READ.ASM):00139                 INC     MASK+1
3130 0C3B             (         READ.ASM):00140                 INC     STABP
3132 20EA             (         READ.ASM):00141                 BRA     FLUSHW                            ; KEEP LOOPING
3134                  (         READ.ASM):00142         FLEX:
3134 39               (         READ.ASM):00143                 RTS
                      (         READ.ASM):00144         
                      (         READ.ASM):00145         ; ---------------
                      (         READ.ASM):00146         ; BREAK CHAR SCAN
                      (         READ.ASM):00147         ; ---------------
                      (         READ.ASM):00148         
3135                  (         READ.ASM):00149         RBRKP:
3135 8D09             (         READ.ASM):00150                 BSR     SIBRKP                            ; FIRST CHECK FOR SIBS
3137 2515             (         READ.ASM):00151                 BCS     FBRK                              ; EXIT IF MATCHED
                      (         READ.ASM):00152         
                      (         READ.ASM):00153         ; FALL THROUGH TO ...
                      (         READ.ASM):00154         
                      (         READ.ASM):00155         ; ----------------------
                      (         READ.ASM):00156         ; NORMAL BREAK CHAR SCAN
                      (         READ.ASM):00157         ; ----------------------
                      (         READ.ASM):00158         
3139                  (         READ.ASM):00159         NBRKP:
3139 8E317F           (         READ.ASM):00160                 LDX     #BRKTBL                           ; BASE OF BREAK CHAR TABLE
313C C605             (         READ.ASM):00161                 LDB     #NBRKS-1                          ; NUMBER OF NORMAL BREAK CHARS
313E 2005             (         READ.ASM):00162                 BRA     NBR1
                      (         READ.ASM):00163         
                      (         READ.ASM):00164         ; ------------------------------
                      (         READ.ASM):00165         ; SELF-INSERTING BREAK CHAR SCAN
                      (         READ.ASM):00166         ; ------------------------------
                      (         READ.ASM):00167         
3140                  (         READ.ASM):00168         SIBRKP:
3140 9E23             (         READ.ASM):00169                 LDX     VOCAB                             ; BASE ADDRESS OF VOCAB TABLE
3142 E680             (         READ.ASM):00170                 LDB     ,X+                               ; GET # SIB CHARS
3144 5A               (         READ.ASM):00171                 DECB                                      ; ZERO-ALIGN COUNT
                      (         READ.ASM):00172         
3145                  (         READ.ASM):00173         NBR1:
3145 A185             (         READ.ASM):00174                 CMPA    B,X
3147 2705             (         READ.ASM):00175                 BEQ     FBRK                              ; MATCHED!
3149 5A               (         READ.ASM):00176                 DECB
314A 2AF9             (         READ.ASM):00177                 BPL     NBR1                              ; KEEP LOOPING
314C 5F               (         READ.ASM):00178                 CLRB                                      ; NO MATCH, CLEAR CARRY
314D 39               (         READ.ASM):00179                 RTS
314E                  (         READ.ASM):00180         FBRK:
314E 53               (         READ.ASM):00181                 COMB                                      ; SET CARRY TO FLAG MATCH
314F 39               (         READ.ASM):00182                 RTS
                      (         READ.ASM):00183         
                      (         READ.ASM):00184         ; -----------------
                      (         READ.ASM):00185         ; VOCABULARY SEARCH
                      (         READ.ASM):00186         ; -----------------
                      (         READ.ASM):00187         
3150                  (         READ.ASM):00188         FINDW:
3150 9E23             (         READ.ASM):00189                 LDX     VOCAB                             ; BASE ADDR OF VOCAB TABLE
3152 E680             (         READ.ASM):00190                 LDB     ,X+                               ; GET # SIB BYTES
3154 3A               (         READ.ASM):00191                 ABX                                       ; AND SKIP OVER THEM
                      (         READ.ASM):00192         
3155 A680             (         READ.ASM):00193                 LDA     ,X+                               ; # BYTES PER TABLE ENTRY
3157 9744             (         READ.ASM):00194                 STA     MASK+1                            ; SAVE IT HERE
                      (         READ.ASM):00195         
3159 EC81             (         READ.ASM):00196                 LDD     ,X++                              ; # OF ENTRIES IN TABLE
315B DD3D             (         READ.ASM):00197                 STD     VAL                               ; SAVE THAT TOO
                      (         READ.ASM):00198         
315D                  (         READ.ASM):00199         FWL1:
315D EC84             (         READ.ASM):00200                 LDD     ,X                                ; CHECK FIRST Z-WORD
315F 109334           (         READ.ASM):00201                 CMPD    ZSTBUO
3162 2607             (         READ.ASM):00202                 BNE     WNEXT                             ; NO GOOD
3164 EC02             (         READ.ASM):00203                 LDD     2,X                               ; ELSE CHECK 2ND HALF
3166 109336           (         READ.ASM):00204                 CMPD    ZSTBUO+2
3169 270D             (         READ.ASM):00205                 BEQ     FWSUCC                            ; MATCHED!
                      (         READ.ASM):00206         
316B                  (         READ.ASM):00207         WNEXT:
316B D644             (         READ.ASM):00208                 LDB     MASK+1                            ; MOVE [X] UP TO
316D 3A               (         READ.ASM):00209                 ABX                                       ; NEXT TABLE ENTRY
316E DC3D             (         READ.ASM):00210                 LDD     VAL
3170 830001           (         READ.ASM):00211                 SUBD    #1
3173 DD3D             (         READ.ASM):00212                 STD     VAL                               ; OUT OF ENTRIES YET?
3175 26E6             (         READ.ASM):00213                 BNE     FWL1                              ; NO, KEEP LOOKING
3177 39               (         READ.ASM):00214                 RTS                                       ; ELSE RETURN WITH [VAL]=0
                      (         READ.ASM):00215         
3178                  (         READ.ASM):00216         FWSUCC:
3178 3089C100         (         READ.ASM):00217                 LEAX    -ZCODE,X                          ; CONVERT TO Z-ADDRESS
317C 9F3D             (         READ.ASM):00218                 STX     VAL                               ; LEAVE RESULT IN [VAL]
317E 39               (         READ.ASM):00219                 RTS
                      (         READ.ASM):00220         
                      (         READ.ASM):00221         ; ------------------
                      (         READ.ASM):00222         ; NORMAL BREAK CHARS
                      (         READ.ASM):00223         ; ------------------
                      (         READ.ASM):00224         
317F                  (         READ.ASM):00225         BRKTBL:
317F 213F2C2E         (         READ.ASM):00226                 FCC     "!?,."
3183 0D               (         READ.ASM):00227                 FCB     EOL
3184 20               (         READ.ASM):00228                 FCB     SPACE
                      (         READ.ASM):00229         
     0006             (         READ.ASM):00230         NBRKS           EQU 6                             ; # NORMAL BREAK CHARS
                      (     cubixzip.asm):00062         
                      (     cubixzip.asm):00063         ;TITLE "ZIP/6809-B INFOCOM, INC. --- OPCODE SUPPORT"
                      (     cubixzip.asm):00064                 INCLUDE PAGING.ASM
                      (       PAGING.ASM):00001         ;       PAGE
                      (       PAGING.ASM):00002         ;       SBTTL   "--- TIMESTAMP PAGING ROUTINES (BM 11/24/84) ---"
                      (       PAGING.ASM):00003         
                      (       PAGING.ASM):00004         ; --------------------
                      (       PAGING.ASM):00005         ; FETCH A VIRTUAL WORD
                      (       PAGING.ASM):00006         ; --------------------
                      (       PAGING.ASM):00007         
3185                  (       PAGING.ASM):00008         GETWRD:
3185 8D38             (       PAGING.ASM):00009                 BSR     GETBYT
3187 973F             (       PAGING.ASM):00010                 STA     TEMP
3189 8D34             (       PAGING.ASM):00011                 BSR     GETBYT
318B 9740             (       PAGING.ASM):00012                 STA     TEMP+1
318D 39               (       PAGING.ASM):00013                 RTS
                      (       PAGING.ASM):00014         
                      (       PAGING.ASM):00015         ; -----------------
                      (       PAGING.ASM):00016         ; FETCH NEXT Z-BYTE
                      (       PAGING.ASM):00017         ; -----------------
                      (       PAGING.ASM):00018         
318E                  (       PAGING.ASM):00019         NEXTPC:
318E 0D18             (       PAGING.ASM):00020                 TST     ZPCFLG                            ; IS [ZPCPNT] VALID?
3190 2619             (       PAGING.ASM):00021                 BNE     NPC2                              ; YES, GET THE BYTE
                      (       PAGING.ASM):00022         
                      (       PAGING.ASM):00023         ; Z-PAGE HAS CHANGED!
                      (       PAGING.ASM):00024         
3192 DC13             (       PAGING.ASM):00025                 LDD     ZPCH                              ; GET TOP 9 BITS OF [ZPC]
3194 4D               (       PAGING.ASM):00026                 TSTA                                      ; IS TOP BIT CLEAR?
3195 2608             (       PAGING.ASM):00027                 BNE     NPC0                              ; NO, PAGE MUST BE SWAPPED
                      (       PAGING.ASM):00028         
3197 D10B             (       PAGING.ASM):00029                 CMPB    ZPURE                             ; IS THIS PAGE PRELOADED?
3199 2404             (       PAGING.ASM):00030                 BHS     NPC0                              ; NO, SWAP IT IN
                      (       PAGING.ASM):00031         
319B CB3F             (       PAGING.ASM):00032                 ADDB    #ZCODEHIGH                        ; ELSE MAKE IT ABSOLUTE
319D 2004             (       PAGING.ASM):00033                 BRA     NPC1                              ; AND CONTINUE
                      (       PAGING.ASM):00034         
319F                  (       PAGING.ASM):00035         NPC0:
319F 0F1F             (       PAGING.ASM):00036                 CLR     MPCFLG                            ; INVALIDATE [MPC] FOR SAFETY
31A1 8D4D             (       PAGING.ASM):00037                 BSR     PAGE                              ; RETURN BUFFER IN [B]
                      (       PAGING.ASM):00038         
31A3                  (       PAGING.ASM):00039         NPC1:
31A3 D716             (       PAGING.ASM):00040                 STB     ZPCPNT                            ; SET MSB OF BUFFER ADDRESS
31A5 0F17             (       PAGING.ASM):00041                 CLR     ZPCPNT+1                          ; CLEAR LSB
31A7 86FF             (       PAGING.ASM):00042                 LDA     #TRUE
31A9 9718             (       PAGING.ASM):00043                 STA     ZPCFLG                            ; VALIDATE [ZPC]
                      (       PAGING.ASM):00044         
31AB                  (       PAGING.ASM):00045         NPC2:
31AB D615             (       PAGING.ASM):00046                 LDB     ZPCL                              ; GET BYTE INDEX
31AD 9E16             (       PAGING.ASM):00047                 LDX     ZPCPNT                            ; AND PAGE ADDRESS
31AF 3A               (       PAGING.ASM):00048                 ABX                                       ; USE [ZPCL] AS OFFSET
31B0 A684             (       PAGING.ASM):00049                 LDA     ,X                                ; AND FETCH THE BYTE
                      (       PAGING.ASM):00050         
31B2 0C15             (       PAGING.ASM):00051                 INC     ZPCL                              ; POINT TO NEXT BYTE
31B4 2608             (       PAGING.ASM):00052                 BNE     NPC3                              ; CONTINUE IF NO OVERFLOW
                      (       PAGING.ASM):00053         
31B6 0F18             (       PAGING.ASM):00054                 CLR     ZPCFLG                            ; ELSE INVALIDATE [ZPC]
31B8 0C14             (       PAGING.ASM):00055                 INC     ZPCM                              ; AND POINT
31BA 2602             (       PAGING.ASM):00056                 BNE     NPC3                              ; TO THE
31BC 0C13             (       PAGING.ASM):00057                 INC     ZPCH                              ; NEXT Z-PAGE
                      (       PAGING.ASM):00058         
31BE                  (       PAGING.ASM):00059         NPC3:
31BE 39               (       PAGING.ASM):00060                 RTS                                       ; RETURN BYTE IN [A]
                      (       PAGING.ASM):00061         
                      (       PAGING.ASM):00062         ; ---------------------
                      (       PAGING.ASM):00063         ; GET NEXT VIRTUAL BYTE
                      (       PAGING.ASM):00064         ; ---------------------
                      (       PAGING.ASM):00065         
31BF                  (       PAGING.ASM):00066         GETBYT:
31BF 0D1F             (       PAGING.ASM):00067                 TST     MPCFLG                            ; IS [MPCPNT] VALID?
31C1 2619             (       PAGING.ASM):00068                 BNE     GTBT2                             ; YES, GET THE BYTE
                      (       PAGING.ASM):00069         
                      (       PAGING.ASM):00070         ; Z-PAGE HAS CHANGED!
                      (       PAGING.ASM):00071         
31C3 DC1A             (       PAGING.ASM):00072                 LDD     MPCH                              ; GET TOP 9 BITS OF [MPC]
31C5 4D               (       PAGING.ASM):00073                 TSTA                                      ; IS TOP BIT CLEAR?
31C6 2608             (       PAGING.ASM):00074                 BNE     GTBT0                             ; NO, PAGE MUST BE SWAPPED
                      (       PAGING.ASM):00075         
     31C9             (       PAGING.ASM):00076         PATCH           EQU pth+1                         ; PATCH POINT FOR "VERIFY"
31C8                  (       PAGING.ASM):00077         pth:
31C8 D10B             (       PAGING.ASM):00078                 CMPB    ZPURE                             ; IS THIS PAGE PRELOADED?
31CA 2404             (       PAGING.ASM):00079                 BHS     GTBT0                             ; NO, SWAP IT IN
                      (       PAGING.ASM):00080         
31CC CB3F             (       PAGING.ASM):00081                 ADDB    #ZCODEHIGH                        ; ELSE MAKE IT ABSOLUTE
31CE 2004             (       PAGING.ASM):00082                 BRA     GTBT1                             ; AND CONTINUE
                      (       PAGING.ASM):00083         
31D0                  (       PAGING.ASM):00084         GTBT0:
31D0 0F18             (       PAGING.ASM):00085                 CLR     ZPCFLG                            ; INVALIDATE [ZPC] FOR SAFETY
31D2 8D1C             (       PAGING.ASM):00086                 BSR     PAGE                              ; RETURN BUFFER PAGE IN [B]
                      (       PAGING.ASM):00087         
31D4                  (       PAGING.ASM):00088         GTBT1:
31D4 D71D             (       PAGING.ASM):00089                 STB     MPCPNT                            ; SET MSB OF BUFFER ADDRESS
31D6 0F1E             (       PAGING.ASM):00090                 CLR     MPCPNT+1                          ; CLEAR LSB
31D8 86FF             (       PAGING.ASM):00091                 LDA     #TRUE
31DA 971F             (       PAGING.ASM):00092                 STA     MPCFLG                            ; VALIDATE [MPC]
                      (       PAGING.ASM):00093         
31DC                  (       PAGING.ASM):00094         GTBT2:
31DC D61C             (       PAGING.ASM):00095                 LDB     MPCL                              ; GET BYTE INDEX
31DE 9E1D             (       PAGING.ASM):00096                 LDX     MPCPNT                            ; AND PAGE ADDRESS
31E0 3A               (       PAGING.ASM):00097                 ABX                                       ; USE [MPCL] AS OFFSET
31E1 A684             (       PAGING.ASM):00098                 LDA     ,X                                ; AND FETCH THE BYTE
                      (       PAGING.ASM):00099         
31E3 0C1C             (       PAGING.ASM):00100                 INC     MPCL                              ; POINT TO NEXT BYTE
31E5 2608             (       PAGING.ASM):00101                 BNE     GTBT3                             ; CONTINUE IF NO OVERFLOW
                      (       PAGING.ASM):00102         
31E7 0F1F             (       PAGING.ASM):00103                 CLR     MPCFLG                            ; ELSE INVALIDATE [MPC]
31E9 0C1B             (       PAGING.ASM):00104                 INC     MPCM                              ; AND POINT
31EB 2602             (       PAGING.ASM):00105                 BNE     GTBT3                             ; TO THE
31ED 0C1A             (       PAGING.ASM):00106                 INC     MPCH                              ; NEXT Z-PAGE
                      (       PAGING.ASM):00107         
31EF                  (       PAGING.ASM):00108         GTBT3:
31EF 39               (       PAGING.ASM):00109                 RTS                                       ; RETURN BYTE IN [A]
                      (       PAGING.ASM):00110         
                      (       PAGING.ASM):00111         ; -------------------------
                      (       PAGING.ASM):00112         ; LOCATE A SWAPPABLE Z-PAGE
                      (       PAGING.ASM):00113         ; -------------------------
                      (       PAGING.ASM):00114         
                      (       PAGING.ASM):00115         ; ENTRY: TARGET PAGE IN [D] (TOP 9 BITS)
                      (       PAGING.ASM):00116         ; EXIT: ABSOLUTE BUFFER PAGE IN [B]
                      (       PAGING.ASM):00117         
31F0                  (       PAGING.ASM):00118         PAGE:
31F0 DD4C             (       PAGING.ASM):00119                 STD     DBLOCK                            ; SAVE TARGET PAGE HERE
31F2 0F0D             (       PAGING.ASM):00120                 CLR     ZPAGE                             ; CLEAR INDEX
31F4 8E2500           (       PAGING.ASM):00121                 LDX     #PTABLE                           ; START AT BOTOM OF TABLE
31F7                  (       PAGING.ASM):00122         PG0:
31F7 10A381           (       PAGING.ASM):00123                 CMPD    ,X++                              ; FOUND IT?
31FA 2720             (       PAGING.ASM):00124                 BEQ     PG1                               ; YES!
31FC 0C0D             (       PAGING.ASM):00125                 INC     ZPAGE                             ; ELSE COUNT NEXT PAGE
31FE 9C0F             (       PAGING.ASM):00126                 CMPX    TABTOP                            ; ANY BUFFERS LEFT?
3200 25F5             (       PAGING.ASM):00127                 BLO     PG0                               ; NO, KEEP SEARCHING
                      (       PAGING.ASM):00128         
                      (       PAGING.ASM):00129         ; SWAP IN THE TARGET PAGE
                      (       PAGING.ASM):00130         
3202 8D52             (       PAGING.ASM):00131                 BSR     EARLY                             ; FIND THE EARLIEST PAGE
3204 D612             (       PAGING.ASM):00132                 LDB     SWAP                              ; MOVE ITS INDEX
3206 D70D             (       PAGING.ASM):00133                 STB     ZPAGE                             ; INTO [ZPAGE]
                      (       PAGING.ASM):00134         
3208 DB0E             (       PAGING.ASM):00135                 ADDB    PAGE0                             ; CALC ABSOLUTE PAGE OF BUFFER
320A D74A             (       PAGING.ASM):00136                 STB     DBUFF                             ; TELL DISK WHERE TO PUT DATA
320C 0F4B             (       PAGING.ASM):00137                 CLR     DBUFF+1                           ; CLEAR LSB
                      (       PAGING.ASM):00138         
320E 8E2500           (       PAGING.ASM):00139                 LDX     #PTABLE                           ; GET THE PAGING TABLE ADDRESS
3211 D60D             (       PAGING.ASM):00140                 LDB     ZPAGE                             ; AND THE BUFFER OFFSET
3213 3A               (       PAGING.ASM):00141                 ABX                                       ; ADD THE OFFSET
3214 3A               (       PAGING.ASM):00142                 ABX                                       ; TWICE FOR WORD ALIGNMENT
3215 DC4C             (       PAGING.ASM):00143                 LDD     DBLOCK                            ; RETRIEVE PAGE ID
3217 ED84             (       PAGING.ASM):00144                 STD     ,X                                ; SPLICE IT INTO THE TABLE
                      (       PAGING.ASM):00145         
3219 BD37D9           (       PAGING.ASM):00146                 JSR     GETDSK                            ; MOVE BLOCK [DBLOCK] TO [DBUFF]
                      (       PAGING.ASM):00147         
                      (       PAGING.ASM):00148         ; UPDATE THE TIMESTAMP
                      (       PAGING.ASM):00149         
321C                  (       PAGING.ASM):00150         PG1:
321C D60D             (       PAGING.ASM):00151                 LDB     ZPAGE                             ; GET BUFFER INDEX
321E 8E2650           (       PAGING.ASM):00152                 LDX     #LRUMAP                           ; CALC ADDRESS OF ENTRY
3221 3A               (       PAGING.ASM):00153                 ABX                                       ; IN TIMESTAMP MAP
3222 A684             (       PAGING.ASM):00154                 LDA     ,X                                ; GET BUFFER'S LAST STAMP
3224 9111             (       PAGING.ASM):00155                 CMPA    STAMP                             ; SAME AS CURRENT STAMP?
3226 2729             (       PAGING.ASM):00156                 BEQ     PG5                               ; EXIT IF SO
                      (       PAGING.ASM):00157         
3228 0C11             (       PAGING.ASM):00158                 INC     STAMP                             ; UPDATE [STAMP]
322A 261B             (       PAGING.ASM):00159                 BNE     PG4                               ; IF STAMP OVERFLOWS ...
                      (       PAGING.ASM):00160         
                      (       PAGING.ASM):00161         ; HANDLE STAMP OVERFLOW
                      (       PAGING.ASM):00162         
322C 8D28             (       PAGING.ASM):00163                 BSR     EARLY                             ; GET EARLIEST STAMP INTO [LRU]
                      (       PAGING.ASM):00164         
322E 8E2650           (       PAGING.ASM):00165                 LDX     #LRUMAP                           ; GET BASE ADDRESS OF STAMPS
3231 5F               (       PAGING.ASM):00166                 CLRB                                      ; INIT STAMP COUNTER
3232                  (       PAGING.ASM):00167         PG2:
3232 A684             (       PAGING.ASM):00168                 LDA     ,X                                ; GET A STAMP
3234 2704             (       PAGING.ASM):00169                 BEQ     PG3                               ; SKIP IF ALREADY ZERO
3236 900A             (       PAGING.ASM):00170                 SUBA    LRU                               ; ELSE SUBTRACT OFF EARLIEST STAMP
3238 A784             (       PAGING.ASM):00171                 STA     ,X                                ; AND REPLACE IT
323A                  (       PAGING.ASM):00172         PG3:
323A 3001             (       PAGING.ASM):00173                 LEAX    +1,X                              ; INCREMENT BASE ADDRESS
323C 5C               (       PAGING.ASM):00174                 INCB                                      ; AND COUNTER
323D D10C             (       PAGING.ASM):00175                 CMPB    PMAX                              ; OUT OF PAGES YET?
323F 25F1             (       PAGING.ASM):00176                 BLO     PG2                               ; LOOP TILL DONE
                      (       PAGING.ASM):00177         
3241 8600             (       PAGING.ASM):00178                 LDA     #0                                ; TURN BACK THE CLOCK
3243 900A             (       PAGING.ASM):00179                 SUBA    LRU                               ; ON [STAMP]
3245 9711             (       PAGING.ASM):00180                 STA     STAMP                             ; TO REFLECT TABLE FUDGING
                      (       PAGING.ASM):00181         
                      (       PAGING.ASM):00182         ; STAMP THE PAGE WITH CURRENT TIME
                      (       PAGING.ASM):00183         
3247                  (       PAGING.ASM):00184         PG4:
3247 8E2650           (       PAGING.ASM):00185                 LDX     #LRUMAP
324A D60D             (       PAGING.ASM):00186                 LDB     ZPAGE
324C 3A               (       PAGING.ASM):00187                 ABX
324D 9611             (       PAGING.ASM):00188                 LDA     STAMP
324F A784             (       PAGING.ASM):00189                 STA     ,X
                      (       PAGING.ASM):00190         
3251                  (       PAGING.ASM):00191         PG5:
3251 D60D             (       PAGING.ASM):00192                 LDB     ZPAGE                             ; GET PAGE OFFSET
3253 DB0E             (       PAGING.ASM):00193                 ADDB    PAGE0                             ; MAKE IT ABSOLUTE
3255 39               (       PAGING.ASM):00194                 RTS                                       ; AND RETURN IT IN [B]
                      (       PAGING.ASM):00195         
                      (       PAGING.ASM):00196         ; -------------------------
                      (       PAGING.ASM):00197         ; LOCATE EARLIEST TIMESTAMP
                      (       PAGING.ASM):00198         ; -------------------------
                      (       PAGING.ASM):00199         
                      (       PAGING.ASM):00200         ; EXIT: [LRU] = EARLIEST STAMP READING
                      (       PAGING.ASM):00201         ;       [SWAP] = INDEX TO EARLIEST BUFFER
                      (       PAGING.ASM):00202         
3256                  (       PAGING.ASM):00203         EARLY:
3256 0F12             (       PAGING.ASM):00204                 CLR     SWAP                              ; RESET [SWAP]
3258 B62650           (       PAGING.ASM):00205                 LDA     LRUMAP                            ; FETCH 1ST READING FOR COMPARISONS
325B 8E2651           (       PAGING.ASM):00206                 LDX     #LRUMAP+1                         ; POINT TO 2ND READING
325E C601             (       PAGING.ASM):00207                 LDB     #1                                ; INIT BUFFER INDEX
3260                  (       PAGING.ASM):00208         EAR0:
3260 A184             (       PAGING.ASM):00209                 CMPA    ,X                                ; IS THIS STAMP EARLIER THAN [A]?
3262 2504             (       PAGING.ASM):00210                 BLO     EAR1                              ; NO, TRY NEXT
3264 A684             (       PAGING.ASM):00211                 LDA     ,X                                ; ELSE MAKE THIS READING THE "NEW" LOWEST
3266 D712             (       PAGING.ASM):00212                 STB     SWAP                              ; AND REMEMBER WHERE WE FOUND IT
3268                  (       PAGING.ASM):00213         EAR1:
3268 3001             (       PAGING.ASM):00214                 LEAX    +1,X                              ; UPDATE POINTER
326A 5C               (       PAGING.ASM):00215                 INCB                                      ; AND BUFFER INDEX
326B D10C             (       PAGING.ASM):00216                 CMPB    PMAX                              ; OUT OF BUFFERS YET?
326D 25F1             (       PAGING.ASM):00217                 BLO     EAR0                              ; LOOP TILL DONE
                      (       PAGING.ASM):00218         
326F 970A             (       PAGING.ASM):00219                 STA     LRU                               ; SAVE EARLIEST STAMP FOUND
3271 39               (       PAGING.ASM):00220                 RTS                                       ; AND RETURN
                      (       PAGING.ASM):00221         
                      (       PAGING.ASM):00222         ; ---------------------
                      (       PAGING.ASM):00223         ; POINT [MPC] TO [TEMP]
                      (       PAGING.ASM):00224         ; ---------------------
                      (       PAGING.ASM):00225         
3272                  (       PAGING.ASM):00226         SETWRD:
3272 DC3F             (       PAGING.ASM):00227                 LDD     TEMP
3274 DD1B             (       PAGING.ASM):00228                 STD     MPCM
3276 0F1A             (       PAGING.ASM):00229                 CLR     MPCH
3278 0F1F             (       PAGING.ASM):00230                 CLR     MPCFLG
327A 39               (       PAGING.ASM):00231                 RTS
                      (     cubixzip.asm):00065                 INCLUDE ZSTRING.ASM
                      (      ZSTRING.ASM):00001         ;       PAGE
                      (      ZSTRING.ASM):00002         ;       SBTTL "--- Z-STRING HANDLERS ---"
                      (      ZSTRING.ASM):00003         
                      (      ZSTRING.ASM):00004         ; -----------------
                      (      ZSTRING.ASM):00005         ; POINT TO Z-STRING
                      (      ZSTRING.ASM):00006         ; -----------------
                      (      ZSTRING.ASM):00007         
327B                  (      ZSTRING.ASM):00008         SETSTR:
327B 4F               (      ZSTRING.ASM):00009                 CLRA
327C 0840             (      ZSTRING.ASM):00010                 ASL     TEMP+1
327E 093F             (      ZSTRING.ASM):00011                 ROL     TEMP
3280 49               (      ZSTRING.ASM):00012                 ROLA
3281 971A             (      ZSTRING.ASM):00013                 STA     MPCH
3283 DC3F             (      ZSTRING.ASM):00014                 LDD     TEMP
3285 DD1B             (      ZSTRING.ASM):00015                 STD     MPCM
3287 0F1F             (      ZSTRING.ASM):00016                 CLR     MPCFLG
3289                  (      ZSTRING.ASM):00017         ZSTEX:
3289 39               (      ZSTRING.ASM):00018                 RTS
                      (      ZSTRING.ASM):00019         
                      (      ZSTRING.ASM):00020         ; --------------
                      (      ZSTRING.ASM):00021         ; PRINT Z-STRING
                      (      ZSTRING.ASM):00022         ; --------------
                      (      ZSTRING.ASM):00023         
328A                  (      ZSTRING.ASM):00024         PZSTR:
328A 0F2A             (      ZSTRING.ASM):00025                 CLR     CSPERM                            ; PERMANENT CHARSET
328C 0F2B             (      ZSTRING.ASM):00026                 CLR     STBYTF                            ; RESET STRING BYTE FLAG
328E 86FF             (      ZSTRING.ASM):00027                 LDA     #$FF
3290 9729             (      ZSTRING.ASM):00028                 STA     CSTEMP                            ; NO TEMP CHARSET ACTIVE
                      (      ZSTRING.ASM):00029         
3292                  (      ZSTRING.ASM):00030         PZSTRL:
3292 BD3344           (      ZSTRING.ASM):00031                 JSR     GETZCH                            ; GET A Z-CHARACTER
3295 25F2             (      ZSTRING.ASM):00032                 BCS     ZSTEX                             ; END OF STRING IF CARRY SET
3297 9743             (      ZSTRING.ASM):00033                 STA     MASK                              ; SAVE CHAR HERE
3299 2741             (      ZSTRING.ASM):00034                 BEQ     PZSTRS                            ; O = SPACE CHAR
329B 8104             (      ZSTRING.ASM):00035                 CMPA    #4                                ; IS THIS AN F-WORD?
329D 2557             (      ZSTRING.ASM):00036                 BLO     PZSTRF                            ; APPARENTLY SO
329F 8106             (      ZSTRING.ASM):00037                 CMPA    #6                                ; SHIFT CHAR?
32A1 253D             (      ZSTRING.ASM):00038                 BLO     PZSTRT                            ; YES, CHANGE CHARSET
                      (      ZSTRING.ASM):00039         
32A3 BD3338           (      ZSTRING.ASM):00040                 JSR     GETMOD
32A6 4D               (      ZSTRING.ASM):00041                 TSTA                                      ; IS THIS CHARSET 0?
32A7 2609             (      ZSTRING.ASM):00042                 BNE     PZSTR1                            ; NOPE
                      (      ZSTRING.ASM):00043         
                      (      ZSTRING.ASM):00044         ; PRINT LOWER-CASE CHAR (CHARSET 0)
                      (      ZSTRING.ASM):00045         
32A9 865B             (      ZSTRING.ASM):00046                 LDA     #$61-6                            ; ASCII "a" MINUS Z-OFFSET
32AB                  (      ZSTRING.ASM):00047         PZSTP0:
32AB 9B43             (      ZSTRING.ASM):00048                 ADDA    MASK                              ; ADD CHARACTER
32AD                  (      ZSTRING.ASM):00049         PZSTP1:
32AD BD36BB           (      ZSTRING.ASM):00050                 JSR     COUT                              ; PRINT RESULT
32B0 20E0             (      ZSTRING.ASM):00051                 BRA     PZSTRL                            ; AND FETCH ANOTHER Z-CHAR
                      (      ZSTRING.ASM):00052         
                      (      ZSTRING.ASM):00053         ; CHARSET 1 OR 2?
                      (      ZSTRING.ASM):00054         
32B2                  (      ZSTRING.ASM):00055         PZSTR1:
32B2 8101             (      ZSTRING.ASM):00056                 CMPA    #1                                ; SET 1?
32B4 2604             (      ZSTRING.ASM):00057                 BNE     PZSTR2                            ; NOPE, IT'S SET 2
                      (      ZSTRING.ASM):00058         
                      (      ZSTRING.ASM):00059         ; PRINT UPPER-CASE CHAR (CHARSET 1)
                      (      ZSTRING.ASM):00060         
32B6 863B             (      ZSTRING.ASM):00061                 LDA     #$41-6                            ; ASCII "A" MINUS Z-OFFSET
32B8 20F1             (      ZSTRING.ASM):00062                 BRA     PZSTP0                            ; AND SO ON ...
                      (      ZSTRING.ASM):00063         
                      (      ZSTRING.ASM):00064         ; DECODE/PRINT CHARSET 2
                      (      ZSTRING.ASM):00065         
32BA                  (      ZSTRING.ASM):00066         PZSTR2:
32BA D643             (      ZSTRING.ASM):00067                 LDB     MASK                              ; RETRIEVE Z-CHAR
32BC C006             (      ZSTRING.ASM):00068                 SUBB    #6                                ; CONVERT TO ZERO-ALIGNED INDEX
32BE 2707             (      ZSTRING.ASM):00069                 BEQ     PZSTRA                            ; IF ZERO, IT'S "DIRECT" ASCII
32C0 8E3457           (      ZSTRING.ASM):00070                 LDX     #CHRTBL                           ; ELSE GET BASE OF DECODE TABLE
32C3 A685             (      ZSTRING.ASM):00071                 LDA     B,X                               ; GET CHAR FROM TABLE
32C5 20E6             (      ZSTRING.ASM):00072                 BRA     PZSTP1                            ; AND PRINT IT!
                      (      ZSTRING.ASM):00073         
                      (      ZSTRING.ASM):00074         ; DECODE/PRINT A "DIRECT" ASCII CHAR
                      (      ZSTRING.ASM):00075         
32C7                  (      ZSTRING.ASM):00076         PZSTRA:
32C7 BD3344           (      ZSTRING.ASM):00077                 JSR     GETZCH                            ; GET NEXT Z-BYTE
32CA 48               (      ZSTRING.ASM):00078                 ASLA                                      ; SHIFT INTO POSITION
32CB 48               (      ZSTRING.ASM):00079                 ASLA
32CC 48               (      ZSTRING.ASM):00080                 ASLA
32CD 48               (      ZSTRING.ASM):00081                 ASLA
32CE 48               (      ZSTRING.ASM):00082                 ASLA
32CF 9743             (      ZSTRING.ASM):00083                 STA     MASK                              ; SAVE MSB
32D1 BD3344           (      ZSTRING.ASM):00084                 JSR     GETZCH                            ; FETCH LSB
32D4 9744             (      ZSTRING.ASM):00085                 STA     MASK+1                            ; SAVE THAT, TOO
32D6 9643             (      ZSTRING.ASM):00086                 LDA     MASK                              ; GET MSB
32D8 9A44             (      ZSTRING.ASM):00087                 ORA     MASK+1                            ; SUPERIMPOSE LSB
32DA 20D1             (      ZSTRING.ASM):00088                 BRA     PZSTP1                            ; AND PRINT RESULT
                      (      ZSTRING.ASM):00089         
                      (      ZSTRING.ASM):00090         ; PRINT A SPACE
                      (      ZSTRING.ASM):00091         
32DC                  (      ZSTRING.ASM):00092         PZSTRS:
32DC 8620             (      ZSTRING.ASM):00093                 LDA     #$20
32DE 20CD             (      ZSTRING.ASM):00094                 BRA     PZSTP1
                      (      ZSTRING.ASM):00095         
                      (      ZSTRING.ASM):00096         ; CHANGE CHARACTER SETS
                      (      ZSTRING.ASM):00097         
32E0                  (      ZSTRING.ASM):00098         PZSTRT:
32E0 8003             (      ZSTRING.ASM):00099                 SUBA    #3                                ; CONVERT TO 1 OR 2
32E2 1F89             (      ZSTRING.ASM):00100                 TFR     A,B
32E4 8D52             (      ZSTRING.ASM):00101                 BSR     GETMOD
32E6 2604             (      ZSTRING.ASM):00102                 BNE     PZSTRP                            ; NO, DO PERMANENT SHIFT
32E8 D729             (      ZSTRING.ASM):00103                 STB     CSTEMP                            ; JUST A TEMP-SHIFT
32EA 20A6             (      ZSTRING.ASM):00104                 BRA     PZSTRL
                      (      ZSTRING.ASM):00105         
32EC                  (      ZSTRING.ASM):00106         PZSTRP:
32EC D72A             (      ZSTRING.ASM):00107                 STB     CSPERM                            ; PERMANENT SHIFT
32EE 912A             (      ZSTRING.ASM):00108                 CMPA    CSPERM                            ; NEW SET SAME AS OLD?
32F0 27A0             (      ZSTRING.ASM):00109                 BEQ     PZSTRL                            ; YES, EXIT
32F2 0F2A             (      ZSTRING.ASM):00110                 CLR     CSPERM                            ; ELSE BACK TO SET 0
32F4 209C             (      ZSTRING.ASM):00111                 BRA     PZSTRL                            ; BEFORE FINISHING
                      (      ZSTRING.ASM):00112         
                      (      ZSTRING.ASM):00113         ; HANDLE AN F-WORD
                      (      ZSTRING.ASM):00114         
32F6                  (      ZSTRING.ASM):00115         PZSTRF:
32F6 4A               (      ZSTRING.ASM):00116                 DECA                                      ; CONVERT TO 0-2
32F7 C640             (      ZSTRING.ASM):00117                 LDB     #64                               ; TIMES 64
32F9 3D               (      ZSTRING.ASM):00118                 MUL
32FA D73C             (      ZSTRING.ASM):00119                 STB     PZSTFO                            ; SAVE FOR LATER
32FC BD3344           (      ZSTRING.ASM):00120                 JSR     GETZCH                            ; GET F-WORD INDEX
32FF 1F89             (      ZSTRING.ASM):00121                 TFR     A,B                               ; MOVE IT
3301 58               (      ZSTRING.ASM):00122                 ASLB                                      ; FORM WORD-ALIGNED INDEX
3302 DB3C             (      ZSTRING.ASM):00123                 ADDB    PZSTFO                            ; ADD OFFSET
3304 9E25             (      ZSTRING.ASM):00124                 LDX     FWORDS                            ; GET BASE ADDR OF FWORDS TABLE
3306 3A               (      ZSTRING.ASM):00125                 ABX                                       ; ADD THE OFFSET
3307 EC84             (      ZSTRING.ASM):00126                 LDD     ,X                                ; GET THE FWORD POINTER
3309 DD3F             (      ZSTRING.ASM):00127                 STD     TEMP                              ; AND SAVE IT
                      (      ZSTRING.ASM):00128         
                      (      ZSTRING.ASM):00129         ; SAVE THE STATE OF CURRENT Z-PRINT
                      (      ZSTRING.ASM):00130         
330B 961A             (      ZSTRING.ASM):00131                 LDA     MPCH
330D 3402             (      ZSTRING.ASM):00132                 PSHS    A
330F 962A             (      ZSTRING.ASM):00133                 LDA     CSPERM
3311 D62B             (      ZSTRING.ASM):00134                 LDB     STBYTF
3313 9E1B             (      ZSTRING.ASM):00135                 LDX     MPCM
3315 109E2C           (      ZSTRING.ASM):00136                 LDY     ZSTWRD
3318 3436             (      ZSTRING.ASM):00137                 PSHS    Y,X,B,A
                      (      ZSTRING.ASM):00138         
331A BD327B           (      ZSTRING.ASM):00139                 JSR     SETSTR                            ; PRINT THE F-WORD
331D BD328A           (      ZSTRING.ASM):00140                 JSR     PZSTR                             ; POINTED TO BY [TEMP]
                      (      ZSTRING.ASM):00141         
                      (      ZSTRING.ASM):00142         ; RESTORE THE OLD Z-STRING
                      (      ZSTRING.ASM):00143         
3320 3536             (      ZSTRING.ASM):00144                 PULS    Y,X,B,A
3322 109F2C           (      ZSTRING.ASM):00145                 STY     ZSTWRD
3325 9F1B             (      ZSTRING.ASM):00146                 STX     MPCM
3327 D72B             (      ZSTRING.ASM):00147                 STB     STBYTF
3329 972A             (      ZSTRING.ASM):00148                 STA     CSPERM
332B 3502             (      ZSTRING.ASM):00149                 PULS    A
332D 971A             (      ZSTRING.ASM):00150                 STA     MPCH
                      (      ZSTRING.ASM):00151         
332F 86FF             (      ZSTRING.ASM):00152                 LDA     #$FF
3331 9729             (      ZSTRING.ASM):00153                 STA     CSTEMP                            ; DISABLE TEMP CHARSET
3333 0F1F             (      ZSTRING.ASM):00154                 CLR     MPCFLG                            ; MPC HAS CHANGED!
3335 7E3292           (      ZSTRING.ASM):00155                 JMP     PZSTRL                            ; CONTINUE INNOCENTLY
                      (      ZSTRING.ASM):00156         
                      (      ZSTRING.ASM):00157         ; ----------------------
                      (      ZSTRING.ASM):00158         ; RETURN CURRENT CHARSET
                      (      ZSTRING.ASM):00159         ; ----------------------
                      (      ZSTRING.ASM):00160         
3338                  (      ZSTRING.ASM):00161         GETMOD:
3338 9629             (      ZSTRING.ASM):00162                 LDA     CSTEMP
333A 2A03             (      ZSTRING.ASM):00163                 BPL     GM
333C 962A             (      ZSTRING.ASM):00164                 LDA     CSPERM
333E 39               (      ZSTRING.ASM):00165                 RTS
                      (      ZSTRING.ASM):00166         
333F                  (      ZSTRING.ASM):00167         GM:
333F C6FF             (      ZSTRING.ASM):00168                 LDB     #$FF
3341 D729             (      ZSTRING.ASM):00169                 STB     CSTEMP
3343 39               (      ZSTRING.ASM):00170                 RTS
                      (      ZSTRING.ASM):00171         
                      (      ZSTRING.ASM):00172         ; ---------------
                      (      ZSTRING.ASM):00173         ; GET NEXT Z-CHAR
                      (      ZSTRING.ASM):00174         ; ---------------
                      (      ZSTRING.ASM):00175         
3344                  (      ZSTRING.ASM):00176         GETZCH:
3344 962B             (      ZSTRING.ASM):00177                 LDA     STBYTF                            ; WHICH BYTE?
3346 2A02             (      ZSTRING.ASM):00178                 BPL     GTZ0
3348 53               (      ZSTRING.ASM):00179                 COMB                                      ; SET CARRY
3349 39               (      ZSTRING.ASM):00180                 RTS                                       ; TO INDICATE "NO MORE CHARS"
                      (      ZSTRING.ASM):00181         
334A                  (      ZSTRING.ASM):00182         GTZ0:
334A 260F             (      ZSTRING.ASM):00183                 BNE     GETZH1                            ; NOT FIRST CHAR
334C 0C2B             (      ZSTRING.ASM):00184                 INC     STBYTF
334E BD3185           (      ZSTRING.ASM):00185                 JSR     GETWRD
3351 DC3F             (      ZSTRING.ASM):00186                 LDD     TEMP
3353 DD2C             (      ZSTRING.ASM):00187                 STD     ZSTWRD
3355 44               (      ZSTRING.ASM):00188                 LSRA
3356 44               (      ZSTRING.ASM):00189                 LSRA
3357                  (      ZSTRING.ASM):00190         GTEXIT:
3357 841F             (      ZSTRING.ASM):00191                 ANDA    #%00011111
3359 5F               (      ZSTRING.ASM):00192                 CLRB                                      ; CLEAR CARRY
335A 39               (      ZSTRING.ASM):00193                 RTS
                      (      ZSTRING.ASM):00194         
335B                  (      ZSTRING.ASM):00195         GETZH1:
335B 4A               (      ZSTRING.ASM):00196                 DECA
335C 2614             (      ZSTRING.ASM):00197                 BNE     GETZH2                            ; MUST BE LAST CHAR
335E 8602             (      ZSTRING.ASM):00198                 LDA     #2
3360 972B             (      ZSTRING.ASM):00199                 STA     STBYTF
3362 DC2C             (      ZSTRING.ASM):00200                 LDD     ZSTWRD
3364 44               (      ZSTRING.ASM):00201                 LSRA
3365 56               (      ZSTRING.ASM):00202                 RORB
3366 962C             (      ZSTRING.ASM):00203                 LDA     ZSTWRD
3368 44               (      ZSTRING.ASM):00204                 LSRA
3369 44               (      ZSTRING.ASM):00205                 LSRA
336A 56               (      ZSTRING.ASM):00206                 RORB
336B 54               (      ZSTRING.ASM):00207                 LSRB
336C 54               (      ZSTRING.ASM):00208                 LSRB
336D 54               (      ZSTRING.ASM):00209                 LSRB
336E                  (      ZSTRING.ASM):00210         GETZH3:
336E 1F98             (      ZSTRING.ASM):00211                 TFR     B,A                               ; EXPECTED HERE
3370 20E5             (      ZSTRING.ASM):00212                 BRA     GTEXIT
                      (      ZSTRING.ASM):00213         
3372                  (      ZSTRING.ASM):00214         GETZH2:
3372 0F2B             (      ZSTRING.ASM):00215                 CLR     STBYTF
3374 DC2C             (      ZSTRING.ASM):00216                 LDD     ZSTWRD
3376 2AF6             (      ZSTRING.ASM):00217                 BPL     GETZH3
3378 032B             (      ZSTRING.ASM):00218                 COM     STBYTF                            ; INDICATE END OF STRING
337A 20F2             (      ZSTRING.ASM):00219                 BRA     GETZH3
                      (      ZSTRING.ASM):00220         
                      (      ZSTRING.ASM):00221         ; -------------------
                      (      ZSTRING.ASM):00222         ; CONVERT TO Z-STRING
                      (      ZSTRING.ASM):00223         ; -------------------
                      (      ZSTRING.ASM):00224         
337C                  (      ZSTRING.ASM):00225         CONZST:
337C CC0505           (      ZSTRING.ASM):00226                 LDD     #$0505                            ; FILL OUTPUT BUFFER
337F DD34             (      ZSTRING.ASM):00227                 STD     ZSTBUO                            ; WITH PAD CHARS
3381 DD36             (      ZSTRING.ASM):00228                 STD     ZSTBUO+2
3383 DD38             (      ZSTRING.ASM):00229                 STD     ZSTBUO+4
                      (      ZSTRING.ASM):00230         
3385 4C               (      ZSTRING.ASM):00231                 INCA                                      ; = 6
3386 9743             (      ZSTRING.ASM):00232                 STA     MASK                              ; INIT CHAR COUNT
                      (      ZSTRING.ASM):00233         
3388 0F3D             (      ZSTRING.ASM):00234                 CLR     VAL                               ; RESET OUTPUT AND
338A 0F3F             (      ZSTRING.ASM):00235                 CLR     TEMP                              ; INPUT INDEXES
                      (      ZSTRING.ASM):00236         
338C                  (      ZSTRING.ASM):00237         CNZSL1:
338C D63F             (      ZSTRING.ASM):00238                 LDB     TEMP
338E 0C3F             (      ZSTRING.ASM):00239                 INC     TEMP
3390 8E002E           (      ZSTRING.ASM):00240                 LDX     #ZSTBUI                           ; POINT TO INPUT BUFFER
3393 A685             (      ZSTRING.ASM):00241                 LDA     B,X                               ; GRAB NEXT CHAR
3395 9744             (      ZSTRING.ASM):00242                 STA     MASK+1                            ; SAVE IT HERE
3397 2604             (      ZSTRING.ASM):00243                 BNE     CNZSL2                            ; IF CHAR WAS ZERO,
3399 8605             (      ZSTRING.ASM):00244                 LDA     #5                                ; USE A Z-PAD
339B 2025             (      ZSTRING.ASM):00245                 BRA     CNZSLO
                      (      ZSTRING.ASM):00246         
339D                  (      ZSTRING.ASM):00247         CNZSL2:
339D 9644             (      ZSTRING.ASM):00248                 LDA     MASK+1
339F BD341D           (      ZSTRING.ASM):00249                 JSR     ZCHRCS                            ; WHICH CHARSET TO USE?
33A2 4D               (      ZSTRING.ASM):00250                 TSTA
33A3 2711             (      ZSTRING.ASM):00251                 BEQ     CNZSLC                            ; IF CHARSET 0, USE LOWER CASE
33A5 8B03             (      ZSTRING.ASM):00252                 ADDA    #3
33A7 D63D             (      ZSTRING.ASM):00253                 LDB     VAL                               ; OUTPUT A TEMP SHIFT
33A9 8E0034           (      ZSTRING.ASM):00254                 LDX     #ZSTBUO
33AC A785             (      ZSTRING.ASM):00255                 STA     B,X
33AE 0C3D             (      ZSTRING.ASM):00256                 INC     VAL
33B0 0A43             (      ZSTRING.ASM):00257                 DEC     MASK
33B2 10270084         (      ZSTRING.ASM):00258                 LBEQ    CNZSLE
                      (      ZSTRING.ASM):00259         
33B6                  (      ZSTRING.ASM):00260         CNZSLC:
33B6 9644             (      ZSTRING.ASM):00261                 LDA     MASK+1
33B8 BD341D           (      ZSTRING.ASM):00262                 JSR     ZCHRCS
33BB 4A               (      ZSTRING.ASM):00263                 DECA
33BC 2A13             (      ZSTRING.ASM):00264                 BPL     CNZSC1                            ; NOT CHARSET 0!
33BE 9644             (      ZSTRING.ASM):00265                 LDA     MASK+1
33C0 805B             (      ZSTRING.ASM):00266                 SUBA    #$61-6                            ; ASCII "a" MINUS 6
                      (      ZSTRING.ASM):00267         
33C2                  (      ZSTRING.ASM):00268         CNZSLO:
33C2 D63D             (      ZSTRING.ASM):00269                 LDB     VAL
33C4 8E0034           (      ZSTRING.ASM):00270                 LDX     #ZSTBUO
33C7 A785             (      ZSTRING.ASM):00271                 STA     B,X
33C9 0C3D             (      ZSTRING.ASM):00272                 INC     VAL
33CB 0A43             (      ZSTRING.ASM):00273                 DEC     MASK
33CD 276B             (      ZSTRING.ASM):00274                 BEQ     CNZSLE                            ; ALL FINISHED
33CF 20BB             (      ZSTRING.ASM):00275                 BRA     CNZSL1                            ; ELSE LOOP BACK FOR MORE
                      (      ZSTRING.ASM):00276         
33D1                  (      ZSTRING.ASM):00277         CNZSC1:
33D1 2606             (      ZSTRING.ASM):00278                 BNE     CNZSC3                            ; MUST BE CHARSET 3
33D3 9644             (      ZSTRING.ASM):00279                 LDA     MASK+1
33D5 803B             (      ZSTRING.ASM):00280                 SUBA    #$41-6                            ; ASCII "A" MINUS 6
33D7 20E9             (      ZSTRING.ASM):00281                 BRA     CNZSLO
                      (      ZSTRING.ASM):00282         
33D9                  (      ZSTRING.ASM):00283         CNZSC3:
33D9 9644             (      ZSTRING.ASM):00284                 LDA     MASK+1
33DB BD340B           (      ZSTRING.ASM):00285                 JSR     CNZS2M                            ; IS IT IN TABLE?
33DE 26E2             (      ZSTRING.ASM):00286                 BNE     CNZSLO                            ; YES, OUTPUT THE CHAR
33E0 8606             (      ZSTRING.ASM):00287                 LDA     #6                                ; ELSE IT'S A "DIRECT" ASCII CHAR
33E2 D63D             (      ZSTRING.ASM):00288                 LDB     VAL
33E4 8E0034           (      ZSTRING.ASM):00289                 LDX     #ZSTBUO
33E7 A785             (      ZSTRING.ASM):00290                 STA     B,X                               ; SEND "DIRECT" TO OUTPUT
33E9 0C3D             (      ZSTRING.ASM):00291                 INC     VAL
33EB 0A43             (      ZSTRING.ASM):00292                 DEC     MASK
33ED 274B             (      ZSTRING.ASM):00293                 BEQ     CNZSLE                            ; NO MORE ROOM!
                      (      ZSTRING.ASM):00294         
                      (      ZSTRING.ASM):00295         ; CONVERT CHAR TO 2-BYTE DIRECT ASCII
                      (      ZSTRING.ASM):00296         
33EF 9644             (      ZSTRING.ASM):00297                 LDA     MASK+1
33F1 44               (      ZSTRING.ASM):00298                 LSRA
33F2 44               (      ZSTRING.ASM):00299                 LSRA
33F3 44               (      ZSTRING.ASM):00300                 LSRA
33F4 44               (      ZSTRING.ASM):00301                 LSRA
33F5 44               (      ZSTRING.ASM):00302                 LSRA
33F6 8403             (      ZSTRING.ASM):00303                 ANDA    #%00000011
33F8 D63D             (      ZSTRING.ASM):00304                 LDB     VAL
33FA 8E0034           (      ZSTRING.ASM):00305                 LDX     #ZSTBUO
33FD A785             (      ZSTRING.ASM):00306                 STA     B,X
33FF 0C3D             (      ZSTRING.ASM):00307                 INC     VAL
3401 0A43             (      ZSTRING.ASM):00308                 DEC     MASK
3403 2735             (      ZSTRING.ASM):00309                 BEQ     CNZSLE                            ; NO MORE ROOM!
3405 9644             (      ZSTRING.ASM):00310                 LDA     MASK+1
3407 841F             (      ZSTRING.ASM):00311                 ANDA    #%00011111                        ; FORM 2ND Z-BYTE
3409 20B7             (      ZSTRING.ASM):00312                 BRA     CNZSLO                            ; AND OUTPUT IT
                      (      ZSTRING.ASM):00313         
                      (      ZSTRING.ASM):00314         ; ----------------------
                      (      ZSTRING.ASM):00315         ; SEARCH CHARSET 3 TABLE
                      (      ZSTRING.ASM):00316         ; ----------------------
                      (      ZSTRING.ASM):00317         
340B                  (      ZSTRING.ASM):00318         CNZS2M:
340B 8E3457           (      ZSTRING.ASM):00319                 LDX     #CHRTBL
340E C619             (      ZSTRING.ASM):00320                 LDB     #25
3410                  (      ZSTRING.ASM):00321         CNLOOP:
3410 A185             (      ZSTRING.ASM):00322                 CMPA    B,X
3412 2704             (      ZSTRING.ASM):00323                 BEQ     CNOK
3414 5A               (      ZSTRING.ASM):00324                 DECB
3415 26F9             (      ZSTRING.ASM):00325                 BNE     CNLOOP
3417 39               (      ZSTRING.ASM):00326                 RTS                                       ; RETURN ZERO IN B IF NO MATCH
                      (      ZSTRING.ASM):00327         
3418                  (      ZSTRING.ASM):00328         CNOK:
3418 1F98             (      ZSTRING.ASM):00329                 TFR     B,A                               ; EXPECTED IN [A]
341A 8B06             (      ZSTRING.ASM):00330                 ADDA    #6                                ; CONVERT TO Z-CHAR
341C 39               (      ZSTRING.ASM):00331                 RTS
                      (      ZSTRING.ASM):00332         
                      (      ZSTRING.ASM):00333         ; -------------------------
                      (      ZSTRING.ASM):00334         ; DETERMINE CHARSET OF CHAR
                      (      ZSTRING.ASM):00335         ; -------------------------
                      (      ZSTRING.ASM):00336         
341D                  (      ZSTRING.ASM):00337         ZCHRCS:
341D 8161             (      ZSTRING.ASM):00338                 CMPA    #$61                              ; ASCII "a"
341F 2506             (      ZSTRING.ASM):00339                 BLO     ZCHR1
3421 817B             (      ZSTRING.ASM):00340                 CMPA    #$7B                              ; ASCII "z"+1
3423 2402             (      ZSTRING.ASM):00341                 BHS     ZCHR1
3425 4F               (      ZSTRING.ASM):00342                 CLRA                                      ; IT'S CHARSET 0
3426 39               (      ZSTRING.ASM):00343                 RTS
                      (      ZSTRING.ASM):00344         
3427                  (      ZSTRING.ASM):00345         ZCHR1:
3427 8141             (      ZSTRING.ASM):00346                 CMPA    #$41                              ; ASCII "A"
3429 2507             (      ZSTRING.ASM):00347                 BLO     ZCHR2
342B 815B             (      ZSTRING.ASM):00348                 CMPA    #$5B                              ; ASCII "Z"+1
342D 2403             (      ZSTRING.ASM):00349                 BHS     ZCHR2
342F 8601             (      ZSTRING.ASM):00350                 LDA     #1                                ; IT'S CHARSET 1
3431 39               (      ZSTRING.ASM):00351                 RTS
                      (      ZSTRING.ASM):00352         
3432                  (      ZSTRING.ASM):00353         ZCHR2:
3432 4D               (      ZSTRING.ASM):00354                 TSTA
3433 2704             (      ZSTRING.ASM):00355                 BEQ     ZCHRX                             ; EXIT IF ZERO
3435 2B02             (      ZSTRING.ASM):00356                 BMI     ZCHRX                             ; OR NEGATIVE
3437 8602             (      ZSTRING.ASM):00357                 LDA     #2                                ; ELSE IT'S CHARSET 2
3439                  (      ZSTRING.ASM):00358         ZCHRX:
3439 39               (      ZSTRING.ASM):00359                 RTS
                      (      ZSTRING.ASM):00360         
                      (      ZSTRING.ASM):00361         ; ---------------
                      (      ZSTRING.ASM):00362         ; CRUSH 6 Z-CHARS
                      (      ZSTRING.ASM):00363         ; ---------------
                      (      ZSTRING.ASM):00364         
343A                  (      ZSTRING.ASM):00365         CNZSLE:
343A DC34             (      ZSTRING.ASM):00366                 LDD     ZSTBUO                            ; HANDLE 1ST TRIPLET
343C 58               (      ZSTRING.ASM):00367                 ASLB
343D 58               (      ZSTRING.ASM):00368                 ASLB
343E 58               (      ZSTRING.ASM):00369                 ASLB
343F 58               (      ZSTRING.ASM):00370                 ASLB
3440 49               (      ZSTRING.ASM):00371                 ROLA
3441 58               (      ZSTRING.ASM):00372                 ASLB
3442 49               (      ZSTRING.ASM):00373                 ROLA
3443 DA36             (      ZSTRING.ASM):00374                 ORB     ZSTBUO+2
3445 DD34             (      ZSTRING.ASM):00375                 STD     ZSTBUO
                      (      ZSTRING.ASM):00376         
3447 DC37             (      ZSTRING.ASM):00377                 LDD     ZSTBUO+3                          ; HANDLE 2ND TRIPLET
3449 58               (      ZSTRING.ASM):00378                 ASLB
344A 58               (      ZSTRING.ASM):00379                 ASLB
344B 58               (      ZSTRING.ASM):00380                 ASLB
344C 58               (      ZSTRING.ASM):00381                 ASLB
344D 49               (      ZSTRING.ASM):00382                 ROLA
344E 58               (      ZSTRING.ASM):00383                 ASLB
344F 49               (      ZSTRING.ASM):00384                 ROLA
3450 DA39             (      ZSTRING.ASM):00385                 ORB     ZSTBUO+5
3452 8A80             (      ZSTRING.ASM):00386                 ORA     #%10000000                        ; SET SIGN BIT OF LAST Z-BYTE
3454 DD36             (      ZSTRING.ASM):00387                 STD     ZSTBUO+2
3456 39               (      ZSTRING.ASM):00388                 RTS
                      (      ZSTRING.ASM):00389         
                      (      ZSTRING.ASM):00390         ; ----------------------
                      (      ZSTRING.ASM):00391         ; CHARSET 2 DECODE TABLE
                      (      ZSTRING.ASM):00392         ; ----------------------
                      (      ZSTRING.ASM):00393         
3457                  (      ZSTRING.ASM):00394         CHRTBL:
3457 00               (      ZSTRING.ASM):00395                 FCB     0                                 ; DUMMY BYTE
3458 0D               (      ZSTRING.ASM):00396                 FCB     $0D                               ; CARRIAGE RETURN
3459 3031323334353637 (      ZSTRING.ASM):00397                 FCC     "0123456789.,!?_#"
     38392E2C213F5F23
3469 27               (      ZSTRING.ASM):00398                 FCB     $27                               ; SINGLE QUOTE
346A 22               (      ZSTRING.ASM):00399                 FCB     $22                               ; DOUBLE QUOTE
346B 2F5C2D3A2829     (      ZSTRING.ASM):00400                 FCC     "/\-:()"
                      (     cubixzip.asm):00066                 INCLUDE OBJECTS.ASM
                      (      OBJECTS.ASM):00001         ;       PAGE
                      (      OBJECTS.ASM):00002         ;       SBTTL "--- OBJECT & PROPERTY HANDLERS ---"
                      (      OBJECTS.ASM):00003         
3471                  (      OBJECTS.ASM):00004         PROPB:
3471 9603             (      OBJECTS.ASM):00005                 LDA     ARG1+1
3473 BD34D4           (      OBJECTS.ASM):00006                 JSR     OBJLOC
3476 9E3F             (      OBJECTS.ASM):00007                 LDX     TEMP
3478 EC07             (      OBJECTS.ASM):00008                 LDD     7,X
347A C33F00           (      OBJECTS.ASM):00009                 ADDD    #ZCODE
347D DD3F             (      OBJECTS.ASM):00010                 STD     TEMP                              ; EXPECTED HERE
347F 1F01             (      OBJECTS.ASM):00011                 TFR     D,X
3481 E684             (      OBJECTS.ASM):00012                 LDB     ,X                                ; GET FIRST BYTE (LENGTH OF DESC)
3483 58               (      OBJECTS.ASM):00013                 ASLB                                      ; WORD-ALIGN IT
3484 5C               (      OBJECTS.ASM):00014                 INCB                                      ; AND POINT JUST PAST IT
3485 39               (      OBJECTS.ASM):00015                 RTS
                      (      OBJECTS.ASM):00016         
3486                  (      OBJECTS.ASM):00017         PROPN:
3486 9E3F             (      OBJECTS.ASM):00018                 LDX     TEMP
3488 3A               (      OBJECTS.ASM):00019                 ABX
3489 A684             (      OBJECTS.ASM):00020                 LDA     ,X
348B 841F             (      OBJECTS.ASM):00021                 ANDA    #%00011111
348D 39               (      OBJECTS.ASM):00022                 RTS
                      (      OBJECTS.ASM):00023         
348E                  (      OBJECTS.ASM):00024         PROPL:
348E 9E3F             (      OBJECTS.ASM):00025                 LDX     TEMP
3490 3A               (      OBJECTS.ASM):00026                 ABX
3491 A684             (      OBJECTS.ASM):00027                 LDA     ,X
3493 46               (      OBJECTS.ASM):00028                 RORA
3494 46               (      OBJECTS.ASM):00029                 RORA
3495 46               (      OBJECTS.ASM):00030                 RORA
3496 46               (      OBJECTS.ASM):00031                 RORA
3497 46               (      OBJECTS.ASM):00032                 RORA
3498 8407             (      OBJECTS.ASM):00033                 ANDA    #%00000111
349A 39               (      OBJECTS.ASM):00034                 RTS
                      (      OBJECTS.ASM):00035         
349B                  (      OBJECTS.ASM):00036         PROPNX:
349B 8DF1             (      OBJECTS.ASM):00037                 BSR     PROPL
349D 973D             (      OBJECTS.ASM):00038                 STA     VAL
349F                  (      OBJECTS.ASM):00039         PPX:
349F 5C               (      OBJECTS.ASM):00040                 INCB
34A0 0A3D             (      OBJECTS.ASM):00041                 DEC     VAL
34A2 2AFB             (      OBJECTS.ASM):00042                 BPL     PPX
34A4 5C               (      OBJECTS.ASM):00043                 INCB
34A5 39               (      OBJECTS.ASM):00044                 RTS
                      (      OBJECTS.ASM):00045         
34A6                  (      OBJECTS.ASM):00046         FLAGSU:
34A6 9603             (      OBJECTS.ASM):00047                 LDA     ARG1+1
34A8 BD34D4           (      OBJECTS.ASM):00048                 JSR     OBJLOC
34AB 9605             (      OBJECTS.ASM):00049                 LDA     ARG2+1
34AD 8110             (      OBJECTS.ASM):00050                 CMPA    #16
34AF 2508             (      OBJECTS.ASM):00051                 BLO     FLGSU1
34B1 8010             (      OBJECTS.ASM):00052                 SUBA    #16
34B3 9E3F             (      OBJECTS.ASM):00053                 LDX     TEMP
34B5 3002             (      OBJECTS.ASM):00054                 LEAX    2,X
34B7 9F3F             (      OBJECTS.ASM):00055                 STX     TEMP
                      (      OBJECTS.ASM):00056         
34B9                  (      OBJECTS.ASM):00057         FLGSU1:
34B9 973E             (      OBJECTS.ASM):00058                 STA     VAL+1
34BB CC0001           (      OBJECTS.ASM):00059                 LDD     #1
34BE DD43             (      OBJECTS.ASM):00060                 STD     MASK
34C0 C60F             (      OBJECTS.ASM):00061                 LDB     #15
34C2 D03E             (      OBJECTS.ASM):00062                 SUBB    VAL+1
                      (      OBJECTS.ASM):00063         
34C4                  (      OBJECTS.ASM):00064         FLGSU2:
34C4 2707             (      OBJECTS.ASM):00065                 BEQ     FLGSU3
34C6 0844             (      OBJECTS.ASM):00066                 ASL     MASK+1
34C8 0943             (      OBJECTS.ASM):00067                 ROL     MASK
34CA 5A               (      OBJECTS.ASM):00068                 DECB
34CB 20F7             (      OBJECTS.ASM):00069                 BRA     FLGSU2
                      (      OBJECTS.ASM):00070         
34CD                  (      OBJECTS.ASM):00071         FLGSU3:
34CD 9E3F             (      OBJECTS.ASM):00072                 LDX     TEMP
34CF EC84             (      OBJECTS.ASM):00073                 LDD     ,X
34D1 DD3D             (      OBJECTS.ASM):00074                 STD     VAL
34D3 39               (      OBJECTS.ASM):00075                 RTS
                      (      OBJECTS.ASM):00076         
34D4                  (      OBJECTS.ASM):00077         OBJLOC:
34D4 C609             (      OBJECTS.ASM):00078                 LDB     #9                                ; NUMBER IN [A] TIMES 9
34D6 3D               (      OBJECTS.ASM):00079                 MUL
34D7 C30035           (      OBJECTS.ASM):00080                 ADDD    #53                               ; PLUS 53
34DA F33F0A           (      OBJECTS.ASM):00081                 ADDD    ZCODE+ZOBJEC                      ; Z-ADDRESS OF OBJECT TABLE
34DD C33F00           (      OBJECTS.ASM):00082                 ADDD    #ZCODE                            ; FORM ABSOLUTE ADDRESS
34E0 DD3F             (      OBJECTS.ASM):00083                 STD     TEMP
34E2 39               (      OBJECTS.ASM):00084                 RTS
                      (     cubixzip.asm):00067         
                      (     cubixzip.asm):00068         ;TITLE "ZIP/6809-B INFOCOM, INC. --- CUBIX DEPENDENT"
                      (     cubixzip.asm):00069                 INCLUDE IO.ASM
                      (           IO.ASM):00001         ;       PAGE
                      (           IO.ASM):00002         ;       SBTTL "--- OS EQUATES ---"
                      (           IO.ASM):00003         
     000D             (           IO.ASM):00004         EOL             EQU $0D                           ; END-OF-LINE CHARACTER
     0008             (           IO.ASM):00005         BS              EQU $08                           ; BACKSPACE CHARACTER
     0020             (           IO.ASM):00006         SPACE           EQU $20                           ; SPACE CHARACTER
                      (           IO.ASM):00007         
                      (           IO.ASM):00008         ;        PAGE
                      (           IO.ASM):00009         ;        SBTTL   "I/O PRIMITIVES"
                      (           IO.ASM):00010         
                      (           IO.ASM):00011         
                      (           IO.ASM):00012         
                      (           IO.ASM):00013         ; --------------------
                      (           IO.ASM):00014         ; ACCESS OS CHAR-PRINT
                      (           IO.ASM):00015         ; --------------------
                      (           IO.ASM):00016         
                      (           IO.ASM):00017         
34E3                  (           IO.ASM):00018         OUTCHR:
34E3 3477             (           IO.ASM):00019                 PSHS    A,B,X,Y,U,CC
34E5 3F               (           IO.ASM):00020                 SWI
34E6 21               (           IO.ASM):00021                 FCB     33                                ;DISPLAY
34E7 3577             (           IO.ASM):00022                 PULS    A,B,X,Y,U,CC
34E9 39               (           IO.ASM):00023                 RTS
                      (           IO.ASM):00024         
                      (           IO.ASM):00025         ; -----------------
                      (           IO.ASM):00026         ; READ A SINGLE KEY
                      (           IO.ASM):00027         ; -----------------
                      (           IO.ASM):00028         
                      (           IO.ASM):00029         ; EXIT: KEYCODE IN [A]
                      (           IO.ASM):00030         
34EA                  (           IO.ASM):00031         BADKEY:
34EA BD360A           (           IO.ASM):00032                 JSR     BOOP                              ; RAZZ
34ED 2002             (           IO.ASM):00033                 BRA     GK                                ; AND TRY AGAIN
                      (           IO.ASM):00034         
34EF                  (           IO.ASM):00035         GETKEY:
34EF 3475             (           IO.ASM):00036                 PSHS    U,X,Y,B,CC                        ; SAVE THESE
34F1                  (           IO.ASM):00037         GK:
34F1 3F               (           IO.ASM):00038                 SWI
34F2 23               (           IO.ASM):00039                 FCB     35
34F3 2708             (           IO.ASM):00040                 BEQ     KTEST                             ; got a key
34F5 0C58             (           IO.ASM):00041                 INC     RAND1                             ; GENERATE RANDOMNESS
34F7 2602             (           IO.ASM):00042                 BNE     >
34F9 0C59             (           IO.ASM):00043                 INC     RAND2
                      (           IO.ASM):00044         !
34FB 20F4             (           IO.ASM):00045                 BRA     GK
34FD                  (           IO.ASM):00046         KTEST:
34FD 9755             (           IO.ASM):00047                 STA     IOCHAR                            ; STORE THE KEYPRESS
                      (           IO.ASM):00048         
                      (           IO.ASM):00049         ; KEYCODE IN [A]
                      (           IO.ASM):00050         
34FF                  (           IO.ASM):00051         QKEY:
34FF 810D             (           IO.ASM):00052                 CMPA    #EOL                              ; "ENTER" IS FINE
3501 271A             (           IO.ASM):00053                 BEQ     CLICK
3503 8108             (           IO.ASM):00054                 CMPA    #BS                               ; SO IS "LEFT ARROW"
3505 2716             (           IO.ASM):00055                 BEQ     CLICK
                      (           IO.ASM):00056         
3507 8161             (           IO.ASM):00057                 CMPA    #$61                              ; LOWER-CASE ALPHA?
3509 250A             (           IO.ASM):00058                 BLO     PKICK                             ; NO, CHECK FOR OTHERS
350B 817B             (           IO.ASM):00059                 CMPA    #$7B                              ; NOTHING ABOVE "z" IS LEGAL
350D 24DB             (           IO.ASM):00060                 BHS     BADKEY
350F 8020             (           IO.ASM):00061                 SUBA    #$20                              ; CONVERT TO UPPER-CASE ALPHA
3511 9755             (           IO.ASM):00062                 STA     IOCHAR                            ; STORE THE KEYPRESS
3513 2008             (           IO.ASM):00063                 BRA     CLICK
                      (           IO.ASM):00064         
3515                  (           IO.ASM):00065         PKICK:
3515 815B             (           IO.ASM):00066                 CMPA    #$5B                              ; NOTHING BETWEEN "Z" AND "a"
3517 24D1             (           IO.ASM):00067                 BHS     BADKEY                            ; IS LEGAL
3519 8120             (           IO.ASM):00068                 CMPA    #$20                              ; NOTHING BELOW "SPACE"
351B 25CD             (           IO.ASM):00069                 BLO     BADKEY                            ; IS LEGAL EITHER
                      (           IO.ASM):00070         
                      (           IO.ASM):00071         ; "CLICK" SOUND FOR KEYS
                      (           IO.ASM):00072         
351D                  (           IO.ASM):00073         CLICK:
351D 3575             (           IO.ASM):00074                 PULS    U,X,Y,B,CC                        ; RESTORE THINGS
351F 9655             (           IO.ASM):00075                 LDA     IOCHAR                            ; RETRIEVE THE KEYPRESS
3521 39               (           IO.ASM):00076                 RTS
                      (           IO.ASM):00077         
                      (           IO.ASM):00078         
                      (           IO.ASM):00079         ; DELAY FOR KEYCLICK
                      (           IO.ASM):00080         
3522                  (           IO.ASM):00081         CDELAY:
3522 8E0100           (           IO.ASM):00082                 LDX     #CFREQ
3525                  (           IO.ASM):00083         CDEL:
3525 301F             (           IO.ASM):00084                 LEAX    -1,X
3527 26FC             (           IO.ASM):00085                 BNE     CDEL
3529 39               (           IO.ASM):00086                 RTS
                      (           IO.ASM):00087         
                      (           IO.ASM):00088         ; -------------------
                      (           IO.ASM):00089         ; READ A LINE OF TEXT
                      (           IO.ASM):00090         ; -------------------
                      (           IO.ASM):00091         
                      (           IO.ASM):00092         ; ENTRY: [ARG1] HAS ADDRESS OF CHAR BUFFER
                      (           IO.ASM):00093         ;        LENGTH OF BUFFER IN 1ST BYTE
                      (           IO.ASM):00094         ; EXIT: # CHARS READ IN [A]
                      (           IO.ASM):00095         
352A                  (           IO.ASM):00096         INPUT:
352A 0F54             (           IO.ASM):00097                 CLR     LINCNT                            ; RESET LINE COUNTER
352C 9E02             (           IO.ASM):00098                 LDX     ARG1                              ; GET ADDRESS OF INPUT BUFFER
352E E680             (           IO.ASM):00099                 LDB     ,X+                               ; GET MAX # CHARS
3530 C002             (           IO.ASM):00100                 SUBB    #2                                ; LEAVE A MARGIN FOR ERROR
3532 D753             (           IO.ASM):00101                 STB     BINDEX                            ; SAVE MAX # CHARS
                      (           IO.ASM):00102         
3534 5F               (           IO.ASM):00103                 CLRB                                      ; RESET       INDEX
3535                  (           IO.ASM):00104         INLOOP:
3535 BD34EF           (           IO.ASM):00105                 JSR     GETKEY                            ; KEY IN [A] AND [IOCHAR]
3538 810D             (           IO.ASM):00106                 CMPA    #EOL                              ; IF EOL,
353A 2732             (           IO.ASM):00107                 BEQ     ENDLIN                            ; LINE IS DONE
353C 8108             (           IO.ASM):00108                 CMPA    #BS                               ; IF BACKSPACE,
353E 2725             (           IO.ASM):00109                 BEQ     GOBACK                            ; TAKE CARE OF IT
                      (           IO.ASM):00110         
3540 8141             (           IO.ASM):00111                 CMPA    #$41                              ; IF LOWER THAN ASCII "A,"
3542 2502             (           IO.ASM):00112                 BLO     SENDCH                            ; SEND THE CHARACTER
3544 8B20             (           IO.ASM):00113                 ADDA    #$20                              ; ELSE CONVERT TO LOWER-CASE
                      (           IO.ASM):00114         
3546                  (           IO.ASM):00115         SENDCH:
3546 A785             (           IO.ASM):00116                 STA     B,X                               ; SEND CHAR TO BUFFER
3548 5C               (           IO.ASM):00117                 INCB                                      ; UPDATE INDEX
3549                  (           IO.ASM):00118         TOSCR:
3549 9655             (           IO.ASM):00119                 LDA     IOCHAR                            ; RETRIEVE KEY CHAR
354B 8D44             (           IO.ASM):00120                 BSR     CHAR                              ; ECHO CHAR TO SCREEN
354D D153             (           IO.ASM):00121                 CMPB    BINDEX                            ; BUFFER FILLED?
354F 2404             (           IO.ASM):00122                 BHS     NOMORE                            ; YES -- INSIST ON BS OR EOL
3551 C13D             (           IO.ASM):00123                 CMPB    #61                               ; 2 SCREEN LINES FILLED?
3553 25E0             (           IO.ASM):00124                 BLO     INLOOP                            ; NO, KEEP GOING
                      (           IO.ASM):00125         
                      (           IO.ASM):00126         ; LINE FULL; INSIST ON EOL OR BACKSPACE
                      (           IO.ASM):00127         
3555                  (           IO.ASM):00128         NOMORE:
3555 BD34EF           (           IO.ASM):00129                 JSR     GETKEY                            ; GET NEXT KEY
3558 810D             (           IO.ASM):00130                 CMPA    #EOL                              ; IF EOL,
355A 2712             (           IO.ASM):00131                 BEQ     ENDLIN                            ; WE'RE FINE
355C 8108             (           IO.ASM):00132                 CMPA    #BS                               ; BACKSPACE
355E 2705             (           IO.ASM):00133                 BEQ     GOBACK                            ; IS OKAY TOO
3560 BD360A           (           IO.ASM):00134                 JSR     BOOP
3563 20F0             (           IO.ASM):00135                 BRA     NOMORE                            ; ELSE PERSIST
                      (           IO.ASM):00136         
                      (           IO.ASM):00137         ; HANDLE BACKSPACE
                      (           IO.ASM):00138         
3565                  (           IO.ASM):00139         GOBACK:
3565 5A               (           IO.ASM):00140                 DECB                                      ; BACK UP CHAR COUNT
3566 2AE1             (           IO.ASM):00141                 BPL     TOSCR                             ; SEND TO SCREEN IF NO UNDERFLOW
3568 5F               (           IO.ASM):00142                 CLRB                                      ; ELSE RESET COUNT
3569 BD360A           (           IO.ASM):00143                 JSR     BOOP                              ; RAZZ
356C 20C7             (           IO.ASM):00144                 BRA     INLOOP                            ; AND TRY AGAIN
                      (           IO.ASM):00145         
                      (           IO.ASM):00146         ; HANDLE EOL
                      (           IO.ASM):00147         
356E                  (           IO.ASM):00148         ENDLIN:
356E A785             (           IO.ASM):00149                 STA     B,X                               ; PUT EOL IN BUFFER
3570 8D1F             (           IO.ASM):00150                 BSR     CHAR                              ; AND ON SCREEN
3572 5C               (           IO.ASM):00151                 INCB                                      ; UPDATE CHAR COUNT
3573 D753             (           IO.ASM):00152                 STB     BINDEX                            ; SAVE IT HERE
                      (           IO.ASM):00153         
                      (           IO.ASM):00154         ; FALL THROUGH TO ...
                      (           IO.ASM):00155         
                      (           IO.ASM):00156         ; ---------------------
                      (           IO.ASM):00157         ; SCRIPT A LINE OF TEXT
                      (           IO.ASM):00158         ; ---------------------
                      (           IO.ASM):00159         
                      (           IO.ASM):00160         ; ENTRY: ADDRESS OF TEXT IN [X]
                      (           IO.ASM):00161         ;        LENGTH OF LINE IN [BINDEX]
                      (           IO.ASM):00162         
3575                  (           IO.ASM):00163         TOPRIN:
3575 0D5E             (           IO.ASM):00164                 TST     SCRIPT                            ; SCRIPTING ENABLED?
3577 2714             (           IO.ASM):00165                 BEQ     INPEX                             ; NO, EXIT IMMEDIATELY
3579 B63F11           (           IO.ASM):00166                 LDA     ZCODE+ZSCRIP+1                    ; GET FLAGS BYTE
357C 8401             (           IO.ASM):00167                 ANDA    #1                                ; BIT 0 SET?
357E 270D             (           IO.ASM):00168                 BEQ     INPEX                             ; NO, IGNORE THE FOLLOWING
                      (           IO.ASM):00169         ;        LDA     #$FE                              ; ELSE
                      (           IO.ASM):00170         ;        STA     DEVNUM                            ; POINT TO PRINTER
3580 D653             (           IO.ASM):00171                 LDB     BINDEX                            ; START AT 1ST BUFFER CHAR
                      (           IO.ASM):00172         
                      (           IO.ASM):00173         
3582                  (           IO.ASM):00174         SCROUT:
3582 A680             (           IO.ASM):00175                 LDA     ,X+                               ; GRAB A CHAR FROM BUFFER
3584 3477             (           IO.ASM):00176                 PSHS    A,B,X,Y,U,CC
3586 3F               (           IO.ASM):00177                 SWI
3587 21               (           IO.ASM):00178                 FCB     33                                ;DISPLAY
3588 3577             (           IO.ASM):00179                 PULS    A,B,X,Y,U,CC
358A 5A               (           IO.ASM):00180                 DECB
358B 26F5             (           IO.ASM):00181                 BNE     SCROUT
358D                  (           IO.ASM):00182         INPEX:
                      (           IO.ASM):00183         ;        CLR     DEVNUM                            ; POINT BACK TO SCREEN
358D 9653             (           IO.ASM):00184                 LDA     BINDEX                            ; RETRIEVE # CHARS IN LINE
358F 39               (           IO.ASM):00185                 RTS
                      (           IO.ASM):00186         
3590                  (           IO.ASM):00187         SFLAG
3590 00               (           IO.ASM):00188                 FCB     0                                 ; FLAG TO SAVE SCRIPT STATE
                      (           IO.ASM):00189         
                      (           IO.ASM):00190         
                      (           IO.ASM):00191         ; -------------------
                      (           IO.ASM):00192         ; PRINT A SINGLE CHAR
                      (           IO.ASM):00193         ; -------------------
                      (           IO.ASM):00194         
                      (           IO.ASM):00195         ; ENTRY: ASCII CODE IN [A]
                      (           IO.ASM):00196         
3591                  (           IO.ASM):00197         CHAR:
3591 9755             (           IO.ASM):00198                 STA     IOCHAR                            ; SAVE CHAR HERE
3593 810D             (           IO.ASM):00199                 CMPA    #$0D
3595 2707             (           IO.ASM):00200                 BEQ     >
3597 3477             (           IO.ASM):00201                 PSHS    A,B,X,Y,U,CC
3599 3F               (           IO.ASM):00202                 SWI
359A 21               (           IO.ASM):00203                 FCB     33
359B 3577             (           IO.ASM):00204                 PULS    A,B,X,Y,U,CC
359D 39               (           IO.ASM):00205                 RTS
                      (           IO.ASM):00206         !
359E 3477             (           IO.ASM):00207                 PSHS    A,B,X,Y,U,CC
35A0 3F               (           IO.ASM):00208                 SWI
35A1 21               (           IO.ASM):00209                 FCB     33
35A2 860A             (           IO.ASM):00210                 LDA     #$0A
35A4 3F               (           IO.ASM):00211                 SWI
35A5 21               (           IO.ASM):00212                 FCB     33
35A6 3577             (           IO.ASM):00213                 PULS    A,B,X,Y,U,CC
35A8 39               (           IO.ASM):00214                 RTS
                      (           IO.ASM):00215         
                      (           IO.ASM):00216         
                      (           IO.ASM):00217         
                      (           IO.ASM):00218         ; FALL THROUGH TO ...
                      (           IO.ASM):00219         
                      (           IO.ASM):00220         ; -------------
                      (           IO.ASM):00221         ; PRINT MESSAGE
                      (           IO.ASM):00222         ; -------------
                      (           IO.ASM):00223         
                      (           IO.ASM):00224         ; ENTRY: ADDRESS OF ASCII MESSAGE IN [X]
                      (           IO.ASM):00225         ;        LENGTH OF MESSAGE IN [B]
                      (           IO.ASM):00226         
35A9                  (           IO.ASM):00227         LINE:
35A9 D753             (           IO.ASM):00228                 STB     BINDEX                            ; SAVE LENGTH
35AB 5F               (           IO.ASM):00229                 CLRB                                      ; INIT INDEX
                      (           IO.ASM):00230         
35AC                  (           IO.ASM):00231         LN:
35AC A685             (           IO.ASM):00232                 LDA     B,X                               ; GET A CHAR
35AE BD3591           (           IO.ASM):00233                 JSR     CHAR
35B1 5C               (           IO.ASM):00234                 INCB
35B2 D153             (           IO.ASM):00235                 CMPB    BINDEX
35B4 25F6             (           IO.ASM):00236                 BLO     LN
35B6 7E3575           (           IO.ASM):00237                 JMP     TOPRIN                            ; HANDLE SCRIPTING
                      (           IO.ASM):00238         
                      (           IO.ASM):00239         ; ----------------
                      (           IO.ASM):00240         ; CLEAR THE SCREEN
                      (           IO.ASM):00241         ; ----------------
                      (           IO.ASM):00242         
35B9                  (           IO.ASM):00243         CLS:
35B9 3477             (           IO.ASM):00244                 PSHS    A,B,X,Y,U,CC
35BB 3F               (           IO.ASM):00245                 SWI
35BC 18               (           IO.ASM):00246                 FCB     24                                ;String to OS
35BD 1B               (           IO.ASM):00247                 FCB     27
35BE 5B324A00         (           IO.ASM):00248                 FCN     '[2J'
35C2 3577             (           IO.ASM):00249                 PULS    A,B,X,Y,U,CC
35C4 39               (           IO.ASM):00250                 RTS
                      (           IO.ASM):00251         
                      (           IO.ASM):00252         
                      (           IO.ASM):00253         
35C5                  (           IO.ASM):00254         BOLD:
35C5 3477             (           IO.ASM):00255                 PSHS    A,B,X,Y,U,CC
35C7 3F               (           IO.ASM):00256                 SWI
35C8 18               (           IO.ASM):00257                 FCB     24                                ;String to OS
35C9 1B               (           IO.ASM):00258                 FCB     27
35CA 5B316D00         (           IO.ASM):00259                 FCN     '[1m'
35CE 3577             (           IO.ASM):00260                 PULS    A,B,X,Y,U,CC
35D0 39               (           IO.ASM):00261                 RTS
                      (           IO.ASM):00262         
35D1                  (           IO.ASM):00263         UNBOLD:
35D1 3477             (           IO.ASM):00264                 PSHS    A,B,X,Y,U,CC
35D3 3F               (           IO.ASM):00265                 SWI
35D4 18               (           IO.ASM):00266                 FCB     24                                ;String to OS
35D5 1B               (           IO.ASM):00267                 FCB     27
35D6 5B306D00         (           IO.ASM):00268                 FCN     '[0m'
35DA 3577             (           IO.ASM):00269                 PULS    A,B,X,Y,U,CC
35DC 39               (           IO.ASM):00270                 RTS
                      (           IO.ASM):00271         
35DD                  (           IO.ASM):00272         REVERSE:
35DD 3477             (           IO.ASM):00273                 PSHS    A,B,X,Y,U,CC
35DF 3F               (           IO.ASM):00274                 SWI
35E0 18               (           IO.ASM):00275                 FCB     24                                ;String to OS
35E1 1B               (           IO.ASM):00276                 FCB     27
35E2 5B376D00         (           IO.ASM):00277                 FCN     '[7m'
35E6 3577             (           IO.ASM):00278                 PULS    A,B,X,Y,U,CC
35E8 39               (           IO.ASM):00279                 RTS
                      (           IO.ASM):00280         
35E9                  (           IO.ASM):00281         HOME:
35E9 3477             (           IO.ASM):00282                 PSHS    A,B,X,Y,U,CC
35EB 3F               (           IO.ASM):00283                 SWI
35EC 18               (           IO.ASM):00284                 FCB     24                                ;String to OS
35ED 1B               (           IO.ASM):00285                 FCB     27
35EE 5B30303B30304800 (           IO.ASM):00286                 FCN     '[00;00H'
35F6 3577             (           IO.ASM):00287                 PULS    A,B,X,Y,U,CC
35F8 39               (           IO.ASM):00288                 RTS
                      (           IO.ASM):00289         
35F9                  (           IO.ASM):00290         MOVECURSOR:
35F9 3477             (           IO.ASM):00291                 PSHS    A,B,X,Y,U,CC
35FB 3F               (           IO.ASM):00292                 SWI
35FC 18               (           IO.ASM):00293                 FCB     24                                ;String to OS
35FD 1B               (           IO.ASM):00294                 FCB     27
35FE 5B32343B30324800 (           IO.ASM):00295                 FCN     '[24;02H'
3606 3577             (           IO.ASM):00296                 PULS    A,B,X,Y,U,CC
3608 39               (           IO.ASM):00297                 RTS
                      (           IO.ASM):00298         ; --------------
                      (           IO.ASM):00299         ; SOUND HANDLERS
                      (           IO.ASM):00300         ; --------------
                      (           IO.ASM):00301         
3609                  (           IO.ASM):00302         AINIT:
3609 39               (           IO.ASM):00303                 RTS
                      (           IO.ASM):00304         
                      (           IO.ASM):00305         ; DO THE RAZZ
360A                  (           IO.ASM):00306         BOOP:
                      (           IO.ASM):00307         
                      (           IO.ASM):00308         ; put sound boop here
                      (           IO.ASM):00309         
360A 39               (           IO.ASM):00310                 RTS
                      (           IO.ASM):00311         
                      (           IO.ASM):00312         ; TIME DELAY
                      (           IO.ASM):00313         
360B                  (           IO.ASM):00314         DELAY:
360B 8E1000           (           IO.ASM):00315                 LDX     #BFREQ                            ; INIT FREQUENCY
360E                  (           IO.ASM):00316         DELOOP:
360E 301F             (           IO.ASM):00317                 LEAX    -1,X
3610 26FC             (           IO.ASM):00318                 BNE     DELOOP
3612 39               (           IO.ASM):00319                 RTS
                      (           IO.ASM):00320         
                      (           IO.ASM):00321         ;-----------------------------------------------------------------------------
                      (     cubixzip.asm):00070                 INCLUDE SCREEN.ASM
                      (       SCREEN.ASM):00001         ;       PAGE
                      (       SCREEN.ASM):00002         ;       SBTTL "--- SCREEN & PRINTER I/O ---"
                      (       SCREEN.ASM):00003         
                      (       SCREEN.ASM):00004         ; ------------
                      (       SCREEN.ASM):00005         ; RESTART GAME
                      (       SCREEN.ASM):00006         ; ------------
                      (       SCREEN.ASM):00007         
3613                  (       SCREEN.ASM):00008         ZSTART:
3613 BD36DA           (       SCREEN.ASM):00009                 JSR     ZCRLF                             ; FLUSH OUTPUT BUFFER
3616 0F5E             (       SCREEN.ASM):00010                 CLR     SCRIPT                            ; DISABLE SCRIPTING [ASK 5/28/85]
                      (       SCREEN.ASM):00011         ;       JSR     ENTER           ; "PRESS ANY KEY TO CONTINUE"[ASK 5/28/85]
3618 B63F11           (       SCREEN.ASM):00012                 LDA     ZCODE+ZSCRIP+1
361B B73590           (       SCREEN.ASM):00013                 STA     SFLAG
361E 7E3623           (       SCREEN.ASM):00014                 JMP     LUKE                              ; SKIP SCRIPT DISABLE
                      (       SCREEN.ASM):00015         ; FALL THROUGH TO ...
                      (       SCREEN.ASM):00016         
                      (       SCREEN.ASM):00017         ; ---------
                      (       SCREEN.ASM):00018         ; COLDSTART
                      (       SCREEN.ASM):00019         ; ---------
                      (       SCREEN.ASM):00020         
3621                  (       SCREEN.ASM):00021         COLD:
3621 0F5E             (       SCREEN.ASM):00022                 CLR     SCRIPT                            ; DISABLE SCRIPTING
3623                  (       SCREEN.ASM):00023         LUKE:
3623 BD35B9           (       SCREEN.ASM):00024                 JSR     CLS                               ; A CLEAN SLATE
3626 BD35C5           (       SCREEN.ASM):00025                 JSR     BOLD
3629 8E363A           (       SCREEN.ASM):00026                 LDX     #LOADM                            ;
362C C621             (       SCREEN.ASM):00027                 LDB     #LOADML
362E BD39E7           (       SCREEN.ASM):00028                 JSR     DLINE                             ; "LOADING GAME ..."
3631 BD35D1           (       SCREEN.ASM):00029                 JSR     UNBOLD
3634 BD35F9           (       SCREEN.ASM):00030                 JSR     MOVECURSOR
3637 7E2800           (       SCREEN.ASM):00031                 JMP     START                             ; AND DO A WARMSTART
                      (       SCREEN.ASM):00032         
363A                  (       SCREEN.ASM):00033         LOADM:
363A 1B               (       SCREEN.ASM):00034                 FCB     27
363B 5B31303B31304820 (       SCREEN.ASM):00035                 FCC     "[10;10H "
3643 5448452053544F52 (       SCREEN.ASM):00036                 FCC     "THE STORY IS LOADING ..."
     59204953204C4F41
     44494E47202E2E2E
365B                  (       SCREEN.ASM):00037         loadlen:
     0021             (       SCREEN.ASM):00038         LOADML          EQU loadlen-LOADM
                      (       SCREEN.ASM):00039         
                      (       SCREEN.ASM):00040         ; -----
                      (       SCREEN.ASM):00041         ; ERROR
                      (       SCREEN.ASM):00042         ; -----
                      (       SCREEN.ASM):00043         
                      (       SCREEN.ASM):00044         ; ENTRY: ERROR CODE # IN [A]
                      (       SCREEN.ASM):00045         
365B                  (       SCREEN.ASM):00046         INTERR:
365B 0D               (       SCREEN.ASM):00047                 FCB     EOL
365C 494E5445524E414C (       SCREEN.ASM):00048                 FCC     "INTERNAL ERROR #"
     204552524F522023
366C                  (       SCREEN.ASM):00049         interrlen:
     0011             (       SCREEN.ASM):00050         IERRL           EQU interrlen-INTERR
                      (       SCREEN.ASM):00051         
366C                  (       SCREEN.ASM):00052         ZERROR:
366C 3402             (       SCREEN.ASM):00053                 PSHS    A                                 ; SAVE CODE #
366E BD36DA           (       SCREEN.ASM):00054                 JSR     ZCRLF                             ; FLUSH BUFFER
3671 8E365B           (       SCREEN.ASM):00055                 LDX     #INTERR
3674 C611             (       SCREEN.ASM):00056                 LDB     #IERRL
3676 BD35A9           (       SCREEN.ASM):00057                 JSR     LINE                              ; "INTERNAL ERROR #"
3679 3502             (       SCREEN.ASM):00058                 PULS    A                                 ; RETRIEVE CODE #
367B 9740             (       SCREEN.ASM):00059                 STA     TEMP+1
367D 0F3F             (       SCREEN.ASM):00060                 CLR     TEMP
367F BD3003           (       SCREEN.ASM):00061                 JSR     NUMBER                            ; CONVERT ERROR CODE #
3682 BD3704           (       SCREEN.ASM):00062                 JSR     CR1                               ; AND SHOW IT
                      (       SCREEN.ASM):00063         
                      (       SCREEN.ASM):00064         ; FALL THROUGH TO ...
                      (       SCREEN.ASM):00065         
                      (       SCREEN.ASM):00066         ; ----
                      (       SCREEN.ASM):00067         ; QUIT
                      (       SCREEN.ASM):00068         ; ----
                      (       SCREEN.ASM):00069         
3685                  (       SCREEN.ASM):00070         ZQUIT:
3685 8E3691           (       SCREEN.ASM):00071                 LDX     #ENDSES
3688 C60F             (       SCREEN.ASM):00072                 LDB     #ENDSL
368A BD35A9           (       SCREEN.ASM):00073                 JSR     LINE                              ; "END OF SESSION"
                      (       SCREEN.ASM):00074         
368D 3F               (       SCREEN.ASM):00075                 SWI
368E 00               (       SCREEN.ASM):00076                 FCB     00
                      (       SCREEN.ASM):00077         
                      (       SCREEN.ASM):00078         
368F                  (       SCREEN.ASM):00079         FREEZE:
368F 20FE             (       SCREEN.ASM):00080                 BRA     FREEZE                            ; STOP DEAD
                      (       SCREEN.ASM):00081         
3691                  (       SCREEN.ASM):00082         ENDSES:
3691 454E44204F462053 (       SCREEN.ASM):00083                 FCC     "END OF SESSION"
     455353494F4E
369F                  (       SCREEN.ASM):00084         VCODE:
369F 0D               (       SCREEN.ASM):00085                 FCB     EOL                               ; SHARED EOL CHAR
36A0                  (       SCREEN.ASM):00086         endseslen:
     000F             (       SCREEN.ASM):00087         ENDSL           EQU endseslen-ENDSES
                      (       SCREEN.ASM):00088         
                      (       SCREEN.ASM):00089         ; --------------------------
                      (       SCREEN.ASM):00090         ; DISPLAY ZIP VERSION NUMBER
                      (       SCREEN.ASM):00091         ; --------------------------
                      (       SCREEN.ASM):00092         
36A0 3638303920435542 (       SCREEN.ASM):00093                 FCC     "6809 CUBIX VERSION"
     4958205645525349
     4F4E
36B2 0D               (       SCREEN.ASM):00094                 FCB     EOL
36B3                  (       SCREEN.ASM):00095         vcodelen:
     0014             (       SCREEN.ASM):00096         VCODEL          EQU vcodelen-VCODE
                      (       SCREEN.ASM):00097         
36B3                  (       SCREEN.ASM):00098         VERNUM:
36B3 8E369F           (       SCREEN.ASM):00099                 LDX     #VCODE
36B6 C614             (       SCREEN.ASM):00100                 LDB     #VCODEL
36B8 7E35A9           (       SCREEN.ASM):00101                 JMP     LINE
                      (       SCREEN.ASM):00102         
                      (       SCREEN.ASM):00103         ; -----------------
                      (       SCREEN.ASM):00104         ; PRINT A CHARACTER
                      (       SCREEN.ASM):00105         ; -----------------
                      (       SCREEN.ASM):00106         
36BB                  (       SCREEN.ASM):00107         COUT:
36BB 810D             (       SCREEN.ASM):00108                 CMPA    #EOL                              ; IF THIS IS A CR,
36BD 271B             (       SCREEN.ASM):00109                 BEQ     ZCRLF                             ; HANDLE AS SUCH
36BF 7E34E3           (       SCREEN.ASM):00110                 JMP     OUTCHR
                      (       SCREEN.ASM):00111         
36C2                  (       SCREEN.ASM):00112         MORES:
36C2 5B6D6F72655D     (       SCREEN.ASM):00113                 FCC     "[more]"
36C8                  (       SCREEN.ASM):00114         morlen:
     0006             (       SCREEN.ASM):00115         MOREL           EQU morlen-MORES
36C8                  (       SCREEN.ASM):00116         MCLR:
36C8 080808080808     (       SCREEN.ASM):00117                 FCB     08,08,08,08,08,08
36CE 202020202020     (       SCREEN.ASM):00118                 FCC     "      "
36D4 080808080808     (       SCREEN.ASM):00119                 FCB     08,08,08,08,08,08
36DA                  (       SCREEN.ASM):00120         mclrlen:
     0012             (       SCREEN.ASM):00121         MCLRL           EQU mclrlen-MCLR
                      (       SCREEN.ASM):00122         
                      (       SCREEN.ASM):00123         
                      (       SCREEN.ASM):00124         ; ---------------
                      (       SCREEN.ASM):00125         ; CARRIAGE RETURN
                      (       SCREEN.ASM):00126         ; ---------------
                      (       SCREEN.ASM):00127         
36DA                  (       SCREEN.ASM):00128         ZCRLF:
36DA 0C54             (       SCREEN.ASM):00129                 INC     LINCNT                            ; NEW LINE GOING OUT
36DC 9654             (       SCREEN.ASM):00130                 LDA     LINCNT
36DE 810D             (       SCREEN.ASM):00131                 CMPA    #13                               ; 13 LINES SENT YET?
36E0 2522             (       SCREEN.ASM):00132                 BLO     CR1                               ; NO, KEEP GOING
                      (       SCREEN.ASM):00133         
                      (       SCREEN.ASM):00134         
36E2 860D             (       SCREEN.ASM):00135                 LDA     #$0D
36E4 BD3591           (       SCREEN.ASM):00136                 JSR     CHAR
                      (       SCREEN.ASM):00137         
36E7 BD35C5           (       SCREEN.ASM):00138                 JSR     BOLD
36EA 8E36C2           (       SCREEN.ASM):00139                 LDX     #MORES                            ; "[MORE]"
36ED C606             (       SCREEN.ASM):00140                 LDB     #MOREL
36EF BD39E7           (       SCREEN.ASM):00141                 JSR     DLINE
36F2 BD35D1           (       SCREEN.ASM):00142                 JSR     UNBOLD
                      (       SCREEN.ASM):00143         
36F5 8D13             (       SCREEN.ASM):00144                 BSR     ZUSL                              ; UPDATE STATUS LINE
36F7 BD34EF           (       SCREEN.ASM):00145                 JSR     GETKEY                            ; GET A KEYPRESS
                      (       SCREEN.ASM):00146         
36FA 8E36C8           (       SCREEN.ASM):00147                 LDX     #MCLR                             ; CLEAR LINE
36FD C612             (       SCREEN.ASM):00148                 LDB     #MCLRL
36FF BD39E7           (       SCREEN.ASM):00149                 JSR     DLINE
                      (       SCREEN.ASM):00150         
3702 0F54             (       SCREEN.ASM):00151                 CLR     LINCNT                            ; RESET LINE COUNTER
                      (       SCREEN.ASM):00152         
3704                  (       SCREEN.ASM):00153         CR1:
3704 860D             (       SCREEN.ASM):00154                 LDA     #$0D
3706 BD3591           (       SCREEN.ASM):00155                 JSR     CHAR
3709 39               (       SCREEN.ASM):00156                 RTS                                       ; AND RETURN
                      (       SCREEN.ASM):00157         
                      (       SCREEN.ASM):00158         ; ------------------
                      (       SCREEN.ASM):00159         ; UPDATE STATUS LINE
                      (       SCREEN.ASM):00160         ; ------------------
                      (       SCREEN.ASM):00161         
370A                  (       SCREEN.ASM):00162         ZUSL:
370A 9651             (       SCREEN.ASM):00163                 LDA     CHRPNT                            ; SAVE ALL Z-STRING VARS
370C D62B             (       SCREEN.ASM):00164                 LDB     STBYTF
370E 109E2C           (       SCREEN.ASM):00165                 LDY     ZSTWRD
3711 3436             (       SCREEN.ASM):00166                 PSHS    X,Y,D
3713 961A             (       SCREEN.ASM):00167                 LDA     MPCH                              ; HIGH BIT OF MPC
3715 D653             (       SCREEN.ASM):00168                 LDB     BINDEX
3717 9E1B             (       SCREEN.ASM):00169                 LDX     MPCM                              ; LOW BYTES OF MPC
3719 109E29           (       SCREEN.ASM):00170                 LDY     CSTEMP                            ; TEMP & PERM TOGETHER!
371C 3436             (       SCREEN.ASM):00171                 PSHS    X,Y,D
                      (       SCREEN.ASM):00172         
                      (       SCREEN.ASM):00173         ; DISPLAY ROOM NAME
                      (       SCREEN.ASM):00174         
371E 0F51             (       SCREEN.ASM):00175                 CLR     CHRPNT                            ; RESET CHAR INDEX
3720 0F5E             (       SCREEN.ASM):00176                 CLR     SCRIPT                            ; DISABLE SCRIPTING
3722 BD35E9           (       SCREEN.ASM):00177                 JSR     HOME
3725 BD35DD           (       SCREEN.ASM):00178                 JSR     REVERSE
                      (       SCREEN.ASM):00179         
3728 8E004F           (       SCREEN.ASM):00180                 LDX     #79                               ;
                      (       SCREEN.ASM):00181         !
372B 8620             (       SCREEN.ASM):00182                 LDA     #SPACE                            ; PRINT A REVERSED LINE
372D BD36BB           (       SCREEN.ASM):00183                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
3730 301F             (       SCREEN.ASM):00184                 DEX
3732 26F7             (       SCREEN.ASM):00185                 BNE     <
3734 BD35E9           (       SCREEN.ASM):00186                 JSR     HOME
                      (       SCREEN.ASM):00187         
3737 8610             (       SCREEN.ASM):00188                 LDA     #$10                              ; GLOBAL VAR #0 (ROOM #)
3739 BD29BC           (       SCREEN.ASM):00189                 JSR     VARGET
373C 9640             (       SCREEN.ASM):00190                 LDA     TEMP+1
373E BD2C7E           (       SCREEN.ASM):00191                 JSR     PRNTDC                            ; GET SHORT DESC INTO [BUFFER]
                      (       SCREEN.ASM):00192         
3741 8620             (       SCREEN.ASM):00193                 LDA     #SPACE                            ; PRINT A SPACE
3743 BD36BB           (       SCREEN.ASM):00194                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
3746 8620             (       SCREEN.ASM):00195                 LDA     #SPACE                            ; PRINT A SPACE
3748 BD36BB           (       SCREEN.ASM):00196                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
                      (       SCREEN.ASM):00197         
374B 8611             (       SCREEN.ASM):00198                 LDA     #$11                              ; FETCH GLOBAL VARIABLE
374D BD29BC           (       SCREEN.ASM):00199                 JSR     VARGET                            ; #1 (SCORE/HOURS)
3750 0D50             (       SCREEN.ASM):00200                 TST     TIMEFL                            ; TIME MODE?
3752 2607             (       SCREEN.ASM):00201                 BNE     PTIME                             ; YES IF NZ
                      (       SCREEN.ASM):00202         
                      (       SCREEN.ASM):00203         ; PRINT SCORE
                      (       SCREEN.ASM):00204         
3754 BD3003           (       SCREEN.ASM):00205                 JSR     NUMBER                            ; PRINT THE VALUE
3757 862F             (       SCREEN.ASM):00206                 LDA     #$2F                              ; ASCII SLASH
3759 2013             (       SCREEN.ASM):00207                 BRA     MOVEP
                      (       SCREEN.ASM):00208         
                      (       SCREEN.ASM):00209         ; PRINT TIME (HOURS)
                      (       SCREEN.ASM):00210         
375B                  (       SCREEN.ASM):00211         PTIME:
375B 9640             (       SCREEN.ASM):00212                 LDA     TEMP+1
375D 2602             (       SCREEN.ASM):00213                 BNE     PTIME1                            ; 00 IS REALLY 24
375F 8618             (       SCREEN.ASM):00214                 LDA     #24
3761                  (       SCREEN.ASM):00215         PTIME1:
3761 810C             (       SCREEN.ASM):00216                 CMPA    #12
3763 2F04             (       SCREEN.ASM):00217                 BLE     PTIME2                            ; IF HOURS IS GREATER THAN 12,
3765 800C             (       SCREEN.ASM):00218                 SUBA    #12                               ; CONVERT TO 12-HOUR TIME
3767 9740             (       SCREEN.ASM):00219                 STA     TEMP+1
3769                  (       SCREEN.ASM):00220         PTIME2:
3769 BD3003           (       SCREEN.ASM):00221                 JSR     NUMBER                            ; SHOW HOURS VALUE
376C 863A             (       SCREEN.ASM):00222                 LDA     #$3A                              ; ASCII COLON
                      (       SCREEN.ASM):00223         
376E                  (       SCREEN.ASM):00224         MOVEP:
376E BD36BB           (       SCREEN.ASM):00225                 JSR     COUT                              ; SEND COLON (OR SLASH)
3771 8612             (       SCREEN.ASM):00226                 LDA     #$12                              ; GLOBAL VAR #2 (MOVES/MINUTES)
3773 BD29BC           (       SCREEN.ASM):00227                 JSR     VARGET
3776 0D50             (       SCREEN.ASM):00228                 TST     TIMEFL                            ; TIME MODE?
3778 272E             (       SCREEN.ASM):00229                 BEQ     PNUM                              ; NO, DO MOVES
                      (       SCREEN.ASM):00230         
                      (       SCREEN.ASM):00231         ; PRINT MINUTES
                      (       SCREEN.ASM):00232         
377A 9640             (       SCREEN.ASM):00233                 LDA     TEMP+1
377C 810A             (       SCREEN.ASM):00234                 CMPA    #10                               ; IF LESS THAN 10 MINUTES,
377E 2405             (       SCREEN.ASM):00235                 BHS     MOVEP1
3780 8630             (       SCREEN.ASM):00236                 LDA     #$30                              ; ADD ASCII ZERO FOR PADDING
3782 BD36BB           (       SCREEN.ASM):00237                 JSR     COUT
                      (       SCREEN.ASM):00238         
3785                  (       SCREEN.ASM):00239         MOVEP1:
3785 BD3003           (       SCREEN.ASM):00240                 JSR     NUMBER                            ; SHOW MINUTES
                      (       SCREEN.ASM):00241         
                      (       SCREEN.ASM):00242         ; PRINT "AM/PM"
                      (       SCREEN.ASM):00243         
3788 8620             (       SCREEN.ASM):00244                 LDA     #SPACE                            ; SEPARATE TIMING
378A BD36BB           (       SCREEN.ASM):00245                 JSR     COUT                              ; FROM "AM/PM"
378D 8611             (       SCREEN.ASM):00246                 LDA     #$11                              ; GLOBAL #1 AGAIN
378F BD29BC           (       SCREEN.ASM):00247                 JSR     VARGET
3792 9640             (       SCREEN.ASM):00248                 LDA     TEMP+1
3794 810C             (       SCREEN.ASM):00249                 CMPA    #12                               ; PAST NOON?
3796 2404             (       SCREEN.ASM):00250                 BHS     USEPM                             ; YES, IT'S PM
3798 8641             (       SCREEN.ASM):00251                 LDA     #$41                              ; "A"
379A 2002             (       SCREEN.ASM):00252                 BRA     DOM
379C                  (       SCREEN.ASM):00253         USEPM:
379C 8650             (       SCREEN.ASM):00254                 LDA     #$50                              ; "P"
379E                  (       SCREEN.ASM):00255         DOM:
379E BD36BB           (       SCREEN.ASM):00256                 JSR     COUT
37A1 864D             (       SCREEN.ASM):00257                 LDA     #$4D                              ; "M"
37A3 BD36BB           (       SCREEN.ASM):00258                 JSR     COUT
37A6 2003             (       SCREEN.ASM):00259                 BRA     AHEAD                             ; DONE!
                      (       SCREEN.ASM):00260         
                      (       SCREEN.ASM):00261         ; PRINT # MOVES
                      (       SCREEN.ASM):00262         
37A8                  (       SCREEN.ASM):00263         PNUM:
37A8 BD3003           (       SCREEN.ASM):00264                 JSR     NUMBER                            ; SIMPLE, EH?
                      (       SCREEN.ASM):00265         
37AB                  (       SCREEN.ASM):00266         AHEAD:
37AB BD3704           (       SCREEN.ASM):00267                 JSR     CR1                               ; DUMP BUFFER
                      (       SCREEN.ASM):00268         
                      (       SCREEN.ASM):00269         
37AE 3536             (       SCREEN.ASM):00270                 PULS    X,Y,D                             ; RESTORE EVERYTHING
37B0 109F29           (       SCREEN.ASM):00271                 STY     CSTEMP
37B3 9F1B             (       SCREEN.ASM):00272                 STX     MPCM
37B5 D753             (       SCREEN.ASM):00273                 STB     BINDEX
37B7 971A             (       SCREEN.ASM):00274                 STA     MPCH
37B9 3536             (       SCREEN.ASM):00275                 PULS    X,Y,D
37BB 109F2C           (       SCREEN.ASM):00276                 STY     ZSTWRD
37BE D72B             (       SCREEN.ASM):00277                 STB     STBYTF
37C0 9751             (       SCREEN.ASM):00278                 STA     CHRPNT
37C2 035E             (       SCREEN.ASM):00279                 COM     SCRIPT                            ; RE-ENABLE SCRIPTING
37C4 0F1F             (       SCREEN.ASM):00280                 CLR     MPCFLG                            ; MPC NO LONGER VALID
37C6 BD35D1           (       SCREEN.ASM):00281                 JSR     UNBOLD
37C9 BD35F9           (       SCREEN.ASM):00282                 JSR     MOVECURSOR
37CC 39               (       SCREEN.ASM):00283                 RTS
                      (     cubixzip.asm):00071                 INCLUDE DISK.ASM
                      (         DISK.ASM):00001         ;       PAGE
                      (         DISK.ASM):00002         ;       SBTTL "--- DISK I/O ---"
                      (         DISK.ASM):00003         
                      (         DISK.ASM):00004         
                      (         DISK.ASM):00005         ; ------------------------
                      (         DISK.ASM):00006         ; READ A Z-BLOCK FROM DISK
                      (         DISK.ASM):00007         ; ------------------------
                      (         DISK.ASM):00008         
                      (         DISK.ASM):00009         ; ENTRY: DRIVE # (0 OR 1) IN [DRIVE]
                      (         DISK.ASM):00010         ;        BLOCK # IN [DBLOCK]
                      (         DISK.ASM):00011         ;        BUFFER ADDRESS IN [DBUFF]
37CD                  (         DISK.ASM):00012         OPENGAMEDSK:
37CD 3F               (         DISK.ASM):00013                 SWI
37CE 0A               (         DISK.ASM):00014                 FCB     10
37CF 10260116         (         DISK.ASM):00015                 LBNE    DERR2                             ; FILE ERROR
37D3 CEDC00           (         DISK.ASM):00016                 LDU     #INFCB                            ; OPEN FILE
37D6 3F               (         DISK.ASM):00017                 SWI
37D7 37               (         DISK.ASM):00018                 FCB     55
37D8 39               (         DISK.ASM):00019                 RTS
37D9                  (         DISK.ASM):00020         GETDSK:
37D9 3476             (         DISK.ASM):00021                 PSHS    X,Y,U,D                           ; SAVE VARIABLES
37DB CEDC00           (         DISK.ASM):00022                 LDU     #INFCB                            ; REWIND FILE
37DE 3F               (         DISK.ASM):00023                 SWI
37DF 3E               (         DISK.ASM):00024                 FCB     62
37E0 DC4C             (         DISK.ASM):00025                 LDD     DBLOCK                            ; GO TO DBLOCK POSITION
37E2 B73841           (         DISK.ASM):00026                 STA     DTEMP
                      (         DISK.ASM):00027         !
37E5 8100             (         DISK.ASM):00028                 CMPA    #$00                              ; HOW MANY BLOCKS OF $10000 DO WE NEED TO GET
37E7 2718             (         DISK.ASM):00029                 BEQ     GETDSK1                           ; NONE, SKIP
37E9 CCFFFF           (         DISK.ASM):00030                 LDD     #$FFFF
37EC CEDC00           (         DISK.ASM):00031                 LDU     #INFCB                            ;
37EF 3F               (         DISK.ASM):00032                 SWI
37F0 3F               (         DISK.ASM):00033                 FCB     63
37F1 CC0001           (         DISK.ASM):00034                 LDD     #1
37F4 CEDC00           (         DISK.ASM):00035                 LDU     #INFCB                            ;
37F7 3F               (         DISK.ASM):00036                 SWI
37F8 3F               (         DISK.ASM):00037                 FCB     63
37F9 7A3841           (         DISK.ASM):00038                 DEC     DTEMP
37FC B63841           (         DISK.ASM):00039                 LDA     DTEMP
37FF 20E4             (         DISK.ASM):00040                 BRA     <
3801                  (         DISK.ASM):00041         GETDSK1:
3801 DC4C             (         DISK.ASM):00042                 LDD     DBLOCK                            ; HOW MANY BLOCKS OF <$10000 DO WE NEED TO GET
3803 1F98             (         DISK.ASM):00043                 TFR     B,A
3805 C600             (         DISK.ASM):00044                 LDB     #$00
3807 CEDC00           (         DISK.ASM):00045                 LDU     #INFCB                            ;
380A 3F               (         DISK.ASM):00046                 SWI
380B 3F               (         DISK.ASM):00047                 FCB     63
380C 3F               (         DISK.ASM):00048                 SWI
380D 3B               (         DISK.ASM):00049                 FCB     59
                      (         DISK.ASM):00050         ; READ 256 BYTES
380E DC4C             (         DISK.ASM):00051                 LDD     DBLOCK
3810 C401             (         DISK.ASM):00052                 ANDB    #01
3812 1F98             (         DISK.ASM):00053                 TFR     B,A
3814 C600             (         DISK.ASM):00054                 LDB     #$00
3816 F73841           (         DISK.ASM):00055                 STB     DTEMP
3819 C3DC0A           (         DISK.ASM):00056                 ADDD    #INFCB+10
381C 1F02             (         DISK.ASM):00057                 TFR     D,Y                               ; D SHOULD CONTAIN START ADDRESS IN BUFFER
                      (         DISK.ASM):00058         !
381E 1F21             (         DISK.ASM):00059                 TFR     Y,X
3820 A680             (         DISK.ASM):00060                 LDA     ,X+                               ; GET BYTE
3822 1F12             (         DISK.ASM):00061                 TFR     X,Y
3824 9E4A             (         DISK.ASM):00062                 LDX     DBUFF
3826 A784             (         DISK.ASM):00063                 STA     ,X
3828 0C4B             (         DISK.ASM):00064                 INC     DBUFF+1
382A 2602             (         DISK.ASM):00065                 BNE     BUFINC
382C 0C4A             (         DISK.ASM):00066                 INC     DBUFF
382E                  (         DISK.ASM):00067         BUFINC:
382E 7A3841           (         DISK.ASM):00068                 DEC     DTEMP
3831 F63841           (         DISK.ASM):00069                 LDB     DTEMP
3834 C100             (         DISK.ASM):00070                 CMPB    #$00
3836 26E6             (         DISK.ASM):00071                 BNE     <
3838 0C4D             (         DISK.ASM):00072                 INC     DBLOCK+1                          ; POINT TO NEXT Z-BLOCK
383A 2602             (         DISK.ASM):00073                 BNE     REND
383C 0C4C             (         DISK.ASM):00074                 INC     DBLOCK
383E                  (         DISK.ASM):00075         REND:
383E 3576             (         DISK.ASM):00076                 PULS    X,Y,U,D                           ; RESTORE VARIABLES
                      (         DISK.ASM):00077         ;        STX     VAL
                      (         DISK.ASM):00078         ;        STD     TEMP
3840 39               (         DISK.ASM):00079                 RTS
                      (         DISK.ASM):00080         
3841                  (         DISK.ASM):00081         DTEMP
3841 00               (         DISK.ASM):00082                 FCB     00
                      (         DISK.ASM):00083         
                      (         DISK.ASM):00084         
                      (         DISK.ASM):00085         ; -----------------
                      (         DISK.ASM):00086         ; SAVE/RESTORE INIT
                      (         DISK.ASM):00087         ; -----------------
                      (         DISK.ASM):00088         
3842                  (         DISK.ASM):00089         SAVRES:
3842 BD36DA           (         DISK.ASM):00090                 JSR     ZCRLF                             ; FLUSH OUTPUT BUFFER
3845 0F5E             (         DISK.ASM):00091                 CLR     SCRIPT                            ; DISABLE SCRIPTING
3847 39               (         DISK.ASM):00092                 RTS
                      (         DISK.ASM):00093         
                      (         DISK.ASM):00094         ; ---------
                      (         DISK.ASM):00095         ; SAVE GAME
                      (         DISK.ASM):00096         ; ---------
                      (         DISK.ASM):00097         
3848                  (         DISK.ASM):00098         ZSAVE:
3848 8DF8             (         DISK.ASM):00099                 BSR     SAVRES                            ; INIT THINGS
384A 3F               (         DISK.ASM):00100                 SWI
384B 18               (         DISK.ASM):00101                 FCB     24                                ;String to OS
384C 0D               (         DISK.ASM):00102                 FCB     13
384D 454E544552204649 (         DISK.ASM):00103                 FCN     'ENTER FILENAME:'
     4C454E414D453A00
385D 3F               (         DISK.ASM):00104                 SWI
385E 03               (         DISK.ASM):00105                 FCB     3                                 ; GET FILENAME
385F 3F               (         DISK.ASM):00106                 SWI
3860 0B               (         DISK.ASM):00107                 FCB     11
3861 2669             (         DISK.ASM):00108                 BNE     DSKABORT
3863 CC5341           (         DISK.ASM):00109                 LDD     #$5341                            ;'SA' GET FIRST PORTION
3866 ED84             (         DISK.ASM):00110                 STD     ,X                                ;SAVE IT
3868 8656             (         DISK.ASM):00111                 LDA     #'V'                              ;LAST CHAR
386A A702             (         DISK.ASM):00112                 STA     2,X                               ;WRITE IT
386C CED000           (         DISK.ASM):00113                 LDU     #SAVFCB                           ; OPEN FILE FOR WRITE/CREATE
386F 3F               (         DISK.ASM):00114                 SWI
3870 47               (         DISK.ASM):00115                 FCB     71
3871 CED000           (         DISK.ASM):00116                 LDU     #SAVFCB                           ; OPEN FILE FOR WRITE/CREATE
3874 3F               (         DISK.ASM):00117                 SWI
3875 38               (         DISK.ASM):00118                 FCB     56
                      (         DISK.ASM):00119         
3876 8E3A17           (         DISK.ASM):00120                 LDX     #SING
3879 C608             (         DISK.ASM):00121                 LDB     #SINGL
387B BD39E7           (         DISK.ASM):00122                 JSR     DLINE                             ; "SAVING"
                      (         DISK.ASM):00123         
387E 8E2740           (         DISK.ASM):00124                 LDX     #BUFSAV                           ; POINT TO AUX BUFFER
3881 FC3F02           (         DISK.ASM):00125                 LDD     ZCODE+ZID                         ; GET GAME ID CODE
3884 ED81             (         DISK.ASM):00126                 STD     ,X++                              ; SAVE IN BUFFER
3886 DC27             (         DISK.ASM):00127                 LDD     OZSTAK                            ; OLD STACK POINTER
3888 ED81             (         DISK.ASM):00128                 STD     ,X++
388A EF81             (         DISK.ASM):00129                 STU     ,X++                              ; AND CURRENT STACK POINTER
388C 9613             (         DISK.ASM):00130                 LDA     ZPCH                              ; HI BYTE OF ZPC
388E A780             (         DISK.ASM):00131                 STA     ,X+
3890 DC14             (         DISK.ASM):00132                 LDD     ZPCM                              ; LOW ZPC BYTES
3892 ED84             (         DISK.ASM):00133                 STD     ,X
                      (         DISK.ASM):00134         
3894 8E2700           (         DISK.ASM):00135                 LDX     #LOCALS                           ; (SAVE 512 BYTES -- MORE THAN NEEDED, BUT  . . .)
3897 CED000           (         DISK.ASM):00136                 LDU     #SAVFCB
389A 3F               (         DISK.ASM):00137                 SWI
389B 3C               (         DISK.ASM):00138                 FCB     60
                      (         DISK.ASM):00139         
389C 8E2300           (         DISK.ASM):00140                 LDX     #ZSTACK                           ; SAVE CONTENTS OF STACK (512 BYTES)
389F CED000           (         DISK.ASM):00141                 LDU     #SAVFCB
38A2 3F               (         DISK.ASM):00142                 SWI
38A3 3C               (         DISK.ASM):00143                 FCB     60
                      (         DISK.ASM):00144         
                      (         DISK.ASM):00145         ; SAVE GAME PRELOAD
                      (         DISK.ASM):00146         
38A4 8E3F00           (         DISK.ASM):00147                 LDX     #ZCODE                            ; START OF PRELOAD
38A7 B63F0E           (         DISK.ASM):00148                 LDA     ZCODE+ZPURBT                      ; SIZE OF PRELOAD (MSB, # PAGES)
38AA 1CFE             (         DISK.ASM):00149                 CLC                                       ; DIVIDE BY 2
38AC 46               (         DISK.ASM):00150                 RORA                                      ;
38AD 4C               (         DISK.ASM):00151                 INCA                                      ; ROUND UP
38AE 973F             (         DISK.ASM):00152                 STA     TEMP                              ; USE [TEMP] AS INDEX
                      (         DISK.ASM):00153         
38B0                  (         DISK.ASM):00154         LSAVE:
38B0 3410             (         DISK.ASM):00155                 PSHS    X
38B2 CED000           (         DISK.ASM):00156                 LDU     #SAVFCB
38B5 3F               (         DISK.ASM):00157                 SWI
38B6 3C               (         DISK.ASM):00158                 FCB     60
38B7 3510             (         DISK.ASM):00159                 PULS    X
38B9 1F10             (         DISK.ASM):00160                 TFR     X,D
38BB C30200           (         DISK.ASM):00161                 ADDD    #$200
38BE 1F01             (         DISK.ASM):00162                 TFR     D,X
38C0 0A3F             (         DISK.ASM):00163                 DEC     TEMP                              ; SAVED ENTIRE PRELOAD YET?
38C2 26EC             (         DISK.ASM):00164                 BNE     LSAVE                             ; NO, KEEP SAVING
38C4 CED000           (         DISK.ASM):00165                 LDU     #SAVFCB
38C7 3F               (         DISK.ASM):00166                 SWI
38C8 39               (         DISK.ASM):00167                 FCB     57                                ; CLOSE FILE
                      (         DISK.ASM):00168         
38C9 7E39C8           (         DISK.ASM):00169                 JMP     RESUME
                      (         DISK.ASM):00170         
                      (         DISK.ASM):00171         
38CC                  (         DISK.ASM):00172         DSKABORT:
38CC 3F               (         DISK.ASM):00173                 SWI
38CD 18               (         DISK.ASM):00174                 FCB     24                                ;String to OS
38CE 0D               (         DISK.ASM):00175                 FCB     13
38CF 4F5045524154494F (         DISK.ASM):00176                 FCN     'OPERATION ABORTED.'
     4E2041424F525445
     442E00
38E2 7E39C8           (         DISK.ASM):00177                 JMP     RESUME
                      (         DISK.ASM):00178         
                      (         DISK.ASM):00179         ; *** ERROR #12: DISK ADDRESS RANGE ***
                      (         DISK.ASM):00180         
38E5                  (         DISK.ASM):00181         DSKERR:
38E5 860C             (         DISK.ASM):00182                 LDA     #12
38E7 2002             (         DISK.ASM):00183                 BRA     DSKEX
                      (         DISK.ASM):00184         
                      (         DISK.ASM):00185         ; *** ERROR #14: DISK ACCESS ***
                      (         DISK.ASM):00186         
38E9                  (         DISK.ASM):00187         DERR2:
38E9 860E             (         DISK.ASM):00188                 LDA     #14
38EB                  (         DISK.ASM):00189         DSKEX:
38EB BD366C           (         DISK.ASM):00190                 JSR     ZERROR
                      (         DISK.ASM):00191         
                      (         DISK.ASM):00192         ; ------------
                      (         DISK.ASM):00193         ; RESTORE GAME
                      (         DISK.ASM):00194         ; ------------
                      (         DISK.ASM):00195         
38EE                  (         DISK.ASM):00196         ZREST:
38EE BD3842           (         DISK.ASM):00197                 JSR     SAVRES
38F1 3F               (         DISK.ASM):00198                 SWI
38F2 18               (         DISK.ASM):00199                 FCB     24                                ;String to OS
38F3 0D               (         DISK.ASM):00200                 FCB     13
38F4 454E544552204649 (         DISK.ASM):00201                 FCN     'ENTER FILENAME:'
     4C454E414D453A00
3904 3F               (         DISK.ASM):00202                 SWI
3905 03               (         DISK.ASM):00203                 FCB     3                                 ; GET FILENAME
3906 3F               (         DISK.ASM):00204                 SWI
3907 0B               (         DISK.ASM):00205                 FCB     11
3908 26C2             (         DISK.ASM):00206                 BNE     DSKABORT
390A CC5341           (         DISK.ASM):00207                 LDD     #$5341                            ;'SA' GET FIRST PORTION
390D ED84             (         DISK.ASM):00208                 STD     ,X                                ;SAVE IT
390F 8656             (         DISK.ASM):00209                 LDA     #'V'                              ;LAST CHAR
3911 A702             (         DISK.ASM):00210                 STA     2,X                               ;WRITE IT
3913 CED000           (         DISK.ASM):00211                 LDU     #SAVFCB                           ; OPEN FILE
3916 3F               (         DISK.ASM):00212                 SWI
3917 37               (         DISK.ASM):00213                 FCB     55
3918 26B2             (         DISK.ASM):00214                 BNE     DSKABORT
391A 3F               (         DISK.ASM):00215                 SWI
391B 3B               (         DISK.ASM):00216                 FCB     59
391C 8E3A1F           (         DISK.ASM):00217                 LDX     #RING
391F C60B             (         DISK.ASM):00218                 LDB     #RINGL
3921 BD39E7           (         DISK.ASM):00219                 JSR     DLINE                             ; "RESTORING"
                      (         DISK.ASM):00220         
                      (         DISK.ASM):00221         ; SAVE LOCALS ON MACHINE STACK
                      (         DISK.ASM):00222         ; IN CASE OF ERROR
                      (         DISK.ASM):00223         
3924 8E2700           (         DISK.ASM):00224                 LDX     #LOCALS                           ; POINT TO LOCALS STORAGE
3927 9F4A             (         DISK.ASM):00225                 STX     DBUFF                             ; POINT TO 1ST PAGE TO RESTORE
3929                  (         DISK.ASM):00226         LOCLP:
3929 EC81             (         DISK.ASM):00227                 LDD     ,X++                              ; GRAB A LOCAL
392B 3406             (         DISK.ASM):00228                 PSHS    D                                 ; AND PUSH IT
392D 8C271E           (         DISK.ASM):00229                 CMPX    #LOCALS+30                        ; SAVED 15 LOCALS YET?
3930 25F7             (         DISK.ASM):00230                 BLO     LOCLP                             ; NO, KEEP PUSHING
                      (         DISK.ASM):00231         
3932 8ED00A           (         DISK.ASM):00232                 LDX     #SAVFCB+10                        ; RETRIEVE LOCALS/BUFFER PAGE
3935 108E2700         (         DISK.ASM):00233                 LDY     #LOCALS
3939 C600             (         DISK.ASM):00234                 LDB     #00
                      (         DISK.ASM):00235         !
393B A680             (         DISK.ASM):00236                 LDA     ,X+
393D A7A0             (         DISK.ASM):00237                 STA     ,Y+
393F 5C               (         DISK.ASM):00238                 INCB
3940 26F9             (         DISK.ASM):00239                 BNE     <
                      (         DISK.ASM):00240         
3942 FC2740           (         DISK.ASM):00241                 LDD     BUFSAV                            ; READ SAVED GAME ID
3945 10B33F02         (         DISK.ASM):00242                 CMPD    ZCODE+ZID                         ; IF IT MATCHES CURRENT GAME ID,
3949 2711             (         DISK.ASM):00243                 BEQ     VERSOK                            ; PROCEED WITH THE RESTORE
                      (         DISK.ASM):00244         
                      (         DISK.ASM):00245         ; WRONG SAVE DISK, ABORT RESTORE
                      (         DISK.ASM):00246         
394B 8E271E           (         DISK.ASM):00247                 LDX     #LOCALS+30                        ; RESTORE PUSHED LOCALS
394E                  (         DISK.ASM):00248         RESLP:
394E 3506             (         DISK.ASM):00249                 PULS    D
3950 ED83             (         DISK.ASM):00250                 STD     ,--X
3952 8C2700           (         DISK.ASM):00251                 CMPX    #LOCALS
3955 22F7             (         DISK.ASM):00252                 BHI     RESLP
3957                  (         DISK.ASM):00253         ERRWP:
3957 8D74             (         DISK.ASM):00254                 BSR     TOBOOT                            ; PROMPT FOR GAME DISK
3959 7E2A3E           (         DISK.ASM):00255                 JMP     PREDF                             ; PREDICATE FAILS
                      (         DISK.ASM):00256         
395C                  (         DISK.ASM):00257         VERSOK:
                      (         DISK.ASM):00258         
395C 32E81E           (         DISK.ASM):00259                 LEAS    +30,S                             ; POP OLD LOCALS OFF STACK
395F FC3F10           (         DISK.ASM):00260                 LDD     ZCODE+ZSCRIP
3962 DD3D             (         DISK.ASM):00261                 STD     VAL                               ; SAVE FLAGS
                      (         DISK.ASM):00262         
3964 CC0200           (         DISK.ASM):00263                 LDD     #$200                             ; begin game load
3967 CED000           (         DISK.ASM):00264                 LDU     #SAVFCB
396A 3F               (         DISK.ASM):00265                 SWI
396B 40               (         DISK.ASM):00266                 FCB     64
396C 1026FF5C         (         DISK.ASM):00267                 LBNE    DSKABORT
                      (         DISK.ASM):00268         
3970 8E2300           (         DISK.ASM):00269                 LDX     #ZSTACK                           ; RETRIEVE
3973 DD4A             (         DISK.ASM):00270                 STD     DBUFF                             ; CONTENTS OF Z-STACK (512 bytes)
3975 CED000           (         DISK.ASM):00271                 LDU     #SAVFCB
3978 3F               (         DISK.ASM):00272                 SWI
3979 3A               (         DISK.ASM):00273                 FCB     58
397A 1026FF4E         (         DISK.ASM):00274                 LBNE    DSKABORT
                      (         DISK.ASM):00275         
397E                  (         DISK.ASM):00276         DOREST:
397E 8E3F00           (         DISK.ASM):00277                 LDX     #ZCODE                            ; NOW RETRIEVE
3981 DD4A             (         DISK.ASM):00278                 STD     DBUFF                             ; 1ST TWO PAGES OF PRELOAD
3983 CED000           (         DISK.ASM):00279                 LDU     #SAVFCB
3986 3F               (         DISK.ASM):00280                 SWI
3987 3A               (         DISK.ASM):00281                 FCB     58
3988 1026FF40         (         DISK.ASM):00282                 LBNE    DSKABORT
398C 1F10             (         DISK.ASM):00283                 TFR     X,D
398E C30200           (         DISK.ASM):00284                 ADDD    #$200
3991 1F01             (         DISK.ASM):00285                 TFR     D,X
3993 B63F0E           (         DISK.ASM):00286                 LDA     ZCODE+ZPURBT                      ; DETERMINE # PAGES
3996 1CFE             (         DISK.ASM):00287                 CLC
3998 46               (         DISK.ASM):00288                 RORA
3999 4C               (         DISK.ASM):00289                 INCA
399A 973F             (         DISK.ASM):00290                 STA     TEMP                              ; TO RETRIEVE
                      (         DISK.ASM):00291         
399C                  (         DISK.ASM):00292         LREST:
399C 3410             (         DISK.ASM):00293                 PSHS    X
399E CED000           (         DISK.ASM):00294                 LDU     #SAVFCB
39A1 3F               (         DISK.ASM):00295                 SWI
39A2 3A               (         DISK.ASM):00296                 FCB     58
39A3 3510             (         DISK.ASM):00297                 PULS    X
39A5 1F10             (         DISK.ASM):00298                 TFR     X,D
39A7 C30200           (         DISK.ASM):00299                 ADDD    #$200
39AA 1F01             (         DISK.ASM):00300                 TFR     D,X
39AC 0A3F             (         DISK.ASM):00301                 DEC     TEMP
39AE 26EC             (         DISK.ASM):00302                 BNE     LREST
                      (         DISK.ASM):00303         
                      (         DISK.ASM):00304         ; RESTORE STATE OF SAVED GAME
                      (         DISK.ASM):00305         
39B0 8E2742           (         DISK.ASM):00306                 LDX     #BUFSAV+2                         ; POINT TO SAVED VARIABLES
39B3 EC81             (         DISK.ASM):00307                 LDD     ,X++
39B5 DD27             (         DISK.ASM):00308                 STD     OZSTAK                            ; RESTORE OLD STACK POINTERS
39B7 EE81             (         DISK.ASM):00309                 LDU     ,X++
39B9 A680             (         DISK.ASM):00310                 LDA     ,X+
39BB 9713             (         DISK.ASM):00311                 STA     ZPCH                              ; HIGH BYTE OF ZPC
39BD EC84             (         DISK.ASM):00312                 LDD     ,X                                ; LOW BYTES OF ZPC
39BF DD14             (         DISK.ASM):00313                 STD     ZPCM
39C1 0F18             (         DISK.ASM):00314                 CLR     ZPCFLG                            ; PC HAS CHANGED!
                      (         DISK.ASM):00315         
39C3 DC3D             (         DISK.ASM):00316                 LDD     VAL                               ; RESTORE FLAGS
39C5 FD3F10           (         DISK.ASM):00317                 STD     ZCODE+ZSCRIP
                      (         DISK.ASM):00318         
                      (         DISK.ASM):00319         ; RESUME GAME AFTER SAVE OR RESTORE
                      (         DISK.ASM):00320         
39C8                  (         DISK.ASM):00321         RESUME:
39C8 8D03             (         DISK.ASM):00322                 BSR     TOBOOT                            ; PROMPT FOR GAME DISK
39CA 7E2A4C           (         DISK.ASM):00323                 JMP     PREDS                             ; PREDICATE SUCCEEDS
                      (         DISK.ASM):00324         
39CD                  (         DISK.ASM):00325         TOBOOT:
39CD BD39D3           (         DISK.ASM):00326                 JSR     ENTER                             ; "PRESS <ENTER> TO CONTINUE"
39D0 035E             (         DISK.ASM):00327                 COM     SCRIPT                            ; RE-ENABLE SCRIPTING
39D2 39               (         DISK.ASM):00328                 RTS
                      (         DISK.ASM):00329         ; ---------------------------
                      (         DISK.ASM):00330         ; "PRESS <ENTER> TO CONTINUE"
                      (         DISK.ASM):00331         ; ---------------------------
                      (         DISK.ASM):00332         
39D3                  (         DISK.ASM):00333         ENTER:
39D3 8E39FB           (         DISK.ASM):00334                 LDX     #PRESS
39D6 C61C             (         DISK.ASM):00335                 LDB     #PRESSL
39D8 D75D             (         DISK.ASM):00336                 STB     CFLAG                             ; ENABLE CURSOR
39DA BD35A9           (         DISK.ASM):00337                 JSR     LINE                              ; "PRESS <ENTER> TO CONTINUE"
39DD BD34EF           (         DISK.ASM):00338                 JSR     GETKEY                            ; GET A KEY
39E0 0F5D             (         DISK.ASM):00339                 CLR     CFLAG                             ; DISABLE CURSOR
39E2 860D             (         DISK.ASM):00340                 LDA     #EOL
39E4 7E36BB           (         DISK.ASM):00341                 JMP     COUT                              ; DO EOL AND RETURN
                      (         DISK.ASM):00342         
                      (         DISK.ASM):00343         
                      (         DISK.ASM):00344         
                      (         DISK.ASM):00345         ; FALL THROUGH TO ...
                      (         DISK.ASM):00346         
                      (         DISK.ASM):00347         ; --------------------
                      (         DISK.ASM):00348         ; DIRECT SCREEN OUTPUT
                      (         DISK.ASM):00349         ; --------------------
                      (         DISK.ASM):00350         
                      (         DISK.ASM):00351         ; ENTRY: SAME AS "LINE" ROUTINE
                      (         DISK.ASM):00352         
39E7                  (         DISK.ASM):00353         DLINE:
39E7 A680             (         DISK.ASM):00354                 LDA     ,X+
39E9 BD34E3           (         DISK.ASM):00355                 JSR     OUTCHR
39EC 5A               (         DISK.ASM):00356                 DECB
39ED 26F8             (         DISK.ASM):00357                 BNE     DLINE
39EF 39               (         DISK.ASM):00358                 RTS
                      (         DISK.ASM):00359         
                      (         DISK.ASM):00360         
                      (         DISK.ASM):00361         ; ---------------------
                      (         DISK.ASM):00362         ; TEXT FOR SAVE/RESTORE
                      (         DISK.ASM):00363         ; ---------------------
                      (         DISK.ASM):00364         
39F0                  (         DISK.ASM):00365         RES:
39F0 524553544F5245   (         DISK.ASM):00366                 FCC     "RESTORE"
39F7                  (         DISK.ASM):00367         reslen:
     0007             (         DISK.ASM):00368         RESL            EQU reslen-RES
                      (         DISK.ASM):00369         
39F7                  (         DISK.ASM):00370         SAV:
39F7 53415645         (         DISK.ASM):00371                 FCC     "SAVE"
39FB                  (         DISK.ASM):00372         savlen:
     0004             (         DISK.ASM):00373         SAVL            EQU savlen-SAV
                      (         DISK.ASM):00374         
                      (         DISK.ASM):00375         
39FB                  (         DISK.ASM):00376         PRESS:
39FB 5052455353203C45 (         DISK.ASM):00377                 FCC     "PRESS <ENTER> TO CONTINUE."
     4E5445523E20544F
     20434F4E54494E55
     452E
3A15 0D               (         DISK.ASM):00378                 FCB     EOL
3A16 3E               (         DISK.ASM):00379                 FCC     ">"
3A17                  (         DISK.ASM):00380         presslen:
     001C             (         DISK.ASM):00381         PRESSL          EQU presslen-PRESS
                      (         DISK.ASM):00382         
                      (         DISK.ASM):00383         
3A17                  (         DISK.ASM):00384         SING:
3A17 0D               (         DISK.ASM):00385                 FCB     EOL
3A18 534156494E47     (         DISK.ASM):00386                 FCC     "SAVING"
3A1E 0D               (         DISK.ASM):00387                 FCB     EOL
3A1F                  (         DISK.ASM):00388         sinlen:
     0008             (         DISK.ASM):00389         SINGL           EQU sinlen-SING
                      (         DISK.ASM):00390         
3A1F                  (         DISK.ASM):00391         RING:
3A1F 0D               (         DISK.ASM):00392                 FCB     EOL
3A20 524553544F52494E (         DISK.ASM):00393                 FCC     "RESTORING"
     47
3A29 0D               (         DISK.ASM):00394                 FCB     EOL
3A2A                  (         DISK.ASM):00395         ringlen:
     000B             (         DISK.ASM):00396         RINGL           EQU ringlen-RING
                      (         DISK.ASM):00397         
3A2A                  (         DISK.ASM):00398         ENDTST:
3A2A 454E44           (         DISK.ASM):00399                 FCC     "END"
                      (     cubixzip.asm):00072         
                      (     cubixzip.asm):00073         ;TITLE "ZIP/6809-B INFOCOM, INC."
                      (     cubixzip.asm):00074                 IF      DEBUG
                      (     cubixzip.asm):00075                     INCLUDE BUGGER.ASM
                      (     cubixzip.asm):00076                 ENDIF
                      (     cubixzip.asm):00077         
                      (     cubixzip.asm):00078                 END

Symbol Table:
[ G] ABSVAL                           2ECC
[ G] ABTEMP                           2ED3
[ G] AHEAD                            37AB
[ G] AINIT                            3609
[ G] ARG1                             0002
[ G] ARG2                             0004
[ G] ARG3                             0006
[ G] ARG4                             0008
[ G] ARGCNT                           0001
[ G] BADKEY                           34EA
[ G] BADOP1                           2952
[ G] BADOP2                           29A0
[ G] BFREQ                            1000
[ G] BINDEX                           0053
[ G] BLINK                            005C
[ G] BOLD                             35C5
[ G] BOOP                             360A
[ G] BRKTBL                           317F
[ G] BS                               0008
[ G] BUFINC                           382E
[ G] BUFSAV                           2740
[ G] CDEL                             3525
[ G] CDELAY                           3522
[ G] CEXIT                            2D17
[ G] CFLAG                            005D
[ G] CFREQ                            0100
[ G] CHAR                             3591
[ G] CHRPNT                           0051
[ G] CHRTBL                           3457
[ G] CLICK                            351D
[ G] CLS                              35B9
[ G] CNLOOP                           3410
[ G] CNOK                             3418
[ G] CNZS2M                           340B
[ G] CNZSC1                           33D1
[ G] CNZSC3                           33D9
[ G] CNZSL1                           338C
[ G] CNZSL2                           339D
[ G] CNZSLC                           33B6
[ G] CNZSLE                           343A
[ G] CNZSLO                           33C2
[ G] COLD                             3621
[ G] CONZST                           337C
[ G] COUT                             36BB
[ G] CPSAV                            0052
[ G] CR1                              3704
[ G] CSPERM                           002A
[ G] CSTEMP                           0029
[ G] CYCLE                            005A
[ G] DBLOCK                           004C
[ G] DBUFF                            004A
[ G] DEBUG                            0000
[ G] DECX                             2EF9
[ G] DELAY                            360B
[ G] DELOOP                           360E
[ G] DERR2                            38E9
[ G] DGC                              3011
[ G] DIGCNT                           300F
[ G] DISPX                            2922
[ G] DIVERR                           2F06
[ G] DIVEX                            2ED2
[ G] DIVIDE                           2EAC
[ G] DLINE                            39E7
[ G] DOB2                             2A66
[ G] DOCALL                           2F3A
[ G] DODIS                            2925
[ G] DOEQ                             2F14
[ G] DOM                              379E
[ G] DOREST                           397E
[ G] DOUDIV                           2EC0
[ G] DRIVE                            0049
[ G] DSKABORT                         38CC
[ G] DSKERR                           38E5
[ G] DSKEX                            38EB
[ G] DSTART                           0000
[ G] DTEMP                            3841
[ G] DVINIT                           2EA4
[ G] EAR0                             3260
[ G] EAR1                             3268
[ G] EARLY                            3256
[ G] ENDCMP                           281C
[ G] ENDERR                           2817
[ G] ENDLIN                           356E
[ G] ENDOK                            2820
[ G] ENDSES                           3691
[ G] endseslen                        36A0
[ G] ENDSL                            000F
[ G] ENDTST                           3A2A
[ G] ENTER                            39D3
[ G] EOL                              000D
[ G] EQBAD                            2F2D
[ G] EQOK                             2F30
[ G] ERRWP                            3957
[ G] ETPEX                            2E22
[ G] FALSE                            0000
[ G] FBRK                             314E
[ G] FINDW                            3150
[ G] FIRST1                           2BD5
[ G] FLAGSU                           34A6
[ G] FLEX                             3134
[ G] FLGSU1                           34B9
[ G] FLGSU2                           34C4
[ G] FLGSU3                           34CD
[ G] FLUSHW                           311E
[ G] FREEZE                           368F
[ G] FWL1                             315D
[ G] FWORDS                           0025
[ G] FWSUCC                           3178
[ G] GDRIVE                           0056
[ G] GETBYT                           31BF
[ G] GETDSK                           37D9
[ G] GETDSK1                          3801
[ G] GETKEY                           34EF
[ G] GETLNG                           29AD
[ G] GETMOD                           3338
[ G] GETP1                            2DE6
[ G] GETP2                            2E05
[ G] GETP2A                           2E1C
[ G] GETP2B                           2E15
[ G] GETP3                            2DF4
[ G] GETPT1                           2E2A
[ G] GETPT2                           2E3A
[ G] GETSHT                           29A5
[ G] GETVAR                           29C4
[ G] GETVR1                           29CA
[ G] GETVRG                           29DB
[ G] GETVRL                           29CE
[ G] GETWRD                           3185
[ G] GETZCH                           3344
[ G] GETZH1                           335B
[ G] GETZH2                           3372
[ G] GETZH3                           336E
[ G] GK                               34F1
[ G] GLOBAL                           0021
[ G] GM                               333F
[ G] GOBACK                           3565
[ G] GPOSIT                           0057
[ G] GPT                              2E40
[ G] GTBT0                            31D0
[ G] GTBT1                            31D4
[ G] GTBT2                            31DC
[ G] GTBT3                            31EF
[ G] GTEXIT                           3357
[ G] GTVX                             29D5
[ G] GTZ0                             334A
[ G] HOME                             35E9
[ G] IERRL                            0011
[ G] IHOLD                            005F
[ G] INFCB                            DC00
[ G] INLOOP                           3535
[ G] INPEX                            358D
[ G] INPUT                            352A
[ G] INTERR                           365B
[ G] interrlen                        366C
[ G] IOBUFF                           2200
[ G] IOCHAR                           0055
[ G] KTEST                            34FD
[ G] LDPRE                            28A6
[ G] LINCNT                           0054
[ G] LINE                             35A9
[ G] LN                               35AC
[ G] loadlen                          365B
[ G] LOADM                            363A
[ G] LOADML                           0021
[ G] LOCALS                           2700
[ G] LOCLP                            3929
[ G] LREST                            399C
[ G] LRU                              000A
[ G] LRUMAP                           2650
[ G] LSAVE                            38B0
[ G] LUKE                             3623
[ G] MASK                             0043
[ G] MATH                             2E6F
[ G] MCLR                             36C8
[ G] MCLRL                            0012
[ G] mclrlen                          36DA
[ G] MEMTOP                           00CF
[ G] MLOOP                            28BA
[ G] MOREL                            0006
[ G] MORES                            36C2
[ G] morlen                           36C8
[ G] MOVECURSOR                       35F9
[ G] MOVEP                            376E
[ G] MOVEP1                           3785
[ G] MPCFLG                           001F
[ G] MPCH                             001A
[ G] MPCL                             001C
[ G] MPCM                             001B
[ G] MPCPNT                           001D
[ G] MSTACK                           21FE
[ G] MSTART                           2100
[ G] MTEMP                            0047
[ G] NBR1                             3145
[ G] NBRKP                            3139
[ G] NBRKS                            0006
[ G] NEXTPC                           318E
[ G] NOMORE                           3555
[ G] NOPS0                            000E
[ G] NOPS1                            0010
[ G] NOPS2                            0019
[ G] NOPSX                            000C
[ G] NORAM                            2866
[ G] NPC0                             319F
[ G] NPC1                             31A3
[ G] NPC2                             31AB
[ G] NPC3                             31BE
[ G] NUMBER                           3003
[ G] NXTP1                            2E52
[ G] NXTP2                            2E65
[ G] NXTP3                            2E62
[ G] OBJLOC                           34D4
[ G] OP0                              292C
[ G] OP1                              293C
[ G] OP1A                             2945
[ G] OP1B                             294E
[ G] OP1C                             2957
[ G] OP1EX                            295A
[ G] OP2                              296D
[ G] OP2A                             2976
[ G] OP2B                             2979
[ G] OP2C                             298A
[ G] OP2D                             298D
[ G] OP2EX                            2993
[ G] OPCODE                           0000
[ G] OPENGAMEDSK                      37CD
[ G] OPEXT                            28D1
[ G] OPT0                             2AB1
[ G] OPT1                             2ACD
[ G] OPT2                             2AED
[ G] OPTX                             2B1F
[ G] OPX0                             28DA
[ G] OPX1                             28E0
[ G] OPX2                             28E9
[ G] OPX3                             28F2
[ G] OPX4                             290F
[ G] OPXNXT                           28F9
[ G] OUTCHR                           34E3
[ G] OVER                             2A39
[ G] OZSTAK                           0027
[ G] PAGE                             31F0
[ G] PAGE0                            000E
[ G] PATCH                            31C9
[ G] PBAD                             2D1B
[ G] PDB0                             2A98
[ G] PDB1                             2AB0
[ G] PG0                              31F7
[ G] PG1                              321C
[ G] PG2                              3232
[ G] PG3                              323A
[ G] PG4                              3247
[ G] PG5                              3251
[ G] PKICK                            3515
[ G] PMAX                             000C
[ G] PNBX                             2A4B
[ G] PNUM                             37A8
[ G] POK                              2D3C
[ G] POPSTK                           2A29
[ G] PPX                              349F
[ G] PREDB                            2A52
[ G] PREDB1                           2A71
[ G] PREDB3                           2A7E
[ G] PREDF                            2A3E
[ G] PREDLB                           2A5E
[ G] PREDNB                           2A44
[ G] PREDS                            2A4C
[ G] PRESS                            39FB
[ G] PRESSL                           001C
[ G] presslen                         3A17
[ G] PRNTDC                           2C7E
[ G] PRNTN3                           3025
[ G] PRNTN4                           3029
[ G] PROPB                            3471
[ G] PROPL                            348E
[ G] PROPN                            3486
[ G] PROPNX                           349B
[ G] PSHDZ                            2A20
[ G] PSHSTK                           2A1E
[ G] PTABLE                           2500
[ G] pth                              31C8
[ G] PTIME                            375B
[ G] PTIME1                           3761
[ G] PTIME2                           3769
[ G] PTP                              2FD5
[ G] PTP1                             2FEA
[ G] PTVX                             2A0F
[ G] PUTBYT                           29F2
[ G] PUTP1                            2FC7
[ G] PUTP2                            2FDA
[ G] PUTP2A                           2FF2
[ G] PUTVAL                           29F6
[ G] PUTVLG                           2A15
[ G] PUTVLL                           2A08
[ G] PUTVR1                           2A04
[ G] PZERO                            3035
[ G] PZSTFO                           003C
[ G] PZSTP0                           32AB
[ G] PZSTP1                           32AD
[ G] PZSTR                            328A
[ G] PZSTR1                           32B2
[ G] PZSTR2                           32BA
[ G] PZSTRA                           32C7
[ G] PZSTRF                           32F6
[ G] PZSTRL                           3292
[ G] PZSTRP                           32EC
[ G] PZSTRS                           32DC
[ G] PZSTRT                           32E0
[ G] QKEY                             34FF
[ G] RAND1                            0058
[ G] RAND2                            0059
[ G] RBRKP                            3135
[ G] RDEX                             3097
[ G] READL                            3086
[ G] READL2                           30C9
[ G] READL3                           30EF
[ G] REMVC1                           2C60
[ G] REMVC2                           2C75
[ G] REMVEX                           2C7B
[ G] REND                             383E
[ G] RES                              39F0
[ G] RESL                             0007
[ G] reslen                           39F7
[ G] RESLP                            394E
[ G] RESUME                           39C8
[ G] RET0                             29F1
[ G] RET1                             2CA4
[ G] RET2                             2CAD
[ G] RETERR                           2CC5
[ G] REVERSE                          35DD
[ G] RFLIP                            2EC8
[ G] RING                             3A1F
[ G] RINGL                            000B
[ G] ringlen                          3A2A
[ G] RL1                              3093
[ G] RL2                              3098
[ G] RL3                              30A1
[ G] RS1                              2000
[ G] RS1E                             200A
[ G] RSIBRK                           30E7
[ G] RTABP                            003A
[ G] SAV                              39F7
[ G] SAVFCB                           D000
[ G] SAVL                             0004
[ G] savlen                           39FB
[ G] SAVRES                           3842
[ G] SCMP                             2D29
[ G] SCOMP                            2D1E
[ G] SCRIPT                           005E
[ G] SCROUT                           3582
[ G] SENDCH                           3546
[ G] SETA0                            2870
[ G] SETNP                            286A
[ G] SETSTR                           327B
[ G] SETWRD                           3272
[ G] SFLAG                            3590
[ G] SIBRKP                           3140
[ G] SING                             3A17
[ G] SINGL                            0008
[ G] sinlen                           3A1F
[ G] SPACE                            0020
[ G] SQUOT                            0045
[ G] SREM                             0046
[ G] ST0                              2823
[ G] ST1A                             2831
[ G] ST1B                             283B
[ G] STABP                            003B
[ G] STAMP                            0011
[ G] START                            2800
[ G] STBYTF                           002B
[ G] SWAP                             0012
[ G] TABS                             2EBA
[ G] TABTOP                           000F
[ G] TDRIVE                           0061
[ G] TEMP                             003F
[ G] TEMP2                            0041
[ G] TIMEFL                           0050
[ G] TOBOOT                           39CD
[ G] TOPRIN                           3575
[ G] TOPSTA                           24FE
[ G] TOSCR                            3549
[ G] TPOSIT                           0060
[ G] TRACK                            004E
[ G] TRUE                             00FF
[ G] TSTEND                           2807
[ G] UDIV                             2EDA
[ G] UDLOOP                           2EE5
[ G] UDNEXT                           2EF8
[ G] UNBOLD                           35D1
[ G] UNDER                            2A34
[ G] USEPM                            379C
[ G] VAL                              003D
[ G] VARGET                           29BC
[ G] VARPUT                           29E4
[ G] VCODE                            369F
[ G] VCODEL                           0014
[ G] vcodelen                         36B3
[ G] VERNUM                           36B3
[ G] VERSOK                           395C
[ G] VOCAB                            0023
[ G] VSUM                             2B91
[ G] VSUM0                            2B9D
[ G] WNEXT                            316B
[ G] ZADD                             2E6B
[ G] ZB0                              2D52
[ G] ZBAND                            2D57
[ G] ZBCOM                            2CE6
[ G] ZBEGIN                           0006
[ G] ZBOR                             2D4C
[ G] ZBTST                            2D3F
[ G] ZCALL                            2F33
[ G] ZCALL1                           2F63
[ G] ZCALL2                           2F7E
[ G] ZCALL3                           2F82
[ G] ZCALL4                           2F99
[ G] ZCHKSM                           001C
[ G] ZCHR1                            3427
[ G] ZCHR2                            3432
[ G] ZCHRCS                           341D
[ G] ZCHRX                            3439
[ G] ZCODE                            3F00
[ G] ZCODEHIGH                        003F
[ G] ZCRLF                            36DA
[ G] ZDEC                             2C26
[ G] ZDIV                             2E99
[ G] ZDLESS                           2D03
[ G] ZENDLD                           0004
[ G] ZEQUAL                           2F0B
[ G] ZERROR                           366C
[ G] ZFCLR                            2D7E
[ G] ZFIRST                           2BCE
[ G] ZFSET                            2D70
[ G] ZFSETP                           2D5F
[ G] ZFWORD                           0018
[ G] ZGET                             2DBD
[ G] ZGETB                            2DD0
[ G] ZGETP                            2DE3
[ G] ZGETPT                           2E27
[ G] ZGLOBA                           000C
[ G] ZGRTR                            2CF9
[ G] ZID                              0002
[ G] ZIGRTR                           2D0C
[ G] ZIN                              2D2F
[ G] ZINC                             2C0E
[ G] ZINC1                            2C18
[ G] ZIP                              2800
[ G] ZJUMP                            2CCA
[ G] ZLENTH                           001A
[ G] ZLESS                            2CEF
[ G] ZLOC                             2BEC
[ G] ZMLOOP                           2E81
[ G] ZMNEXT                           2E91
[ G] ZMOD                             2E9E
[ G] ZMODE                            0001
[ G] ZMOVE                            2D97
[ G] ZMUL                             2E7A
[ G] ZMVEX                            2DBC
[ G] ZNEXT                            2BC5
[ G] ZNEXTP                           2E4B
[ G] ZNOOP                            2B5F
[ G] ZOBJEC                           000A
[ G] ZPAGE                            000D
[ G] ZPCFLG                           0018
[ G] ZPCH                             0013
[ G] ZPCL                             0015
[ G] ZPCM                             0014
[ G] ZPCPNT                           0016
[ G] ZPGTOP                           0060
[ G] ZPOP                             305B
[ G] ZPRB                             2C32
[ G] ZPRC                             2FFA
[ G] ZPRD                             2C7C
[ G] ZPRI                             2B42
[ G] ZPRINT                           2CD4
[ G] ZPRN                             2FFF
[ G] ZPRR                             2B60
[ G] ZPTSIZ                           2BFC
[ G] ZPURBT                           000E
[ G] ZPURE                            000B
[ G] ZPUSH                            3056
[ G] ZPUT                             2FA4
[ G] ZPUTB                            2FB6
[ G] ZPUTP                            2FC4
[ G] ZQUIT                            3685
[ G] ZRAND                            303A
[ G] ZREAD                            3063
[ G] ZREMOV                           2C3C
[ G] ZREST                            38EE
[ G] ZRET                             2C90
[ G] ZRFALS                           2B3F
[ G] ZRSTAK                           2B67
[ G] ZRT                              2B39
[ G] ZRTRUE                           2B37
[ G] ZSAVE                            3848
[ G] ZSCRIP                           0010
[ G] ZSCRN                            2B5F
[ G] ZSERIA                           0012
[ G] ZSET                             2D8E
[ G] ZSPLIT                           2B5F
[ G] ZSTACK                           2300
[ G] ZSTAKL                           00FF
[ G] ZSTART                           3613
[ G] ZSTBUI                           002E
[ G] ZSTBUO                           0034
[ G] ZSTEX                            3289
[ G] ZSTWRD                           002C
[ G] ZSUB                             2E74
[ G] ZUSL                             370A
[ G] ZVALUE                           2CDE
[ G] ZVER                             2B6F
[ G] ZVERS                            0000
[ G] ZVOCAB                           0008
[ G] ZZERO                            2BBC
