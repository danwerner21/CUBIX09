                      (     cubixzip.asm):00001         ;TITLE   "ZIP/6809-C INFOCOM, INC. --- INITIALIZATION"
                      (     cubixzip.asm):00002         
                      (     cubixzip.asm):00003         ; -------------------------------
                      (     cubixzip.asm):00004         ; ZIP/6809 VERSION C
                      (     cubixzip.asm):00005         ; Z-CODE INTERPRETER PROGRAM
                      (     cubixzip.asm):00006         ; FOR CUBIX
                      (     cubixzip.asm):00007         ; -------------------------------
                      (     cubixzip.asm):00008         
                      (     cubixzip.asm):00009         ; COMPANY PRIVATE -- NOT FOR DISTRIBUTION
                      (     cubixzip.asm):00010         
     0000             (     cubixzip.asm):00011         DEBUG           = 0                               ; ASSEMBLY FLAG
                      (     cubixzip.asm):00012         
                      (     cubixzip.asm):00013         ; -----------
                      (     cubixzip.asm):00014         ; ERROR CODES
                      (     cubixzip.asm):00015         ; -----------
                      (     cubixzip.asm):00016         
                      (     cubixzip.asm):00017         ; 00 -- INSUFFICIENT RAM
                      (     cubixzip.asm):00018         ; 01 -- ILLEGAL X-OP
                      (     cubixzip.asm):00019         ; 02 -- ILLEGAL 0-OP
                      (     cubixzip.asm):00020         ; 03 -- ILLEGAL 1-OP
                      (     cubixzip.asm):00021         ; 04 -- ILLEGAL 2-OP
                      (     cubixzip.asm):00022         ; 05 -- Z-STACK UNDERFLOW
                      (     cubixzip.asm):00023         ; 06 -- Z-STACK OVERFLOW
                      (     cubixzip.asm):00024         ; 07 -- ILLEGAL PROPERTY LENGTH (GETP)
                      (     cubixzip.asm):00025         ; 08 -- DIVISION BY ZERO
                      (     cubixzip.asm):00026         ; 09 -- ILLEGAL ARGUMENT COUNT (EQUAL?)
                      (     cubixzip.asm):00027         ; 10 -- ILLEGAL PROPERTY ID (PUTP)
                      (     cubixzip.asm):00028         ; 11 -- ILLEGAL PROPERTY LENGTH (PUTP)
                      (     cubixzip.asm):00029         ; 12 -- DISK ADDRESS OUT OF RANGE
                      (     cubixzip.asm):00030         ; 13 -- PARSER OVERFLOW
                      (     cubixzip.asm):00031         ; 14 -- DRIVE ACCESS
                      (     cubixzip.asm):00032         ; 15 -- Z-STACK DESTROYED
                      (     cubixzip.asm):00033         ; 16 -- ZIP NOT FULLY LOADED
                      (     cubixzip.asm):00034         
                      (     cubixzip.asm):00035                 ORG     $2000
                      (     cubixzip.asm):00036         
2000                  (     cubixzip.asm):00037         RS1:
2000 4F               (     cubixzip.asm):00038                 CLRA                                      ; USE PAGE ZERO
2001 1F8B             (     cubixzip.asm):00039                 TFR     A,DP                              ; AS THE DIRECT PAGE
2003 10CE21FE         (     cubixzip.asm):00040                 LDS     #MSTACK                           ; GIVE THE STACK A NEW HOME
2007 7E3622           (     cubixzip.asm):00041                 JMP     COLD                              ; PERFORM ONE-TIME INITIALIZATION
200A                  (     cubixzip.asm):00042         RS1E:
200A                  (     cubixzip.asm):00043                 RMB     $100-(RS1E-RS1)
                      (     cubixzip.asm):00044         
                      (     cubixzip.asm):00045         
2100                  (     cubixzip.asm):00046         MSTART: ; START OF FREE PROGRAM RAM
                      (     cubixzip.asm):00047         
                      (     cubixzip.asm):00048                 INCLUDE eq.asm
                      (           eq.asm):00001         ;PAGE
                      (           eq.asm):00002         ;SBTTL "--- MEMORY ORGANIZATION ---"
                      (           eq.asm):00003         
     0100             (           eq.asm):00004         CFREQ           = $100
     1000             (           eq.asm):00005         BFREQ           = $1000
                      (           eq.asm):00006         
                      (           eq.asm):00007         
     00FF             (           eq.asm):00008         TRUE            = $FF
     0000             (           eq.asm):00009         FALSE           = 0
                      (           eq.asm):00010         
     0000             (           eq.asm):00011         DSTART          = 0                               ; START OF DIRECT-PAGE RAM
                      (           eq.asm):00012         
     21FE             (           eq.asm):00013         MSTACK          = MSTART+$FE                      ; TOP OF MACHINE STACK (254 BYTES)
     2200             (           eq.asm):00014         IOBUFF          = MSTART+$100                     ; 256-BYTE DISK I/O BUFFER
     2300             (           eq.asm):00015         ZSTACK          = MSTART+$200                     ; Z-STACK (255 WORDS)
     00FF             (           eq.asm):00016         ZSTAKL          = 255                             ; LENGTH OF Z-STACK IN WORDS
     24FE             (           eq.asm):00017         TOPSTA          = (2*ZSTAKL)+ZSTACK               ; TOP OF Z-STACK
     2500             (           eq.asm):00018         PTABLE          = MSTART+$400                     ; PAGING TABLE ($140 BYTES/$A0 WORDS)
     2650             (           eq.asm):00019         LRUMAP          = MSTART+$550                     ; TIMESTAMP MAP ($A0 BYTES)
     2700             (           eq.asm):00020         LOCALS          = MSTART+$600                     ; LOCAL VARIABLE STORAGE (32 BYTES)
     2740             (           eq.asm):00021         BUFSAV          = MSTART+$640                     ; I/O AUX BUFFER (32 BYTES)
     2800             (           eq.asm):00022         ZIP             = MSTART+$700                     ; START OF EXECUTABLE CODE
     3F00             (           eq.asm):00023         ZCODE           = ZIP+$1700                       ; START OF Z-CODE (ASSUME 5.75K ZIP)
     003F             (           eq.asm):00024         ZCODEHIGH       = (ZIP+$1700)/256                 ; START OF Z-CODE (ASSUME 5.75K ZIP)
     00CF             (           eq.asm):00025         MEMTOP          = $CF                             ; TOP PAGE OF AVAILABLE RAM
     D000             (           eq.asm):00026         SAVFCB          = $D000
     DC00             (           eq.asm):00027         INFCB           = $DC00
                      (           eq.asm):00028         
                      (           eq.asm):00029         ; Z-CODE HEADER OFFSETS
                      (           eq.asm):00030         
     0000             (           eq.asm):00031         ZVERS           = 0                               ; VERSION BYTE
     0001             (           eq.asm):00032         ZMODE           = 1                               ; MODE SELECT BYTE
     0002             (           eq.asm):00033         ZID             = 2                               ; GAME ID WORD
     0004             (           eq.asm):00034         ZENDLD          = 4                               ; START OF NON-PRELOADED Z-CODE
     0006             (           eq.asm):00035         ZBEGIN          = 6                               ; EXECUTION ADDRESS
     0008             (           eq.asm):00036         ZVOCAB          = 8                               ; START OF VOCABULARY TABLE
     000A             (           eq.asm):00037         ZOBJEC          = 10                              ; START OF OBJECT TABLE
     000C             (           eq.asm):00038         ZGLOBA          = 12                              ; START OF GLOBAL VARIABLE TABLE
     000E             (           eq.asm):00039         ZPURBT          = 14                              ; START OF "PURE" Z-CODE
     0010             (           eq.asm):00040         ZSCRIP          = 16                              ; FLAG WORD
     0012             (           eq.asm):00041         ZSERIA          = 18                              ; 3-WORD ASCII SERIAL NUMBER
     0018             (           eq.asm):00042         ZFWORD          = 24                              ; START OF FWORDS TABLE
     001A             (           eq.asm):00043         ZLENTH          = 26                              ; LENGTH OF Z-PROGRAM IN WORDS
     001C             (           eq.asm):00044         ZCHKSM          = 28                              ; Z-CODE CHECKSUM WORD
                      (           eq.asm):00045         
                      (           eq.asm):00046         ;       SBTTL "--- ZIP D-PAGE VARIABLES ---"
                      (           eq.asm):00047         
     0000             (           eq.asm):00048         OPCODE          = DSTART                          ; CURRENT OPCODE
     0001             (           eq.asm):00049         ARGCNT          = OPCODE+1                        ; # ARGUMENTS
     0002             (           eq.asm):00050         ARG1            = OPCODE+2                        ; ARGUMENT #1 (WORD)
     0004             (           eq.asm):00051         ARG2            = OPCODE+4                        ; ARGUMENT #2 (WORD)
     0006             (           eq.asm):00052         ARG3            = OPCODE+6                        ; ARGUMENT #3 (WORD)
     0008             (           eq.asm):00053         ARG4            = OPCODE+8                        ; ARGUMENT #4 (WORD)
                      (           eq.asm):00054         
     000A             (           eq.asm):00055         LRU             = OPCODE+10                       ; (BYTE) LEAST RECENTLY USED PAGE INDEX
     000B             (           eq.asm):00056         ZPURE           = LRU+1                           ; (BYTE) 1ST VIRTUAL PAGE OF PURE Z-CODE
     000C             (           eq.asm):00057         PMAX            = LRU+2                           ; (BYTE) MAXIMUM # SWAPPING PAGES
     000D             (           eq.asm):00058         ZPAGE           = LRU+3                           ; (BYTE) CURRENT SWAPPING PAGE
     000E             (           eq.asm):00059         PAGE0           = LRU+4                           ; (BYTE) 1ST ABS PAGE OF SWAPPING SPACE
     000F             (           eq.asm):00060         TABTOP          = LRU+5                           ; (WORD) ADDRESS OF LAST P-TABLE ENTRY
     0011             (           eq.asm):00061         STAMP           = LRU+7                           ; (BYTE) CURRENT TIMESTAMP (BM 11/24/84)
     0012             (           eq.asm):00062         SWAP            = LRU+8                           ; (BYTE) EARLIEST BUFFER (BM 11/24/84)
                      (           eq.asm):00063         
     0013             (           eq.asm):00064         ZPCH            = LRU+9                           ; HIGHEST-ORDER BIT OF PC
     0014             (           eq.asm):00065         ZPCM            = ZPCH+1                          ; MIDDLE 8 BITS OF PC
     0015             (           eq.asm):00066         ZPCL            = ZPCH+2                          ; LOWER 8 BITS OF PC
     0016             (           eq.asm):00067         ZPCPNT          = ZPCH+3                          ; POINTER TO ACTUAL PC PAGE (WORD)
     0018             (           eq.asm):00068         ZPCFLG          = ZPCH+5                          ; FLAG: "TRUE" IF ZPCPNT VALID
                      (           eq.asm):00069         
     001A             (           eq.asm):00070         MPCH            = ZPCH+7                          ; HIGHEST-ORDER BIT OF MEM POINTER
     001B             (           eq.asm):00071         MPCM            = MPCH+1                          ; MIDDLE 8 BITS OF MEM POINTER
     001C             (           eq.asm):00072         MPCL            = MPCH+2                          ; LOW-ORDER 8 BITS OF MEMORY POINTER
     001D             (           eq.asm):00073         MPCPNT          = MPCH+3                          ; ACTUAL POINTER TO MEMORY (WORD)
     001F             (           eq.asm):00074         MPCFLG          = MPCH+5                          ; FLAG: "TRUE" IF MPCPNT VALID
                      (           eq.asm):00075         
     0021             (           eq.asm):00076         GLOBAL          = MPCH+7                          ; GLOBAL VARIABLE POINTER (WORD)
     0023             (           eq.asm):00077         VOCAB           = GLOBAL+2                        ; VOCAB TABLE POINTER (WORD)
     0025             (           eq.asm):00078         FWORDS          = GLOBAL+4                        ; FWORDS TABLE POINTER (WORD)
                      (           eq.asm):00079         
     0027             (           eq.asm):00080         OZSTAK          = GLOBAL+6                        ; ZSP SAVE REGISTER (FOR ZCALL)
                      (           eq.asm):00081         
     0029             (           eq.asm):00082         CSTEMP          = OZSTAK+2                        ; SET IF TEMP CHARSET IN EFFECT
     002A             (           eq.asm):00083         CSPERM          = CSTEMP+1                        ; CURRENT PERM CHARSET
     002B             (           eq.asm):00084         STBYTF          = CSTEMP+2                        ; 0=1ST, 1=2ND, 2=3RD, 0=LAST
                      (           eq.asm):00085         
     002C             (           eq.asm):00086         ZSTWRD          = CSTEMP+3                        ; WORD STORAGE (WORD)
     002E             (           eq.asm):00087         ZSTBUI          = ZSTWRD+2                        ; Z-STRING INPUT BUFFER (6 BYTES)
     0034             (           eq.asm):00088         ZSTBUO          = ZSTWRD+8                        ; Z-STRING OUTPUT BUFFER (6 BYTES)
     003A             (           eq.asm):00089         RTABP           = ZSTWRD+14                       ; RESULT TABLE POINTER
     003B             (           eq.asm):00090         STABP           = ZSTWRD+15                       ; SOURCE TABLE POINTER
     003C             (           eq.asm):00091         PZSTFO          = ZSTWRD+16                       ; FWORD TABLE BLOCK OFFSET
                      (           eq.asm):00092         
     003D             (           eq.asm):00093         VAL             = ZSTWRD+17                       ; VALUE RETURN REGISTER (WORD)
     003F             (           eq.asm):00094         TEMP            = VAL+2                           ; TEMPORARY REGISTER (WORD)
     0041             (           eq.asm):00095         TEMP2           = VAL+4                           ; ANOTHER TEMPORARY REGISTER (WORD)
     0043             (           eq.asm):00096         MASK            = VAL+6                           ; BIT-MASK REGISTER (WORD)
     0045             (           eq.asm):00097         SQUOT           = VAL+8                           ; SIGN OF QUOTIENT
     0046             (           eq.asm):00098         SREM            = VAL+9                           ; SIGN OF REMAINDER
     0047             (           eq.asm):00099         MTEMP           = VAL+10                          ; MATH TEMP REGISTER (WORD)
                      (           eq.asm):00100         
     0049             (           eq.asm):00101         DRIVE           = VAL+12                          ; DRIVE NUMBER
     004A             (           eq.asm):00102         DBUFF           = DRIVE+1                         ; DISK I/O BUFFER POINTER (WORD)
     004C             (           eq.asm):00103         DBLOCK          = DRIVE+3                         ; Z-BLOCK # (WORD)
     004E             (           eq.asm):00104         TRACK           = DRIVE+5                         ; TRACK/SECTOR ADDRESS (WORD)
                      (           eq.asm):00105         
     0050             (           eq.asm):00106         TIMEFL          = DRIVE+7                         ; "TRUE" IF TIME MODE
                      (           eq.asm):00107         
     0051             (           eq.asm):00108         CHRPNT          = TIMEFL+1                        ; I/O BUFFER INDEX
     0052             (           eq.asm):00109         CPSAV           = CHRPNT+1                        ; SAVE REGISTER FOR [CHRPNT]
     0053             (           eq.asm):00110         BINDEX          = CHRPNT+2                        ; BUFFER DISPLAY INDEX
     0054             (           eq.asm):00111         LINCNT          = CHRPNT+3                        ; # LINES DISPLAYED SINCE LAST USL
     0055             (           eq.asm):00112         IOCHAR          = CHRPNT+4                        ; CURRENT I/O CHARACTER
     0056             (           eq.asm):00113         GDRIVE          = CHRPNT+5                        ; GAME-SAVE DEFAULT DRIVE #
     0057             (           eq.asm):00114         GPOSIT          = CHRPNT+6                        ; GAME-SAVE DEFAULT POSITION
     0058             (           eq.asm):00115         RAND1           = CHRPNT+7                        ; RANDOM NUMBER REGISTER
     0059             (           eq.asm):00116         RAND2           = CHRPNT+8                        ; DITTO
     005A             (           eq.asm):00117         CYCLE           = CHRPNT+9                        ; TIMER FOR CURSOR BLINK (WORD)
     005C             (           eq.asm):00118         BLINK           = CHRPNT+11                       ; MASK FOR CURSOR BLINK
     005D             (           eq.asm):00119         CFLAG           = CHRPNT+12                       ; CURSOR ENABLE FLAG
     005E             (           eq.asm):00120         SCRIPT          = CHRPNT+13                       ; SCRIPTING ENABLE FLAG
     005F             (           eq.asm):00121         IHOLD           = CHRPNT+14                       ; INTERRUPT HOLD
     0060             (           eq.asm):00122         TPOSIT          = CHRPNT+15                       ; TEMP GAME POSITION
     0061             (           eq.asm):00123         TDRIVE          = CHRPNT+16                       ; TEMP GAME DRIVE
                      (           eq.asm):00124         
     0060             (           eq.asm):00125         ZPGTOP          = CHRPNT+15                       ; END OF DIRECT-PAGE VARIABLES
                      (     cubixzip.asm):00049                 INCLUDE warm.asm
                      (         warm.asm):00001         ;       PAGE
                      (         warm.asm):00002         ;       SBTTL "--- WARMSTART ROUTINE ---"
                      (         warm.asm):00003         
     00               (         warm.asm):00004                 SETDP   0
                      (         warm.asm):00005                 ORG     ZIP                               ; START OF EXECUTABLE CODE
                      (         warm.asm):00006         
                      (         warm.asm):00007         ; WARMSTART ENTRY
                      (         warm.asm):00008         
2800                  (         warm.asm):00009         START:
2800 10CE21FE         (         warm.asm):00010                 LDS     #MSTACK                           ; RESET MACHINE STACK
                      (         warm.asm):00011         
                      (         warm.asm):00012         
                      (         warm.asm):00013         ; TEST TO SEE IF ZIP IS ALL LOADED
                      (         warm.asm):00014         
2804 8E0003           (         warm.asm):00015                 LDX     #3
2807                  (         warm.asm):00016         TSTEND:
2807 A6893A14         (         warm.asm):00017                 LDA     ENDTST-1,X
280B A189281B         (         warm.asm):00018                 CMPA    ENDCMP-1,X
280F 2606             (         warm.asm):00019                 BNE     ENDERR
2811 301F             (         warm.asm):00020                 LEAX    -1,X
2813 26F2             (         warm.asm):00021                 BNE     TSTEND
2815 2009             (         warm.asm):00022                 BRA     ENDOK
2817                  (         warm.asm):00023         ENDERR:
2817 8610             (         warm.asm):00024                 LDA     #16
2819 7E366D           (         warm.asm):00025                 JMP     ZERROR                            ;
                      (         warm.asm):00026         
281C                  (         warm.asm):00027         ENDCMP:
281C 454E4400         (         warm.asm):00028                 FCN     'END'
                      (         warm.asm):00029         
                      (         warm.asm):00030         ; CLEAR ALL DIRECT-PAGE VARIABLES
                      (         warm.asm):00031         
2820                  (         warm.asm):00032         ENDOK:
2820 8E0000           (         warm.asm):00033                 LDX     #DSTART
2823                  (         warm.asm):00034         ST0:
2823 6F80             (         warm.asm):00035                 CLR     ,X+
2825 8C0060           (         warm.asm):00036                 CMPX    #ZPGTOP
2828 25F9             (         warm.asm):00037                 BLO     ST0
                      (         warm.asm):00038         
282A 0C11             (         warm.asm):00039                 INC     STAMP                             ; INIT TIMESTAMP TO 1 (BM 11/24/84)
                      (         warm.asm):00040         
                      (         warm.asm):00041         ; RESET THE PAGING TABLE
                      (         warm.asm):00042         
282C 8E2500           (         warm.asm):00043                 LDX     #PTABLE
282F 86FF             (         warm.asm):00044                 LDA     #$FF
2831                  (         warm.asm):00045         ST1A:
2831 A780             (         warm.asm):00046                 STA     ,X+
2833 8C2640           (         warm.asm):00047                 CMPX    #PTABLE+$140
2836 25F9             (         warm.asm):00048                 BLO     ST1A
                      (         warm.asm):00049         
                      (         warm.asm):00050         ; CLEAR THE TIMESTAMP MAP (BM 11/24/84)
                      (         warm.asm):00051         
2838 8E2650           (         warm.asm):00052                 LDX     #LRUMAP
283B                  (         warm.asm):00053         ST1B:
283B 6F80             (         warm.asm):00054                 CLR     ,X+
283D 8C26F0           (         warm.asm):00055                 CMPX    #LRUMAP+$A0
2840 25F9             (         warm.asm):00056                 BLO     ST1B
                      (         warm.asm):00057         
2842 BD37CE           (         warm.asm):00058                 JSR     OPENGAMEDSK                       ; open the game file -- needs to be selected by now
2845 CC0000           (         warm.asm):00059                 LDD     #0
2848 DD4C             (         warm.asm):00060                 STD     DBLOCK
                      (         warm.asm):00061         
                      (         warm.asm):00062         ; GET THE FIRST SECTOR OF Z-CODE
                      (         warm.asm):00063         
284A CC3F00           (         warm.asm):00064                 LDD     #ZCODE                            ; POINT TO 1ST
284D DD4A             (         warm.asm):00065                 STD     DBUFF                             ; Z-CODE LOCATION
284F BD37DA           (         warm.asm):00066                 JSR     GETDSK                            ; FETCH BLOCK #0 FROM DRIVE 0
                      (         warm.asm):00067         
                      (         warm.asm):00068         ; EXTRACT GAME DATA FROM Z-CODE HEADER
                      (         warm.asm):00069         
2852 B63F04           (         warm.asm):00070                 LDA     ZCODE+ZENDLD                      ; GET MSB OF ENDLOAD POINTER
2855 4C               (         warm.asm):00071                 INCA                                      ; ADD ONE TO GET
2856 970B             (         warm.asm):00072                 STA     ZPURE                             ; 1ST PAGE IN "PURE" CODE
2858 8B3F             (         warm.asm):00073                 ADDA    #ZCODEHIGH                        ; ADD BASE ADDRESS TO GET
285A 970E             (         warm.asm):00074                 STA     PAGE0                             ; 1ST PAGE OF SWAPPING SPACE
                      (         warm.asm):00075         
285C C6CF             (         warm.asm):00076                 LDB     #MEMTOP                           ; TOP PAGE OF MEMORY
285E D00E             (         warm.asm):00077                 SUBB    PAGE0                             ; SUBTRACT ADDRESS OF PAGING BUFFER
2860 2304             (         warm.asm):00078                 BLS     NORAM
2862 C108             (         warm.asm):00079                 CMPB    #8
2864 2404             (         warm.asm):00080                 BHS     SETNP                             ; MUST HAVE AT LEAST 8 SWAPPING PAGES
                      (         warm.asm):00081         
                      (         warm.asm):00082         ; *** ERROR #0 -- INSUFFICIENT RAM ***
                      (         warm.asm):00083         
2866                  (         warm.asm):00084         NORAM:
2866 4F               (         warm.asm):00085                 CLRA
2867 BD366D           (         warm.asm):00086                 JSR     ZERROR
                      (         warm.asm):00087         
                      (         warm.asm):00088         ; [B] HAS # FREE SWAPPING PAGES
                      (         warm.asm):00089         
286A                  (         warm.asm):00090         SETNP:
286A C190             (         warm.asm):00091                 CMPB    #$90                              ; MAKE SURE # PAGES
286C 2502             (         warm.asm):00092                 BLO     SETA0                             ; DOESN'T EXCEED
286E C690             (         warm.asm):00093                 LDB     #$90                              ; $90
2870                  (         warm.asm):00094         SETA0:
2870 D70C             (         warm.asm):00095                 STB     PMAX                              ; SET MAXIMUM # FREE PAGES
2872 8E2500           (         warm.asm):00096                 LDX     #PTABLE                           ; ADD BASE ADDR OF P-TABLE
2875 3A               (         warm.asm):00097                 ABX                                       ; TO PAGING LIMIT
2876 3A               (         warm.asm):00098                 ABX                                       ; TWICE (FOR WORD-ALIGNMENT)
2877 9F0F             (         warm.asm):00099                 STX     TABTOP                            ; TO GET ADDR OF HIGHEST TABLE ENTRY
                      (         warm.asm):00100         
2879 B63F01           (         warm.asm):00101                 LDA     ZCODE+ZMODE                       ; GET MODE BYTE
287C 8A08             (         warm.asm):00102                 ORA     #%00001000                        ;
287E B73F01           (         warm.asm):00103                 STA     ZCODE+ZMODE                       ; (WE DON'T WANT ANY DIRTY WORDS)
2881 8402             (         warm.asm):00104                 ANDA    #%00000010                        ; ISOLATE STAT-LINE FORMAT BIT
2883 9750             (         warm.asm):00105                 STA     TIMEFL                            ; 0=SCORE/MOVES, NZ=HOURS/MINUTES
                      (         warm.asm):00106         
2885 FC3F06           (         warm.asm):00107                 LDD     ZCODE+ZBEGIN                      ; GET START ADDRESS OF Z-CODE
2888 DD14             (         warm.asm):00108                 STD     ZPCM                              ; HIGH BITS AT ZPCH ALREADY CLEARED
                      (         warm.asm):00109         
288A FC3F0C           (         warm.asm):00110                 LDD     ZCODE+ZGLOBA                      ; GET RELATIVE ADDR OF GLOBAL TABLE
288D C33F00           (         warm.asm):00111                 ADDD    #ZCODE                            ; CONVERT TO ABSOLUTE ADDRESS
2890 DD21             (         warm.asm):00112                 STD     GLOBAL
                      (         warm.asm):00113         
2892 FC3F18           (         warm.asm):00114                 LDD     ZCODE+ZFWORD                      ; DO SAME FOR FWORDS TABLE
2895 C33F00           (         warm.asm):00115                 ADDD    #ZCODE
2898 DD25             (         warm.asm):00116                 STD     FWORDS
                      (         warm.asm):00117         
289A FC3F08           (         warm.asm):00118                 LDD     ZCODE+ZVOCAB                      ; AND VOCABULARY TABLE
289D C33F00           (         warm.asm):00119                 ADDD    #ZCODE
28A0 DD23             (         warm.asm):00120                 STD     VOCAB
                      (         warm.asm):00121         
                      (         warm.asm):00122         ; GRAB THE REST OF THE PRELOAD
                      (         warm.asm):00123         
28A2 960B             (         warm.asm):00124                 LDA     ZPURE                             ; GET # PAGES IN PRELOAD + 1
28A4 973F             (         warm.asm):00125                 STA     TEMP                              ; USE AS AN INDEX
28A6                  (         warm.asm):00126         LDPRE:
28A6 BD37DA           (         warm.asm):00127                 JSR     GETDSK                            ; GRAB THE BLOCK
28A9 0A3F             (         warm.asm):00128                 DEC     TEMP
28AB 26F9             (         warm.asm):00129                 BNE     LDPRE                             ; KEEP READING TILL DONE
                      (         warm.asm):00130         
28AD CE24FE           (         warm.asm):00131                 LDU     #TOPSTA                           ; INIT THE ZSP
28B0 DF27             (         warm.asm):00132                 STU     OZSTAK                            ; REMEMBER ITS POSITION
                      (         warm.asm):00133         
28B2 BD35BA           (         warm.asm):00134                 JSR     CLS                               ; CLEAR THE SCREEN
28B5 035E             (         warm.asm):00135                 COM     SCRIPT                            ; ENABLE SCRIPTING
                      (         warm.asm):00136         
28B7 B63591           (         warm.asm):00137                 LDA     SFLAG                             ; SCRIPTING FLAG
28BA B73F11           (         warm.asm):00138                 STA     ZCODE+ZSCRIP+1
                      (         warm.asm):00139         
                      (         warm.asm):00140         ; FALL INTO MAIN LOOP
                      (     cubixzip.asm):00050         
                      (     cubixzip.asm):00051         ;TITLE "ZIP/6809-B INFOCOM, INC. --- MAINLINE"
                      (     cubixzip.asm):00052                 INCLUDE MAIN.ASM
                      (         MAIN.ASM):00001         ;       PAGE
                      (         MAIN.ASM):00002         ;       SBTTL "--- MAIN LOOP ---"
                      (         MAIN.ASM):00003         
28BD                  (         MAIN.ASM):00004         MLOOP:
28BD 0A59             (         MAIN.ASM):00005                 DEC     RAND2                             ; RANDOMNESS
28BF 0A59             (         MAIN.ASM):00006                 DEC     RAND2
                      (         MAIN.ASM):00007         
28C1 0F01             (         MAIN.ASM):00008                 CLR     ARGCNT                            ; RESET # ARGUMENTS
28C3 BD3191           (         MAIN.ASM):00009                 JSR     NEXTPC                            ; GET NEXT Z-BYTE
28C6 9700             (         MAIN.ASM):00010                 STA     OPCODE                            ; SAVE OPCODE
                      (         MAIN.ASM):00011         
                      (         MAIN.ASM):00012                 IF      DEBUG = 1
                      (         MAIN.ASM):00013                     LDB     #'0'
                      (         MAIN.ASM):00014                     JSR     DOBUG
                      (         MAIN.ASM):00015                     LDA     OPCODE
                      (         MAIN.ASM):00016                 ENDIF
                      (         MAIN.ASM):00017         
28C8 102A00A4         (         MAIN.ASM):00018                 LBPL    OP2                               ; 2-OP IF POSITIVE
28CC 81B0             (         MAIN.ASM):00019                 CMPA    #176
28CE 256F             (         MAIN.ASM):00020                 BLO     OP1                               ; IT'S A 1-OP
28D0 81C0             (         MAIN.ASM):00021                 CMPA    #192
28D2 255B             (         MAIN.ASM):00022                 BLO     OP0                               ; IF NOT A 0-OP ...
                      (         MAIN.ASM):00023         
                      (         MAIN.ASM):00024         ; HANDLE AN X-OP
                      (         MAIN.ASM):00025         
28D4                  (         MAIN.ASM):00026         OPEXT:
28D4 BD3191           (         MAIN.ASM):00027                 JSR     NEXTPC                            ; GET ARGUMENT BYTE
28D7 9741             (         MAIN.ASM):00028                 STA     TEMP2                             ; HOLD IT HERE
28D9 0F42             (         MAIN.ASM):00029                 CLR     TEMP2+1                           ; INIT LOOP INDEX
28DB 2006             (         MAIN.ASM):00030                 BRA     OPX1
                      (         MAIN.ASM):00031         
28DD                  (         MAIN.ASM):00032         OPX0:
28DD 9641             (         MAIN.ASM):00033                 LDA     TEMP2                             ; GRAB ARG BYTE
28DF 48               (         MAIN.ASM):00034                 ASLA                                      ; SHIFT TO BITS 7 & 6
28E0 48               (         MAIN.ASM):00035                 ASLA
28E1 9741             (         MAIN.ASM):00036                 STA     TEMP2                             ; SAVE RESULT
                      (         MAIN.ASM):00037         
28E3                  (         MAIN.ASM):00038         OPX1:
28E3 84C0             (         MAIN.ASM):00039                 ANDA    #%11000000                        ; MASK OUT GARBAGE
28E5 2605             (         MAIN.ASM):00040                 BNE     OPX2
28E7 BD29B0           (         MAIN.ASM):00041                 JSR     GETLNG                            ; 00 = LONG IMMEDIATE
28EA 2010             (         MAIN.ASM):00042                 BRA     OPXNXT
                      (         MAIN.ASM):00043         
28EC                  (         MAIN.ASM):00044         OPX2:
28EC 8140             (         MAIN.ASM):00045                 CMPA    #%01000000
28EE 2605             (         MAIN.ASM):00046                 BNE     OPX3
28F0 BD29A8           (         MAIN.ASM):00047                 JSR     GETSHT                            ; 01 = SHORT IMMEDIATE
28F3 2007             (         MAIN.ASM):00048                 BRA     OPXNXT
                      (         MAIN.ASM):00049         
28F5                  (         MAIN.ASM):00050         OPX3:
28F5 8180             (         MAIN.ASM):00051                 CMPA    #%10000000
28F7 2619             (         MAIN.ASM):00052                 BNE     OPX4                              ; 11 = NO MORE VARIABLES
28F9 BD29C7           (         MAIN.ASM):00053                 JSR     GETVAR                            ; 10 = VARIABLE
                      (         MAIN.ASM):00054         
28FC                  (         MAIN.ASM):00055         OPXNXT:
28FC D642             (         MAIN.ASM):00056                 LDB     TEMP2+1                           ; GET INDEX
28FE 8E0002           (         MAIN.ASM):00057                 LDX     #ARG1                             ; BASE ADDR OF ARGS
2901 3A               (         MAIN.ASM):00058                 ABX                                       ; ADD OFFSET IN B
2902 DC3F             (         MAIN.ASM):00059                 LDD     TEMP                              ; GRAB THE ARGUMENT'S VALUE
2904 ED84             (         MAIN.ASM):00060                 STD     ,X                                ; AND SAVE IT
2906 0C01             (         MAIN.ASM):00061                 INC     ARGCNT                            ; KEEP TRACK
2908 0C42             (         MAIN.ASM):00062                 INC     TEMP2+1                           ; UPDATE
290A 0C42             (         MAIN.ASM):00063                 INC     TEMP2+1                           ; ARGUMENT INDEX
290C 9642             (         MAIN.ASM):00064                 LDA     TEMP2+1                           ; DONE 4 ARGS YET?
290E 8108             (         MAIN.ASM):00065                 CMPA    #8
2910 25CB             (         MAIN.ASM):00066                 BLO     OPX0                              ; NO, KEEP GRABBING
                      (         MAIN.ASM):00067         
                      (         MAIN.ASM):00068         ; DISPATCH THE X-OP
                      (         MAIN.ASM):00069         
2912                  (         MAIN.ASM):00070         OPX4:
2912 D600             (         MAIN.ASM):00071                 LDB     OPCODE                            ; RETRIEVE THE OPCODE
2914 C1E0             (         MAIN.ASM):00072                 CMPB    #224                              ; IS IT AN EXTENDED 2-OP?
2916 1025007C         (         MAIN.ASM):00073                 LBLO    OP2EX                             ; YES, HANDLE LIKE A 2-OP
291A C41F             (         MAIN.ASM):00074                 ANDB    #%00011111                        ; ELSE ISOLATE OP BITS
291C C10C             (         MAIN.ASM):00075                 CMPB    #NOPSX                            ; COMPARE TO LEGAL # OF X-OPS
291E 2505             (         MAIN.ASM):00076                 BLO     DISPX                             ; CONTINUE IF OKAY
                      (         MAIN.ASM):00077         
                      (         MAIN.ASM):00078         ; *** ERROR #1 -- ILLEGAL X-OP ***
                      (         MAIN.ASM):00079         
2920 8601             (         MAIN.ASM):00080                 LDA     #1
2922 BD366D           (         MAIN.ASM):00081                 JSR     ZERROR
                      (         MAIN.ASM):00082         
2925                  (         MAIN.ASM):00083         DISPX:
2925 8E2B22           (         MAIN.ASM):00084                 LDX     #OPTX                             ; X-OP DISPATCH TABLE
2928                  (         MAIN.ASM):00085         DODIS:
2928 58               (         MAIN.ASM):00086                 ASLB                                      ; FORM A WORD-OFFSET INTO IT
2929 3A               (         MAIN.ASM):00087                 ABX                                       ; ADD THE OFFSET
                      (         MAIN.ASM):00088         
                      (         MAIN.ASM):00089                 IF      DEBUG
                      (         MAIN.ASM):00090                     PSHS    X
                      (         MAIN.ASM):00091                     LDB     #'1'
                      (         MAIN.ASM):00092                     JSR     DOBUG
                      (         MAIN.ASM):00093                     PULS    X
                      (         MAIN.ASM):00094                 ENDIF
                      (         MAIN.ASM):00095         
292A AD94             (         MAIN.ASM):00096                 JSR     [,X]                              ; HANDLE THE OPCODE
292C 7E28BD           (         MAIN.ASM):00097                 JMP     MLOOP                             ; AND GO BACK FOR ANOTHER
                      (         MAIN.ASM):00098         
                      (         MAIN.ASM):00099         ; HANDLE A 0-OP
                      (         MAIN.ASM):00100         
292F                  (         MAIN.ASM):00101         OP0:
292F 8E2AB4           (         MAIN.ASM):00102                 LDX     #OPT0                             ; 0-OP DISPATCH TABLE
2932 D600             (         MAIN.ASM):00103                 LDB     OPCODE                            ; FETCH OPCODE
2934 C40F             (         MAIN.ASM):00104                 ANDB    #%00001111                        ; ISOLATE OP BITS
2936 C10E             (         MAIN.ASM):00105                 CMPB    #NOPS0                            ; OPCODE OUT OF RANGE?
2938 25EE             (         MAIN.ASM):00106                 BLO     DODIS                             ; NO, GO DISPATCH IT
                      (         MAIN.ASM):00107         
                      (         MAIN.ASM):00108         ; *** ERROR #2 -- ILLEGAL 0-OP ***
                      (         MAIN.ASM):00109         
293A 8602             (         MAIN.ASM):00110                 LDA     #2
293C BD366D           (         MAIN.ASM):00111                 JSR     ZERROR
                      (         MAIN.ASM):00112         
                      (         MAIN.ASM):00113         ; HANDLE A 1-OP
                      (         MAIN.ASM):00114         
293F                  (         MAIN.ASM):00115         OP1:
293F 8430             (         MAIN.ASM):00116                 ANDA    #%00110000                        ; ISOLATE ARG BITS
2941 2605             (         MAIN.ASM):00117                 BNE     OP1A
2943 BD29B0           (         MAIN.ASM):00118                 JSR     GETLNG                            ; 00 = LONG IMMEDIATE
2946 2015             (         MAIN.ASM):00119                 BRA     OP1EX
                      (         MAIN.ASM):00120         
2948                  (         MAIN.ASM):00121         OP1A:
2948 8110             (         MAIN.ASM):00122                 CMPA    #%00010000
294A 2605             (         MAIN.ASM):00123                 BNE     OP1B
294C BD29A8           (         MAIN.ASM):00124                 JSR     GETSHT                            ; 01 = SHORT IMMEDIATE
294F 200C             (         MAIN.ASM):00125                 BRA     OP1EX
                      (         MAIN.ASM):00126         
2951                  (         MAIN.ASM):00127         OP1B:
2951 8120             (         MAIN.ASM):00128                 CMPA    #%00100000
2953 2705             (         MAIN.ASM):00129                 BEQ     OP1C
                      (         MAIN.ASM):00130         
                      (         MAIN.ASM):00131         ; *** ERROR #3 -- ILLEGAL 1-OP ***
                      (         MAIN.ASM):00132         
2955                  (         MAIN.ASM):00133         BADOP1:
2955 8603             (         MAIN.ASM):00134                 LDA     #3
2957 BD366D           (         MAIN.ASM):00135                 JSR     ZERROR
                      (         MAIN.ASM):00136         
295A                  (         MAIN.ASM):00137         OP1C:
295A BD29C7           (         MAIN.ASM):00138                 JSR     GETVAR                            ; 10 = VARIABLE
                      (         MAIN.ASM):00139         
295D                  (         MAIN.ASM):00140         OP1EX:
295D DC3F             (         MAIN.ASM):00141                 LDD     TEMP
295F DD02             (         MAIN.ASM):00142                 STD     ARG1                              ; GRAB THE ARGUMENT
2961 0C01             (         MAIN.ASM):00143                 INC     ARGCNT                            ; ONE ARGUMENT
2963 8E2AD0           (         MAIN.ASM):00144                 LDX     #OPT1                             ; ADDR OF 1-OP DISPATCH TABLE
2966 D600             (         MAIN.ASM):00145                 LDB     OPCODE                            ; RESTORE OPCODE
2968 C40F             (         MAIN.ASM):00146                 ANDB    #%00001111                        ; ISOLATE OP BITS
296A C110             (         MAIN.ASM):00147                 CMPB    #NOPS1                            ; IF OPCODE OUT OF RANGE,
296C 24E7             (         MAIN.ASM):00148                 BHS     BADOP1                            ; REPORT IT
296E 20B8             (         MAIN.ASM):00149                 BRA     DODIS                             ; ELSE DISPATCH THE 1-OP
                      (         MAIN.ASM):00150         
                      (         MAIN.ASM):00151         ; HANDLE A 2-OP
                      (         MAIN.ASM):00152         
2970                  (         MAIN.ASM):00153         OP2:
2970 8440             (         MAIN.ASM):00154                 ANDA    #%01000000                        ; ISOLATE 1ST ARG BIT
2972 2605             (         MAIN.ASM):00155                 BNE     OP2A
2974 BD29A8           (         MAIN.ASM):00156                 JSR     GETSHT                            ; 0 = SHORT IMMEDIATE
2977 2003             (         MAIN.ASM):00157                 BRA     OP2B
                      (         MAIN.ASM):00158         
2979                  (         MAIN.ASM):00159         OP2A:
2979 BD29C7           (         MAIN.ASM):00160                 JSR     GETVAR                            ; 1 = VARIABLE
                      (         MAIN.ASM):00161         
297C                  (         MAIN.ASM):00162         OP2B:
297C DC3F             (         MAIN.ASM):00163                 LDD     TEMP                              ; GRAB VALUE
297E DD02             (         MAIN.ASM):00164                 STD     ARG1                              ; SAVE IN ARG1
2980 0C01             (         MAIN.ASM):00165                 INC     ARGCNT
                      (         MAIN.ASM):00166         
2982 9600             (         MAIN.ASM):00167                 LDA     OPCODE                            ; RESTORE OPCODE
2984 8420             (         MAIN.ASM):00168                 ANDA    #%00100000                        ; ISOLATE 2ND ARG BIT
2986 2605             (         MAIN.ASM):00169                 BNE     OP2C
2988 BD29A8           (         MAIN.ASM):00170                 JSR     GETSHT                            ; 0 = SHORT IMMEDIATE
298B 2003             (         MAIN.ASM):00171                 BRA     OP2D
                      (         MAIN.ASM):00172         
298D                  (         MAIN.ASM):00173         OP2C:
298D BD29C7           (         MAIN.ASM):00174                 JSR     GETVAR                            ; 1 = VARIABLE
                      (         MAIN.ASM):00175         
2990                  (         MAIN.ASM):00176         OP2D:
2990 DC3F             (         MAIN.ASM):00177                 LDD     TEMP                              ; GRAB 2ND VALUE
2992 DD04             (         MAIN.ASM):00178                 STD     ARG2                              ; STORE AS ARG2
2994 0C01             (         MAIN.ASM):00179                 INC     ARGCNT
                      (         MAIN.ASM):00180         
2996                  (         MAIN.ASM):00181         OP2EX:
2996 8E2AF0           (         MAIN.ASM):00182                 LDX     #OPT2                             ; ADDR OF 2-OP DISPATCH TABLE
2999 D600             (         MAIN.ASM):00183                 LDB     OPCODE                            ; RESTORE YET AGAIN
299B C41F             (         MAIN.ASM):00184                 ANDB    #%00011111                        ; ISOLATE OP BITS
299D C119             (         MAIN.ASM):00185                 CMPB    #NOPS2                            ; OPCODE IN RANGE?
299F 1025FF85         (         MAIN.ASM):00186                 LBLO    DODIS                             ; YES, GO DISPATCH IT
                      (         MAIN.ASM):00187         
                      (         MAIN.ASM):00188         ; *** ERROR #4 -- ILLEGAL 2-OP ***
                      (         MAIN.ASM):00189         
29A3                  (         MAIN.ASM):00190         BADOP2:
29A3 8604             (         MAIN.ASM):00191                 LDA     #4
29A5 BD366D           (         MAIN.ASM):00192                 JSR     ZERROR
                      (     cubixzip.asm):00053                 INCLUDE SUBS.ASM
                      (         SUBS.ASM):00001         ;       PAGE
                      (         SUBS.ASM):00002         ;       SBTTL "--- MAIN LOOP SUPPORT ---"
                      (         SUBS.ASM):00003         
                      (         SUBS.ASM):00004         ; -----------------------
                      (         SUBS.ASM):00005         ; FETCH A SHORT IMMEDIATE
                      (         SUBS.ASM):00006         ; -----------------------
                      (         SUBS.ASM):00007         
29A8                  (         SUBS.ASM):00008         GETSHT:
29A8 BD3191           (         SUBS.ASM):00009                 JSR     NEXTPC                            ; NEXT Z-BYTE IS
29AB 9740             (         SUBS.ASM):00010                 STA     TEMP+1                            ; THE LSB OF ARGUMENT
29AD 0F3F             (         SUBS.ASM):00011                 CLR     TEMP                              ; MSB IS ZERO
29AF 39               (         SUBS.ASM):00012                 RTS
                      (         SUBS.ASM):00013         
                      (         SUBS.ASM):00014         ; ----------------------
                      (         SUBS.ASM):00015         ; FETCH A LONG IMMEDIATE
                      (         SUBS.ASM):00016         ; ----------------------
                      (         SUBS.ASM):00017         
29B0                  (         SUBS.ASM):00018         GETLNG:
29B0 BD3191           (         SUBS.ASM):00019                 JSR     NEXTPC                            ; NEXT Z-BYTE IS MSB
29B3 3402             (         SUBS.ASM):00020                 PSHS    A                                 ; SAVE ON STACK
29B5 BD3191           (         SUBS.ASM):00021                 JSR     NEXTPC                            ; NOW GRAB LSB
29B8 9740             (         SUBS.ASM):00022                 STA     TEMP+1                            ; STORE IT
29BA 3502             (         SUBS.ASM):00023                 PULS    A                                 ; RETRIEVE MSB
29BC 973F             (         SUBS.ASM):00024                 STA     TEMP                              ; AND STORE IT
29BE 39               (         SUBS.ASM):00025                 RTS
                      (         SUBS.ASM):00026         
                      (         SUBS.ASM):00027         ; ----------------
                      (         SUBS.ASM):00028         ; FETCH A VARIABLE
                      (         SUBS.ASM):00029         ; ----------------
                      (         SUBS.ASM):00030         
                      (         SUBS.ASM):00031         ; GET WITHIN AN OPCODE
                      (         SUBS.ASM):00032         
29BF                  (         SUBS.ASM):00033         VARGET:
29BF 4D               (         SUBS.ASM):00034                 TSTA                                      ; IF NON-ZERO,
29C0 260B             (         SUBS.ASM):00035                 BNE     GETVR1                            ; ACCESS A VARIABLE
29C2 BD2A2C           (         SUBS.ASM):00036                 JSR     POPSTK                            ; ELSE TAKE VAR OFF STACK
29C5 205A             (         SUBS.ASM):00037                 BRA     PSHSTK                            ; WITHOUT ALTERING STACK
                      (         SUBS.ASM):00038         
29C7                  (         SUBS.ASM):00039         GETVAR:
29C7 BD3191           (         SUBS.ASM):00040                 JSR     NEXTPC                            ; GRAB VAR-TYPE BYTE
29CA 4D               (         SUBS.ASM):00041                 TSTA                                      ; IF ZERO,
29CB 275F             (         SUBS.ASM):00042                 BEQ     POPSTK                            ; VALUE IS ON STACK
                      (         SUBS.ASM):00043         
                      (         SUBS.ASM):00044         ; IS VARIABLE LOCAL OR GLOBAL?
                      (         SUBS.ASM):00045         
29CD                  (         SUBS.ASM):00046         GETVR1:
29CD 8110             (         SUBS.ASM):00047                 CMPA    #16
29CF 240D             (         SUBS.ASM):00048                 BHS     GETVRG                            ; IT'S GLOBAL
                      (         SUBS.ASM):00049         
                      (         SUBS.ASM):00050         ; HANDLE A LOCAL VARIABLE
                      (         SUBS.ASM):00051         
29D1                  (         SUBS.ASM):00052         GETVRL:
29D1 4A               (         SUBS.ASM):00053                 DECA                                      ; FORM A ZERO-ALIGNED INDEX
29D2 48               (         SUBS.ASM):00054                 ASLA                                      ; WORD INDEX
29D3 8E2700           (         SUBS.ASM):00055                 LDX     #LOCALS                           ; INTO LOCAL VAR TABLE
29D6 1F89             (         SUBS.ASM):00056                 TFR     A,B                               ; MOVE AND
29D8                  (         SUBS.ASM):00057         GTVX:
29D8 3A               (         SUBS.ASM):00058                 ABX                                       ; ADD INDEXING OFFSET
29D9 EC84             (         SUBS.ASM):00059                 LDD     ,X                                ; FETCH VALUE
29DB DD3F             (         SUBS.ASM):00060                 STD     TEMP                              ; AND RETURN IT
29DD 39               (         SUBS.ASM):00061                 RTS
                      (         SUBS.ASM):00062         
                      (         SUBS.ASM):00063         ; HANDLE A GLOBAL VARIABLE
                      (         SUBS.ASM):00064         
29DE                  (         SUBS.ASM):00065         GETVRG:
29DE 8010             (         SUBS.ASM):00066                 SUBA    #16                               ; ZERO-ALIGN
29E0 9E21             (         SUBS.ASM):00067                 LDX     GLOBAL                            ; BASE OF GLOBAL VAR TABLE
29E2 1F89             (         SUBS.ASM):00068                 TFR     A,B                               ; CONVERT TO WORD-ALIGNED INDEX
29E4 3A               (         SUBS.ASM):00069                 ABX                                       ; BY ADDING OFFSET TWICE (CLEVER, EH?)
29E5 20F1             (         SUBS.ASM):00070                 BRA     GTVX                              ; 2ND ADD ABOVE
                      (         SUBS.ASM):00071         
                      (         SUBS.ASM):00072         ; --------------
                      (         SUBS.ASM):00073         ; RETURN A VALUE
                      (         SUBS.ASM):00074         ; --------------
                      (         SUBS.ASM):00075         
                      (         SUBS.ASM):00076         ; RETURN FROM WITHIN OPCODE
                      (         SUBS.ASM):00077         
29E7                  (         SUBS.ASM):00078         VARPUT:
29E7 4D               (         SUBS.ASM):00079                 TSTA                                      ; IF NON-ZERO
29E8 261D             (         SUBS.ASM):00080                 BNE     PUTVR1                            ; ACCESS A VARIABLE
29EA 3706             (         SUBS.ASM):00081                 PULU    D                                 ; ELSE FLUSH TOP ITEM OFF STACK
29EC 118324FE         (         SUBS.ASM):00082                 CMPU    #TOPSTA
29F0 2245             (         SUBS.ASM):00083                 BHI     UNDER                             ; WATCH FOR UNDERFLOW!
29F2 202D             (         SUBS.ASM):00084                 BRA     PSHSTK                            ; AND PUSH [TEMP] ONTO STACK
                      (         SUBS.ASM):00085         
                      (         SUBS.ASM):00086         ; RETURN A ZERO
                      (         SUBS.ASM):00087         
29F4                  (         SUBS.ASM):00088         RET0:
29F4 4F               (         SUBS.ASM):00089                 CLRA                                      ; CLEAR MSB
                      (         SUBS.ASM):00090         
                      (         SUBS.ASM):00091         ; RETURN BYTE IN [A]
                      (         SUBS.ASM):00092         
29F5                  (         SUBS.ASM):00093         PUTBYT:
29F5 9740             (         SUBS.ASM):00094                 STA     TEMP+1                            ; USE [A] AS LSB
29F7 0F3F             (         SUBS.ASM):00095                 CLR     TEMP                              ; ZERO MSB
                      (         SUBS.ASM):00096         
                      (         SUBS.ASM):00097         ; RETURN VALUE IN [TEMP]
                      (         SUBS.ASM):00098         
29F9                  (         SUBS.ASM):00099         PUTVAL:
29F9 9E3F             (         SUBS.ASM):00100                 LDX     TEMP                              ; GET VALUE IN [TEMP]
29FB 3410             (         SUBS.ASM):00101                 PSHS    X                                 ; AND HOLD ON TO IT
29FD BD3191           (         SUBS.ASM):00102                 JSR     NEXTPC                            ; GET VAR-TYPE BYTE
2A00 3510             (         SUBS.ASM):00103                 PULS    X                                 ; RETRIEVE VALUE
2A02 9F3F             (         SUBS.ASM):00104                 STX     TEMP                              ; PUT IT BACK IN [TEMP]
2A04 4D               (         SUBS.ASM):00105                 TSTA                                      ; IF TYPE-BYTE IS ZERO,
2A05 271A             (         SUBS.ASM):00106                 BEQ     PSHSTK                            ; VALUE GOES TO THE STACK
                      (         SUBS.ASM):00107         
                      (         SUBS.ASM):00108         ; LOCAL OR GLOBAL?
                      (         SUBS.ASM):00109         
2A07                  (         SUBS.ASM):00110         PUTVR1:
2A07 8110             (         SUBS.ASM):00111                 CMPA    #16
2A09 240D             (         SUBS.ASM):00112                 BHS     PUTVLG                            ; IT'S GLOBAL
                      (         SUBS.ASM):00113         
                      (         SUBS.ASM):00114         ; HANDLE A LOCAL VARIABLE
                      (         SUBS.ASM):00115         
2A0B                  (         SUBS.ASM):00116         PUTVLL:
2A0B 4A               (         SUBS.ASM):00117                 DECA
2A0C 48               (         SUBS.ASM):00118                 ASLA
2A0D 1F89             (         SUBS.ASM):00119                 TFR     A,B
2A0F 8E2700           (         SUBS.ASM):00120                 LDX     #LOCALS                           ; INTO LOCAL VARIABLE TABLE
2A12                  (         SUBS.ASM):00121         PTVX:
2A12 3A               (         SUBS.ASM):00122                 ABX
2A13 DC3F             (         SUBS.ASM):00123                 LDD     TEMP
2A15 ED84             (         SUBS.ASM):00124                 STD     ,X
2A17 39               (         SUBS.ASM):00125                 RTS
                      (         SUBS.ASM):00126         
                      (         SUBS.ASM):00127         ; HANDLE A GLOBAL VARIABLE
                      (         SUBS.ASM):00128         
2A18                  (         SUBS.ASM):00129         PUTVLG:
2A18 8010             (         SUBS.ASM):00130                 SUBA    #16                               ; ZERO-ALIGN
2A1A 9E21             (         SUBS.ASM):00131                 LDX     GLOBAL                            ; BASE OF GLOBAL VAR TABLE
2A1C 1F89             (         SUBS.ASM):00132                 TFR     A,B                               ; FORM WORD-ALIGNED INDEX
2A1E 3A               (         SUBS.ASM):00133                 ABX                                       ; BY ADDING OFFSET TO BASE
2A1F 20F1             (         SUBS.ASM):00134                 BRA     PTVX                              ; TWICE
                      (         SUBS.ASM):00135         
                      (         SUBS.ASM):00136         ; --------------------
                      (         SUBS.ASM):00137         ; PUSH [TEMP] TO STACK
                      (         SUBS.ASM):00138         ; --------------------
                      (         SUBS.ASM):00139         
2A21                  (         SUBS.ASM):00140         PSHSTK:
2A21 DC3F             (         SUBS.ASM):00141                 LDD     TEMP
                      (         SUBS.ASM):00142         
                      (         SUBS.ASM):00143         ; PUSH [D] TO STACK
                      (         SUBS.ASM):00144         
2A23                  (         SUBS.ASM):00145         PSHDZ:
2A23 3606             (         SUBS.ASM):00146                 PSHU    D
2A25 11832300         (         SUBS.ASM):00147                 CMPU    #ZSTACK
2A29 2511             (         SUBS.ASM):00148                 BLO     OVER
2A2B 39               (         SUBS.ASM):00149                 RTS
                      (         SUBS.ASM):00150         
                      (         SUBS.ASM):00151         ; -------------------------
                      (         SUBS.ASM):00152         ; POP STACK, SAVE IN [TEMP]
                      (         SUBS.ASM):00153         ; -------------------------
                      (         SUBS.ASM):00154         
2A2C                  (         SUBS.ASM):00155         POPSTK:
2A2C 3706             (         SUBS.ASM):00156                 PULU    D                                 ; PULL A WORD
2A2E DD3F             (         SUBS.ASM):00157                 STD     TEMP                              ; SAVE IT IN [TEMP]
2A30 118324FE         (         SUBS.ASM):00158                 CMPU    #TOPSTA
2A34 2201             (         SUBS.ASM):00159                 BHI     UNDER
2A36 39               (         SUBS.ASM):00160                 RTS
                      (         SUBS.ASM):00161         
                      (         SUBS.ASM):00162         ; *** ERROR #5 -- Z-STACK UNDERFLOW ***
                      (         SUBS.ASM):00163         
2A37                  (         SUBS.ASM):00164         UNDER:
2A37 8605             (         SUBS.ASM):00165                 LDA     #5
2A39 7E366D           (         SUBS.ASM):00166                 JMP     ZERROR
                      (         SUBS.ASM):00167         
                      (         SUBS.ASM):00168         ; *** ERROR #6 -- Z-STACK OVERFLOW ***
                      (         SUBS.ASM):00169         
2A3C                  (         SUBS.ASM):00170         OVER:
2A3C 8606             (         SUBS.ASM):00171                 LDA     #6
2A3E 7E366D           (         SUBS.ASM):00172                 JMP     ZERROR
                      (         SUBS.ASM):00173         
                      (         SUBS.ASM):00174         ; ---------------
                      (         SUBS.ASM):00175         ; PREDICATE FAILS
                      (         SUBS.ASM):00176         ; ---------------
                      (         SUBS.ASM):00177         
2A41                  (         SUBS.ASM):00178         PREDF:
2A41 BD3191           (         SUBS.ASM):00179                 JSR     NEXTPC                            ; GET 1ST BRANCH BYTE
2A44 4D               (         SUBS.ASM):00180                 TSTA                                      ; IF BIT 7 ISN'T SET,
2A45 2A0E             (         SUBS.ASM):00181                 BPL     PREDB                             ; DO THE BRANCH
                      (         SUBS.ASM):00182         
2A47                  (         SUBS.ASM):00183         PREDNB:
2A47 8440             (         SUBS.ASM):00184                 ANDA    #%01000000                        ; ELSE TEST BIT 6
2A49 2603             (         SUBS.ASM):00185                 BNE     PNBX                              ; ALL DONE IF SET
2A4B BD3191           (         SUBS.ASM):00186                 JSR     NEXTPC                            ; ELSE SKIP OVER 2ND BRANCH BYTE
2A4E                  (         SUBS.ASM):00187         PNBX:
2A4E 39               (         SUBS.ASM):00188                 RTS                                       ; BEFORE LEAVING
                      (         SUBS.ASM):00189         
                      (         SUBS.ASM):00190         ; ------------------
                      (         SUBS.ASM):00191         ; PREDICATE SUCCEEDS
                      (         SUBS.ASM):00192         ; ------------------
                      (         SUBS.ASM):00193         
2A4F                  (         SUBS.ASM):00194         PREDS:
2A4F BD3191           (         SUBS.ASM):00195                 JSR     NEXTPC
2A52 4D               (         SUBS.ASM):00196                 TSTA                                      ; IF BIT 7 IS SET,
2A53 2AF2             (         SUBS.ASM):00197                 BPL     PREDNB                            ; BRANCH ON PREDICATE FAILURE
                      (         SUBS.ASM):00198         
                      (         SUBS.ASM):00199         ; ----------------
                      (         SUBS.ASM):00200         ; PERFORM A BRANCH
                      (         SUBS.ASM):00201         ; ----------------
                      (         SUBS.ASM):00202         
2A55                  (         SUBS.ASM):00203         PREDB:
2A55 8540             (         SUBS.ASM):00204                 BITA    #%01000000                        ; LONG OR SHORT BRANCH?
2A57 2708             (         SUBS.ASM):00205                 BEQ     PREDLB                            ; LONG IF BIT 6 IS OFF
2A59 843F             (         SUBS.ASM):00206                 ANDA    #%00111111                        ; ELSE FORM SHORT OFFSET
2A5B 9740             (         SUBS.ASM):00207                 STA     TEMP+1                            ; USE AS LSB OF BRANCH OFFSET
2A5D 0F3F             (         SUBS.ASM):00208                 CLR     TEMP                              ; ZERO MSB OF OFFSET
2A5F 2013             (         SUBS.ASM):00209                 BRA     PREDB1                            ; AND DO THE BRANCH
                      (         SUBS.ASM):00210         
                      (         SUBS.ASM):00211         ; HANDLE A LONG BRANCH
                      (         SUBS.ASM):00212         
2A61                  (         SUBS.ASM):00213         PREDLB:
2A61 843F             (         SUBS.ASM):00214                 ANDA    #%00111111                        ; FORM MSB OF OFFSET
2A63 8520             (         SUBS.ASM):00215                 BITA    #%00100000                        ; CHECK SIGN OF 14-BIT VALUE
2A65 2702             (         SUBS.ASM):00216                 BEQ     DOB2                              ; IT'S POSITIVE
2A67 8AE0             (         SUBS.ASM):00217                 ORA     #%11100000                        ; ELSE EXTEND SIGN BITS
2A69                  (         SUBS.ASM):00218         DOB2:
2A69 3402             (         SUBS.ASM):00219                 PSHS    A                                 ; SAVE MSB OF BRANCH
2A6B BD3191           (         SUBS.ASM):00220                 JSR     NEXTPC                            ; GRAB NEXT Z-BYTE
2A6E 9740             (         SUBS.ASM):00221                 STA     TEMP+1                            ; USE AS LSB OF BRANCH
2A70 3502             (         SUBS.ASM):00222                 PULS    A
2A72 973F             (         SUBS.ASM):00223                 STA     TEMP                              ; RETRIEVE MSB
                      (         SUBS.ASM):00224         
                      (         SUBS.ASM):00225         ; BRANCH TO Z-ADDRESS IN [TEMP]
                      (         SUBS.ASM):00226         
2A74                  (         SUBS.ASM):00227         PREDB1:
2A74 DC3F             (         SUBS.ASM):00228                 LDD     TEMP                              ; IF OFFSET IS ZERO,
2A76 102700C8         (         SUBS.ASM):00229                 LBEQ    ZRFALS                            ; DO AN "RFALSE"
2A7A 830001           (         SUBS.ASM):00230                 SUBD    #1                                ; IF OFFSET IS ONE,
2A7D 102700B9         (         SUBS.ASM):00231                 LBEQ    ZRTRUE                            ; DO AN "RTRUE"
                      (         SUBS.ASM):00232         
2A81                  (         SUBS.ASM):00233         PREDB3:
2A81 830001           (         SUBS.ASM):00234                 SUBD    #1                                ; D = OFFSET-2
2A84 DD3F             (         SUBS.ASM):00235                 STD     TEMP                              ; SAVE NEW OFFSET
                      (         SUBS.ASM):00236         
                      (         SUBS.ASM):00237         ; USE [VAL] TO HOLD TOP 9 BITS OF OFFSET
                      (         SUBS.ASM):00238         
2A86 973E             (         SUBS.ASM):00239                 STA     VAL+1
2A88 5F               (         SUBS.ASM):00240                 CLRB
2A89 48               (         SUBS.ASM):00241                 ASLA                                      ; EXTEND THE SIGN BIT
2A8A 59               (         SUBS.ASM):00242                 ROLB                                      ; SHIFT CARRY TO BIT 0 OF [B]
2A8B D73D             (         SUBS.ASM):00243                 STB     VAL                               ; SAVE AS UPPER BYTE OF OFFSET
                      (         SUBS.ASM):00244         
2A8D 9640             (         SUBS.ASM):00245                 LDA     TEMP+1                            ; GET LOW BYTE OF OFFSET
2A8F 1CFE             (         SUBS.ASM):00246                 ANDCC   #%11111110                        ; CLEAR CARRY
2A91 9915             (         SUBS.ASM):00247                 ADCA    ZPCL                              ; ADD LOW BYTE OF CURRENT ZPC
2A93 2406             (         SUBS.ASM):00248                 BCC     PDB0                              ; IF OVERFLOWED,
                      (         SUBS.ASM):00249         
2A95 0C3E             (         SUBS.ASM):00250                 INC     VAL+1                             ; UPDATE
2A97 2602             (         SUBS.ASM):00251                 BNE     PDB0                              ; UPPER
2A99 0C3D             (         SUBS.ASM):00252                 INC     VAL                               ; 9 BITS
                      (         SUBS.ASM):00253         
2A9B                  (         SUBS.ASM):00254         PDB0:
2A9B 9715             (         SUBS.ASM):00255                 STA     ZPCL                              ; LOW-BYTES CALCED
                      (         SUBS.ASM):00256         
2A9D DC3D             (         SUBS.ASM):00257                 LDD     VAL                               ; IF 9 UPPER BITS ARE ZERO,
2A9F 2712             (         SUBS.ASM):00258                 BEQ     PDB1                              ; NO NEED TO CHANGE PAGES
                      (         SUBS.ASM):00259         
2AA1 963E             (         SUBS.ASM):00260                 LDA     VAL+1                             ; ELSE ADD MIDDLE BYTES
2AA3 1CFE             (         SUBS.ASM):00261                 ANDCC   #%11111110                        ; CLEAR CARRY
2AA5 9914             (         SUBS.ASM):00262                 ADCA    ZPCM
2AA7 9714             (         SUBS.ASM):00263                 STA     ZPCM
2AA9 963D             (         SUBS.ASM):00264                 LDA     VAL                               ; NOW ADD THE TOP BITS
2AAB 9913             (         SUBS.ASM):00265                 ADCA    ZPCH                              ; USING PREVIOUS CARRY
2AAD 8401             (         SUBS.ASM):00266                 ANDA    #%00000001                        ; ISOLATE BIT 0
2AAF 9713             (         SUBS.ASM):00267                 STA     ZPCH
2AB1 0F18             (         SUBS.ASM):00268                 CLR     ZPCFLG                            ; CHANGED PAGES
2AB3                  (         SUBS.ASM):00269         PDB1:
2AB3 39               (         SUBS.ASM):00270                 RTS
                      (     cubixzip.asm):00054                 INCLUDE DISPATCH.ASM
                      (     DISPATCH.ASM):00001         ;       PAGE
                      (     DISPATCH.ASM):00002         ;       SBTTL "--- OPCODE DISPATCH TABLES ---"
                      (     DISPATCH.ASM):00003         
                      (     DISPATCH.ASM):00004         ; 0-OPS
                      (     DISPATCH.ASM):00005         
2AB4                  (     DISPATCH.ASM):00006         OPT0:
2AB4 2B3A             (     DISPATCH.ASM):00007                 FDB     ZRTRUE                            ; 0
2AB6 2B42             (     DISPATCH.ASM):00008                 FDB     ZRFALS                            ; 1
2AB8 2B45             (     DISPATCH.ASM):00009                 FDB     ZPRI                              ; 2
2ABA 2B63             (     DISPATCH.ASM):00010                 FDB     ZPRR                              ; 3
2ABC 2B62             (     DISPATCH.ASM):00011                 FDB     ZNOOP                             ; 4
2ABE 384C             (     DISPATCH.ASM):00012                 FDB     ZSAVE                             ; 5
2AC0 38D4             (     DISPATCH.ASM):00013                 FDB     ZREST                             ; 6
2AC2 3614             (     DISPATCH.ASM):00014                 FDB     ZSTART                            ; 7
2AC4 2B6A             (     DISPATCH.ASM):00015                 FDB     ZRSTAK                            ; 8
2AC6 2A2C             (     DISPATCH.ASM):00016                 FDB     POPSTK                            ; 9
2AC8 3686             (     DISPATCH.ASM):00017                 FDB     ZQUIT                             ; 10
2ACA 36DB             (     DISPATCH.ASM):00018                 FDB     ZCRLF                             ; 11
2ACC 370B             (     DISPATCH.ASM):00019                 FDB     ZUSL                              ; 12
2ACE 2B72             (     DISPATCH.ASM):00020                 FDB     ZVER                              ; 13
                      (     DISPATCH.ASM):00021         
     000E             (     DISPATCH.ASM):00022         NOPS0           EQU 14                            ; NUMBER OF 0-OPS
                      (     DISPATCH.ASM):00023         
                      (     DISPATCH.ASM):00024         ; 1-OPS
                      (     DISPATCH.ASM):00025         
2AD0                  (     DISPATCH.ASM):00026         OPT1:
2AD0 2BBF             (     DISPATCH.ASM):00027                 FDB     ZZERO                             ; 0
2AD2 2BC8             (     DISPATCH.ASM):00028                 FDB     ZNEXT                             ; 1
2AD4 2BD1             (     DISPATCH.ASM):00029                 FDB     ZFIRST                            ; 2
2AD6 2BEF             (     DISPATCH.ASM):00030                 FDB     ZLOC                              ; 3
2AD8 2BFF             (     DISPATCH.ASM):00031                 FDB     ZPTSIZ                            ; 4
2ADA 2C11             (     DISPATCH.ASM):00032                 FDB     ZINC                              ; 5
2ADC 2C29             (     DISPATCH.ASM):00033                 FDB     ZDEC                              ; 6
2ADE 2C35             (     DISPATCH.ASM):00034                 FDB     ZPRB                              ; 7
2AE0 2955             (     DISPATCH.ASM):00035                 FDB     BADOP1                            ; 8 (UNDEFINED)
2AE2 2C3F             (     DISPATCH.ASM):00036                 FDB     ZREMOV                            ; 9
2AE4 2C7F             (     DISPATCH.ASM):00037                 FDB     ZPRD                              ; 10
2AE6 2C93             (     DISPATCH.ASM):00038                 FDB     ZRET                              ; 11
2AE8 2CCD             (     DISPATCH.ASM):00039                 FDB     ZJUMP                             ; 12
2AEA 2CD7             (     DISPATCH.ASM):00040                 FDB     ZPRINT                            ; 13
2AEC 2CE1             (     DISPATCH.ASM):00041                 FDB     ZVALUE                            ; 14
2AEE 2CE9             (     DISPATCH.ASM):00042                 FDB     ZBCOM                             ; 15
                      (     DISPATCH.ASM):00043         
     0010             (     DISPATCH.ASM):00044         NOPS1           EQU 16                            ; NUMBER OF 1-OPS
                      (     DISPATCH.ASM):00045         
                      (     DISPATCH.ASM):00046         ; 2-OPS
                      (     DISPATCH.ASM):00047         
2AF0                  (     DISPATCH.ASM):00048         OPT2:
2AF0 29A3             (     DISPATCH.ASM):00049                 FDB     BADOP2                            ; 0 (UNDEFINED)
2AF2 2F0E             (     DISPATCH.ASM):00050                 FDB     ZEQUAL                            ; 1
2AF4 2CF2             (     DISPATCH.ASM):00051                 FDB     ZLESS                             ; 2
2AF6 2CFC             (     DISPATCH.ASM):00052                 FDB     ZGRTR                             ; 3
2AF8 2D06             (     DISPATCH.ASM):00053                 FDB     ZDLESS                            ; 4
2AFA 2D0F             (     DISPATCH.ASM):00054                 FDB     ZIGRTR                            ; 5
2AFC 2D32             (     DISPATCH.ASM):00055                 FDB     ZIN                               ; 6
2AFE 2D42             (     DISPATCH.ASM):00056                 FDB     ZBTST                             ; 7
2B00 2D4F             (     DISPATCH.ASM):00057                 FDB     ZBOR                              ; 8
2B02 2D5A             (     DISPATCH.ASM):00058                 FDB     ZBAND                             ; 9
2B04 2D62             (     DISPATCH.ASM):00059                 FDB     ZFSETP                            ; 10
2B06 2D73             (     DISPATCH.ASM):00060                 FDB     ZFSET                             ; 11
2B08 2D81             (     DISPATCH.ASM):00061                 FDB     ZFCLR                             ; 12
2B0A 2D91             (     DISPATCH.ASM):00062                 FDB     ZSET                              ; 13
2B0C 2D9A             (     DISPATCH.ASM):00063                 FDB     ZMOVE                             ; 14
2B0E 2DC0             (     DISPATCH.ASM):00064                 FDB     ZGET                              ; 15
2B10 2DD3             (     DISPATCH.ASM):00065                 FDB     ZGETB                             ; 16
2B12 2DE6             (     DISPATCH.ASM):00066                 FDB     ZGETP                             ; 17
2B14 2E2A             (     DISPATCH.ASM):00067                 FDB     ZGETPT                            ; 18
2B16 2E4E             (     DISPATCH.ASM):00068                 FDB     ZNEXTP                            ; 19
2B18 2E6E             (     DISPATCH.ASM):00069                 FDB     ZADD                              ; 20
2B1A 2E77             (     DISPATCH.ASM):00070                 FDB     ZSUB                              ; 21
2B1C 2E7D             (     DISPATCH.ASM):00071                 FDB     ZMUL                              ; 22
2B1E 2E9C             (     DISPATCH.ASM):00072                 FDB     ZDIV                              ; 23
2B20 2EA1             (     DISPATCH.ASM):00073                 FDB     ZMOD                              ; 24
                      (     DISPATCH.ASM):00074         
     0019             (     DISPATCH.ASM):00075         NOPS2           EQU 25                            ; NUMBER OF 2-OPS
                      (     DISPATCH.ASM):00076         
                      (     DISPATCH.ASM):00077         ; X-OPS
                      (     DISPATCH.ASM):00078         
2B22                  (     DISPATCH.ASM):00079         OPTX:
2B22 2F36             (     DISPATCH.ASM):00080                 FDB     ZCALL                             ; 0
2B24 2FA7             (     DISPATCH.ASM):00081                 FDB     ZPUT                              ; 1
2B26 2FB9             (     DISPATCH.ASM):00082                 FDB     ZPUTB                             ; 2
2B28 2FC7             (     DISPATCH.ASM):00083                 FDB     ZPUTP                             ; 3
2B2A 3066             (     DISPATCH.ASM):00084                 FDB     ZREAD                             ; 4
2B2C 2FFD             (     DISPATCH.ASM):00085                 FDB     ZPRC                              ; 5
2B2E 3002             (     DISPATCH.ASM):00086                 FDB     ZPRN                              ; 6
2B30 303D             (     DISPATCH.ASM):00087                 FDB     ZRAND                             ; 7
2B32 3059             (     DISPATCH.ASM):00088                 FDB     ZPUSH                             ; 8
2B34 305E             (     DISPATCH.ASM):00089                 FDB     ZPOP                              ; 9
2B36 2B62             (     DISPATCH.ASM):00090                 FDB     ZSPLIT                            ; 10
2B38 2B62             (     DISPATCH.ASM):00091                 FDB     ZSCRN                             ; 11
                      (     DISPATCH.ASM):00092         
     000C             (     DISPATCH.ASM):00093         NOPSX           EQU 12                            ; NUMBER OF X-OPS
                      (     cubixzip.asm):00055         
                      (     cubixzip.asm):00056         ;TITLE "ZIP/6809-B INFOCOM, INC. --- OPCODE EXECUTORS"
                      (     cubixzip.asm):00057                 INCLUDE OPS0.ASM
                      (         OPS0.ASM):00001         ;       PAGE
                      (         OPS0.ASM):00002         ;       SBTTL "--- 0-OPS ---"
                      (         OPS0.ASM):00003         
                      (         OPS0.ASM):00004         ; -----
                      (         OPS0.ASM):00005         ; RTRUE
                      (         OPS0.ASM):00006         ; -----
                      (         OPS0.ASM):00007         
                      (         OPS0.ASM):00008         ; Simulate a RETURN 1
                      (         OPS0.ASM):00009         
2B3A                  (         OPS0.ASM):00010         ZRTRUE:
2B3A C601             (         OPS0.ASM):00011                 LDB     #1
                      (         OPS0.ASM):00012         
2B3C                  (         OPS0.ASM):00013         ZRT:
2B3C 4F               (         OPS0.ASM):00014                 CLRA
2B3D DD02             (         OPS0.ASM):00015                 STD     ARG1                              ; SAVE VALUE HERE
2B3F 7E2C93           (         OPS0.ASM):00016                 JMP     ZRET
                      (         OPS0.ASM):00017         
                      (         OPS0.ASM):00018         ; ------
                      (         OPS0.ASM):00019         ; RFALSE
                      (         OPS0.ASM):00020         ; ------
                      (         OPS0.ASM):00021         
                      (         OPS0.ASM):00022         ; Simulate a RETURN 0
                      (         OPS0.ASM):00023         
2B42                  (         OPS0.ASM):00024         ZRFALS:
2B42 5F               (         OPS0.ASM):00025                 CLRB
2B43 20F7             (         OPS0.ASM):00026                 BRA     ZRT
                      (         OPS0.ASM):00027         
                      (         OPS0.ASM):00028         ; ------
                      (         OPS0.ASM):00029         ; PRINTI
                      (         OPS0.ASM):00030         ; ------
                      (         OPS0.ASM):00031         
                      (         OPS0.ASM):00032         ; Print the Z-string immediately following the opcode
                      (         OPS0.ASM):00033         
2B45                  (         OPS0.ASM):00034         ZPRI:
2B45 9613             (         OPS0.ASM):00035                 LDA     ZPCH                              ; MOVE ZPC INTO MPC
2B47 971A             (         OPS0.ASM):00036                 STA     MPCH
2B49 DC14             (         OPS0.ASM):00037                 LDD     ZPCM
2B4B DD1B             (         OPS0.ASM):00038                 STD     MPCM
2B4D 0F1F             (         OPS0.ASM):00039                 CLR     MPCFLG                            ; ZERO MPC FLAG
                      (         OPS0.ASM):00040         
2B4F BD328D           (         OPS0.ASM):00041                 JSR     PZSTR                             ; PRINT THE STRING AT [MPC]
                      (         OPS0.ASM):00042         
2B52 961A             (         OPS0.ASM):00043                 LDA     MPCH                              ; UPDATE ZPC FROM MPC
2B54 9713             (         OPS0.ASM):00044                 STA     ZPCH
2B56 DC1B             (         OPS0.ASM):00045                 LDD     MPCM
2B58 DD14             (         OPS0.ASM):00046                 STD     ZPCM
2B5A 961F             (         OPS0.ASM):00047                 LDA     MPCFLG                            ; ALSO UPDATE FLAG
2B5C 9718             (         OPS0.ASM):00048                 STA     ZPCFLG
2B5E DC1D             (         OPS0.ASM):00049                 LDD     MPCPNT                            ; AND PAGE POINTER
2B60 DD16             (         OPS0.ASM):00050                 STD     ZPCPNT
                      (         OPS0.ASM):00051         
                      (         OPS0.ASM):00052         ; FALL THROUGH TO ...
                      (         OPS0.ASM):00053         
                      (         OPS0.ASM):00054         ; ----
                      (         OPS0.ASM):00055         ; NOOP
                      (         OPS0.ASM):00056         ; ----
                      (         OPS0.ASM):00057         
2B62                  (         OPS0.ASM):00058         ZNOOP:
2B62 39               (         OPS0.ASM):00059                 RTS
                      (         OPS0.ASM):00060         
                      (         OPS0.ASM):00061         ; ------
                      (         OPS0.ASM):00062         ; PRINTR
                      (         OPS0.ASM):00063         ; ------
                      (         OPS0.ASM):00064         
                      (         OPS0.ASM):00065         ; Execute a PRINTI, followed by CRLF and RTRUE
                      (         OPS0.ASM):00066         
2B63                  (         OPS0.ASM):00067         ZPRR:
2B63 8DE0             (         OPS0.ASM):00068                 BSR     ZPRI
2B65 BD36DB           (         OPS0.ASM):00069                 JSR     ZCRLF
2B68 20D0             (         OPS0.ASM):00070                 BRA     ZRTRUE
                      (         OPS0.ASM):00071         
                      (         OPS0.ASM):00072         ; ------
                      (         OPS0.ASM):00073         ; RSTACK
                      (         OPS0.ASM):00074         ; ------
                      (         OPS0.ASM):00075         
                      (         OPS0.ASM):00076         ; Execute a RETURN, with CALL value on top of the stack
                      (         OPS0.ASM):00077         
2B6A                  (         OPS0.ASM):00078         ZRSTAK:
2B6A BD2A2C           (         OPS0.ASM):00079                 JSR     POPSTK
2B6D DD02             (         OPS0.ASM):00080                 STD     ARG1                              ; TOS WAS LEFT IN [D]
2B6F 7E2C93           (         OPS0.ASM):00081                 JMP     ZRET
                      (         OPS0.ASM):00082         
                      (         OPS0.ASM):00083         ; ------
                      (         OPS0.ASM):00084         ; VERIFY
                      (         OPS0.ASM):00085         ; ------
                      (         OPS0.ASM):00086         
                      (         OPS0.ASM):00087         ; Verify the game code
                      (         OPS0.ASM):00088         
2B72                  (         OPS0.ASM):00089         ZVER:
2B72 BD36B4           (         OPS0.ASM):00090                 JSR     VERNUM                            ; DISPLAY ZIP VERSION CODE
2B75 FC3F1A           (         OPS0.ASM):00091                 LDD     ZCODE+ZLENTH                      ; GET LENGTH OF Z-CODE
2B78 DD04             (         OPS0.ASM):00092                 STD     ARG2                              ; IN WORDS
                      (         OPS0.ASM):00093         
                      (         OPS0.ASM):00094         ; CLEAR VARIABLES
                      (         OPS0.ASM):00095         
2B7A 4F               (         OPS0.ASM):00096                 CLRA
2B7B 5F               (         OPS0.ASM):00097                 CLRB
2B7C DD02             (         OPS0.ASM):00098                 STD     ARG1
2B7E DD06             (         OPS0.ASM):00099                 STD     ARG3                              ; BIT 17 OF Z-CODE LENGTH
2B80 DD3F             (         OPS0.ASM):00100                 STD     TEMP                              ; BYTE COUNT
                      (         OPS0.ASM):00101         
                      (         OPS0.ASM):00102         ; CONVERT Z-CODE LENGTH TO BYTES
                      (         OPS0.ASM):00103         
2B82 0805             (         OPS0.ASM):00104                 ASL     ARG2+1                            ; BOTTOM 8 BITS
2B84 0904             (         OPS0.ASM):00105                 ROL     ARG2                              ; MIDDLE 8 BITS
2B86 0907             (         OPS0.ASM):00106                 ROL     ARG3+1                            ; 17TH BIT OF LENGTH
                      (         OPS0.ASM):00107         
2B88 8640             (         OPS0.ASM):00108                 LDA     #$40                              ; 1ST 64 BYTES
2B8A 9740             (         OPS0.ASM):00109                 STA     TEMP+1                            ; ARE NOT CHECKED
2B8C BD3275           (         OPS0.ASM):00110                 JSR     SETWRD                            ; [TEMP] POINTS TO FIRST BYTE
                      (         OPS0.ASM):00111         
2B8F 8606             (         OPS0.ASM):00112                 LDA     #ARG3                             ; PATCH [GETBYT] ROUTINE
2B91 B731CC           (         OPS0.ASM):00113                 STA     PATCH                             ; SO PRELOAD WILL BE READ FROM DISK
                      (         OPS0.ASM):00114         
2B94                  (         OPS0.ASM):00115         VSUM:
2B94 BD31C2           (         OPS0.ASM):00116                 JSR     GETBYT                            ; GET A BYTE
2B97 5F               (         OPS0.ASM):00117                 CLRB                                      ; CLEAR CARRY
2B98 9903             (         OPS0.ASM):00118                 ADCA    ARG1+1                            ; ADD TO SUM
2B9A 9703             (         OPS0.ASM):00119                 STA     ARG1+1
2B9C 2402             (         OPS0.ASM):00120                 BCC     VSUM0
2B9E 0C02             (         OPS0.ASM):00121                 INC     ARG1
                      (         OPS0.ASM):00122         
2BA0                  (         OPS0.ASM):00123         VSUM0:
2BA0 DC1B             (         OPS0.ASM):00124                 LDD     MPCM                              ; END OF GAME YET?
2BA2 109304           (         OPS0.ASM):00125                 CMPD    ARG2
2BA5 26ED             (         OPS0.ASM):00126                 BNE     VSUM
                      (         OPS0.ASM):00127         
2BA7 961A             (         OPS0.ASM):00128                 LDA     MPCH                              ; ALSO CHECK TOP BIT
2BA9 9107             (         OPS0.ASM):00129                 CMPA    ARG3+1
2BAB 26E7             (         OPS0.ASM):00130                 BNE     VSUM
                      (         OPS0.ASM):00131         
2BAD 860B             (         OPS0.ASM):00132                 LDA     #ZPURE
2BAF B731CC           (         OPS0.ASM):00133                 STA     PATCH                             ; UNPATCH [GETBYT]
                      (         OPS0.ASM):00134         
2BB2 FC3F1C           (         OPS0.ASM):00135                 LDD     ZCODE+ZCHKSM                      ; GET CHECKSUM
2BB5 109302           (         OPS0.ASM):00136                 CMPD    ARG1                              ; SAME AS CALCULATED?
2BB8 1027FE93         (         OPS0.ASM):00137                 LBEQ    PREDS                             ; YES, PREDICATE SUCCEEDS
2BBC 7E2A41           (         OPS0.ASM):00138                 JMP     PREDF                             ; ELSE FAILURE ...
                      (     cubixzip.asm):00058                 INCLUDE OPS1.ASM
                      (         OPS1.ASM):00001         ;       PAGE
                      (         OPS1.ASM):00002         ;       SBTTL "--- 1-OPS ---"
                      (         OPS1.ASM):00003         
                      (         OPS1.ASM):00004         ; -----
                      (         OPS1.ASM):00005         ; ZERO?
                      (         OPS1.ASM):00006         ; -----
                      (         OPS1.ASM):00007         
                      (         OPS1.ASM):00008         ; Is arg1 equal to zero? [PRED]
                      (         OPS1.ASM):00009         
2BBF                  (         OPS1.ASM):00010         ZZERO:
2BBF DC02             (         OPS1.ASM):00011                 LDD     ARG1
2BC1 1027FE8A         (         OPS1.ASM):00012                 LBEQ    PREDS
2BC5 7E2A41           (         OPS1.ASM):00013                 JMP     PREDF
                      (         OPS1.ASM):00014         
                      (         OPS1.ASM):00015         ; -----
                      (         OPS1.ASM):00016         ; NEXT?
                      (         OPS1.ASM):00017         ; -----
                      (         OPS1.ASM):00018         
                      (         OPS1.ASM):00019         ; Return the NEXT pointer in object "arg1"; fail if
                      (         OPS1.ASM):00020         ; none left, and return zero [VALUE][PRED]
                      (         OPS1.ASM):00021         
2BC8                  (         OPS1.ASM):00022         ZNEXT:
2BC8 9603             (         OPS1.ASM):00023                 LDA     ARG1+1
2BCA BD34D7           (         OPS1.ASM):00024                 JSR     OBJLOC
2BCD C605             (         OPS1.ASM):00025                 LDB     #5                                ; SAME AS FIRST?
2BCF 2007             (         OPS1.ASM):00026                 BRA     FIRST1
                      (         OPS1.ASM):00027         
                      (         OPS1.ASM):00028         ; ------
                      (         OPS1.ASM):00029         ; FIRST?
                      (         OPS1.ASM):00030         ; ------
                      (         OPS1.ASM):00031         
                      (         OPS1.ASM):00032         ; Return the FIRST pointer in object "arg1"; fail if
                      (         OPS1.ASM):00033         ; none, and return zero [VALUE][PRED]
                      (         OPS1.ASM):00034         
2BD1                  (         OPS1.ASM):00035         ZFIRST:
2BD1 9603             (         OPS1.ASM):00036                 LDA     ARG1+1
2BD3 BD34D7           (         OPS1.ASM):00037                 JSR     OBJLOC
2BD6 C606             (         OPS1.ASM):00038                 LDB     #6
                      (         OPS1.ASM):00039         
2BD8                  (         OPS1.ASM):00040         FIRST1:
2BD8 9E3F             (         OPS1.ASM):00041                 LDX     TEMP
2BDA A685             (         OPS1.ASM):00042                 LDA     B,X                               ; FETCH SLOT
2BDC 9740             (         OPS1.ASM):00043                 STA     TEMP+1                            ; SAVE HERE
2BDE 3402             (         OPS1.ASM):00044                 PSHS    A                                 ; AND ON STACK
2BE0 0F3F             (         OPS1.ASM):00045                 CLR     TEMP                              ; ZERO MSB
2BE2 BD29F9           (         OPS1.ASM):00046                 JSR     PUTVAL
2BE5 3502             (         OPS1.ASM):00047                 PULS    A
2BE7 4D               (         OPS1.ASM):00048                 TSTA
2BE8 1027FE55         (         OPS1.ASM):00049                 LBEQ    PREDF                             ; FAILURE
2BEC 7E2A4F           (         OPS1.ASM):00050                 JMP     PREDS                             ; OR SUCCESS
                      (         OPS1.ASM):00051         
                      (         OPS1.ASM):00052         ; ---
                      (         OPS1.ASM):00053         ; LOC
                      (         OPS1.ASM):00054         ; ---
                      (         OPS1.ASM):00055         
                      (         OPS1.ASM):00056         ; Return the object containing object "arg1"; zero if none [VALUE]
                      (         OPS1.ASM):00057         
2BEF                  (         OPS1.ASM):00058         ZLOC:
2BEF 9603             (         OPS1.ASM):00059                 LDA     ARG1+1
2BF1 BD34D7           (         OPS1.ASM):00060                 JSR     OBJLOC
2BF4 9E3F             (         OPS1.ASM):00061                 LDX     TEMP
2BF6 A604             (         OPS1.ASM):00062                 LDA     4,X
2BF8 9740             (         OPS1.ASM):00063                 STA     TEMP+1
2BFA 0F3F             (         OPS1.ASM):00064                 CLR     TEMP
2BFC 7E29F9           (         OPS1.ASM):00065                 JMP     PUTVAL
                      (         OPS1.ASM):00066         
                      (         OPS1.ASM):00067         ; ------
                      (         OPS1.ASM):00068         ; PTSIZE
                      (         OPS1.ASM):00069         ; ------
                      (         OPS1.ASM):00070         
                      (         OPS1.ASM):00071         ; Return length of prop table "arg1" in bytes [VALUE]
                      (         OPS1.ASM):00072         
2BFF                  (         OPS1.ASM):00073         ZPTSIZ:
2BFF DC02             (         OPS1.ASM):00074                 LDD     ARG1
2C01 C33F00           (         OPS1.ASM):00075                 ADDD    #ZCODE
2C04 830001           (         OPS1.ASM):00076                 SUBD    #1
2C07 DD3F             (         OPS1.ASM):00077                 STD     TEMP
2C09 5F               (         OPS1.ASM):00078                 CLRB
2C0A BD3491           (         OPS1.ASM):00079                 JSR     PROPL
2C0D 4C               (         OPS1.ASM):00080                 INCA
2C0E 7E29F5           (         OPS1.ASM):00081                 JMP     PUTBYT
                      (         OPS1.ASM):00082         
                      (         OPS1.ASM):00083         ; ---
                      (         OPS1.ASM):00084         ; INC
                      (         OPS1.ASM):00085         ; ---
                      (         OPS1.ASM):00086         
                      (         OPS1.ASM):00087         ; Increment arg1 [VALUE]
                      (         OPS1.ASM):00088         
2C11                  (         OPS1.ASM):00089         ZINC:
2C11 9603             (         OPS1.ASM):00090                 LDA     ARG1+1
2C13 BD29BF           (         OPS1.ASM):00091                 JSR     VARGET
2C16 DC3F             (         OPS1.ASM):00092                 LDD     TEMP
2C18 C30001           (         OPS1.ASM):00093                 ADDD    #1
2C1B                  (         OPS1.ASM):00094         ZINC1:
2C1B DD3F             (         OPS1.ASM):00095                 STD     TEMP
2C1D 3406             (         OPS1.ASM):00096                 PSHS    D
2C1F 9603             (         OPS1.ASM):00097                 LDA     ARG1+1
2C21 BD29E7           (         OPS1.ASM):00098                 JSR     VARPUT
2C24 3506             (         OPS1.ASM):00099                 PULS    D
2C26 DD3F             (         OPS1.ASM):00100                 STD     TEMP
2C28 39               (         OPS1.ASM):00101                 RTS
                      (         OPS1.ASM):00102         
                      (         OPS1.ASM):00103         ; ---
                      (         OPS1.ASM):00104         ; DEC
                      (         OPS1.ASM):00105         ; ---
                      (         OPS1.ASM):00106         
                      (         OPS1.ASM):00107         ; Decrement arg1 [VALUE]
                      (         OPS1.ASM):00108         
2C29                  (         OPS1.ASM):00109         ZDEC:
2C29 9603             (         OPS1.ASM):00110                 LDA     ARG1+1
2C2B BD29BF           (         OPS1.ASM):00111                 JSR     VARGET
2C2E DC3F             (         OPS1.ASM):00112                 LDD     TEMP
2C30 830001           (         OPS1.ASM):00113                 SUBD    #1
2C33 20E6             (         OPS1.ASM):00114                 BRA     ZINC1
                      (         OPS1.ASM):00115         
                      (         OPS1.ASM):00116         ; ------
                      (         OPS1.ASM):00117         ; PRINTB
                      (         OPS1.ASM):00118         ; ------
                      (         OPS1.ASM):00119         
                      (         OPS1.ASM):00120         ; PRINT the string pointed to by BYTE-pointer "arg1"
                      (         OPS1.ASM):00121         
2C35                  (         OPS1.ASM):00122         ZPRB:
2C35 DC02             (         OPS1.ASM):00123                 LDD     ARG1
2C37 DD3F             (         OPS1.ASM):00124                 STD     TEMP
2C39 BD3275           (         OPS1.ASM):00125                 JSR     SETWRD
2C3C 7E328D           (         OPS1.ASM):00126                 JMP     PZSTR
                      (         OPS1.ASM):00127         
                      (         OPS1.ASM):00128         ; ------
                      (         OPS1.ASM):00129         ; REMOVE
                      (         OPS1.ASM):00130         ; ------
                      (         OPS1.ASM):00131         
                      (         OPS1.ASM):00132         ; Move object "arg1" to pseudo-object #0
                      (         OPS1.ASM):00133         
2C3F                  (         OPS1.ASM):00134         ZREMOV:
2C3F 9603             (         OPS1.ASM):00135                 LDA     ARG1+1
2C41 BD34D7           (         OPS1.ASM):00136                 JSR     OBJLOC
2C44 9E3F             (         OPS1.ASM):00137                 LDX     TEMP
2C46 A604             (         OPS1.ASM):00138                 LDA     4,X
2C48 2734             (         OPS1.ASM):00139                 BEQ     REMVEX                            ; NO OBJECT
                      (         OPS1.ASM):00140         
2C4A 3410             (         OPS1.ASM):00141                 PSHS    X                                 ; SAVE [TEMP]
                      (         OPS1.ASM):00142         
2C4C BD34D7           (         OPS1.ASM):00143                 JSR     OBJLOC
2C4F 9E3F             (         OPS1.ASM):00144                 LDX     TEMP
2C51 A606             (         OPS1.ASM):00145                 LDA     6,X
2C53 9103             (         OPS1.ASM):00146                 CMPA    ARG1+1
2C55 260C             (         OPS1.ASM):00147                 BNE     REMVC1
                      (         OPS1.ASM):00148         
2C57 3510             (         OPS1.ASM):00149                 PULS    X                                 ; RETRIEVE FORMER [TEMP]
2C59 3410             (         OPS1.ASM):00150                 PSHS    X                                 ; SAVE COPY ON STACK
                      (         OPS1.ASM):00151         
2C5B A605             (         OPS1.ASM):00152                 LDA     5,X                               ; OLD [TEMP] IS IN [X]
2C5D 9E3F             (         OPS1.ASM):00153                 LDX     TEMP
2C5F A706             (         OPS1.ASM):00154                 STA     6,X
                      (         OPS1.ASM):00155         
2C61 2015             (         OPS1.ASM):00156                 BRA     REMVC2
                      (         OPS1.ASM):00157         
2C63                  (         OPS1.ASM):00158         REMVC1:
2C63 BD34D7           (         OPS1.ASM):00159                 JSR     OBJLOC
2C66 9E3F             (         OPS1.ASM):00160                 LDX     TEMP
2C68 A605             (         OPS1.ASM):00161                 LDA     5,X
2C6A 9103             (         OPS1.ASM):00162                 CMPA    ARG1+1
2C6C 26F5             (         OPS1.ASM):00163                 BNE     REMVC1
                      (         OPS1.ASM):00164         
2C6E 3510             (         OPS1.ASM):00165                 PULS    X
2C70 3410             (         OPS1.ASM):00166                 PSHS    X
                      (         OPS1.ASM):00167         
2C72 A605             (         OPS1.ASM):00168                 LDA     5,X
2C74 9E3F             (         OPS1.ASM):00169                 LDX     TEMP
2C76 A705             (         OPS1.ASM):00170                 STA     5,X
                      (         OPS1.ASM):00171         
2C78                  (         OPS1.ASM):00172         REMVC2:
2C78 3510             (         OPS1.ASM):00173                 PULS    X
2C7A 6F04             (         OPS1.ASM):00174                 CLR     4,X
2C7C 6F05             (         OPS1.ASM):00175                 CLR     5,X
                      (         OPS1.ASM):00176         
2C7E                  (         OPS1.ASM):00177         REMVEX:
2C7E 39               (         OPS1.ASM):00178                 RTS
                      (         OPS1.ASM):00179         
                      (         OPS1.ASM):00180         ; ------
                      (         OPS1.ASM):00181         ; PRINTD
                      (         OPS1.ASM):00182         ; ------
                      (         OPS1.ASM):00183         
                      (         OPS1.ASM):00184         ; Print short description of object "arg1"
                      (         OPS1.ASM):00185         
2C7F                  (         OPS1.ASM):00186         ZPRD:
2C7F 9603             (         OPS1.ASM):00187                 LDA     ARG1+1
                      (         OPS1.ASM):00188         
2C81                  (         OPS1.ASM):00189         PRNTDC:
2C81 BD34D7           (         OPS1.ASM):00190                 JSR     OBJLOC
2C84 9E3F             (         OPS1.ASM):00191                 LDX     TEMP
2C86 EC07             (         OPS1.ASM):00192                 LDD     7,X
2C88 C30001           (         OPS1.ASM):00193                 ADDD    #1                                ; INCREMENT
2C8B DD3F             (         OPS1.ASM):00194                 STD     TEMP                              ; AND SAVE
2C8D BD3275           (         OPS1.ASM):00195                 JSR     SETWRD
2C90 7E328D           (         OPS1.ASM):00196                 JMP     PZSTR
                      (         OPS1.ASM):00197         
                      (         OPS1.ASM):00198         ; ------
                      (         OPS1.ASM):00199         ; RETURN
                      (         OPS1.ASM):00200         ; ------
                      (         OPS1.ASM):00201         
                      (         OPS1.ASM):00202         ; Return from a CALL with value "arg1"
                      (         OPS1.ASM):00203         
2C93                  (         OPS1.ASM):00204         ZRET:
2C93 DE27             (         OPS1.ASM):00205                 LDU     OZSTAK                            ; STAY IN SYNC!
2C95 BD2A2C           (         OPS1.ASM):00206                 JSR     POPSTK                            ; POP # LOCALS
2C98 D73D             (         OPS1.ASM):00207                 STB     VAL                               ; SAVE COUNT HERE
                      (         OPS1.ASM):00208         
2C9A 43               (         OPS1.ASM):00209                 COMA                                      ; COMPLEMENT [A]
2C9B 913D             (         OPS1.ASM):00210                 CMPA    VAL                               ; SHOULD BE OPPOSITE OF [B]
2C9D 2629             (         OPS1.ASM):00211                 BNE     RETERR                            ; IF NOT, STACK IS BAD (BM 11/24/84)
                      (         OPS1.ASM):00212         
2C9F 5D               (         OPS1.ASM):00213                 TSTB                                      ; CHECK # LOCALS
2CA0 270E             (         OPS1.ASM):00214                 BEQ     RET2                              ; SKIP IF NO LOCALS
                      (         OPS1.ASM):00215         
                      (         OPS1.ASM):00216         ; RESTORE LOCAL VARIABLES
                      (         OPS1.ASM):00217         
2CA2 8E2700           (         OPS1.ASM):00218                 LDX     #LOCALS                           ; SET UP A POINTER
2CA5 58               (         OPS1.ASM):00219                 ASLB                                      ; WORD-ALIGN THE INDEX
2CA6 3A               (         OPS1.ASM):00220                 ABX                                       ; [X] POINTS TO LAST LOCAL VAR
                      (         OPS1.ASM):00221         
2CA7                  (         OPS1.ASM):00222         RET1:
2CA7 BD2A2C           (         OPS1.ASM):00223                 JSR     POPSTK                            ; POP A VALUE ([X] UNAFFECTED)
2CAA ED83             (         OPS1.ASM):00224                 STD     ,--X                              ; SAVE IN [LOCALS], UPDATE INDEX
2CAC 0A3D             (         OPS1.ASM):00225                 DEC     VAL
2CAE 26F7             (         OPS1.ASM):00226                 BNE     RET1                              ; LOOP TILL ALL LOCALS POPPED
                      (         OPS1.ASM):00227         
                      (         OPS1.ASM):00228         ; RESTORE OTHER VARIABLES
                      (         OPS1.ASM):00229         
2CB0                  (         OPS1.ASM):00230         RET2:
2CB0 BD2A2C           (         OPS1.ASM):00231                 JSR     POPSTK
2CB3 DD13             (         OPS1.ASM):00232                 STD     ZPCH                              ; RESTORE TOP 9 BITS OF ZPC
2CB5 BD2A2C           (         OPS1.ASM):00233                 JSR     POPSTK
2CB8 D715             (         OPS1.ASM):00234                 STB     ZPCL                              ; RESTORE LOWER 8 BITS OF ZPC
2CBA BD2A2C           (         OPS1.ASM):00235                 JSR     POPSTK
2CBD DD27             (         OPS1.ASM):00236                 STD     OZSTAK                            ; AND OLD ZSP
2CBF 0F18             (         OPS1.ASM):00237                 CLR     ZPCFLG                            ; PC NO LONGER VALID
                      (         OPS1.ASM):00238         
2CC1 DC02             (         OPS1.ASM):00239                 LDD     ARG1
2CC3 DD3F             (         OPS1.ASM):00240                 STD     TEMP                              ; PASS THE RETURN VALUE
2CC5 7E29F9           (         OPS1.ASM):00241                 JMP     PUTVAL                            ; TO PUTVAL
                      (         OPS1.ASM):00242         
                      (         OPS1.ASM):00243         ; *** ERROR #15: Z-STACK DESTROYED ***
                      (         OPS1.ASM):00244         
2CC8                  (         OPS1.ASM):00245         RETERR:
2CC8 860F             (         OPS1.ASM):00246                 LDA     #15
2CCA 7E366D           (         OPS1.ASM):00247                 JMP     ZERROR
                      (         OPS1.ASM):00248         
                      (         OPS1.ASM):00249         ; ----
                      (         OPS1.ASM):00250         ; JUMP
                      (         OPS1.ASM):00251         ; ----
                      (         OPS1.ASM):00252         
                      (         OPS1.ASM):00253         ; Branch to location pointed to by 16-bit 2's-comp "arg1"
                      (         OPS1.ASM):00254         
2CCD                  (         OPS1.ASM):00255         ZJUMP:
2CCD DC02             (         OPS1.ASM):00256                 LDD     ARG1                              ; TREAT LIKE A BRANCH
2CCF 830001           (         OPS1.ASM):00257                 SUBD    #1                                ; THAT ALWAYS SUCCEEDS
2CD2 DD3F             (         OPS1.ASM):00258                 STD     TEMP
2CD4 7E2A81           (         OPS1.ASM):00259                 JMP     PREDB3
                      (         OPS1.ASM):00260         
                      (         OPS1.ASM):00261         ; -----
                      (         OPS1.ASM):00262         ; PRINT
                      (         OPS1.ASM):00263         ; -----
                      (         OPS1.ASM):00264         
                      (         OPS1.ASM):00265         ; Print the z-string pointed to by WORD-pointer "arg1"
                      (         OPS1.ASM):00266         
2CD7                  (         OPS1.ASM):00267         ZPRINT:
2CD7 DC02             (         OPS1.ASM):00268                 LDD     ARG1
2CD9 DD3F             (         OPS1.ASM):00269                 STD     TEMP                              ; TELL SETSTR
2CDB BD327E           (         OPS1.ASM):00270                 JSR     SETSTR                            ; WHERE THE STRING RESIDES
2CDE 7E328D           (         OPS1.ASM):00271                 JMP     PZSTR                             ; AND PRINT IT
                      (         OPS1.ASM):00272         
                      (         OPS1.ASM):00273         ; -----
                      (         OPS1.ASM):00274         ; VALUE
                      (         OPS1.ASM):00275         ; -----
                      (         OPS1.ASM):00276         
                      (         OPS1.ASM):00277         ; Return value of arg1 [VALUE]
                      (         OPS1.ASM):00278         
2CE1                  (         OPS1.ASM):00279         ZVALUE:
2CE1 9603             (         OPS1.ASM):00280                 LDA     ARG1+1                            ; GRAB VARIABLE ID
2CE3 BD29BF           (         OPS1.ASM):00281                 JSR     VARGET                            ; FETCH ITS VALUE
2CE6 7E29F9           (         OPS1.ASM):00282                 JMP     PUTVAL                            ; AND RETURN IT
                      (         OPS1.ASM):00283         
                      (         OPS1.ASM):00284         ; ----
                      (         OPS1.ASM):00285         ; BCOM
                      (         OPS1.ASM):00286         ; ----
                      (         OPS1.ASM):00287         
                      (         OPS1.ASM):00288         ; Complement arg1 [VALUE]
                      (         OPS1.ASM):00289         
2CE9                  (         OPS1.ASM):00290         ZBCOM:
2CE9 DC02             (         OPS1.ASM):00291                 LDD     ARG1                              ; GRAB ARGUMENT
2CEB 43               (         OPS1.ASM):00292                 COMA                                      ; COMPLEMENT MSB
2CEC 53               (         OPS1.ASM):00293                 COMB                                      ; AND LSB
2CED DD3F             (         OPS1.ASM):00294                 STD     TEMP                              ; AND PASS TO PUTVAL
2CEF 7E29F9           (         OPS1.ASM):00295                 JMP     PUTVAL
                      (     cubixzip.asm):00059                 INCLUDE OPS2.ASM
                      (         OPS2.ASM):00001         ;       PAGE
                      (         OPS2.ASM):00002         ;       SBTTL "--- 2-OPS ---"
                      (         OPS2.ASM):00003         
                      (         OPS2.ASM):00004         ; -----
                      (         OPS2.ASM):00005         ; LESS?
                      (         OPS2.ASM):00006         ; -----
                      (         OPS2.ASM):00007         
                      (         OPS2.ASM):00008         ; Is arg1 less than arg2? [PRED]
                      (         OPS2.ASM):00009         
2CF2                  (         OPS2.ASM):00010         ZLESS:
2CF2 DC02             (         OPS2.ASM):00011                 LDD     ARG1
2CF4 DD3F             (         OPS2.ASM):00012                 STD     TEMP
2CF6 DC04             (         OPS2.ASM):00013                 LDD     ARG2
2CF8 DD3D             (         OPS2.ASM):00014                 STD     VAL
2CFA 201E             (         OPS2.ASM):00015                 BRA     CEXIT
                      (         OPS2.ASM):00016         
                      (         OPS2.ASM):00017         ; -----
                      (         OPS2.ASM):00018         ; GRTR?
                      (         OPS2.ASM):00019         ; -----
                      (         OPS2.ASM):00020         
                      (         OPS2.ASM):00021         ; Is arg1 greater than arg2? [PRED]
                      (         OPS2.ASM):00022         
2CFC                  (         OPS2.ASM):00023         ZGRTR:
2CFC DC02             (         OPS2.ASM):00024                 LDD     ARG1
2CFE DD3D             (         OPS2.ASM):00025                 STD     VAL
2D00 DC04             (         OPS2.ASM):00026                 LDD     ARG2
2D02 DD3F             (         OPS2.ASM):00027                 STD     TEMP
2D04 2014             (         OPS2.ASM):00028                 BRA     CEXIT
                      (         OPS2.ASM):00029         
                      (         OPS2.ASM):00030         ; ------
                      (         OPS2.ASM):00031         ; DLESS?
                      (         OPS2.ASM):00032         ; ------
                      (         OPS2.ASM):00033         
                      (         OPS2.ASM):00034         ; Decrement variable "arg1"; succeed if new value
                      (         OPS2.ASM):00035         ; is less than arg2 [PRED]
                      (         OPS2.ASM):00036         
2D06                  (         OPS2.ASM):00037         ZDLESS:
2D06 BD2C29           (         OPS2.ASM):00038                 JSR     ZDEC                              ; DECREMENT THE VARIABLE
2D09 DC04             (         OPS2.ASM):00039                 LDD     ARG2
2D0B DD3D             (         OPS2.ASM):00040                 STD     VAL
2D0D 200B             (         OPS2.ASM):00041                 BRA     CEXIT                             ; AND COMPARE
                      (         OPS2.ASM):00042         
                      (         OPS2.ASM):00043         ; ------
                      (         OPS2.ASM):00044         ; IGRTR?
                      (         OPS2.ASM):00045         ; ------
                      (         OPS2.ASM):00046         
                      (         OPS2.ASM):00047         ; Increment variable "arg1"; succeed if new value is
                      (         OPS2.ASM):00048         ; greater than arg2 [PRED]
                      (         OPS2.ASM):00049         
2D0F                  (         OPS2.ASM):00050         ZIGRTR:
2D0F BD2C11           (         OPS2.ASM):00051                 JSR     ZINC                              ; INCREMENT THE VARIABLE
2D12 DC3F             (         OPS2.ASM):00052                 LDD     TEMP
2D14 DD3D             (         OPS2.ASM):00053                 STD     VAL
2D16 DC04             (         OPS2.ASM):00054                 LDD     ARG2
2D18 DD3F             (         OPS2.ASM):00055                 STD     TEMP
                      (         OPS2.ASM):00056         
2D1A                  (         OPS2.ASM):00057         CEXIT:
2D1A 8D05             (         OPS2.ASM):00058                 BSR     SCOMP
2D1C 2521             (         OPS2.ASM):00059                 BLO     POK
2D1E                  (         OPS2.ASM):00060         PBAD:
2D1E 7E2A41           (         OPS2.ASM):00061                 JMP     PREDF
                      (         OPS2.ASM):00062         
                      (         OPS2.ASM):00063         ; -----------------
                      (         OPS2.ASM):00064         ; SIGNED COMPARISON
                      (         OPS2.ASM):00065         ; -----------------
                      (         OPS2.ASM):00066         
2D21                  (         OPS2.ASM):00067         SCOMP:
2D21 963D             (         OPS2.ASM):00068                 LDA     VAL                               ; ARE ARGUMENTS
2D23 983F             (         OPS2.ASM):00069                 EORA    TEMP                              ; SIGNED THE SAME?
2D25 2A05             (         OPS2.ASM):00070                 BPL     SCMP                              ; YES, DO ORDINARY COMPARE
2D27 963D             (         OPS2.ASM):00071                 LDA     VAL                               ; ELSE COMPARE
2D29 913F             (         OPS2.ASM):00072                 CMPA    TEMP                              ; ONLY THE HIGH BYTES
2D2B 39               (         OPS2.ASM):00073                 RTS
                      (         OPS2.ASM):00074         
2D2C                  (         OPS2.ASM):00075         SCMP:
2D2C DC3F             (         OPS2.ASM):00076                 LDD     TEMP
2D2E 10933D           (         OPS2.ASM):00077                 CMPD    VAL
2D31 39               (         OPS2.ASM):00078                 RTS
                      (         OPS2.ASM):00079         
                      (         OPS2.ASM):00080         ; ---
                      (         OPS2.ASM):00081         ; IN?
                      (         OPS2.ASM):00082         ; ---
                      (         OPS2.ASM):00083         
                      (         OPS2.ASM):00084         ; Is object "arg1" contained in object "arg2?" [PRED]
                      (         OPS2.ASM):00085         
2D32                  (         OPS2.ASM):00086         ZIN:
2D32 9603             (         OPS2.ASM):00087                 LDA     ARG1+1
2D34 BD34D7           (         OPS2.ASM):00088                 JSR     OBJLOC
2D37 9E3F             (         OPS2.ASM):00089                 LDX     TEMP
2D39 9605             (         OPS2.ASM):00090                 LDA     ARG2+1
2D3B A104             (         OPS2.ASM):00091                 CMPA    4,X
2D3D 26DF             (         OPS2.ASM):00092                 BNE     PBAD
2D3F                  (         OPS2.ASM):00093         POK:
2D3F 7E2A4F           (         OPS2.ASM):00094                 JMP     PREDS
                      (         OPS2.ASM):00095         
                      (         OPS2.ASM):00096         ; ----
                      (         OPS2.ASM):00097         ; BTST
                      (         OPS2.ASM):00098         ; ----
                      (         OPS2.ASM):00099         
                      (         OPS2.ASM):00100         ; Is every "on" bit in arg1 also "on" in arg2? [PRED]
                      (         OPS2.ASM):00101         
2D42                  (         OPS2.ASM):00102         ZBTST:
2D42 DC04             (         OPS2.ASM):00103                 LDD     ARG2
2D44 9402             (         OPS2.ASM):00104                 ANDA    ARG1
2D46 D403             (         OPS2.ASM):00105                 ANDB    ARG1+1
2D48 109304           (         OPS2.ASM):00106                 CMPD    ARG2
2D4B 27F2             (         OPS2.ASM):00107                 BEQ     POK
2D4D 20CF             (         OPS2.ASM):00108                 BRA     PBAD
                      (         OPS2.ASM):00109         
                      (         OPS2.ASM):00110         ; ---
                      (         OPS2.ASM):00111         ; BOR
                      (         OPS2.ASM):00112         ; ---
                      (         OPS2.ASM):00113         
                      (         OPS2.ASM):00114         ; Return bitwise OR of arg1 and arg2 [VALUE]
                      (         OPS2.ASM):00115         
2D4F                  (         OPS2.ASM):00116         ZBOR:
2D4F DC02             (         OPS2.ASM):00117                 LDD     ARG1
2D51 9A04             (         OPS2.ASM):00118                 ORA     ARG2
2D53 DA05             (         OPS2.ASM):00119                 ORB     ARG2+1
2D55                  (         OPS2.ASM):00120         ZB0:
2D55 DD3F             (         OPS2.ASM):00121                 STD     TEMP
2D57 7E29F9           (         OPS2.ASM):00122                 JMP     PUTVAL
                      (         OPS2.ASM):00123         
                      (         OPS2.ASM):00124         ; ----
                      (         OPS2.ASM):00125         ; BAND
                      (         OPS2.ASM):00126         ; ----
                      (         OPS2.ASM):00127         
                      (         OPS2.ASM):00128         ; Return bitwise AND of arg1 and arg2 [VALUE]
                      (         OPS2.ASM):00129         
2D5A                  (         OPS2.ASM):00130         ZBAND:
2D5A DC02             (         OPS2.ASM):00131                 LDD     ARG1
2D5C 9404             (         OPS2.ASM):00132                 ANDA    ARG2
2D5E D405             (         OPS2.ASM):00133                 ANDB    ARG2+1
2D60 20F3             (         OPS2.ASM):00134                 BRA     ZB0
                      (         OPS2.ASM):00135         
                      (         OPS2.ASM):00136         ; -----
                      (         OPS2.ASM):00137         ; FSET?
                      (         OPS2.ASM):00138         ; -----
                      (         OPS2.ASM):00139         
                      (         OPS2.ASM):00140         ; Is flag "arg2" set in object "arg1?" [PRED]
                      (         OPS2.ASM):00141         
2D62                  (         OPS2.ASM):00142         ZFSETP:
2D62 BD34A9           (         OPS2.ASM):00143                 JSR     FLAGSU                            ; GET BIT
2D65 DC3D             (         OPS2.ASM):00144                 LDD     VAL
2D67 9443             (         OPS2.ASM):00145                 ANDA    MASK
2D69 973D             (         OPS2.ASM):00146                 STA     VAL
2D6B D444             (         OPS2.ASM):00147                 ANDB    MASK+1
2D6D DA3D             (         OPS2.ASM):00148                 ORB     VAL
2D6F 26CE             (         OPS2.ASM):00149                 BNE     POK                               ; BIT IS ON
2D71 20AB             (         OPS2.ASM):00150                 BRA     PBAD
                      (         OPS2.ASM):00151         
                      (         OPS2.ASM):00152         ; ----
                      (         OPS2.ASM):00153         ; FSET
                      (         OPS2.ASM):00154         ; ----
                      (         OPS2.ASM):00155         
                      (         OPS2.ASM):00156         ; Set flag "arg2" in object "arg1"
                      (         OPS2.ASM):00157         
2D73                  (         OPS2.ASM):00158         ZFSET:
2D73 BD34A9           (         OPS2.ASM):00159                 JSR     FLAGSU
2D76 9E3F             (         OPS2.ASM):00160                 LDX     TEMP                              ; ADDRESS OF FLAGS
2D78 DC3D             (         OPS2.ASM):00161                 LDD     VAL                               ; GRAB FLAGS
2D7A 9A43             (         OPS2.ASM):00162                 ORA     MASK                              ; SUPERIMPOSE THE
2D7C DA44             (         OPS2.ASM):00163                 ORB     MASK+1                            ; MASKING PATTERN
2D7E ED84             (         OPS2.ASM):00164                 STD     ,X                                ; AND REPLACE FLAG
2D80 39               (         OPS2.ASM):00165                 RTS
                      (         OPS2.ASM):00166         
                      (         OPS2.ASM):00167         ; ------
                      (         OPS2.ASM):00168         ; FCLEAR
                      (         OPS2.ASM):00169         ; ------
                      (         OPS2.ASM):00170         
                      (         OPS2.ASM):00171         ; Clear flag "arg2" in object "arg1"
                      (         OPS2.ASM):00172         
2D81                  (         OPS2.ASM):00173         ZFCLR:
2D81 BD34A9           (         OPS2.ASM):00174                 JSR     FLAGSU
2D84 9E3F             (         OPS2.ASM):00175                 LDX     TEMP                              ; ADDRESS OF OBJECT
2D86 DC43             (         OPS2.ASM):00176                 LDD     MASK                              ; GRAB THE MASK
2D88 43               (         OPS2.ASM):00177                 COMA                                      ; COMPLEMENT IT
2D89 53               (         OPS2.ASM):00178                 COMB
2D8A 943D             (         OPS2.ASM):00179                 ANDA    VAL                               ; SUPERIMPOSE FLAGS
2D8C D43E             (         OPS2.ASM):00180                 ANDB    VAL+1                             ; TO MASK OUT TARGET
2D8E ED84             (         OPS2.ASM):00181                 STD     ,X                                ; REPLACE THE FLAGS
2D90 39               (         OPS2.ASM):00182                 RTS
                      (         OPS2.ASM):00183         
                      (         OPS2.ASM):00184         ; ---
                      (         OPS2.ASM):00185         ; SET
                      (         OPS2.ASM):00186         ; ---
                      (         OPS2.ASM):00187         
                      (         OPS2.ASM):00188         ; Set variable "arg1" equal to value "arg2"
                      (         OPS2.ASM):00189         
2D91                  (         OPS2.ASM):00190         ZSET:
2D91 DC04             (         OPS2.ASM):00191                 LDD     ARG2
2D93 DD3F             (         OPS2.ASM):00192                 STD     TEMP
2D95 9603             (         OPS2.ASM):00193                 LDA     ARG1+1
2D97 7E29E7           (         OPS2.ASM):00194                 JMP     VARPUT
                      (         OPS2.ASM):00195         
                      (         OPS2.ASM):00196         ; ----
                      (         OPS2.ASM):00197         ; MOVE
                      (         OPS2.ASM):00198         ; ----
                      (         OPS2.ASM):00199         
                      (         OPS2.ASM):00200         ; Put object "arg1" into object "arg2"
                      (         OPS2.ASM):00201         
2D9A                  (         OPS2.ASM):00202         ZMOVE:
2D9A BD2C3F           (         OPS2.ASM):00203                 JSR     ZREMOV                            ; REMOVE OBJECT FIRST
2D9D 9603             (         OPS2.ASM):00204                 LDA     ARG1+1
2D9F BD34D7           (         OPS2.ASM):00205                 JSR     OBJLOC                            ; GET ADDRESS OF OBJECT
2DA2 9E3F             (         OPS2.ASM):00206                 LDX     TEMP                              ; PUT ADDRESS IN X
2DA4 3410             (         OPS2.ASM):00207                 PSHS    X                                 ; SAVE IT HERE TOO
2DA6 9605             (         OPS2.ASM):00208                 LDA     ARG2+1
2DA8 A704             (         OPS2.ASM):00209                 STA     4,X
                      (         OPS2.ASM):00210         
2DAA BD34D7           (         OPS2.ASM):00211                 JSR     OBJLOC
2DAD 9E3F             (         OPS2.ASM):00212                 LDX     TEMP
2DAF A606             (         OPS2.ASM):00213                 LDA     6,X
2DB1 973D             (         OPS2.ASM):00214                 STA     VAL                               ; HOLD HERE FOR A MOMENT
2DB3 9603             (         OPS2.ASM):00215                 LDA     ARG1+1
2DB5 A706             (         OPS2.ASM):00216                 STA     6,X
2DB7 3510             (         OPS2.ASM):00217                 PULS    X                                 ; RESTORE OLD [TEMP]
2DB9 963D             (         OPS2.ASM):00218                 LDA     VAL
2DBB 2702             (         OPS2.ASM):00219                 BEQ     ZMVEX
2DBD A705             (         OPS2.ASM):00220                 STA     5,X
2DBF                  (         OPS2.ASM):00221         ZMVEX:
2DBF 39               (         OPS2.ASM):00222                 RTS
                      (         OPS2.ASM):00223         
                      (         OPS2.ASM):00224         ; ---
                      (         OPS2.ASM):00225         ; GET
                      (         OPS2.ASM):00226         ; ---
                      (         OPS2.ASM):00227         
                      (         OPS2.ASM):00228         ; Return value of item "arg2" in WORD-table at "arg1" [VALUE]
                      (         OPS2.ASM):00229         
2DC0                  (         OPS2.ASM):00230         ZGET:
2DC0 0805             (         OPS2.ASM):00231                 ASL     ARG2+1
2DC2 0904             (         OPS2.ASM):00232                 ROL     ARG2                              ; WORD-ALIGN ARG2
2DC4 DC04             (         OPS2.ASM):00233                 LDD     ARG2
2DC6 D302             (         OPS2.ASM):00234                 ADDD    ARG1                              ; ADD OFFSET TO TABLE ADDRESS
2DC8 DD3F             (         OPS2.ASM):00235                 STD     TEMP
2DCA BD3275           (         OPS2.ASM):00236                 JSR     SETWRD
2DCD BD3188           (         OPS2.ASM):00237                 JSR     GETWRD
2DD0 7E29F9           (         OPS2.ASM):00238                 JMP     PUTVAL
                      (         OPS2.ASM):00239         
                      (         OPS2.ASM):00240         ; ----
                      (         OPS2.ASM):00241         ; GETB
                      (         OPS2.ASM):00242         ; ----
                      (         OPS2.ASM):00243         
                      (         OPS2.ASM):00244         ; Return value of item "arg2" in BYTE-table at "arg1" [VALUE]
                      (         OPS2.ASM):00245         
2DD3                  (         OPS2.ASM):00246         ZGETB:
2DD3 DC02             (         OPS2.ASM):00247                 LDD     ARG1
2DD5 D304             (         OPS2.ASM):00248                 ADDD    ARG2
2DD7 DD3F             (         OPS2.ASM):00249                 STD     TEMP
2DD9 BD3275           (         OPS2.ASM):00250                 JSR     SETWRD
2DDC BD31C2           (         OPS2.ASM):00251                 JSR     GETBYT
2DDF 9740             (         OPS2.ASM):00252                 STA     TEMP+1
2DE1 0F3F             (         OPS2.ASM):00253                 CLR     TEMP
2DE3 7E29F9           (         OPS2.ASM):00254                 JMP     PUTVAL
                      (         OPS2.ASM):00255         
                      (         OPS2.ASM):00256         ; ----
                      (         OPS2.ASM):00257         ; GETP
                      (         OPS2.ASM):00258         ; ----
                      (         OPS2.ASM):00259         
                      (         OPS2.ASM):00260         ; Return prop "arg2" of object "arg1"; if specified prop
                      (         OPS2.ASM):00261         ; doesn't exist, return prop'th element of default object [VALUE]
                      (         OPS2.ASM):00262         
2DE6                  (         OPS2.ASM):00263         ZGETP:
2DE6 BD3474           (         OPS2.ASM):00264                 JSR     PROPB                             ; GET POINTER TO PROPS
2DE9                  (         OPS2.ASM):00265         GETP1:
2DE9 BD3489           (         OPS2.ASM):00266                 JSR     PROPN
2DEC 9105             (         OPS2.ASM):00267                 CMPA    ARG2+1
2DEE 2718             (         OPS2.ASM):00268                 BEQ     GETP2
2DF0 2505             (         OPS2.ASM):00269                 BLO     GETP3
                      (         OPS2.ASM):00270         
2DF2 BD349E           (         OPS2.ASM):00271                 JSR     PROPNX
2DF5 20F2             (         OPS2.ASM):00272                 BRA     GETP1                             ; TRY AGAIN WITH NEXT PROP
                      (         OPS2.ASM):00273         
2DF7                  (         OPS2.ASM):00274         GETP3:
2DF7 FC3F0A           (         OPS2.ASM):00275                 LDD     ZCODE+ZOBJEC                      ; Z-ADDR OF OBJECT TABLE
2DFA C33F00           (         OPS2.ASM):00276                 ADDD    #ZCODE                            ; FORM THE ABSOLUTE ADDRESS
2DFD 1F01             (         OPS2.ASM):00277                 TFR     D,X                               ; USE AS AN INDEX
2DFF D605             (         OPS2.ASM):00278                 LDB     ARG2+1                            ; GET PROPERTY #
2E01 5A               (         OPS2.ASM):00279                 DECB
2E02 58               (         OPS2.ASM):00280                 ASLB
2E03 3A               (         OPS2.ASM):00281                 ABX                                       ; ADD TO TABLE ADDRESS
2E04 EC84             (         OPS2.ASM):00282                 LDD     ,X                                ; FETCH THE PROPERTY
2E06 201D             (         OPS2.ASM):00283                 BRA     ETPEX                             ; AND PASS IT ON
                      (         OPS2.ASM):00284         
2E08                  (         OPS2.ASM):00285         GETP2:
2E08 BD3491           (         OPS2.ASM):00286                 JSR     PROPL
2E0B 5C               (         OPS2.ASM):00287                 INCB                                      ; SOMETHING SHOULD BE IN B!
2E0C 4D               (         OPS2.ASM):00288                 TSTA                                      ; AND IN A!
2E0D 2710             (         OPS2.ASM):00289                 BEQ     GETP2A
2E0F 8101             (         OPS2.ASM):00290                 CMPA    #1
2E11 2705             (         OPS2.ASM):00291                 BEQ     GETP2B
                      (         OPS2.ASM):00292         
                      (         OPS2.ASM):00293         ; *** ERROR #7: PROPERTY LENGTH ***
                      (         OPS2.ASM):00294         
2E13 8607             (         OPS2.ASM):00295                 LDA     #7
2E15 BD366D           (         OPS2.ASM):00296                 JSR     ZERROR
                      (         OPS2.ASM):00297         
2E18                  (         OPS2.ASM):00298         GETP2B:
2E18 9E3F             (         OPS2.ASM):00299                 LDX     TEMP
2E1A 3A               (         OPS2.ASM):00300                 ABX
2E1B EC84             (         OPS2.ASM):00301                 LDD     ,X
2E1D 2006             (         OPS2.ASM):00302                 BRA     ETPEX
                      (         OPS2.ASM):00303         
2E1F                  (         OPS2.ASM):00304         GETP2A:
2E1F 9E3F             (         OPS2.ASM):00305                 LDX     TEMP
2E21 3A               (         OPS2.ASM):00306                 ABX
2E22 E684             (         OPS2.ASM):00307                 LDB     ,X
2E24 4F               (         OPS2.ASM):00308                 CLRA
2E25                  (         OPS2.ASM):00309         ETPEX:
2E25 DD3F             (         OPS2.ASM):00310                 STD     TEMP
2E27 7E29F9           (         OPS2.ASM):00311                 JMP     PUTVAL
                      (         OPS2.ASM):00312         
                      (         OPS2.ASM):00313         ; -----
                      (         OPS2.ASM):00314         ; GETPT
                      (         OPS2.ASM):00315         ; -----
                      (         OPS2.ASM):00316         
                      (         OPS2.ASM):00317         ; Return a POINTER to prop table "arg2" in object "arg1" [VALUE]
                      (         OPS2.ASM):00318         
2E2A                  (         OPS2.ASM):00319         ZGETPT:
2E2A BD3474           (         OPS2.ASM):00320                 JSR     PROPB
2E2D                  (         OPS2.ASM):00321         GETPT1:
2E2D BD3489           (         OPS2.ASM):00322                 JSR     PROPN
2E30 9105             (         OPS2.ASM):00323                 CMPA    ARG2+1
2E32 2709             (         OPS2.ASM):00324                 BEQ     GETPT2
2E34 1025FBBC         (         OPS2.ASM):00325                 LBLO    RET0
2E38 BD349E           (         OPS2.ASM):00326                 JSR     PROPNX                            ; TRY NEXT ENTRY
2E3B 20F0             (         OPS2.ASM):00327                 BRA     GETPT1
                      (         OPS2.ASM):00328         
2E3D                  (         OPS2.ASM):00329         GETPT2:
2E3D 0C40             (         OPS2.ASM):00330                 INC     TEMP+1
2E3F 2602             (         OPS2.ASM):00331                 BNE     GPT
2E41 0C3F             (         OPS2.ASM):00332                 INC     TEMP
2E43                  (         OPS2.ASM):00333         GPT:
2E43 4F               (         OPS2.ASM):00334                 CLRA                                      ; ADD OFFSET IN [B]
2E44 D33F             (         OPS2.ASM):00335                 ADDD    TEMP
2E46 833F00           (         OPS2.ASM):00336                 SUBD    #ZCODE                            ; CHANGE TO RELATIVE POINTER
2E49 DD3F             (         OPS2.ASM):00337                 STD     TEMP
2E4B 7E29F9           (         OPS2.ASM):00338                 JMP     PUTVAL
                      (         OPS2.ASM):00339         
                      (         OPS2.ASM):00340         ; -----
                      (         OPS2.ASM):00341         ; NEXTP
                      (         OPS2.ASM):00342         ; -----
                      (         OPS2.ASM):00343         
                      (         OPS2.ASM):00344         ; Return prop index number of the prop following prop "arg2"
                      (         OPS2.ASM):00345         ; in object "arg1"; return zero if last property; return
                      (         OPS2.ASM):00346         ; 1st prop # if arg2=0; error if no prop "arg2" in "arg1" [VALUE]
                      (         OPS2.ASM):00347         
2E4E                  (         OPS2.ASM):00348         ZNEXTP:
2E4E BD3474           (         OPS2.ASM):00349                 JSR     PROPB
2E51 9605             (         OPS2.ASM):00350                 LDA     ARG2+1
2E53 2713             (         OPS2.ASM):00351                 BEQ     NXTP2
                      (         OPS2.ASM):00352         
2E55                  (         OPS2.ASM):00353         NXTP1:
2E55 BD3489           (         OPS2.ASM):00354                 JSR     PROPN
2E58 9105             (         OPS2.ASM):00355                 CMPA    ARG2+1
2E5A 2709             (         OPS2.ASM):00356                 BEQ     NXTP3
2E5C 1025FB94         (         OPS2.ASM):00357                 LBCS    RET0
2E60 BD349E           (         OPS2.ASM):00358                 JSR     PROPNX                            ; TRY NEXT ENTRY
2E63 20F0             (         OPS2.ASM):00359                 BRA     NXTP1
                      (         OPS2.ASM):00360         
2E65                  (         OPS2.ASM):00361         NXTP3:
2E65 BD349E           (         OPS2.ASM):00362                 JSR     PROPNX
                      (         OPS2.ASM):00363         
2E68                  (         OPS2.ASM):00364         NXTP2:
2E68 BD3489           (         OPS2.ASM):00365                 JSR     PROPN
2E6B 7E29F5           (         OPS2.ASM):00366                 JMP     PUTBYT
                      (         OPS2.ASM):00367         
                      (         OPS2.ASM):00368         ; ---
                      (         OPS2.ASM):00369         ; ADD
                      (         OPS2.ASM):00370         ; ---
                      (         OPS2.ASM):00371         
                      (         OPS2.ASM):00372         ; Return (arg1+arg2) [VALUE]
                      (         OPS2.ASM):00373         
2E6E                  (         OPS2.ASM):00374         ZADD:
2E6E DC02             (         OPS2.ASM):00375                 LDD     ARG1
2E70 D304             (         OPS2.ASM):00376                 ADDD    ARG2
2E72                  (         OPS2.ASM):00377         MATH:
2E72 DD3F             (         OPS2.ASM):00378                 STD     TEMP
2E74 7E29F9           (         OPS2.ASM):00379                 JMP     PUTVAL
                      (         OPS2.ASM):00380         
                      (         OPS2.ASM):00381         ; ---
                      (         OPS2.ASM):00382         ; SUB
                      (         OPS2.ASM):00383         ; ---
                      (         OPS2.ASM):00384         
                      (         OPS2.ASM):00385         ; Return (arg1-arg2) [VALUE]
                      (         OPS2.ASM):00386         
2E77                  (         OPS2.ASM):00387         ZSUB:
2E77 DC02             (         OPS2.ASM):00388                 LDD     ARG1
2E79 9304             (         OPS2.ASM):00389                 SUBD    ARG2
2E7B 20F5             (         OPS2.ASM):00390                 BRA     MATH
                      (         OPS2.ASM):00391         
                      (         OPS2.ASM):00392         ; ---
                      (         OPS2.ASM):00393         ; MUL
                      (         OPS2.ASM):00394         ; ---
                      (         OPS2.ASM):00395         
                      (         OPS2.ASM):00396         ; Return (arg1*arg2) [VALUE]
                      (         OPS2.ASM):00397         
2E7D                  (         OPS2.ASM):00398         ZMUL:
2E7D 8E0011           (         OPS2.ASM):00399                 LDX     #17                               ; INIT LOOP INDEX
2E80 4F               (         OPS2.ASM):00400                 CLRA                                      ; CLEAR THE
2E81 5F               (         OPS2.ASM):00401                 CLRB                                      ; CARRY
2E82 DD47             (         OPS2.ASM):00402                 STD     MTEMP                             ; AND TEMP REGISTER
                      (         OPS2.ASM):00403         
2E84                  (         OPS2.ASM):00404         ZMLOOP:
2E84 0647             (         OPS2.ASM):00405                 ROR     MTEMP
2E86 0648             (         OPS2.ASM):00406                 ROR     MTEMP+1
2E88 0604             (         OPS2.ASM):00407                 ROR     ARG2                              ; SHIFT A BIT
2E8A 0605             (         OPS2.ASM):00408                 ROR     ARG2+1                            ; INTO POSITION
2E8C 2406             (         OPS2.ASM):00409                 BCC     ZMNEXT                            ; NO ADDITION IF BIT CLEAR
                      (         OPS2.ASM):00410         
2E8E DC02             (         OPS2.ASM):00411                 LDD     ARG1
2E90 D347             (         OPS2.ASM):00412                 ADDD    MTEMP
2E92 DD47             (         OPS2.ASM):00413                 STD     MTEMP
                      (         OPS2.ASM):00414         
2E94                  (         OPS2.ASM):00415         ZMNEXT:
2E94 301F             (         OPS2.ASM):00416                 LEAX    -1,X                              ; ALL BITS EXAMINED?
2E96 26EC             (         OPS2.ASM):00417                 BNE     ZMLOOP                            ; NO, KEEP SHIFTING
                      (         OPS2.ASM):00418         
2E98 DC04             (         OPS2.ASM):00419                 LDD     ARG2                              ; ELSE GRAB PRODUCT
2E9A 20D6             (         OPS2.ASM):00420                 BRA     MATH                              ; AND RETURN
                      (         OPS2.ASM):00421         
                      (         OPS2.ASM):00422         ; ---------
                      (         OPS2.ASM):00423         ; DIV & MOD
                      (         OPS2.ASM):00424         ; ---------
                      (         OPS2.ASM):00425         
                      (         OPS2.ASM):00426         ; DIV: Return quotient of int(arg1/arg2) [VALUE]
                      (         OPS2.ASM):00427         ; MOD: Return remainder of int(arg1/arg2) [VALUE]
                      (         OPS2.ASM):00428         
2E9C                  (         OPS2.ASM):00429         ZDIV:
2E9C 8D09             (         OPS2.ASM):00430                 BSR     DVINIT
2E9E 7E29F9           (         OPS2.ASM):00431                 JMP     PUTVAL                            ; AND SHIP OUT [TEMP]
                      (         OPS2.ASM):00432         
2EA1                  (         OPS2.ASM):00433         ZMOD:
2EA1 8D04             (         OPS2.ASM):00434                 BSR     DVINIT
2EA3 DC3D             (         OPS2.ASM):00435                 LDD     VAL                               ; RETURN THE
2EA5 20CB             (         OPS2.ASM):00436                 BRA     MATH                              ; REMAINDER IN [VAL]
                      (         OPS2.ASM):00437         
                      (         OPS2.ASM):00438         ; -----------
                      (         OPS2.ASM):00439         ; DIVIDE INIT
                      (         OPS2.ASM):00440         ; -----------
                      (         OPS2.ASM):00441         
2EA7                  (         OPS2.ASM):00442         DVINIT:
2EA7 DC02             (         OPS2.ASM):00443                 LDD     ARG1
2EA9 DD3F             (         OPS2.ASM):00444                 STD     TEMP
2EAB DC04             (         OPS2.ASM):00445                 LDD     ARG2
2EAD DD3D             (         OPS2.ASM):00446                 STD     VAL
                      (         OPS2.ASM):00447         
                      (         OPS2.ASM):00448         ; FALL THROUGH ...
                      (         OPS2.ASM):00449         
                      (         OPS2.ASM):00450         ; ---------------
                      (         OPS2.ASM):00451         ; SIGNED DIVISION
                      (         OPS2.ASM):00452         ; ---------------
                      (         OPS2.ASM):00453         
                      (         OPS2.ASM):00454         ; ENTRY: DIVIDEND IN [TEMP], DIVISOR IN [VAL]
                      (         OPS2.ASM):00455         ; EXIT: QUOTIENT IN [TEMP], REMAINDER IN [VAL]
                      (         OPS2.ASM):00456         
2EAF                  (         OPS2.ASM):00457         DIVIDE:
2EAF 963F             (         OPS2.ASM):00458                 LDA     TEMP                              ; SIGN OF REMAINDER
2EB1 9746             (         OPS2.ASM):00459                 STA     SREM                              ; IS ALWAYS SIGN OF DIVIDEND
2EB3 983D             (         OPS2.ASM):00460                 EORA    VAL                               ; SIGN OF QUOTIENT IS POSITIVE
2EB5 9745             (         OPS2.ASM):00461                 STA     SQUOT                             ; IF SIGNS OF TERMS ARE THE SAME
                      (         OPS2.ASM):00462         
2EB7 0D3F             (         OPS2.ASM):00463                 TST     TEMP                              ; IF DIVIDEND IS NEGATIVE,
2EB9 2A02             (         OPS2.ASM):00464                 BPL     TABS                              ; CALC ABSOLUTE VALUE
2EBB 8D19             (         OPS2.ASM):00465                 BSR     ABTEMP
                      (         OPS2.ASM):00466         
2EBD                  (         OPS2.ASM):00467         TABS:
2EBD 0D3D             (         OPS2.ASM):00468                 TST     VAL                               ; IF DIVISOR IS NEGATIVE,
2EBF 2A02             (         OPS2.ASM):00469                 BPL     DOUDIV                            ; DO THE SAME
2EC1 8D0C             (         OPS2.ASM):00470                 BSR     ABSVAL
                      (         OPS2.ASM):00471         
2EC3                  (         OPS2.ASM):00472         DOUDIV:
2EC3 8D18             (         OPS2.ASM):00473                 BSR     UDIV                              ; UNSIGNED DIVIDE
                      (         OPS2.ASM):00474         
2EC5 0D45             (         OPS2.ASM):00475                 TST     SQUOT
2EC7 2A02             (         OPS2.ASM):00476                 BPL     RFLIP
2EC9 8D0B             (         OPS2.ASM):00477                 BSR     ABTEMP
                      (         OPS2.ASM):00478         
2ECB                  (         OPS2.ASM):00479         RFLIP:
2ECB 0D46             (         OPS2.ASM):00480                 TST     SREM
2ECD 2A06             (         OPS2.ASM):00481                 BPL     DIVEX
                      (         OPS2.ASM):00482         
                      (         OPS2.ASM):00483         ; FALL THROUGH ...
                      (         OPS2.ASM):00484         
                      (         OPS2.ASM):00485         ; -------------
                      (         OPS2.ASM):00486         ; CALC ABS(VAL)
                      (         OPS2.ASM):00487         ; -------------
                      (         OPS2.ASM):00488         
2ECF                  (         OPS2.ASM):00489         ABSVAL:
2ECF 4F               (         OPS2.ASM):00490                 CLRA
2ED0 5F               (         OPS2.ASM):00491                 CLRB
2ED1 933D             (         OPS2.ASM):00492                 SUBD    VAL
2ED3 DD3D             (         OPS2.ASM):00493                 STD     VAL
                      (         OPS2.ASM):00494         
2ED5                  (         OPS2.ASM):00495         DIVEX:
2ED5 39               (         OPS2.ASM):00496                 RTS
                      (         OPS2.ASM):00497         
                      (         OPS2.ASM):00498         ; --------------
                      (         OPS2.ASM):00499         ; CALC ABS(TEMP)
                      (         OPS2.ASM):00500         ; --------------
                      (         OPS2.ASM):00501         
2ED6                  (         OPS2.ASM):00502         ABTEMP:
2ED6 4F               (         OPS2.ASM):00503                 CLRA
2ED7 5F               (         OPS2.ASM):00504                 CLRB
2ED8 933F             (         OPS2.ASM):00505                 SUBD    TEMP
2EDA DD3F             (         OPS2.ASM):00506                 STD     TEMP
2EDC 39               (         OPS2.ASM):00507                 RTS
                      (         OPS2.ASM):00508         
                      (         OPS2.ASM):00509         ; -----------------
                      (         OPS2.ASM):00510         ; UNSIGNED DIVISION
                      (         OPS2.ASM):00511         ; -----------------
                      (         OPS2.ASM):00512         
                      (         OPS2.ASM):00513         ; ENTRY: DIVIDEND IN [TEMP], DIVISOR IN [VAL]
                      (         OPS2.ASM):00514         ; EXIT: QUOTIENT IN [TEMP], REMAINDER IN [VAL]
                      (         OPS2.ASM):00515         
2EDD                  (         OPS2.ASM):00516         UDIV:
2EDD DC3D             (         OPS2.ASM):00517                 LDD     VAL
2EDF 2728             (         OPS2.ASM):00518                 BEQ     DIVERR                            ; CAN'T DIVIDE BY ZERO!
                      (         OPS2.ASM):00519         
2EE1 8E0010           (         OPS2.ASM):00520                 LDX     #16                               ; INIT LOOP INDEX
2EE4 4F               (         OPS2.ASM):00521                 CLRA                                      ; CLEAR THE
2EE5 5F               (         OPS2.ASM):00522                 CLRB                                      ; CARRY
2EE6 DD47             (         OPS2.ASM):00523                 STD     MTEMP                             ; AND HI-DIVIDEND REGISTER
                      (         OPS2.ASM):00524         
2EE8                  (         OPS2.ASM):00525         UDLOOP:
2EE8 0940             (         OPS2.ASM):00526                 ROL     TEMP+1
2EEA 093F             (         OPS2.ASM):00527                 ROL     TEMP
2EEC 0948             (         OPS2.ASM):00528                 ROL     MTEMP+1
2EEE 0947             (         OPS2.ASM):00529                 ROL     MTEMP
                      (         OPS2.ASM):00530         
2EF0 DC47             (         OPS2.ASM):00531                 LDD     MTEMP                             ; IS DIVIDEND < DIVISOR?
2EF2 933D             (         OPS2.ASM):00532                 SUBD    VAL
2EF4 2505             (         OPS2.ASM):00533                 BCS     UDNEXT                            ; YES, CLEAR THE CARRY AND LOOP
2EF6 DD47             (         OPS2.ASM):00534                 STD     MTEMP                             ; ELSE UPDATE DIVIDEND
2EF8 43               (         OPS2.ASM):00535                 COMA                                      ; SET THE CARRY
2EF9 2001             (         OPS2.ASM):00536                 BRA     DECX                              ; AND LOOP
                      (         OPS2.ASM):00537         
2EFB                  (         OPS2.ASM):00538         UDNEXT:
2EFB 4F               (         OPS2.ASM):00539                 CLRA                                      ; CLEAR CARRY
                      (         OPS2.ASM):00540         
2EFC                  (         OPS2.ASM):00541         DECX:
2EFC 301F             (         OPS2.ASM):00542                 LEAX    -1,X
2EFE 26E8             (         OPS2.ASM):00543                 BNE     UDLOOP
                      (         OPS2.ASM):00544         
2F00 0940             (         OPS2.ASM):00545                 ROL     TEMP+1                            ; SHIFT LAST CARRY INTO PLACE
2F02 093F             (         OPS2.ASM):00546                 ROL     TEMP
2F04 DC47             (         OPS2.ASM):00547                 LDD     MTEMP                             ; MOVE REMAINDER INTO
2F06 DD3D             (         OPS2.ASM):00548                 STD     VAL                               ; ITS RIGHTFUL PLACE
2F08 39               (         OPS2.ASM):00549                 RTS
                      (         OPS2.ASM):00550         
                      (         OPS2.ASM):00551         ; *** ERROR #8: DIVISION ***
                      (         OPS2.ASM):00552         
2F09                  (         OPS2.ASM):00553         DIVERR:
2F09 8608             (         OPS2.ASM):00554                 LDA     #8
2F0B BD366D           (         OPS2.ASM):00555                 JSR     ZERROR
                      (     cubixzip.asm):00060                 INCLUDE OPSX.ASM
                      (         OPSX.ASM):00001         ;       PAGE
                      (         OPSX.ASM):00002         ;       SBTTL "--- X-OPS ---"
                      (         OPSX.ASM):00003         
                      (         OPSX.ASM):00004         ; ------
                      (         OPSX.ASM):00005         ; EQUAL?
                      (         OPSX.ASM):00006         ; ------
                      (         OPSX.ASM):00007         
2F0E                  (         OPSX.ASM):00008         ZEQUAL:
2F0E 0A01             (         OPSX.ASM):00009                 DEC     ARGCNT
2F10 2605             (         OPSX.ASM):00010                 BNE     DOEQ
                      (         OPSX.ASM):00011         
                      (         OPSX.ASM):00012         ; *** ERROR #9: NOT ENOUGH "EQUAL?" ARGS ***
                      (         OPSX.ASM):00013         
2F12 8609             (         OPSX.ASM):00014                 LDA     #9
2F14 BD366D           (         OPSX.ASM):00015                 JSR     ZERROR
                      (         OPSX.ASM):00016         
2F17                  (         OPSX.ASM):00017         DOEQ:
2F17 DC02             (         OPSX.ASM):00018                 LDD     ARG1
2F19 109304           (         OPSX.ASM):00019                 CMPD    ARG2
2F1C 2715             (         OPSX.ASM):00020                 BEQ     EQOK
2F1E 0A01             (         OPSX.ASM):00021                 DEC     ARGCNT
2F20 270E             (         OPSX.ASM):00022                 BEQ     EQBAD
                      (         OPSX.ASM):00023         
2F22 109306           (         OPSX.ASM):00024                 CMPD    ARG3
2F25 270C             (         OPSX.ASM):00025                 BEQ     EQOK
2F27 0A01             (         OPSX.ASM):00026                 DEC     ARGCNT
2F29 2705             (         OPSX.ASM):00027                 BEQ     EQBAD
                      (         OPSX.ASM):00028         
2F2B 109308           (         OPSX.ASM):00029                 CMPD    ARG4
2F2E 2703             (         OPSX.ASM):00030                 BEQ     EQOK
2F30                  (         OPSX.ASM):00031         EQBAD:
2F30 7E2A41           (         OPSX.ASM):00032                 JMP     PREDF
                      (         OPSX.ASM):00033         
2F33                  (         OPSX.ASM):00034         EQOK:
2F33 7E2A4F           (         OPSX.ASM):00035                 JMP     PREDS
                      (         OPSX.ASM):00036         
                      (         OPSX.ASM):00037         ; ----
                      (         OPSX.ASM):00038         ; CALL
                      (         OPSX.ASM):00039         ; ----
                      (         OPSX.ASM):00040         
                      (         OPSX.ASM):00041         ; Branch to function pointed to by [arg1 * 2], passing
                      (         OPSX.ASM):00042         ; the optional parameters "arg2" thru "arg4" [VALUE]
                      (         OPSX.ASM):00043         
2F36                  (         OPSX.ASM):00044         ZCALL:
2F36 DC02             (         OPSX.ASM):00045                 LDD     ARG1                              ; DID FUNCTION = 0?
2F38 2603             (         OPSX.ASM):00046                 BNE     DOCALL                            ; NO, CONTINUE
2F3A 7E2E72           (         OPSX.ASM):00047                 JMP     MATH                              ; ELSE RETURN A ZERO
                      (         OPSX.ASM):00048         
2F3D                  (         OPSX.ASM):00049         DOCALL:
2F3D DC27             (         OPSX.ASM):00050                 LDD     OZSTAK                            ; ZSP FROM PREVIOUS ZCALL
2F3F BD2A23           (         OPSX.ASM):00051                 JSR     PSHDZ
2F42 D615             (         OPSX.ASM):00052                 LDB     ZPCL                              ; LOW 8 BITS OF ZPC
2F44 BD2A23           (         OPSX.ASM):00053                 JSR     PSHDZ                             ; SAVE TO Z-STACK
2F47 DC13             (         OPSX.ASM):00054                 LDD     ZPCH                              ; PUSH H & M PC
2F49 BD2A23           (         OPSX.ASM):00055                 JSR     PSHDZ
                      (         OPSX.ASM):00056         
                      (         OPSX.ASM):00057         ; MULTIPLY ARG1 BY 2; FORM 17-BIT ADDR
                      (         OPSX.ASM):00058         
2F4C 4F               (         OPSX.ASM):00059                 CLRA
2F4D 0803             (         OPSX.ASM):00060                 ASL     ARG1+1                            ; BOTTOM 8 BITS
2F4F 0902             (         OPSX.ASM):00061                 ROL     ARG1                              ; MIDDLE 8
2F51 49               (         OPSX.ASM):00062                 ROLA                                      ; TOP BIT
2F52 9713             (         OPSX.ASM):00063                 STA     ZPCH
2F54 DC02             (         OPSX.ASM):00064                 LDD     ARG1
2F56 DD14             (         OPSX.ASM):00065                 STD     ZPCM
2F58 0F18             (         OPSX.ASM):00066                 CLR     ZPCFLG                            ; [ZPC] HAS CHANGED ...
                      (         OPSX.ASM):00067         
2F5A BD3191           (         OPSX.ASM):00068                 JSR     NEXTPC                            ; FETCH # NEW LOCALS
2F5D 9741             (         OPSX.ASM):00069                 STA     TEMP2                             ; SAVE IT HERE FOR INDEXING
2F5F 9742             (         OPSX.ASM):00070                 STA     TEMP2+1                           ; AND HERE FOR REFERENCE
2F61 271E             (         OPSX.ASM):00071                 BEQ     ZCALL2                            ; NO LOCALS IN THIS FUNCTION
                      (         OPSX.ASM):00072         
                      (         OPSX.ASM):00073         ; SAVE OLD LOCALS, REPLACE WITH NEW
                      (         OPSX.ASM):00074         
2F63 8E2700           (         OPSX.ASM):00075                 LDX     #LOCALS                           ; INIT POINTER
2F66                  (         OPSX.ASM):00076         ZCALL1:
2F66 EC84             (         OPSX.ASM):00077                 LDD     ,X                                ; GRAB AN OLD LOCAL
2F68 3410             (         OPSX.ASM):00078                 PSHS    X                                 ; SAVE THE POINTER
2F6A BD2A23           (         OPSX.ASM):00079                 JSR     PSHDZ                             ; PUSH OLD LOCAL TO Z-STACK
2F6D BD3191           (         OPSX.ASM):00080                 JSR     NEXTPC                            ; GET MSB OF NEW LOCAL
2F70 3402             (         OPSX.ASM):00081                 PSHS    A                                 ; SAVE HERE
2F72 BD3191           (         OPSX.ASM):00082                 JSR     NEXTPC                            ; NOW GET LSB
2F75 1F89             (         OPSX.ASM):00083                 TFR     A,B                               ; POSITION IT PROPERLY
2F77 3502             (         OPSX.ASM):00084                 PULS    A                                 ; RETRIEVE MSB
2F79 3510             (         OPSX.ASM):00085                 PULS    X                                 ; THIS IS WHERE IT GOES
2F7B ED81             (         OPSX.ASM):00086                 STD     ,X++                              ; STORE NEW LOCAL, UPDATE POINTER
2F7D 0A41             (         OPSX.ASM):00087                 DEC     TEMP2                             ; ANY MORE OLD LOCALS?
2F7F 26E5             (         OPSX.ASM):00088                 BNE     ZCALL1                            ; KEEP LOOPING TILL DONE
                      (         OPSX.ASM):00089         
2F81                  (         OPSX.ASM):00090         ZCALL2:
2F81 0A01             (         OPSX.ASM):00091                 DEC     ARGCNT                            ; EXTRA ARGUMENTS IN THIS CALL?
2F83 2717             (         OPSX.ASM):00092                 BEQ     ZCALL4                            ; NO ARGS TO PASS
                      (         OPSX.ASM):00093         
                      (         OPSX.ASM):00094         ; MOVE UP TO 3 ARGS TO LOCAL STORAGE
                      (         OPSX.ASM):00095         
2F85                  (         OPSX.ASM):00096         ZCALL3:
2F85 DC04             (         OPSX.ASM):00097                 LDD     ARG2
2F87 FD2700           (         OPSX.ASM):00098                 STD     LOCALS
2F8A 0A01             (         OPSX.ASM):00099                 DEC     ARGCNT
2F8C 270E             (         OPSX.ASM):00100                 BEQ     ZCALL4
2F8E DC06             (         OPSX.ASM):00101                 LDD     ARG3
2F90 FD2702           (         OPSX.ASM):00102                 STD     LOCALS+2
2F93 0A01             (         OPSX.ASM):00103                 DEC     ARGCNT
2F95 2705             (         OPSX.ASM):00104                 BEQ     ZCALL4
2F97 DC08             (         OPSX.ASM):00105                 LDD     ARG4
2F99 FD2704           (         OPSX.ASM):00106                 STD     LOCALS+4
                      (         OPSX.ASM):00107         
2F9C                  (         OPSX.ASM):00108         ZCALL4:
2F9C D642             (         OPSX.ASM):00109                 LDB     TEMP2+1                           ; REMEMBER # LOCALS SAVED
2F9E 1F98             (         OPSX.ASM):00110                 TFR     B,A                               ; COPY INTO [A]
2FA0 43               (         OPSX.ASM):00111                 COMA                                      ; COMPLEMENT FOR ERROR CHECK (BM 11/24/84)
2FA1 BD2A23           (         OPSX.ASM):00112                 JSR     PSHDZ                             ; AND RETURN
2FA4 DF27             (         OPSX.ASM):00113                 STU     OZSTAK                            ; "THE WAY WE WERE ..."
2FA6 39               (         OPSX.ASM):00114                 RTS
                      (         OPSX.ASM):00115         
                      (         OPSX.ASM):00116         ; ---
                      (         OPSX.ASM):00117         ; PUT
                      (         OPSX.ASM):00118         ; ---
                      (         OPSX.ASM):00119         
                      (         OPSX.ASM):00120         ; Set item "arg2" in WORD-table "arg1" equal to "arg3"
                      (         OPSX.ASM):00121         
2FA7                  (         OPSX.ASM):00122         ZPUT:
2FA7 0805             (         OPSX.ASM):00123                 ASL     ARG2+1                            ; WORD-ALIGN
2FA9 0904             (         OPSX.ASM):00124                 ROL     ARG2                              ; ARG2
2FAB DC04             (         OPSX.ASM):00125                 LDD     ARG2
2FAD D302             (         OPSX.ASM):00126                 ADDD    ARG1                              ; ADD Z-ADDR OF TABLE
2FAF C33F00           (         OPSX.ASM):00127                 ADDD    #ZCODE                            ; FORM ABSOLUTE ADDRESS
2FB2 1F01             (         OPSX.ASM):00128                 TFR     D,X                               ; FOR USE AS AN INDEX
2FB4 DC06             (         OPSX.ASM):00129                 LDD     ARG3
2FB6 ED84             (         OPSX.ASM):00130                 STD     ,X
2FB8 39               (         OPSX.ASM):00131                 RTS
                      (         OPSX.ASM):00132         
                      (         OPSX.ASM):00133         ; ----
                      (         OPSX.ASM):00134         ; PUTB
                      (         OPSX.ASM):00135         ; ----
                      (         OPSX.ASM):00136         
                      (         OPSX.ASM):00137         ; Set item "arg2" in BYTE-table "arg1" equal to "arg3"
                      (         OPSX.ASM):00138         
2FB9                  (         OPSX.ASM):00139         ZPUTB:
2FB9 DC04             (         OPSX.ASM):00140                 LDD     ARG2
2FBB D302             (         OPSX.ASM):00141                 ADDD    ARG1
2FBD C33F00           (         OPSX.ASM):00142                 ADDD    #ZCODE
2FC0 1F01             (         OPSX.ASM):00143                 TFR     D,X
2FC2 9607             (         OPSX.ASM):00144                 LDA     ARG3+1
2FC4 A784             (         OPSX.ASM):00145                 STA     ,X
2FC6 39               (         OPSX.ASM):00146                 RTS
                      (         OPSX.ASM):00147         
                      (         OPSX.ASM):00148         ; ----
                      (         OPSX.ASM):00149         ; PUTP
                      (         OPSX.ASM):00150         ; ----
                      (         OPSX.ASM):00151         
                      (         OPSX.ASM):00152         ; Set property "arg2" in object "arg1" equal to "arg3"
                      (         OPSX.ASM):00153         
2FC7                  (         OPSX.ASM):00154         ZPUTP:
2FC7 BD3474           (         OPSX.ASM):00155                 JSR     PROPB
2FCA                  (         OPSX.ASM):00156         PUTP1:
2FCA BD3489           (         OPSX.ASM):00157                 JSR     PROPN
2FCD 9105             (         OPSX.ASM):00158                 CMPA    ARG2+1
2FCF 270C             (         OPSX.ASM):00159                 BEQ     PUTP2
2FD1 2405             (         OPSX.ASM):00160                 BHS     PTP
                      (         OPSX.ASM):00161         
                      (         OPSX.ASM):00162         ; *** ERROR #10: BAD PROPERTY NUMBER ***
                      (         OPSX.ASM):00163         
2FD3 860A             (         OPSX.ASM):00164                 LDA     #10
2FD5 BD366D           (         OPSX.ASM):00165                 JSR     ZERROR                            ; ERROR #7 (BAD PROPERTY #)
                      (         OPSX.ASM):00166         
2FD8                  (         OPSX.ASM):00167         PTP:
2FD8 BD349E           (         OPSX.ASM):00168                 JSR     PROPNX                            ; NEXT ITEM
2FDB 20ED             (         OPSX.ASM):00169                 BRA     PUTP1
                      (         OPSX.ASM):00170         
2FDD                  (         OPSX.ASM):00171         PUTP2:
2FDD BD3491           (         OPSX.ASM):00172                 JSR     PROPL
2FE0 5C               (         OPSX.ASM):00173                 INCB
2FE1 4D               (         OPSX.ASM):00174                 TSTA
2FE2 2711             (         OPSX.ASM):00175                 BEQ     PUTP2A
2FE4 8101             (         OPSX.ASM):00176                 CMPA    #1
2FE6 2705             (         OPSX.ASM):00177                 BEQ     PTP1
                      (         OPSX.ASM):00178         
                      (         OPSX.ASM):00179         ; *** ERROR #11: PROPERTY LENGTH ***
                      (         OPSX.ASM):00180         
2FE8 860B             (         OPSX.ASM):00181                 LDA     #11
2FEA BD366D           (         OPSX.ASM):00182                 JSR     ZERROR                            ; ERROR #8 (PROP TOO LONG)
                      (         OPSX.ASM):00183         
2FED                  (         OPSX.ASM):00184         PTP1:
2FED 9E3F             (         OPSX.ASM):00185                 LDX     TEMP
2FEF 3A               (         OPSX.ASM):00186                 ABX
2FF0 DC06             (         OPSX.ASM):00187                 LDD     ARG3
2FF2 ED84             (         OPSX.ASM):00188                 STD     ,X
2FF4 39               (         OPSX.ASM):00189                 RTS
                      (         OPSX.ASM):00190         
2FF5                  (         OPSX.ASM):00191         PUTP2A:
2FF5 9607             (         OPSX.ASM):00192                 LDA     ARG3+1
2FF7 9E3F             (         OPSX.ASM):00193                 LDX     TEMP
2FF9 3A               (         OPSX.ASM):00194                 ABX
2FFA A784             (         OPSX.ASM):00195                 STA     ,X
2FFC 39               (         OPSX.ASM):00196                 RTS
                      (         OPSX.ASM):00197         
                      (         OPSX.ASM):00198         ; ------
                      (         OPSX.ASM):00199         ; PRINTC
                      (         OPSX.ASM):00200         ; ------
                      (         OPSX.ASM):00201         
                      (         OPSX.ASM):00202         ; Print the character with ASCII value "arg1"
                      (         OPSX.ASM):00203         
2FFD                  (         OPSX.ASM):00204         ZPRC:
2FFD 9603             (         OPSX.ASM):00205                 LDA     ARG1+1
2FFF 7E36BC           (         OPSX.ASM):00206                 JMP     COUT
                      (         OPSX.ASM):00207         
                      (         OPSX.ASM):00208         ; ------
                      (         OPSX.ASM):00209         ; PRINTN
                      (         OPSX.ASM):00210         ; ------
                      (         OPSX.ASM):00211         
                      (         OPSX.ASM):00212         ; Print "arg1" as a signed integer
                      (         OPSX.ASM):00213         
3002                  (         OPSX.ASM):00214         ZPRN:
3002 DC02             (         OPSX.ASM):00215                 LDD     ARG1
3004 DD3F             (         OPSX.ASM):00216                 STD     TEMP
                      (         OPSX.ASM):00217         
                      (         OPSX.ASM):00218         ; PRINT THE SIGNED VALUE IN [TEMP]
                      (         OPSX.ASM):00219         
3006                  (         OPSX.ASM):00220         NUMBER:
3006 DC3F             (         OPSX.ASM):00221                 LDD     TEMP
3008 2A08             (         OPSX.ASM):00222                 BPL     DIGCNT                            ; IF NUMBER IS NEGATIVE,
300A 862D             (         OPSX.ASM):00223                 LDA     #$2D                              ; START WITH A MINUS SIGN
300C BD36BC           (         OPSX.ASM):00224                 JSR     COUT
300F BD2ED6           (         OPSX.ASM):00225                 JSR     ABTEMP                            ; GET ABS(TEMP)
                      (         OPSX.ASM):00226         
                      (         OPSX.ASM):00227         ; COUNT # OF DECIMAL DIGITS
                      (         OPSX.ASM):00228         
3012                  (         OPSX.ASM):00229         DIGCNT:
3012 0F43             (         OPSX.ASM):00230                 CLR     MASK                              ; RESET INDEX
3014                  (         OPSX.ASM):00231         DGC:
3014 DC3F             (         OPSX.ASM):00232                 LDD     TEMP                              ; CHECK QUOTIENT
3016 2710             (         OPSX.ASM):00233                 BEQ     PRNTN3                            ; SKIP IF ZERO
3018 CC000A           (         OPSX.ASM):00234                 LDD     #10
301B DD3D             (         OPSX.ASM):00235                 STD     VAL                               ; ELSE DIVIDE BY 10
301D BD2EDD           (         OPSX.ASM):00236                 JSR     UDIV                              ; UNSIGNED DIVIDE
3020 963E             (         OPSX.ASM):00237                 LDA     VAL+1                             ; GET LSB OF REMAINDER
3022 3402             (         OPSX.ASM):00238                 PSHS    A                                 ; SAVE ON STACK
3024 0C43             (         OPSX.ASM):00239                 INC     MASK                              ; INCREMENT CHAR COUNT
3026 20EC             (         OPSX.ASM):00240                 BRA     DGC                               ; LOOP TILL ARG1=0
                      (         OPSX.ASM):00241         
3028                  (         OPSX.ASM):00242         PRNTN3:
3028 9643             (         OPSX.ASM):00243                 LDA     MASK
302A 270C             (         OPSX.ASM):00244                 BEQ     PZERO                             ; PRINT AT LEAST A "0"
302C                  (         OPSX.ASM):00245         PRNTN4:
302C 3502             (         OPSX.ASM):00246                 PULS    A                                 ; GET A CHAR
302E 8B30             (         OPSX.ASM):00247                 ADDA    #$30                              ; CONVERT TO ASCII NUMBER
3030 BD36BC           (         OPSX.ASM):00248                 JSR     COUT
3033 0A43             (         OPSX.ASM):00249                 DEC     MASK                              ; OUT OF CHARS?
3035 26F5             (         OPSX.ASM):00250                 BNE     PRNTN4                            ; KEEP PRINTING TILL
3037 39               (         OPSX.ASM):00251                 RTS                                       ; DONE
                      (         OPSX.ASM):00252         
                      (         OPSX.ASM):00253         ; PRINT A ZERO
                      (         OPSX.ASM):00254         
3038                  (         OPSX.ASM):00255         PZERO:
3038 8630             (         OPSX.ASM):00256                 LDA     #$30                              ; ASCII "0"
303A 7E36BC           (         OPSX.ASM):00257                 JMP     COUT
                      (         OPSX.ASM):00258         
                      (         OPSX.ASM):00259         ; ------
                      (         OPSX.ASM):00260         ; RANDOM
                      (         OPSX.ASM):00261         ; ------
                      (         OPSX.ASM):00262         
                      (         OPSX.ASM):00263         ; Return a random value between zero and "arg1" [VALUE]
                      (         OPSX.ASM):00264         
303D                  (         OPSX.ASM):00265         ZRAND:
303D DC02             (         OPSX.ASM):00266                 LDD     ARG1                              ; USE [ARG1]
303F DD3D             (         OPSX.ASM):00267                 STD     VAL                               ; AS THE DIVISOR
                      (         OPSX.ASM):00268         
3041 DC58             (         OPSX.ASM):00269                 LDD     RAND1                             ; GET A RANDOM #
3043 C3AA55           (         OPSX.ASM):00270                 ADDD    #$AA55                            ; DO WEIRD THINGS
3046 9759             (         OPSX.ASM):00271                 STA     RAND2                             ; SAVE AS
3048 D758             (         OPSX.ASM):00272                 STB     RAND1                             ; NEW SEED
304A 847F             (         OPSX.ASM):00273                 ANDA    #%01111111                        ; MAKE POSITIVE
304C DD3F             (         OPSX.ASM):00274                 STD     TEMP                              ; MAKE IT THE DIVIDEND
                      (         OPSX.ASM):00275         
304E BD2EAF           (         OPSX.ASM):00276                 JSR     DIVIDE                            ; UNSIGNED DIVIDE!
3051 DC3D             (         OPSX.ASM):00277                 LDD     VAL                               ; GET REMAINDER
3053 C30001           (         OPSX.ASM):00278                 ADDD    #1                                ; AT LEAST 1
3056 7E2E72           (         OPSX.ASM):00279                 JMP     MATH
                      (         OPSX.ASM):00280         
                      (         OPSX.ASM):00281         ; ----
                      (         OPSX.ASM):00282         ; PUSH
                      (         OPSX.ASM):00283         ; ----
                      (         OPSX.ASM):00284         
                      (         OPSX.ASM):00285         ; Push "arg1" onto the Z-stack
                      (         OPSX.ASM):00286         
3059                  (         OPSX.ASM):00287         ZPUSH:
3059 DC02             (         OPSX.ASM):00288                 LDD     ARG1
305B 7E2A23           (         OPSX.ASM):00289                 JMP     PSHDZ
                      (         OPSX.ASM):00290         
                      (         OPSX.ASM):00291         ; ---
                      (         OPSX.ASM):00292         ; POP
                      (         OPSX.ASM):00293         ; ---
                      (         OPSX.ASM):00294         
                      (         OPSX.ASM):00295         ; Pop a word off Z-stack and store in variable "arg1"
                      (         OPSX.ASM):00296         
305E                  (         OPSX.ASM):00297         ZPOP:
305E BD2A2C           (         OPSX.ASM):00298                 JSR     POPSTK
3061 9603             (         OPSX.ASM):00299                 LDA     ARG1+1                            ; GET VARIABLE ID
3063 7E29E7           (         OPSX.ASM):00300                 JMP     VARPUT
                      (         OPSX.ASM):00301         
                      (         OPSX.ASM):00302         ; -----
                      (         OPSX.ASM):00303         ; SPLIT
                      (         OPSX.ASM):00304         ; -----
                      (         OPSX.ASM):00305         
     2B62             (         OPSX.ASM):00306         ZSPLIT          EQU ZNOOP
                      (         OPSX.ASM):00307         
                      (         OPSX.ASM):00308         ; ------
                      (         OPSX.ASM):00309         ; SCREEN
                      (         OPSX.ASM):00310         ; ------
                      (         OPSX.ASM):00311         
     2B62             (         OPSX.ASM):00312         ZSCRN           EQU ZNOOP
                      (     cubixzip.asm):00061                 INCLUDE READ.ASM
                      (         READ.ASM):00001         ;       PAGE
                      (         READ.ASM):00002         ;       SBTTL "--- READ HANDLER ---"
                      (         READ.ASM):00003         
3066                  (         READ.ASM):00004         ZREAD:
3066 BD370B           (         READ.ASM):00005                 JSR     ZUSL                              ; UPDATE STATUS LINE FIRST
                      (         READ.ASM):00006         
3069 DC02             (         READ.ASM):00007                 LDD     ARG1                              ; CALC ABSOLUTE ADDRESS
306B C33F00           (         READ.ASM):00008                 ADDD    #ZCODE                            ; OF READ BUFFERS
306E DD02             (         READ.ASM):00009                 STD     ARG1
3070 DC04             (         READ.ASM):00010                 LDD     ARG2
3072 C33F00           (         READ.ASM):00011                 ADDD    #ZCODE
3075 DD04             (         READ.ASM):00012                 STD     ARG2
                      (         READ.ASM):00013         
3077 BD352B           (         READ.ASM):00014                 JSR     INPUT                             ; READ LINE; RETURN LENGTH IN A
307A 9743             (         READ.ASM):00015                 STA     MASK                              ; # CHARS IN LINE
307C 0F44             (         READ.ASM):00016                 CLR     MASK+1                            ; # CHARS IN CURRENT WORD
                      (         READ.ASM):00017         
307E 9E04             (         READ.ASM):00018                 LDX     ARG2                              ; SET # OF WORDS READ
3080 6F01             (         READ.ASM):00019                 CLR     1,X                               ; TO ZERO
                      (         READ.ASM):00020         
3082 8601             (         READ.ASM):00021                 LDA     #1                                ; = 1
3084 973B             (         READ.ASM):00022                 STA     STABP                             ; INIT SOURCE TABLE POINTER
3086 4C               (         READ.ASM):00023                 INCA                                      ; = 2
3087 973A             (         READ.ASM):00024                 STA     RTABP                             ; AND RESULT TABLE POINTER
                      (         READ.ASM):00025         
3089                  (         READ.ASM):00026         READL:
3089 9E04             (         READ.ASM):00027                 LDX     ARG2
308B A680             (         READ.ASM):00028                 LDA     ,X+                               ; FETCH MAXIMUM # OF WORDS
308D A184             (         READ.ASM):00029                 CMPA    ,X                                ; COMPARE TO # WORDS READ
308F 2405             (         READ.ASM):00030                 BHS     RL1                               ; STILL ROOM
                      (         READ.ASM):00031         
                      (         READ.ASM):00032         ; *** ERROR #13 -- PARSER OVERFLOW ***
                      (         READ.ASM):00033         
3091 860D             (         READ.ASM):00034                 LDA     #13
3093 BD366D           (         READ.ASM):00035                 JSR     ZERROR
                      (         READ.ASM):00036         
3096                  (         READ.ASM):00037         RL1:
3096 DC43             (         READ.ASM):00038                 LDD     MASK                              ; OUT OF CHARS & WORDS?
3098 2601             (         READ.ASM):00039                 BNE     RL2                               ; NOT YET
309A                  (         READ.ASM):00040         RDEX:
309A 39               (         READ.ASM):00041                 RTS                                       ; ELSE SCRAM
                      (         READ.ASM):00042         
309B                  (         READ.ASM):00043         RL2:
309B 9644             (         READ.ASM):00044                 LDA     MASK+1                            ; GET CHAR COUNT
309D 8106             (         READ.ASM):00045                 CMPA    #6                                ; 6 CHARS DONE?
309F 2503             (         READ.ASM):00046                 BLO     RL3                               ; NOT YET
30A1 BD3121           (         READ.ASM):00047                 JSR     FLUSHW                            ; ELSE FLUSH WORD
                      (         READ.ASM):00048         
30A4                  (         READ.ASM):00049         RL3:
30A4 9644             (         READ.ASM):00050                 LDA     MASK+1                            ; FIRST CHAR IN WORD?
30A6 2624             (         READ.ASM):00051                 BNE     READL2                            ; NOPE
                      (         READ.ASM):00052         
                      (         READ.ASM):00053         ; CLEAR OUT WORD BUFFER [ZSTBUI]
                      (         READ.ASM):00054         
30A8 5F               (         READ.ASM):00055                 CLRB                                      ; [A] IS ALREADY ZERO
30A9 DD2E             (         READ.ASM):00056                 STD     ZSTBUI
30AB DD30             (         READ.ASM):00057                 STD     ZSTBUI+2
30AD DD32             (         READ.ASM):00058                 STD     ZSTBUI+4
                      (         READ.ASM):00059         
30AF D63A             (         READ.ASM):00060                 LDB     RTABP
30B1 9E04             (         READ.ASM):00061                 LDX     ARG2
30B3 3A               (         READ.ASM):00062                 ABX
30B4 D63B             (         READ.ASM):00063                 LDB     STABP
30B6 E703             (         READ.ASM):00064                 STB     3,X                               ; STORE POSITION
                      (         READ.ASM):00065         
30B8 9E02             (         READ.ASM):00066                 LDX     ARG1
30BA A685             (         READ.ASM):00067                 LDA     B,X                               ; GRAB A CHAR FROM SOURCE BUFFER
30BC BD3143           (         READ.ASM):00068                 JSR     SIBRKP                            ; IS IT A SIB?
30BF 2529             (         READ.ASM):00069                 BCS     RSIBRK                            ; YES IF CARRY IS SET
30C1 BD313C           (         READ.ASM):00070                 JSR     NBRKP                             ; IS IT A "NORMAL" BREAK CHAR?
30C4 2406             (         READ.ASM):00071                 BCC     READL2                            ; NO, KEEP SCANNING
30C6 0C3B             (         READ.ASM):00072                 INC     STABP                             ; ELSE FLUSH STRANDED BREAK
30C8 0A43             (         READ.ASM):00073                 DEC     MASK                              ; UPDATE # OF CHARS IN LINE
30CA 20BD             (         READ.ASM):00074                 BRA     READL                             ; AND LOOP BACK
                      (         READ.ASM):00075         
30CC                  (         READ.ASM):00076         READL2:
30CC 9643             (         READ.ASM):00077                 LDA     MASK                              ; OUT OF CHARS?
30CE 2722             (         READ.ASM):00078                 BEQ     READL3                            ; SURE ENOUGH
30D0 D63B             (         READ.ASM):00079                 LDB     STABP
30D2 9E02             (         READ.ASM):00080                 LDX     ARG1
30D4 A685             (         READ.ASM):00081                 LDA     B,X                               ; ELSE GRAB NEXT CHAR
30D6 BD3138           (         READ.ASM):00082                 JSR     RBRKP                             ; IS IT A BREAK?
30D9 2517             (         READ.ASM):00083                 BCS     READL3                            ; YES IF CARRY SET
30DB D644             (         READ.ASM):00084                 LDB     MASK+1                            ; ELSE POINT TO
30DD 8E002E           (         READ.ASM):00085                 LDX     #ZSTBUI                           ; WORD BUFFER
30E0 A785             (         READ.ASM):00086                 STA     B,X                               ; STORE CHAR IN BUFFER
30E2 0A43             (         READ.ASM):00087                 DEC     MASK                              ; ONE LESS CHAR IN LINE
30E4 0C44             (         READ.ASM):00088                 INC     MASK+1                            ; ONE MORE IN RESULT
30E6 0C3B             (         READ.ASM):00089                 INC     STABP                             ; POINT TO NEXT CHAR
30E8 209F             (         READ.ASM):00090                 BRA     READL                             ; AND LOOP BACK
                      (         READ.ASM):00091         
30EA                  (         READ.ASM):00092         RSIBRK:
30EA 972E             (         READ.ASM):00093                 STA     ZSTBUI                            ; STORE THE SIB
30EC 0A43             (         READ.ASM):00094                 DEC     MASK                              ; UPDATE LINE-CHAR COUNT
30EE 0C44             (         READ.ASM):00095                 INC     MASK+1                            ; WORD-CHAR COUNT
30F0 0C3B             (         READ.ASM):00096                 INC     STABP                             ; AND # CHARS IN WORD
                      (         READ.ASM):00097         
30F2                  (         READ.ASM):00098         READL3:
30F2 9644             (         READ.ASM):00099                 LDA     MASK+1                            ; ANY CHARS IN WORD?
30F4 2793             (         READ.ASM):00100                 BEQ     READL                             ; APPARENTLY NOT
                      (         READ.ASM):00101         
30F6 D63A             (         READ.ASM):00102                 LDB     RTABP                             ; POINT TO
30F8 9E04             (         READ.ASM):00103                 LDX     ARG2                              ; IN THIS ENTRY
30FA 3A               (         READ.ASM):00104                 ABX
30FB 9644             (         READ.ASM):00105                 LDA     MASK+1                            ; FETCH ACTUAL WORD LENGTH
30FD A702             (         READ.ASM):00106                 STA     2,X                               ; AND STORE IN 3RD BYTE
                      (         READ.ASM):00107         
30FF 9643             (         READ.ASM):00108                 LDA     MASK
3101 3402             (         READ.ASM):00109                 PSHS    A                                 ; SAVE THIS
3103 BD337F           (         READ.ASM):00110                 JSR     CONZST                            ; CONVERT TO Z-STRING
3106 BD3153           (         READ.ASM):00111                 JSR     FINDW                             ; LOOK UP IN VOCABULARY
3109 3502             (         READ.ASM):00112                 PULS    A
310B 9743             (         READ.ASM):00113                 STA     MASK                              ; RESTORE
                      (         READ.ASM):00114         
310D 9E04             (         READ.ASM):00115                 LDX     ARG2
310F 6C01             (         READ.ASM):00116                 INC     1,X                               ; UPDATE # WORDS READ
3111 D63A             (         READ.ASM):00117                 LDB     RTABP                             ; POINT [X] TO 1ST BYTE
3113 3A               (         READ.ASM):00118                 ABX                                       ; IN CURRENT ENTRY
3114 CB04             (         READ.ASM):00119                 ADDB    #4
3116 D73A             (         READ.ASM):00120                 STB     RTABP                             ; POINT TO NEXT ENTRY
3118 DC3D             (         READ.ASM):00121                 LDD     VAL                               ; STORE [VAL] IN ENTRY
311A ED84             (         READ.ASM):00122                 STD     ,X
311C 0F44             (         READ.ASM):00123                 CLR     MASK+1                            ; RESET WORD-CHAR COUNT
311E 7E3089           (         READ.ASM):00124                 JMP     READL                             ; AND CONTINUE
                      (         READ.ASM):00125         
                      (         READ.ASM):00126         ; ----------
                      (         READ.ASM):00127         ; FLUSH WORD
                      (         READ.ASM):00128         ; ----------
                      (         READ.ASM):00129         
3121                  (         READ.ASM):00130         FLUSHW:
3121 9643             (         READ.ASM):00131                 LDA     MASK
3123 2712             (         READ.ASM):00132                 BEQ     FLEX
3125 D63B             (         READ.ASM):00133                 LDB     STABP
3127 9E02             (         READ.ASM):00134                 LDX     ARG1
3129 A685             (         READ.ASM):00135                 LDA     B,X
312B 8D0B             (         READ.ASM):00136                 BSR     RBRKP                             ; WORD BREAK?
312D 2508             (         READ.ASM):00137                 BCS     FLEX                              ; EXIT IF SO
312F 0A43             (         READ.ASM):00138                 DEC     MASK
3131 0C44             (         READ.ASM):00139                 INC     MASK+1
3133 0C3B             (         READ.ASM):00140                 INC     STABP
3135 20EA             (         READ.ASM):00141                 BRA     FLUSHW                            ; KEEP LOOPING
3137                  (         READ.ASM):00142         FLEX:
3137 39               (         READ.ASM):00143                 RTS
                      (         READ.ASM):00144         
                      (         READ.ASM):00145         ; ---------------
                      (         READ.ASM):00146         ; BREAK CHAR SCAN
                      (         READ.ASM):00147         ; ---------------
                      (         READ.ASM):00148         
3138                  (         READ.ASM):00149         RBRKP:
3138 8D09             (         READ.ASM):00150                 BSR     SIBRKP                            ; FIRST CHECK FOR SIBS
313A 2515             (         READ.ASM):00151                 BCS     FBRK                              ; EXIT IF MATCHED
                      (         READ.ASM):00152         
                      (         READ.ASM):00153         ; FALL THROUGH TO ...
                      (         READ.ASM):00154         
                      (         READ.ASM):00155         ; ----------------------
                      (         READ.ASM):00156         ; NORMAL BREAK CHAR SCAN
                      (         READ.ASM):00157         ; ----------------------
                      (         READ.ASM):00158         
313C                  (         READ.ASM):00159         NBRKP:
313C 8E3182           (         READ.ASM):00160                 LDX     #BRKTBL                           ; BASE OF BREAK CHAR TABLE
313F C605             (         READ.ASM):00161                 LDB     #NBRKS-1                          ; NUMBER OF NORMAL BREAK CHARS
3141 2005             (         READ.ASM):00162                 BRA     NBR1
                      (         READ.ASM):00163         
                      (         READ.ASM):00164         ; ------------------------------
                      (         READ.ASM):00165         ; SELF-INSERTING BREAK CHAR SCAN
                      (         READ.ASM):00166         ; ------------------------------
                      (         READ.ASM):00167         
3143                  (         READ.ASM):00168         SIBRKP:
3143 9E23             (         READ.ASM):00169                 LDX     VOCAB                             ; BASE ADDRESS OF VOCAB TABLE
3145 E680             (         READ.ASM):00170                 LDB     ,X+                               ; GET # SIB CHARS
3147 5A               (         READ.ASM):00171                 DECB                                      ; ZERO-ALIGN COUNT
                      (         READ.ASM):00172         
3148                  (         READ.ASM):00173         NBR1:
3148 A185             (         READ.ASM):00174                 CMPA    B,X
314A 2705             (         READ.ASM):00175                 BEQ     FBRK                              ; MATCHED!
314C 5A               (         READ.ASM):00176                 DECB
314D 2AF9             (         READ.ASM):00177                 BPL     NBR1                              ; KEEP LOOPING
314F 5F               (         READ.ASM):00178                 CLRB                                      ; NO MATCH, CLEAR CARRY
3150 39               (         READ.ASM):00179                 RTS
3151                  (         READ.ASM):00180         FBRK:
3151 53               (         READ.ASM):00181                 COMB                                      ; SET CARRY TO FLAG MATCH
3152 39               (         READ.ASM):00182                 RTS
                      (         READ.ASM):00183         
                      (         READ.ASM):00184         ; -----------------
                      (         READ.ASM):00185         ; VOCABULARY SEARCH
                      (         READ.ASM):00186         ; -----------------
                      (         READ.ASM):00187         
3153                  (         READ.ASM):00188         FINDW:
3153 9E23             (         READ.ASM):00189                 LDX     VOCAB                             ; BASE ADDR OF VOCAB TABLE
3155 E680             (         READ.ASM):00190                 LDB     ,X+                               ; GET # SIB BYTES
3157 3A               (         READ.ASM):00191                 ABX                                       ; AND SKIP OVER THEM
                      (         READ.ASM):00192         
3158 A680             (         READ.ASM):00193                 LDA     ,X+                               ; # BYTES PER TABLE ENTRY
315A 9744             (         READ.ASM):00194                 STA     MASK+1                            ; SAVE IT HERE
                      (         READ.ASM):00195         
315C EC81             (         READ.ASM):00196                 LDD     ,X++                              ; # OF ENTRIES IN TABLE
315E DD3D             (         READ.ASM):00197                 STD     VAL                               ; SAVE THAT TOO
                      (         READ.ASM):00198         
3160                  (         READ.ASM):00199         FWL1:
3160 EC84             (         READ.ASM):00200                 LDD     ,X                                ; CHECK FIRST Z-WORD
3162 109334           (         READ.ASM):00201                 CMPD    ZSTBUO
3165 2607             (         READ.ASM):00202                 BNE     WNEXT                             ; NO GOOD
3167 EC02             (         READ.ASM):00203                 LDD     2,X                               ; ELSE CHECK 2ND HALF
3169 109336           (         READ.ASM):00204                 CMPD    ZSTBUO+2
316C 270D             (         READ.ASM):00205                 BEQ     FWSUCC                            ; MATCHED!
                      (         READ.ASM):00206         
316E                  (         READ.ASM):00207         WNEXT:
316E D644             (         READ.ASM):00208                 LDB     MASK+1                            ; MOVE [X] UP TO
3170 3A               (         READ.ASM):00209                 ABX                                       ; NEXT TABLE ENTRY
3171 DC3D             (         READ.ASM):00210                 LDD     VAL
3173 830001           (         READ.ASM):00211                 SUBD    #1
3176 DD3D             (         READ.ASM):00212                 STD     VAL                               ; OUT OF ENTRIES YET?
3178 26E6             (         READ.ASM):00213                 BNE     FWL1                              ; NO, KEEP LOOKING
317A 39               (         READ.ASM):00214                 RTS                                       ; ELSE RETURN WITH [VAL]=0
                      (         READ.ASM):00215         
317B                  (         READ.ASM):00216         FWSUCC:
317B 3089C100         (         READ.ASM):00217                 LEAX    -ZCODE,X                          ; CONVERT TO Z-ADDRESS
317F 9F3D             (         READ.ASM):00218                 STX     VAL                               ; LEAVE RESULT IN [VAL]
3181 39               (         READ.ASM):00219                 RTS
                      (         READ.ASM):00220         
                      (         READ.ASM):00221         ; ------------------
                      (         READ.ASM):00222         ; NORMAL BREAK CHARS
                      (         READ.ASM):00223         ; ------------------
                      (         READ.ASM):00224         
3182                  (         READ.ASM):00225         BRKTBL:
3182 213F2C2E         (         READ.ASM):00226                 FCC     "!?,."
3186 0D               (         READ.ASM):00227                 FCB     EOL
3187 20               (         READ.ASM):00228                 FCB     SPACE
                      (         READ.ASM):00229         
     0006             (         READ.ASM):00230         NBRKS           EQU 6                             ; # NORMAL BREAK CHARS
                      (     cubixzip.asm):00062         
                      (     cubixzip.asm):00063         ;TITLE "ZIP/6809-B INFOCOM, INC. --- OPCODE SUPPORT"
                      (     cubixzip.asm):00064                 INCLUDE PAGING.ASM
                      (       PAGING.ASM):00001         ;       PAGE
                      (       PAGING.ASM):00002         ;       SBTTL   "--- TIMESTAMP PAGING ROUTINES (BM 11/24/84) ---"
                      (       PAGING.ASM):00003         
                      (       PAGING.ASM):00004         ; --------------------
                      (       PAGING.ASM):00005         ; FETCH A VIRTUAL WORD
                      (       PAGING.ASM):00006         ; --------------------
                      (       PAGING.ASM):00007         
3188                  (       PAGING.ASM):00008         GETWRD:
3188 8D38             (       PAGING.ASM):00009                 BSR     GETBYT
318A 973F             (       PAGING.ASM):00010                 STA     TEMP
318C 8D34             (       PAGING.ASM):00011                 BSR     GETBYT
318E 9740             (       PAGING.ASM):00012                 STA     TEMP+1
3190 39               (       PAGING.ASM):00013                 RTS
                      (       PAGING.ASM):00014         
                      (       PAGING.ASM):00015         ; -----------------
                      (       PAGING.ASM):00016         ; FETCH NEXT Z-BYTE
                      (       PAGING.ASM):00017         ; -----------------
                      (       PAGING.ASM):00018         
3191                  (       PAGING.ASM):00019         NEXTPC:
3191 0D18             (       PAGING.ASM):00020                 TST     ZPCFLG                            ; IS [ZPCPNT] VALID?
3193 2619             (       PAGING.ASM):00021                 BNE     NPC2                              ; YES, GET THE BYTE
                      (       PAGING.ASM):00022         
                      (       PAGING.ASM):00023         ; Z-PAGE HAS CHANGED!
                      (       PAGING.ASM):00024         
3195 DC13             (       PAGING.ASM):00025                 LDD     ZPCH                              ; GET TOP 9 BITS OF [ZPC]
3197 4D               (       PAGING.ASM):00026                 TSTA                                      ; IS TOP BIT CLEAR?
3198 2608             (       PAGING.ASM):00027                 BNE     NPC0                              ; NO, PAGE MUST BE SWAPPED
                      (       PAGING.ASM):00028         
319A D10B             (       PAGING.ASM):00029                 CMPB    ZPURE                             ; IS THIS PAGE PRELOADED?
319C 2404             (       PAGING.ASM):00030                 BHS     NPC0                              ; NO, SWAP IT IN
                      (       PAGING.ASM):00031         
319E CB3F             (       PAGING.ASM):00032                 ADDB    #ZCODEHIGH                        ; ELSE MAKE IT ABSOLUTE
31A0 2004             (       PAGING.ASM):00033                 BRA     NPC1                              ; AND CONTINUE
                      (       PAGING.ASM):00034         
31A2                  (       PAGING.ASM):00035         NPC0:
31A2 0F1F             (       PAGING.ASM):00036                 CLR     MPCFLG                            ; INVALIDATE [MPC] FOR SAFETY
31A4 8D4D             (       PAGING.ASM):00037                 BSR     PAGE                              ; RETURN BUFFER IN [B]
                      (       PAGING.ASM):00038         
31A6                  (       PAGING.ASM):00039         NPC1:
31A6 D716             (       PAGING.ASM):00040                 STB     ZPCPNT                            ; SET MSB OF BUFFER ADDRESS
31A8 0F17             (       PAGING.ASM):00041                 CLR     ZPCPNT+1                          ; CLEAR LSB
31AA 86FF             (       PAGING.ASM):00042                 LDA     #TRUE
31AC 9718             (       PAGING.ASM):00043                 STA     ZPCFLG                            ; VALIDATE [ZPC]
                      (       PAGING.ASM):00044         
31AE                  (       PAGING.ASM):00045         NPC2:
31AE D615             (       PAGING.ASM):00046                 LDB     ZPCL                              ; GET BYTE INDEX
31B0 9E16             (       PAGING.ASM):00047                 LDX     ZPCPNT                            ; AND PAGE ADDRESS
31B2 3A               (       PAGING.ASM):00048                 ABX                                       ; USE [ZPCL] AS OFFSET
31B3 A684             (       PAGING.ASM):00049                 LDA     ,X                                ; AND FETCH THE BYTE
                      (       PAGING.ASM):00050         
31B5 0C15             (       PAGING.ASM):00051                 INC     ZPCL                              ; POINT TO NEXT BYTE
31B7 2608             (       PAGING.ASM):00052                 BNE     NPC3                              ; CONTINUE IF NO OVERFLOW
                      (       PAGING.ASM):00053         
31B9 0F18             (       PAGING.ASM):00054                 CLR     ZPCFLG                            ; ELSE INVALIDATE [ZPC]
31BB 0C14             (       PAGING.ASM):00055                 INC     ZPCM                              ; AND POINT
31BD 2602             (       PAGING.ASM):00056                 BNE     NPC3                              ; TO THE
31BF 0C13             (       PAGING.ASM):00057                 INC     ZPCH                              ; NEXT Z-PAGE
                      (       PAGING.ASM):00058         
31C1                  (       PAGING.ASM):00059         NPC3:
31C1 39               (       PAGING.ASM):00060                 RTS                                       ; RETURN BYTE IN [A]
                      (       PAGING.ASM):00061         
                      (       PAGING.ASM):00062         ; ---------------------
                      (       PAGING.ASM):00063         ; GET NEXT VIRTUAL BYTE
                      (       PAGING.ASM):00064         ; ---------------------
                      (       PAGING.ASM):00065         
31C2                  (       PAGING.ASM):00066         GETBYT:
31C2 0D1F             (       PAGING.ASM):00067                 TST     MPCFLG                            ; IS [MPCPNT] VALID?
31C4 2619             (       PAGING.ASM):00068                 BNE     GTBT2                             ; YES, GET THE BYTE
                      (       PAGING.ASM):00069         
                      (       PAGING.ASM):00070         ; Z-PAGE HAS CHANGED!
                      (       PAGING.ASM):00071         
31C6 DC1A             (       PAGING.ASM):00072                 LDD     MPCH                              ; GET TOP 9 BITS OF [MPC]
31C8 4D               (       PAGING.ASM):00073                 TSTA                                      ; IS TOP BIT CLEAR?
31C9 2608             (       PAGING.ASM):00074                 BNE     GTBT0                             ; NO, PAGE MUST BE SWAPPED
                      (       PAGING.ASM):00075         
     31CC             (       PAGING.ASM):00076         PATCH           EQU pth+1                         ; PATCH POINT FOR "VERIFY"
31CB                  (       PAGING.ASM):00077         pth:
31CB D10B             (       PAGING.ASM):00078                 CMPB    ZPURE                             ; IS THIS PAGE PRELOADED?
31CD 2404             (       PAGING.ASM):00079                 BHS     GTBT0                             ; NO, SWAP IT IN
                      (       PAGING.ASM):00080         
31CF CB3F             (       PAGING.ASM):00081                 ADDB    #ZCODEHIGH                        ; ELSE MAKE IT ABSOLUTE
31D1 2004             (       PAGING.ASM):00082                 BRA     GTBT1                             ; AND CONTINUE
                      (       PAGING.ASM):00083         
31D3                  (       PAGING.ASM):00084         GTBT0:
31D3 0F18             (       PAGING.ASM):00085                 CLR     ZPCFLG                            ; INVALIDATE [ZPC] FOR SAFETY
31D5 8D1C             (       PAGING.ASM):00086                 BSR     PAGE                              ; RETURN BUFFER PAGE IN [B]
                      (       PAGING.ASM):00087         
31D7                  (       PAGING.ASM):00088         GTBT1:
31D7 D71D             (       PAGING.ASM):00089                 STB     MPCPNT                            ; SET MSB OF BUFFER ADDRESS
31D9 0F1E             (       PAGING.ASM):00090                 CLR     MPCPNT+1                          ; CLEAR LSB
31DB 86FF             (       PAGING.ASM):00091                 LDA     #TRUE
31DD 971F             (       PAGING.ASM):00092                 STA     MPCFLG                            ; VALIDATE [MPC]
                      (       PAGING.ASM):00093         
31DF                  (       PAGING.ASM):00094         GTBT2:
31DF D61C             (       PAGING.ASM):00095                 LDB     MPCL                              ; GET BYTE INDEX
31E1 9E1D             (       PAGING.ASM):00096                 LDX     MPCPNT                            ; AND PAGE ADDRESS
31E3 3A               (       PAGING.ASM):00097                 ABX                                       ; USE [MPCL] AS OFFSET
31E4 A684             (       PAGING.ASM):00098                 LDA     ,X                                ; AND FETCH THE BYTE
                      (       PAGING.ASM):00099         
31E6 0C1C             (       PAGING.ASM):00100                 INC     MPCL                              ; POINT TO NEXT BYTE
31E8 2608             (       PAGING.ASM):00101                 BNE     GTBT3                             ; CONTINUE IF NO OVERFLOW
                      (       PAGING.ASM):00102         
31EA 0F1F             (       PAGING.ASM):00103                 CLR     MPCFLG                            ; ELSE INVALIDATE [MPC]
31EC 0C1B             (       PAGING.ASM):00104                 INC     MPCM                              ; AND POINT
31EE 2602             (       PAGING.ASM):00105                 BNE     GTBT3                             ; TO THE
31F0 0C1A             (       PAGING.ASM):00106                 INC     MPCH                              ; NEXT Z-PAGE
                      (       PAGING.ASM):00107         
31F2                  (       PAGING.ASM):00108         GTBT3:
31F2 39               (       PAGING.ASM):00109                 RTS                                       ; RETURN BYTE IN [A]
                      (       PAGING.ASM):00110         
                      (       PAGING.ASM):00111         ; -------------------------
                      (       PAGING.ASM):00112         ; LOCATE A SWAPPABLE Z-PAGE
                      (       PAGING.ASM):00113         ; -------------------------
                      (       PAGING.ASM):00114         
                      (       PAGING.ASM):00115         ; ENTRY: TARGET PAGE IN [D] (TOP 9 BITS)
                      (       PAGING.ASM):00116         ; EXIT: ABSOLUTE BUFFER PAGE IN [B]
                      (       PAGING.ASM):00117         
31F3                  (       PAGING.ASM):00118         PAGE:
31F3 DD4C             (       PAGING.ASM):00119                 STD     DBLOCK                            ; SAVE TARGET PAGE HERE
31F5 0F0D             (       PAGING.ASM):00120                 CLR     ZPAGE                             ; CLEAR INDEX
31F7 8E2500           (       PAGING.ASM):00121                 LDX     #PTABLE                           ; START AT BOTOM OF TABLE
31FA                  (       PAGING.ASM):00122         PG0:
31FA 10A381           (       PAGING.ASM):00123                 CMPD    ,X++                              ; FOUND IT?
31FD 2720             (       PAGING.ASM):00124                 BEQ     PG1                               ; YES!
31FF 0C0D             (       PAGING.ASM):00125                 INC     ZPAGE                             ; ELSE COUNT NEXT PAGE
3201 9C0F             (       PAGING.ASM):00126                 CMPX    TABTOP                            ; ANY BUFFERS LEFT?
3203 25F5             (       PAGING.ASM):00127                 BLO     PG0                               ; NO, KEEP SEARCHING
                      (       PAGING.ASM):00128         
                      (       PAGING.ASM):00129         ; SWAP IN THE TARGET PAGE
                      (       PAGING.ASM):00130         
3205 8D52             (       PAGING.ASM):00131                 BSR     EARLY                             ; FIND THE EARLIEST PAGE
3207 D612             (       PAGING.ASM):00132                 LDB     SWAP                              ; MOVE ITS INDEX
3209 D70D             (       PAGING.ASM):00133                 STB     ZPAGE                             ; INTO [ZPAGE]
                      (       PAGING.ASM):00134         
320B DB0E             (       PAGING.ASM):00135                 ADDB    PAGE0                             ; CALC ABSOLUTE PAGE OF BUFFER
320D D74A             (       PAGING.ASM):00136                 STB     DBUFF                             ; TELL DISK WHERE TO PUT DATA
320F 0F4B             (       PAGING.ASM):00137                 CLR     DBUFF+1                           ; CLEAR LSB
                      (       PAGING.ASM):00138         
3211 8E2500           (       PAGING.ASM):00139                 LDX     #PTABLE                           ; GET THE PAGING TABLE ADDRESS
3214 D60D             (       PAGING.ASM):00140                 LDB     ZPAGE                             ; AND THE BUFFER OFFSET
3216 3A               (       PAGING.ASM):00141                 ABX                                       ; ADD THE OFFSET
3217 3A               (       PAGING.ASM):00142                 ABX                                       ; TWICE FOR WORD ALIGNMENT
3218 DC4C             (       PAGING.ASM):00143                 LDD     DBLOCK                            ; RETRIEVE PAGE ID
321A ED84             (       PAGING.ASM):00144                 STD     ,X                                ; SPLICE IT INTO THE TABLE
                      (       PAGING.ASM):00145         
321C BD37DA           (       PAGING.ASM):00146                 JSR     GETDSK                            ; MOVE BLOCK [DBLOCK] TO [DBUFF]
                      (       PAGING.ASM):00147         
                      (       PAGING.ASM):00148         ; UPDATE THE TIMESTAMP
                      (       PAGING.ASM):00149         
321F                  (       PAGING.ASM):00150         PG1:
321F D60D             (       PAGING.ASM):00151                 LDB     ZPAGE                             ; GET BUFFER INDEX
3221 8E2650           (       PAGING.ASM):00152                 LDX     #LRUMAP                           ; CALC ADDRESS OF ENTRY
3224 3A               (       PAGING.ASM):00153                 ABX                                       ; IN TIMESTAMP MAP
3225 A684             (       PAGING.ASM):00154                 LDA     ,X                                ; GET BUFFER'S LAST STAMP
3227 9111             (       PAGING.ASM):00155                 CMPA    STAMP                             ; SAME AS CURRENT STAMP?
3229 2729             (       PAGING.ASM):00156                 BEQ     PG5                               ; EXIT IF SO
                      (       PAGING.ASM):00157         
322B 0C11             (       PAGING.ASM):00158                 INC     STAMP                             ; UPDATE [STAMP]
322D 261B             (       PAGING.ASM):00159                 BNE     PG4                               ; IF STAMP OVERFLOWS ...
                      (       PAGING.ASM):00160         
                      (       PAGING.ASM):00161         ; HANDLE STAMP OVERFLOW
                      (       PAGING.ASM):00162         
322F 8D28             (       PAGING.ASM):00163                 BSR     EARLY                             ; GET EARLIEST STAMP INTO [LRU]
                      (       PAGING.ASM):00164         
3231 8E2650           (       PAGING.ASM):00165                 LDX     #LRUMAP                           ; GET BASE ADDRESS OF STAMPS
3234 5F               (       PAGING.ASM):00166                 CLRB                                      ; INIT STAMP COUNTER
3235                  (       PAGING.ASM):00167         PG2:
3235 A684             (       PAGING.ASM):00168                 LDA     ,X                                ; GET A STAMP
3237 2704             (       PAGING.ASM):00169                 BEQ     PG3                               ; SKIP IF ALREADY ZERO
3239 900A             (       PAGING.ASM):00170                 SUBA    LRU                               ; ELSE SUBTRACT OFF EARLIEST STAMP
323B A784             (       PAGING.ASM):00171                 STA     ,X                                ; AND REPLACE IT
323D                  (       PAGING.ASM):00172         PG3:
323D 3001             (       PAGING.ASM):00173                 LEAX    +1,X                              ; INCREMENT BASE ADDRESS
323F 5C               (       PAGING.ASM):00174                 INCB                                      ; AND COUNTER
3240 D10C             (       PAGING.ASM):00175                 CMPB    PMAX                              ; OUT OF PAGES YET?
3242 25F1             (       PAGING.ASM):00176                 BLO     PG2                               ; LOOP TILL DONE
                      (       PAGING.ASM):00177         
3244 8600             (       PAGING.ASM):00178                 LDA     #0                                ; TURN BACK THE CLOCK
3246 900A             (       PAGING.ASM):00179                 SUBA    LRU                               ; ON [STAMP]
3248 9711             (       PAGING.ASM):00180                 STA     STAMP                             ; TO REFLECT TABLE FUDGING
                      (       PAGING.ASM):00181         
                      (       PAGING.ASM):00182         ; STAMP THE PAGE WITH CURRENT TIME
                      (       PAGING.ASM):00183         
324A                  (       PAGING.ASM):00184         PG4:
324A 8E2650           (       PAGING.ASM):00185                 LDX     #LRUMAP
324D D60D             (       PAGING.ASM):00186                 LDB     ZPAGE
324F 3A               (       PAGING.ASM):00187                 ABX
3250 9611             (       PAGING.ASM):00188                 LDA     STAMP
3252 A784             (       PAGING.ASM):00189                 STA     ,X
                      (       PAGING.ASM):00190         
3254                  (       PAGING.ASM):00191         PG5:
3254 D60D             (       PAGING.ASM):00192                 LDB     ZPAGE                             ; GET PAGE OFFSET
3256 DB0E             (       PAGING.ASM):00193                 ADDB    PAGE0                             ; MAKE IT ABSOLUTE
3258 39               (       PAGING.ASM):00194                 RTS                                       ; AND RETURN IT IN [B]
                      (       PAGING.ASM):00195         
                      (       PAGING.ASM):00196         ; -------------------------
                      (       PAGING.ASM):00197         ; LOCATE EARLIEST TIMESTAMP
                      (       PAGING.ASM):00198         ; -------------------------
                      (       PAGING.ASM):00199         
                      (       PAGING.ASM):00200         ; EXIT: [LRU] = EARLIEST STAMP READING
                      (       PAGING.ASM):00201         ;       [SWAP] = INDEX TO EARLIEST BUFFER
                      (       PAGING.ASM):00202         
3259                  (       PAGING.ASM):00203         EARLY:
3259 0F12             (       PAGING.ASM):00204                 CLR     SWAP                              ; RESET [SWAP]
325B B62650           (       PAGING.ASM):00205                 LDA     LRUMAP                            ; FETCH 1ST READING FOR COMPARISONS
325E 8E2651           (       PAGING.ASM):00206                 LDX     #LRUMAP+1                         ; POINT TO 2ND READING
3261 C601             (       PAGING.ASM):00207                 LDB     #1                                ; INIT BUFFER INDEX
3263                  (       PAGING.ASM):00208         EAR0:
3263 A184             (       PAGING.ASM):00209                 CMPA    ,X                                ; IS THIS STAMP EARLIER THAN [A]?
3265 2504             (       PAGING.ASM):00210                 BLO     EAR1                              ; NO, TRY NEXT
3267 A684             (       PAGING.ASM):00211                 LDA     ,X                                ; ELSE MAKE THIS READING THE "NEW" LOWEST
3269 D712             (       PAGING.ASM):00212                 STB     SWAP                              ; AND REMEMBER WHERE WE FOUND IT
326B                  (       PAGING.ASM):00213         EAR1:
326B 3001             (       PAGING.ASM):00214                 LEAX    +1,X                              ; UPDATE POINTER
326D 5C               (       PAGING.ASM):00215                 INCB                                      ; AND BUFFER INDEX
326E D10C             (       PAGING.ASM):00216                 CMPB    PMAX                              ; OUT OF BUFFERS YET?
3270 25F1             (       PAGING.ASM):00217                 BLO     EAR0                              ; LOOP TILL DONE
                      (       PAGING.ASM):00218         
3272 970A             (       PAGING.ASM):00219                 STA     LRU                               ; SAVE EARLIEST STAMP FOUND
3274 39               (       PAGING.ASM):00220                 RTS                                       ; AND RETURN
                      (       PAGING.ASM):00221         
                      (       PAGING.ASM):00222         ; ---------------------
                      (       PAGING.ASM):00223         ; POINT [MPC] TO [TEMP]
                      (       PAGING.ASM):00224         ; ---------------------
                      (       PAGING.ASM):00225         
3275                  (       PAGING.ASM):00226         SETWRD:
3275 DC3F             (       PAGING.ASM):00227                 LDD     TEMP
3277 DD1B             (       PAGING.ASM):00228                 STD     MPCM
3279 0F1A             (       PAGING.ASM):00229                 CLR     MPCH
327B 0F1F             (       PAGING.ASM):00230                 CLR     MPCFLG
327D 39               (       PAGING.ASM):00231                 RTS
                      (     cubixzip.asm):00065                 INCLUDE ZSTRING.ASM
                      (      ZSTRING.ASM):00001         ;       PAGE
                      (      ZSTRING.ASM):00002         ;       SBTTL "--- Z-STRING HANDLERS ---"
                      (      ZSTRING.ASM):00003         
                      (      ZSTRING.ASM):00004         ; -----------------
                      (      ZSTRING.ASM):00005         ; POINT TO Z-STRING
                      (      ZSTRING.ASM):00006         ; -----------------
                      (      ZSTRING.ASM):00007         
327E                  (      ZSTRING.ASM):00008         SETSTR:
327E 4F               (      ZSTRING.ASM):00009                 CLRA
327F 0840             (      ZSTRING.ASM):00010                 ASL     TEMP+1
3281 093F             (      ZSTRING.ASM):00011                 ROL     TEMP
3283 49               (      ZSTRING.ASM):00012                 ROLA
3284 971A             (      ZSTRING.ASM):00013                 STA     MPCH
3286 DC3F             (      ZSTRING.ASM):00014                 LDD     TEMP
3288 DD1B             (      ZSTRING.ASM):00015                 STD     MPCM
328A 0F1F             (      ZSTRING.ASM):00016                 CLR     MPCFLG
328C                  (      ZSTRING.ASM):00017         ZSTEX:
328C 39               (      ZSTRING.ASM):00018                 RTS
                      (      ZSTRING.ASM):00019         
                      (      ZSTRING.ASM):00020         ; --------------
                      (      ZSTRING.ASM):00021         ; PRINT Z-STRING
                      (      ZSTRING.ASM):00022         ; --------------
                      (      ZSTRING.ASM):00023         
328D                  (      ZSTRING.ASM):00024         PZSTR:
328D 0F2A             (      ZSTRING.ASM):00025                 CLR     CSPERM                            ; PERMANENT CHARSET
328F 0F2B             (      ZSTRING.ASM):00026                 CLR     STBYTF                            ; RESET STRING BYTE FLAG
3291 86FF             (      ZSTRING.ASM):00027                 LDA     #$FF
3293 9729             (      ZSTRING.ASM):00028                 STA     CSTEMP                            ; NO TEMP CHARSET ACTIVE
                      (      ZSTRING.ASM):00029         
3295                  (      ZSTRING.ASM):00030         PZSTRL:
3295 BD3347           (      ZSTRING.ASM):00031                 JSR     GETZCH                            ; GET A Z-CHARACTER
3298 25F2             (      ZSTRING.ASM):00032                 BCS     ZSTEX                             ; END OF STRING IF CARRY SET
329A 9743             (      ZSTRING.ASM):00033                 STA     MASK                              ; SAVE CHAR HERE
329C 2741             (      ZSTRING.ASM):00034                 BEQ     PZSTRS                            ; O = SPACE CHAR
329E 8104             (      ZSTRING.ASM):00035                 CMPA    #4                                ; IS THIS AN F-WORD?
32A0 2557             (      ZSTRING.ASM):00036                 BLO     PZSTRF                            ; APPARENTLY SO
32A2 8106             (      ZSTRING.ASM):00037                 CMPA    #6                                ; SHIFT CHAR?
32A4 253D             (      ZSTRING.ASM):00038                 BLO     PZSTRT                            ; YES, CHANGE CHARSET
                      (      ZSTRING.ASM):00039         
32A6 BD333B           (      ZSTRING.ASM):00040                 JSR     GETMOD
32A9 4D               (      ZSTRING.ASM):00041                 TSTA                                      ; IS THIS CHARSET 0?
32AA 2609             (      ZSTRING.ASM):00042                 BNE     PZSTR1                            ; NOPE
                      (      ZSTRING.ASM):00043         
                      (      ZSTRING.ASM):00044         ; PRINT LOWER-CASE CHAR (CHARSET 0)
                      (      ZSTRING.ASM):00045         
32AC 865B             (      ZSTRING.ASM):00046                 LDA     #$61-6                            ; ASCII "a" MINUS Z-OFFSET
32AE                  (      ZSTRING.ASM):00047         PZSTP0:
32AE 9B43             (      ZSTRING.ASM):00048                 ADDA    MASK                              ; ADD CHARACTER
32B0                  (      ZSTRING.ASM):00049         PZSTP1:
32B0 BD36BC           (      ZSTRING.ASM):00050                 JSR     COUT                              ; PRINT RESULT
32B3 20E0             (      ZSTRING.ASM):00051                 BRA     PZSTRL                            ; AND FETCH ANOTHER Z-CHAR
                      (      ZSTRING.ASM):00052         
                      (      ZSTRING.ASM):00053         ; CHARSET 1 OR 2?
                      (      ZSTRING.ASM):00054         
32B5                  (      ZSTRING.ASM):00055         PZSTR1:
32B5 8101             (      ZSTRING.ASM):00056                 CMPA    #1                                ; SET 1?
32B7 2604             (      ZSTRING.ASM):00057                 BNE     PZSTR2                            ; NOPE, IT'S SET 2
                      (      ZSTRING.ASM):00058         
                      (      ZSTRING.ASM):00059         ; PRINT UPPER-CASE CHAR (CHARSET 1)
                      (      ZSTRING.ASM):00060         
32B9 863B             (      ZSTRING.ASM):00061                 LDA     #$41-6                            ; ASCII "A" MINUS Z-OFFSET
32BB 20F1             (      ZSTRING.ASM):00062                 BRA     PZSTP0                            ; AND SO ON ...
                      (      ZSTRING.ASM):00063         
                      (      ZSTRING.ASM):00064         ; DECODE/PRINT CHARSET 2
                      (      ZSTRING.ASM):00065         
32BD                  (      ZSTRING.ASM):00066         PZSTR2:
32BD D643             (      ZSTRING.ASM):00067                 LDB     MASK                              ; RETRIEVE Z-CHAR
32BF C006             (      ZSTRING.ASM):00068                 SUBB    #6                                ; CONVERT TO ZERO-ALIGNED INDEX
32C1 2707             (      ZSTRING.ASM):00069                 BEQ     PZSTRA                            ; IF ZERO, IT'S "DIRECT" ASCII
32C3 8E345A           (      ZSTRING.ASM):00070                 LDX     #CHRTBL                           ; ELSE GET BASE OF DECODE TABLE
32C6 A685             (      ZSTRING.ASM):00071                 LDA     B,X                               ; GET CHAR FROM TABLE
32C8 20E6             (      ZSTRING.ASM):00072                 BRA     PZSTP1                            ; AND PRINT IT!
                      (      ZSTRING.ASM):00073         
                      (      ZSTRING.ASM):00074         ; DECODE/PRINT A "DIRECT" ASCII CHAR
                      (      ZSTRING.ASM):00075         
32CA                  (      ZSTRING.ASM):00076         PZSTRA:
32CA BD3347           (      ZSTRING.ASM):00077                 JSR     GETZCH                            ; GET NEXT Z-BYTE
32CD 48               (      ZSTRING.ASM):00078                 ASLA                                      ; SHIFT INTO POSITION
32CE 48               (      ZSTRING.ASM):00079                 ASLA
32CF 48               (      ZSTRING.ASM):00080                 ASLA
32D0 48               (      ZSTRING.ASM):00081                 ASLA
32D1 48               (      ZSTRING.ASM):00082                 ASLA
32D2 9743             (      ZSTRING.ASM):00083                 STA     MASK                              ; SAVE MSB
32D4 BD3347           (      ZSTRING.ASM):00084                 JSR     GETZCH                            ; FETCH LSB
32D7 9744             (      ZSTRING.ASM):00085                 STA     MASK+1                            ; SAVE THAT, TOO
32D9 9643             (      ZSTRING.ASM):00086                 LDA     MASK                              ; GET MSB
32DB 9A44             (      ZSTRING.ASM):00087                 ORA     MASK+1                            ; SUPERIMPOSE LSB
32DD 20D1             (      ZSTRING.ASM):00088                 BRA     PZSTP1                            ; AND PRINT RESULT
                      (      ZSTRING.ASM):00089         
                      (      ZSTRING.ASM):00090         ; PRINT A SPACE
                      (      ZSTRING.ASM):00091         
32DF                  (      ZSTRING.ASM):00092         PZSTRS:
32DF 8620             (      ZSTRING.ASM):00093                 LDA     #$20
32E1 20CD             (      ZSTRING.ASM):00094                 BRA     PZSTP1
                      (      ZSTRING.ASM):00095         
                      (      ZSTRING.ASM):00096         ; CHANGE CHARACTER SETS
                      (      ZSTRING.ASM):00097         
32E3                  (      ZSTRING.ASM):00098         PZSTRT:
32E3 8003             (      ZSTRING.ASM):00099                 SUBA    #3                                ; CONVERT TO 1 OR 2
32E5 1F89             (      ZSTRING.ASM):00100                 TFR     A,B
32E7 8D52             (      ZSTRING.ASM):00101                 BSR     GETMOD
32E9 2604             (      ZSTRING.ASM):00102                 BNE     PZSTRP                            ; NO, DO PERMANENT SHIFT
32EB D729             (      ZSTRING.ASM):00103                 STB     CSTEMP                            ; JUST A TEMP-SHIFT
32ED 20A6             (      ZSTRING.ASM):00104                 BRA     PZSTRL
                      (      ZSTRING.ASM):00105         
32EF                  (      ZSTRING.ASM):00106         PZSTRP:
32EF D72A             (      ZSTRING.ASM):00107                 STB     CSPERM                            ; PERMANENT SHIFT
32F1 912A             (      ZSTRING.ASM):00108                 CMPA    CSPERM                            ; NEW SET SAME AS OLD?
32F3 27A0             (      ZSTRING.ASM):00109                 BEQ     PZSTRL                            ; YES, EXIT
32F5 0F2A             (      ZSTRING.ASM):00110                 CLR     CSPERM                            ; ELSE BACK TO SET 0
32F7 209C             (      ZSTRING.ASM):00111                 BRA     PZSTRL                            ; BEFORE FINISHING
                      (      ZSTRING.ASM):00112         
                      (      ZSTRING.ASM):00113         ; HANDLE AN F-WORD
                      (      ZSTRING.ASM):00114         
32F9                  (      ZSTRING.ASM):00115         PZSTRF:
32F9 4A               (      ZSTRING.ASM):00116                 DECA                                      ; CONVERT TO 0-2
32FA C640             (      ZSTRING.ASM):00117                 LDB     #64                               ; TIMES 64
32FC 3D               (      ZSTRING.ASM):00118                 MUL
32FD D73C             (      ZSTRING.ASM):00119                 STB     PZSTFO                            ; SAVE FOR LATER
32FF BD3347           (      ZSTRING.ASM):00120                 JSR     GETZCH                            ; GET F-WORD INDEX
3302 1F89             (      ZSTRING.ASM):00121                 TFR     A,B                               ; MOVE IT
3304 58               (      ZSTRING.ASM):00122                 ASLB                                      ; FORM WORD-ALIGNED INDEX
3305 DB3C             (      ZSTRING.ASM):00123                 ADDB    PZSTFO                            ; ADD OFFSET
3307 9E25             (      ZSTRING.ASM):00124                 LDX     FWORDS                            ; GET BASE ADDR OF FWORDS TABLE
3309 3A               (      ZSTRING.ASM):00125                 ABX                                       ; ADD THE OFFSET
330A EC84             (      ZSTRING.ASM):00126                 LDD     ,X                                ; GET THE FWORD POINTER
330C DD3F             (      ZSTRING.ASM):00127                 STD     TEMP                              ; AND SAVE IT
                      (      ZSTRING.ASM):00128         
                      (      ZSTRING.ASM):00129         ; SAVE THE STATE OF CURRENT Z-PRINT
                      (      ZSTRING.ASM):00130         
330E 961A             (      ZSTRING.ASM):00131                 LDA     MPCH
3310 3402             (      ZSTRING.ASM):00132                 PSHS    A
3312 962A             (      ZSTRING.ASM):00133                 LDA     CSPERM
3314 D62B             (      ZSTRING.ASM):00134                 LDB     STBYTF
3316 9E1B             (      ZSTRING.ASM):00135                 LDX     MPCM
3318 109E2C           (      ZSTRING.ASM):00136                 LDY     ZSTWRD
331B 3436             (      ZSTRING.ASM):00137                 PSHS    Y,X,B,A
                      (      ZSTRING.ASM):00138         
331D BD327E           (      ZSTRING.ASM):00139                 JSR     SETSTR                            ; PRINT THE F-WORD
3320 BD328D           (      ZSTRING.ASM):00140                 JSR     PZSTR                             ; POINTED TO BY [TEMP]
                      (      ZSTRING.ASM):00141         
                      (      ZSTRING.ASM):00142         ; RESTORE THE OLD Z-STRING
                      (      ZSTRING.ASM):00143         
3323 3536             (      ZSTRING.ASM):00144                 PULS    Y,X,B,A
3325 109F2C           (      ZSTRING.ASM):00145                 STY     ZSTWRD
3328 9F1B             (      ZSTRING.ASM):00146                 STX     MPCM
332A D72B             (      ZSTRING.ASM):00147                 STB     STBYTF
332C 972A             (      ZSTRING.ASM):00148                 STA     CSPERM
332E 3502             (      ZSTRING.ASM):00149                 PULS    A
3330 971A             (      ZSTRING.ASM):00150                 STA     MPCH
                      (      ZSTRING.ASM):00151         
3332 86FF             (      ZSTRING.ASM):00152                 LDA     #$FF
3334 9729             (      ZSTRING.ASM):00153                 STA     CSTEMP                            ; DISABLE TEMP CHARSET
3336 0F1F             (      ZSTRING.ASM):00154                 CLR     MPCFLG                            ; MPC HAS CHANGED!
3338 7E3295           (      ZSTRING.ASM):00155                 JMP     PZSTRL                            ; CONTINUE INNOCENTLY
                      (      ZSTRING.ASM):00156         
                      (      ZSTRING.ASM):00157         ; ----------------------
                      (      ZSTRING.ASM):00158         ; RETURN CURRENT CHARSET
                      (      ZSTRING.ASM):00159         ; ----------------------
                      (      ZSTRING.ASM):00160         
333B                  (      ZSTRING.ASM):00161         GETMOD:
333B 9629             (      ZSTRING.ASM):00162                 LDA     CSTEMP
333D 2A03             (      ZSTRING.ASM):00163                 BPL     GM
333F 962A             (      ZSTRING.ASM):00164                 LDA     CSPERM
3341 39               (      ZSTRING.ASM):00165                 RTS
                      (      ZSTRING.ASM):00166         
3342                  (      ZSTRING.ASM):00167         GM:
3342 C6FF             (      ZSTRING.ASM):00168                 LDB     #$FF
3344 D729             (      ZSTRING.ASM):00169                 STB     CSTEMP
3346 39               (      ZSTRING.ASM):00170                 RTS
                      (      ZSTRING.ASM):00171         
                      (      ZSTRING.ASM):00172         ; ---------------
                      (      ZSTRING.ASM):00173         ; GET NEXT Z-CHAR
                      (      ZSTRING.ASM):00174         ; ---------------
                      (      ZSTRING.ASM):00175         
3347                  (      ZSTRING.ASM):00176         GETZCH:
3347 962B             (      ZSTRING.ASM):00177                 LDA     STBYTF                            ; WHICH BYTE?
3349 2A02             (      ZSTRING.ASM):00178                 BPL     GTZ0
334B 53               (      ZSTRING.ASM):00179                 COMB                                      ; SET CARRY
334C 39               (      ZSTRING.ASM):00180                 RTS                                       ; TO INDICATE "NO MORE CHARS"
                      (      ZSTRING.ASM):00181         
334D                  (      ZSTRING.ASM):00182         GTZ0:
334D 260F             (      ZSTRING.ASM):00183                 BNE     GETZH1                            ; NOT FIRST CHAR
334F 0C2B             (      ZSTRING.ASM):00184                 INC     STBYTF
3351 BD3188           (      ZSTRING.ASM):00185                 JSR     GETWRD
3354 DC3F             (      ZSTRING.ASM):00186                 LDD     TEMP
3356 DD2C             (      ZSTRING.ASM):00187                 STD     ZSTWRD
3358 44               (      ZSTRING.ASM):00188                 LSRA
3359 44               (      ZSTRING.ASM):00189                 LSRA
335A                  (      ZSTRING.ASM):00190         GTEXIT:
335A 841F             (      ZSTRING.ASM):00191                 ANDA    #%00011111
335C 5F               (      ZSTRING.ASM):00192                 CLRB                                      ; CLEAR CARRY
335D 39               (      ZSTRING.ASM):00193                 RTS
                      (      ZSTRING.ASM):00194         
335E                  (      ZSTRING.ASM):00195         GETZH1:
335E 4A               (      ZSTRING.ASM):00196                 DECA
335F 2614             (      ZSTRING.ASM):00197                 BNE     GETZH2                            ; MUST BE LAST CHAR
3361 8602             (      ZSTRING.ASM):00198                 LDA     #2
3363 972B             (      ZSTRING.ASM):00199                 STA     STBYTF
3365 DC2C             (      ZSTRING.ASM):00200                 LDD     ZSTWRD
3367 44               (      ZSTRING.ASM):00201                 LSRA
3368 56               (      ZSTRING.ASM):00202                 RORB
3369 962C             (      ZSTRING.ASM):00203                 LDA     ZSTWRD
336B 44               (      ZSTRING.ASM):00204                 LSRA
336C 44               (      ZSTRING.ASM):00205                 LSRA
336D 56               (      ZSTRING.ASM):00206                 RORB
336E 54               (      ZSTRING.ASM):00207                 LSRB
336F 54               (      ZSTRING.ASM):00208                 LSRB
3370 54               (      ZSTRING.ASM):00209                 LSRB
3371                  (      ZSTRING.ASM):00210         GETZH3:
3371 1F98             (      ZSTRING.ASM):00211                 TFR     B,A                               ; EXPECTED HERE
3373 20E5             (      ZSTRING.ASM):00212                 BRA     GTEXIT
                      (      ZSTRING.ASM):00213         
3375                  (      ZSTRING.ASM):00214         GETZH2:
3375 0F2B             (      ZSTRING.ASM):00215                 CLR     STBYTF
3377 DC2C             (      ZSTRING.ASM):00216                 LDD     ZSTWRD
3379 2AF6             (      ZSTRING.ASM):00217                 BPL     GETZH3
337B 032B             (      ZSTRING.ASM):00218                 COM     STBYTF                            ; INDICATE END OF STRING
337D 20F2             (      ZSTRING.ASM):00219                 BRA     GETZH3
                      (      ZSTRING.ASM):00220         
                      (      ZSTRING.ASM):00221         ; -------------------
                      (      ZSTRING.ASM):00222         ; CONVERT TO Z-STRING
                      (      ZSTRING.ASM):00223         ; -------------------
                      (      ZSTRING.ASM):00224         
337F                  (      ZSTRING.ASM):00225         CONZST:
337F CC0505           (      ZSTRING.ASM):00226                 LDD     #$0505                            ; FILL OUTPUT BUFFER
3382 DD34             (      ZSTRING.ASM):00227                 STD     ZSTBUO                            ; WITH PAD CHARS
3384 DD36             (      ZSTRING.ASM):00228                 STD     ZSTBUO+2
3386 DD38             (      ZSTRING.ASM):00229                 STD     ZSTBUO+4
                      (      ZSTRING.ASM):00230         
3388 4C               (      ZSTRING.ASM):00231                 INCA                                      ; = 6
3389 9743             (      ZSTRING.ASM):00232                 STA     MASK                              ; INIT CHAR COUNT
                      (      ZSTRING.ASM):00233         
338B 0F3D             (      ZSTRING.ASM):00234                 CLR     VAL                               ; RESET OUTPUT AND
338D 0F3F             (      ZSTRING.ASM):00235                 CLR     TEMP                              ; INPUT INDEXES
                      (      ZSTRING.ASM):00236         
338F                  (      ZSTRING.ASM):00237         CNZSL1:
338F D63F             (      ZSTRING.ASM):00238                 LDB     TEMP
3391 0C3F             (      ZSTRING.ASM):00239                 INC     TEMP
3393 8E002E           (      ZSTRING.ASM):00240                 LDX     #ZSTBUI                           ; POINT TO INPUT BUFFER
3396 A685             (      ZSTRING.ASM):00241                 LDA     B,X                               ; GRAB NEXT CHAR
3398 9744             (      ZSTRING.ASM):00242                 STA     MASK+1                            ; SAVE IT HERE
339A 2604             (      ZSTRING.ASM):00243                 BNE     CNZSL2                            ; IF CHAR WAS ZERO,
339C 8605             (      ZSTRING.ASM):00244                 LDA     #5                                ; USE A Z-PAD
339E 2025             (      ZSTRING.ASM):00245                 BRA     CNZSLO
                      (      ZSTRING.ASM):00246         
33A0                  (      ZSTRING.ASM):00247         CNZSL2:
33A0 9644             (      ZSTRING.ASM):00248                 LDA     MASK+1
33A2 BD3420           (      ZSTRING.ASM):00249                 JSR     ZCHRCS                            ; WHICH CHARSET TO USE?
33A5 4D               (      ZSTRING.ASM):00250                 TSTA
33A6 2711             (      ZSTRING.ASM):00251                 BEQ     CNZSLC                            ; IF CHARSET 0, USE LOWER CASE
33A8 8B03             (      ZSTRING.ASM):00252                 ADDA    #3
33AA D63D             (      ZSTRING.ASM):00253                 LDB     VAL                               ; OUTPUT A TEMP SHIFT
33AC 8E0034           (      ZSTRING.ASM):00254                 LDX     #ZSTBUO
33AF A785             (      ZSTRING.ASM):00255                 STA     B,X
33B1 0C3D             (      ZSTRING.ASM):00256                 INC     VAL
33B3 0A43             (      ZSTRING.ASM):00257                 DEC     MASK
33B5 10270084         (      ZSTRING.ASM):00258                 LBEQ    CNZSLE
                      (      ZSTRING.ASM):00259         
33B9                  (      ZSTRING.ASM):00260         CNZSLC:
33B9 9644             (      ZSTRING.ASM):00261                 LDA     MASK+1
33BB BD3420           (      ZSTRING.ASM):00262                 JSR     ZCHRCS
33BE 4A               (      ZSTRING.ASM):00263                 DECA
33BF 2A13             (      ZSTRING.ASM):00264                 BPL     CNZSC1                            ; NOT CHARSET 0!
33C1 9644             (      ZSTRING.ASM):00265                 LDA     MASK+1
33C3 805B             (      ZSTRING.ASM):00266                 SUBA    #$61-6                            ; ASCII "a" MINUS 6
                      (      ZSTRING.ASM):00267         
33C5                  (      ZSTRING.ASM):00268         CNZSLO:
33C5 D63D             (      ZSTRING.ASM):00269                 LDB     VAL
33C7 8E0034           (      ZSTRING.ASM):00270                 LDX     #ZSTBUO
33CA A785             (      ZSTRING.ASM):00271                 STA     B,X
33CC 0C3D             (      ZSTRING.ASM):00272                 INC     VAL
33CE 0A43             (      ZSTRING.ASM):00273                 DEC     MASK
33D0 276B             (      ZSTRING.ASM):00274                 BEQ     CNZSLE                            ; ALL FINISHED
33D2 20BB             (      ZSTRING.ASM):00275                 BRA     CNZSL1                            ; ELSE LOOP BACK FOR MORE
                      (      ZSTRING.ASM):00276         
33D4                  (      ZSTRING.ASM):00277         CNZSC1:
33D4 2606             (      ZSTRING.ASM):00278                 BNE     CNZSC3                            ; MUST BE CHARSET 3
33D6 9644             (      ZSTRING.ASM):00279                 LDA     MASK+1
33D8 803B             (      ZSTRING.ASM):00280                 SUBA    #$41-6                            ; ASCII "A" MINUS 6
33DA 20E9             (      ZSTRING.ASM):00281                 BRA     CNZSLO
                      (      ZSTRING.ASM):00282         
33DC                  (      ZSTRING.ASM):00283         CNZSC3:
33DC 9644             (      ZSTRING.ASM):00284                 LDA     MASK+1
33DE BD340E           (      ZSTRING.ASM):00285                 JSR     CNZS2M                            ; IS IT IN TABLE?
33E1 26E2             (      ZSTRING.ASM):00286                 BNE     CNZSLO                            ; YES, OUTPUT THE CHAR
33E3 8606             (      ZSTRING.ASM):00287                 LDA     #6                                ; ELSE IT'S A "DIRECT" ASCII CHAR
33E5 D63D             (      ZSTRING.ASM):00288                 LDB     VAL
33E7 8E0034           (      ZSTRING.ASM):00289                 LDX     #ZSTBUO
33EA A785             (      ZSTRING.ASM):00290                 STA     B,X                               ; SEND "DIRECT" TO OUTPUT
33EC 0C3D             (      ZSTRING.ASM):00291                 INC     VAL
33EE 0A43             (      ZSTRING.ASM):00292                 DEC     MASK
33F0 274B             (      ZSTRING.ASM):00293                 BEQ     CNZSLE                            ; NO MORE ROOM!
                      (      ZSTRING.ASM):00294         
                      (      ZSTRING.ASM):00295         ; CONVERT CHAR TO 2-BYTE DIRECT ASCII
                      (      ZSTRING.ASM):00296         
33F2 9644             (      ZSTRING.ASM):00297                 LDA     MASK+1
33F4 44               (      ZSTRING.ASM):00298                 LSRA
33F5 44               (      ZSTRING.ASM):00299                 LSRA
33F6 44               (      ZSTRING.ASM):00300                 LSRA
33F7 44               (      ZSTRING.ASM):00301                 LSRA
33F8 44               (      ZSTRING.ASM):00302                 LSRA
33F9 8403             (      ZSTRING.ASM):00303                 ANDA    #%00000011
33FB D63D             (      ZSTRING.ASM):00304                 LDB     VAL
33FD 8E0034           (      ZSTRING.ASM):00305                 LDX     #ZSTBUO
3400 A785             (      ZSTRING.ASM):00306                 STA     B,X
3402 0C3D             (      ZSTRING.ASM):00307                 INC     VAL
3404 0A43             (      ZSTRING.ASM):00308                 DEC     MASK
3406 2735             (      ZSTRING.ASM):00309                 BEQ     CNZSLE                            ; NO MORE ROOM!
3408 9644             (      ZSTRING.ASM):00310                 LDA     MASK+1
340A 841F             (      ZSTRING.ASM):00311                 ANDA    #%00011111                        ; FORM 2ND Z-BYTE
340C 20B7             (      ZSTRING.ASM):00312                 BRA     CNZSLO                            ; AND OUTPUT IT
                      (      ZSTRING.ASM):00313         
                      (      ZSTRING.ASM):00314         ; ----------------------
                      (      ZSTRING.ASM):00315         ; SEARCH CHARSET 3 TABLE
                      (      ZSTRING.ASM):00316         ; ----------------------
                      (      ZSTRING.ASM):00317         
340E                  (      ZSTRING.ASM):00318         CNZS2M:
340E 8E345A           (      ZSTRING.ASM):00319                 LDX     #CHRTBL
3411 C619             (      ZSTRING.ASM):00320                 LDB     #25
3413                  (      ZSTRING.ASM):00321         CNLOOP:
3413 A185             (      ZSTRING.ASM):00322                 CMPA    B,X
3415 2704             (      ZSTRING.ASM):00323                 BEQ     CNOK
3417 5A               (      ZSTRING.ASM):00324                 DECB
3418 26F9             (      ZSTRING.ASM):00325                 BNE     CNLOOP
341A 39               (      ZSTRING.ASM):00326                 RTS                                       ; RETURN ZERO IN B IF NO MATCH
                      (      ZSTRING.ASM):00327         
341B                  (      ZSTRING.ASM):00328         CNOK:
341B 1F98             (      ZSTRING.ASM):00329                 TFR     B,A                               ; EXPECTED IN [A]
341D 8B06             (      ZSTRING.ASM):00330                 ADDA    #6                                ; CONVERT TO Z-CHAR
341F 39               (      ZSTRING.ASM):00331                 RTS
                      (      ZSTRING.ASM):00332         
                      (      ZSTRING.ASM):00333         ; -------------------------
                      (      ZSTRING.ASM):00334         ; DETERMINE CHARSET OF CHAR
                      (      ZSTRING.ASM):00335         ; -------------------------
                      (      ZSTRING.ASM):00336         
3420                  (      ZSTRING.ASM):00337         ZCHRCS:
3420 8161             (      ZSTRING.ASM):00338                 CMPA    #$61                              ; ASCII "a"
3422 2506             (      ZSTRING.ASM):00339                 BLO     ZCHR1
3424 817B             (      ZSTRING.ASM):00340                 CMPA    #$7B                              ; ASCII "z"+1
3426 2402             (      ZSTRING.ASM):00341                 BHS     ZCHR1
3428 4F               (      ZSTRING.ASM):00342                 CLRA                                      ; IT'S CHARSET 0
3429 39               (      ZSTRING.ASM):00343                 RTS
                      (      ZSTRING.ASM):00344         
342A                  (      ZSTRING.ASM):00345         ZCHR1:
342A 8141             (      ZSTRING.ASM):00346                 CMPA    #$41                              ; ASCII "A"
342C 2507             (      ZSTRING.ASM):00347                 BLO     ZCHR2
342E 815B             (      ZSTRING.ASM):00348                 CMPA    #$5B                              ; ASCII "Z"+1
3430 2403             (      ZSTRING.ASM):00349                 BHS     ZCHR2
3432 8601             (      ZSTRING.ASM):00350                 LDA     #1                                ; IT'S CHARSET 1
3434 39               (      ZSTRING.ASM):00351                 RTS
                      (      ZSTRING.ASM):00352         
3435                  (      ZSTRING.ASM):00353         ZCHR2:
3435 4D               (      ZSTRING.ASM):00354                 TSTA
3436 2704             (      ZSTRING.ASM):00355                 BEQ     ZCHRX                             ; EXIT IF ZERO
3438 2B02             (      ZSTRING.ASM):00356                 BMI     ZCHRX                             ; OR NEGATIVE
343A 8602             (      ZSTRING.ASM):00357                 LDA     #2                                ; ELSE IT'S CHARSET 2
343C                  (      ZSTRING.ASM):00358         ZCHRX:
343C 39               (      ZSTRING.ASM):00359                 RTS
                      (      ZSTRING.ASM):00360         
                      (      ZSTRING.ASM):00361         ; ---------------
                      (      ZSTRING.ASM):00362         ; CRUSH 6 Z-CHARS
                      (      ZSTRING.ASM):00363         ; ---------------
                      (      ZSTRING.ASM):00364         
343D                  (      ZSTRING.ASM):00365         CNZSLE:
343D DC34             (      ZSTRING.ASM):00366                 LDD     ZSTBUO                            ; HANDLE 1ST TRIPLET
343F 58               (      ZSTRING.ASM):00367                 ASLB
3440 58               (      ZSTRING.ASM):00368                 ASLB
3441 58               (      ZSTRING.ASM):00369                 ASLB
3442 58               (      ZSTRING.ASM):00370                 ASLB
3443 49               (      ZSTRING.ASM):00371                 ROLA
3444 58               (      ZSTRING.ASM):00372                 ASLB
3445 49               (      ZSTRING.ASM):00373                 ROLA
3446 DA36             (      ZSTRING.ASM):00374                 ORB     ZSTBUO+2
3448 DD34             (      ZSTRING.ASM):00375                 STD     ZSTBUO
                      (      ZSTRING.ASM):00376         
344A DC37             (      ZSTRING.ASM):00377                 LDD     ZSTBUO+3                          ; HANDLE 2ND TRIPLET
344C 58               (      ZSTRING.ASM):00378                 ASLB
344D 58               (      ZSTRING.ASM):00379                 ASLB
344E 58               (      ZSTRING.ASM):00380                 ASLB
344F 58               (      ZSTRING.ASM):00381                 ASLB
3450 49               (      ZSTRING.ASM):00382                 ROLA
3451 58               (      ZSTRING.ASM):00383                 ASLB
3452 49               (      ZSTRING.ASM):00384                 ROLA
3453 DA39             (      ZSTRING.ASM):00385                 ORB     ZSTBUO+5
3455 8A80             (      ZSTRING.ASM):00386                 ORA     #%10000000                        ; SET SIGN BIT OF LAST Z-BYTE
3457 DD36             (      ZSTRING.ASM):00387                 STD     ZSTBUO+2
3459 39               (      ZSTRING.ASM):00388                 RTS
                      (      ZSTRING.ASM):00389         
                      (      ZSTRING.ASM):00390         ; ----------------------
                      (      ZSTRING.ASM):00391         ; CHARSET 2 DECODE TABLE
                      (      ZSTRING.ASM):00392         ; ----------------------
                      (      ZSTRING.ASM):00393         
345A                  (      ZSTRING.ASM):00394         CHRTBL:
345A 00               (      ZSTRING.ASM):00395                 FCB     0                                 ; DUMMY BYTE
345B 0D               (      ZSTRING.ASM):00396                 FCB     $0D                               ; CARRIAGE RETURN
345C 3031323334353637 (      ZSTRING.ASM):00397                 FCC     "0123456789.,!?_#"
     38392E2C213F5F23
346C 27               (      ZSTRING.ASM):00398                 FCB     $27                               ; SINGLE QUOTE
346D 22               (      ZSTRING.ASM):00399                 FCB     $22                               ; DOUBLE QUOTE
346E 2F5C2D3A2829     (      ZSTRING.ASM):00400                 FCC     "/\-:()"
                      (     cubixzip.asm):00066                 INCLUDE OBJECTS.ASM
                      (      OBJECTS.ASM):00001         ;       PAGE
                      (      OBJECTS.ASM):00002         ;       SBTTL "--- OBJECT & PROPERTY HANDLERS ---"
                      (      OBJECTS.ASM):00003         
3474                  (      OBJECTS.ASM):00004         PROPB:
3474 9603             (      OBJECTS.ASM):00005                 LDA     ARG1+1
3476 BD34D7           (      OBJECTS.ASM):00006                 JSR     OBJLOC
3479 9E3F             (      OBJECTS.ASM):00007                 LDX     TEMP
347B EC07             (      OBJECTS.ASM):00008                 LDD     7,X
347D C33F00           (      OBJECTS.ASM):00009                 ADDD    #ZCODE
3480 DD3F             (      OBJECTS.ASM):00010                 STD     TEMP                              ; EXPECTED HERE
3482 1F01             (      OBJECTS.ASM):00011                 TFR     D,X
3484 E684             (      OBJECTS.ASM):00012                 LDB     ,X                                ; GET FIRST BYTE (LENGTH OF DESC)
3486 58               (      OBJECTS.ASM):00013                 ASLB                                      ; WORD-ALIGN IT
3487 5C               (      OBJECTS.ASM):00014                 INCB                                      ; AND POINT JUST PAST IT
3488 39               (      OBJECTS.ASM):00015                 RTS
                      (      OBJECTS.ASM):00016         
3489                  (      OBJECTS.ASM):00017         PROPN:
3489 9E3F             (      OBJECTS.ASM):00018                 LDX     TEMP
348B 3A               (      OBJECTS.ASM):00019                 ABX
348C A684             (      OBJECTS.ASM):00020                 LDA     ,X
348E 841F             (      OBJECTS.ASM):00021                 ANDA    #%00011111
3490 39               (      OBJECTS.ASM):00022                 RTS
                      (      OBJECTS.ASM):00023         
3491                  (      OBJECTS.ASM):00024         PROPL:
3491 9E3F             (      OBJECTS.ASM):00025                 LDX     TEMP
3493 3A               (      OBJECTS.ASM):00026                 ABX
3494 A684             (      OBJECTS.ASM):00027                 LDA     ,X
3496 46               (      OBJECTS.ASM):00028                 RORA
3497 46               (      OBJECTS.ASM):00029                 RORA
3498 46               (      OBJECTS.ASM):00030                 RORA
3499 46               (      OBJECTS.ASM):00031                 RORA
349A 46               (      OBJECTS.ASM):00032                 RORA
349B 8407             (      OBJECTS.ASM):00033                 ANDA    #%00000111
349D 39               (      OBJECTS.ASM):00034                 RTS
                      (      OBJECTS.ASM):00035         
349E                  (      OBJECTS.ASM):00036         PROPNX:
349E 8DF1             (      OBJECTS.ASM):00037                 BSR     PROPL
34A0 973D             (      OBJECTS.ASM):00038                 STA     VAL
34A2                  (      OBJECTS.ASM):00039         PPX:
34A2 5C               (      OBJECTS.ASM):00040                 INCB
34A3 0A3D             (      OBJECTS.ASM):00041                 DEC     VAL
34A5 2AFB             (      OBJECTS.ASM):00042                 BPL     PPX
34A7 5C               (      OBJECTS.ASM):00043                 INCB
34A8 39               (      OBJECTS.ASM):00044                 RTS
                      (      OBJECTS.ASM):00045         
34A9                  (      OBJECTS.ASM):00046         FLAGSU:
34A9 9603             (      OBJECTS.ASM):00047                 LDA     ARG1+1
34AB BD34D7           (      OBJECTS.ASM):00048                 JSR     OBJLOC
34AE 9605             (      OBJECTS.ASM):00049                 LDA     ARG2+1
34B0 8110             (      OBJECTS.ASM):00050                 CMPA    #16
34B2 2508             (      OBJECTS.ASM):00051                 BLO     FLGSU1
34B4 8010             (      OBJECTS.ASM):00052                 SUBA    #16
34B6 9E3F             (      OBJECTS.ASM):00053                 LDX     TEMP
34B8 3002             (      OBJECTS.ASM):00054                 LEAX    2,X
34BA 9F3F             (      OBJECTS.ASM):00055                 STX     TEMP
                      (      OBJECTS.ASM):00056         
34BC                  (      OBJECTS.ASM):00057         FLGSU1:
34BC 973E             (      OBJECTS.ASM):00058                 STA     VAL+1
34BE CC0001           (      OBJECTS.ASM):00059                 LDD     #1
34C1 DD43             (      OBJECTS.ASM):00060                 STD     MASK
34C3 C60F             (      OBJECTS.ASM):00061                 LDB     #15
34C5 D03E             (      OBJECTS.ASM):00062                 SUBB    VAL+1
                      (      OBJECTS.ASM):00063         
34C7                  (      OBJECTS.ASM):00064         FLGSU2:
34C7 2707             (      OBJECTS.ASM):00065                 BEQ     FLGSU3
34C9 0844             (      OBJECTS.ASM):00066                 ASL     MASK+1
34CB 0943             (      OBJECTS.ASM):00067                 ROL     MASK
34CD 5A               (      OBJECTS.ASM):00068                 DECB
34CE 20F7             (      OBJECTS.ASM):00069                 BRA     FLGSU2
                      (      OBJECTS.ASM):00070         
34D0                  (      OBJECTS.ASM):00071         FLGSU3:
34D0 9E3F             (      OBJECTS.ASM):00072                 LDX     TEMP
34D2 EC84             (      OBJECTS.ASM):00073                 LDD     ,X
34D4 DD3D             (      OBJECTS.ASM):00074                 STD     VAL
34D6 39               (      OBJECTS.ASM):00075                 RTS
                      (      OBJECTS.ASM):00076         
34D7                  (      OBJECTS.ASM):00077         OBJLOC:
34D7 C609             (      OBJECTS.ASM):00078                 LDB     #9                                ; NUMBER IN [A] TIMES 9
34D9 3D               (      OBJECTS.ASM):00079                 MUL
34DA C30035           (      OBJECTS.ASM):00080                 ADDD    #53                               ; PLUS 53
34DD F33F0A           (      OBJECTS.ASM):00081                 ADDD    ZCODE+ZOBJEC                      ; Z-ADDRESS OF OBJECT TABLE
34E0 C33F00           (      OBJECTS.ASM):00082                 ADDD    #ZCODE                            ; FORM ABSOLUTE ADDRESS
34E3 DD3F             (      OBJECTS.ASM):00083                 STD     TEMP
34E5 39               (      OBJECTS.ASM):00084                 RTS
                      (     cubixzip.asm):00067         
                      (     cubixzip.asm):00068         ;TITLE "ZIP/6809-B INFOCOM, INC. --- CUBIX DEPENDENT"
                      (     cubixzip.asm):00069                 INCLUDE IO.ASM
                      (           IO.ASM):00001         ;       PAGE
                      (           IO.ASM):00002         ;       SBTTL "--- OS EQUATES ---"
                      (           IO.ASM):00003         
     000D             (           IO.ASM):00004         EOL             EQU $0D                           ; END-OF-LINE CHARACTER
     0008             (           IO.ASM):00005         BS              EQU $08                           ; BACKSPACE CHARACTER
     0020             (           IO.ASM):00006         SPACE           EQU $20                           ; SPACE CHARACTER
                      (           IO.ASM):00007         
                      (           IO.ASM):00008         ;        PAGE
                      (           IO.ASM):00009         ;        SBTTL   "I/O PRIMITIVES"
                      (           IO.ASM):00010         
                      (           IO.ASM):00011         
                      (           IO.ASM):00012         
                      (           IO.ASM):00013         ; --------------------
                      (           IO.ASM):00014         ; ACCESS OS CHAR-PRINT
                      (           IO.ASM):00015         ; --------------------
                      (           IO.ASM):00016         
                      (           IO.ASM):00017         
34E6                  (           IO.ASM):00018         OUTCHR:
34E6 3477             (           IO.ASM):00019                 PSHS    A,B,X,Y,U,CC
34E8 3F               (           IO.ASM):00020                 SWI
34E9 21               (           IO.ASM):00021                 FCB     33                                ;DISPLAY
34EA 3577             (           IO.ASM):00022                 PULS    A,B,X,Y,U,CC
34EC 39               (           IO.ASM):00023                 RTS
                      (           IO.ASM):00024         
                      (           IO.ASM):00025         ; -----------------
                      (           IO.ASM):00026         ; READ A SINGLE KEY
                      (           IO.ASM):00027         ; -----------------
                      (           IO.ASM):00028         
                      (           IO.ASM):00029         ; EXIT: KEYCODE IN [A]
                      (           IO.ASM):00030         
34ED                  (           IO.ASM):00031         BADKEY:
34ED BD360B           (           IO.ASM):00032                 JSR     BOOP                              ; RAZZ
34F0 2002             (           IO.ASM):00033                 BRA     GK                                ; AND TRY AGAIN
                      (           IO.ASM):00034         
34F2                  (           IO.ASM):00035         GETKEY:
34F2 3475             (           IO.ASM):00036                 PSHS    U,X,Y,B,CC                        ; SAVE THESE
                      (           IO.ASM):00037         
                      (           IO.ASM):00038         
34F4                  (           IO.ASM):00039         GK:
34F4 3F               (           IO.ASM):00040                 SWI
34F5 23               (           IO.ASM):00041                 FCB     35
34F6 2708             (           IO.ASM):00042                 BEQ     KTEST                             ; got a key
34F8 0C58             (           IO.ASM):00043                 INC     RAND1                             ; GENERATE RANDOMNESS
34FA 2602             (           IO.ASM):00044                 BNE     >
34FC 0C59             (           IO.ASM):00045                 INC     RAND2
                      (           IO.ASM):00046         !
34FE 20F4             (           IO.ASM):00047                 BRA     GK
3500                  (           IO.ASM):00048         KTEST:
3500 9755             (           IO.ASM):00049                 STA     IOCHAR                            ; STORE THE KEYPRESS
                      (           IO.ASM):00050         
                      (           IO.ASM):00051         
                      (           IO.ASM):00052         ; KEYCODE IN [A]
                      (           IO.ASM):00053         
3502                  (           IO.ASM):00054         QKEY:
3502 810D             (           IO.ASM):00055                 CMPA    #EOL                              ; "ENTER" IS FINE
3504 2718             (           IO.ASM):00056                 BEQ     CLICK
3506 8108             (           IO.ASM):00057                 CMPA    #BS                               ; SO IS "LEFT ARROW"
3508 2714             (           IO.ASM):00058                 BEQ     CLICK
                      (           IO.ASM):00059         
350A 8161             (           IO.ASM):00060                 CMPA    #$61                              ; LOWER-CASE ALPHA?
350C 2508             (           IO.ASM):00061                 BLO     PKICK                             ; NO, CHECK FOR OTHERS
350E 817B             (           IO.ASM):00062                 CMPA    #$7B                              ; NOTHING ABOVE "z" IS LEGAL
3510 24DB             (           IO.ASM):00063                 BHS     BADKEY
3512 8020             (           IO.ASM):00064                 SUBA    #$20                              ; CONVERT TO UPPER-CASE ALPHA
3514 2008             (           IO.ASM):00065                 BRA     CLICK
                      (           IO.ASM):00066         
3516                  (           IO.ASM):00067         PKICK:
3516 815B             (           IO.ASM):00068                 CMPA    #$5B                              ; NOTHING BETWEEN "Z" AND "a"
3518 24D3             (           IO.ASM):00069                 BHS     BADKEY                            ; IS LEGAL
351A 8120             (           IO.ASM):00070                 CMPA    #$20                              ; NOTHING BELOW "SPACE"
351C 25CF             (           IO.ASM):00071                 BLO     BADKEY                            ; IS LEGAL EITHER
                      (           IO.ASM):00072         
                      (           IO.ASM):00073         ; "CLICK" SOUND FOR KEYS
                      (           IO.ASM):00074         
351E                  (           IO.ASM):00075         CLICK:
351E 3575             (           IO.ASM):00076                 PULS    U,X,Y,B,CC                        ; RESTORE THINGS
3520 9655             (           IO.ASM):00077                 LDA     IOCHAR                            ; RETRIEVE THE KEYPRESS
3522 39               (           IO.ASM):00078                 RTS
                      (           IO.ASM):00079         
                      (           IO.ASM):00080         
                      (           IO.ASM):00081         ; DELAY FOR KEYCLICK
                      (           IO.ASM):00082         
3523                  (           IO.ASM):00083         CDELAY:
3523 8E0100           (           IO.ASM):00084                 LDX     #CFREQ
3526                  (           IO.ASM):00085         CDEL:
3526 301F             (           IO.ASM):00086                 LEAX    -1,X
3528 26FC             (           IO.ASM):00087                 BNE     CDEL
352A 39               (           IO.ASM):00088                 RTS
                      (           IO.ASM):00089         
                      (           IO.ASM):00090         ; -------------------
                      (           IO.ASM):00091         ; READ A LINE OF TEXT
                      (           IO.ASM):00092         ; -------------------
                      (           IO.ASM):00093         
                      (           IO.ASM):00094         ; ENTRY: [ARG1] HAS ADDRESS OF CHAR BUFFER
                      (           IO.ASM):00095         ;        LENGTH OF BUFFER IN 1ST BYTE
                      (           IO.ASM):00096         ; EXIT: # CHARS READ IN [A]
                      (           IO.ASM):00097         
352B                  (           IO.ASM):00098         INPUT:
352B 0F54             (           IO.ASM):00099                 CLR     LINCNT                            ; RESET LINE COUNTER
352D 9E02             (           IO.ASM):00100                 LDX     ARG1                              ; GET ADDRESS OF INPUT BUFFER
352F E680             (           IO.ASM):00101                 LDB     ,X+                               ; GET MAX # CHARS
3531 C002             (           IO.ASM):00102                 SUBB    #2                                ; LEAVE A MARGIN FOR ERROR
3533 D753             (           IO.ASM):00103                 STB     BINDEX                            ; SAVE MAX # CHARS
                      (           IO.ASM):00104         
3535 5F               (           IO.ASM):00105                 CLRB                                      ; RESET       INDEX
3536                  (           IO.ASM):00106         INLOOP:
3536 BD34F2           (           IO.ASM):00107                 JSR     GETKEY                            ; KEY IN [A] AND [IOCHAR]
3539 810D             (           IO.ASM):00108                 CMPA    #EOL                              ; IF EOL,
353B 2732             (           IO.ASM):00109                 BEQ     ENDLIN                            ; LINE IS DONE
353D 8108             (           IO.ASM):00110                 CMPA    #BS                               ; IF BACKSPACE,
353F 2725             (           IO.ASM):00111                 BEQ     GOBACK                            ; TAKE CARE OF IT
                      (           IO.ASM):00112         
3541 8141             (           IO.ASM):00113                 CMPA    #$41                              ; IF LOWER THAN ASCII "A,"
3543 2502             (           IO.ASM):00114                 BLO     SENDCH                            ; SEND THE CHARACTER
3545 8B20             (           IO.ASM):00115                 ADDA    #$20                              ; ELSE CONVERT TO LOWER-CASE
                      (           IO.ASM):00116         
3547                  (           IO.ASM):00117         SENDCH:
3547 A785             (           IO.ASM):00118                 STA     B,X                               ; SEND CHAR TO BUFFER
3549 5C               (           IO.ASM):00119                 INCB                                      ; UPDATE INDEX
354A                  (           IO.ASM):00120         TOSCR:
354A 9655             (           IO.ASM):00121                 LDA     IOCHAR                            ; RETRIEVE KEY CHAR
354C 8D44             (           IO.ASM):00122                 BSR     CHAR                              ; ECHO CHAR TO SCREEN
354E D153             (           IO.ASM):00123                 CMPB    BINDEX                            ; BUFFER FILLED?
3550 2404             (           IO.ASM):00124                 BHS     NOMORE                            ; YES -- INSIST ON BS OR EOL
3552 C13D             (           IO.ASM):00125                 CMPB    #61                               ; 2 SCREEN LINES FILLED?
3554 25E0             (           IO.ASM):00126                 BLO     INLOOP                            ; NO, KEEP GOING
                      (           IO.ASM):00127         
                      (           IO.ASM):00128         ; LINE FULL; INSIST ON EOL OR BACKSPACE
                      (           IO.ASM):00129         
3556                  (           IO.ASM):00130         NOMORE:
3556 BD34F2           (           IO.ASM):00131                 JSR     GETKEY                            ; GET NEXT KEY
3559 810D             (           IO.ASM):00132                 CMPA    #EOL                              ; IF EOL,
355B 2712             (           IO.ASM):00133                 BEQ     ENDLIN                            ; WE'RE FINE
355D 8108             (           IO.ASM):00134                 CMPA    #BS                               ; BACKSPACE
355F 2705             (           IO.ASM):00135                 BEQ     GOBACK                            ; IS OKAY TOO
3561 BD360B           (           IO.ASM):00136                 JSR     BOOP
3564 20F0             (           IO.ASM):00137                 BRA     NOMORE                            ; ELSE PERSIST
                      (           IO.ASM):00138         
                      (           IO.ASM):00139         ; HANDLE BACKSPACE
                      (           IO.ASM):00140         
3566                  (           IO.ASM):00141         GOBACK:
3566 5A               (           IO.ASM):00142                 DECB                                      ; BACK UP CHAR COUNT
3567 2AE1             (           IO.ASM):00143                 BPL     TOSCR                             ; SEND TO SCREEN IF NO UNDERFLOW
3569 5F               (           IO.ASM):00144                 CLRB                                      ; ELSE RESET COUNT
356A BD360B           (           IO.ASM):00145                 JSR     BOOP                              ; RAZZ
356D 20C7             (           IO.ASM):00146                 BRA     INLOOP                            ; AND TRY AGAIN
                      (           IO.ASM):00147         
                      (           IO.ASM):00148         ; HANDLE EOL
                      (           IO.ASM):00149         
356F                  (           IO.ASM):00150         ENDLIN:
356F A785             (           IO.ASM):00151                 STA     B,X                               ; PUT EOL IN BUFFER
3571 8D1F             (           IO.ASM):00152                 BSR     CHAR                              ; AND ON SCREEN
3573 5C               (           IO.ASM):00153                 INCB                                      ; UPDATE CHAR COUNT
3574 D753             (           IO.ASM):00154                 STB     BINDEX                            ; SAVE IT HERE
                      (           IO.ASM):00155         
                      (           IO.ASM):00156         ; FALL THROUGH TO ...
                      (           IO.ASM):00157         
                      (           IO.ASM):00158         ; ---------------------
                      (           IO.ASM):00159         ; SCRIPT A LINE OF TEXT
                      (           IO.ASM):00160         ; ---------------------
                      (           IO.ASM):00161         
                      (           IO.ASM):00162         ; ENTRY: ADDRESS OF TEXT IN [X]
                      (           IO.ASM):00163         ;        LENGTH OF LINE IN [BINDEX]
                      (           IO.ASM):00164         
3576                  (           IO.ASM):00165         TOPRIN:
3576 0D5E             (           IO.ASM):00166                 TST     SCRIPT                            ; SCRIPTING ENABLED?
3578 2714             (           IO.ASM):00167                 BEQ     INPEX                             ; NO, EXIT IMMEDIATELY
357A B63F11           (           IO.ASM):00168                 LDA     ZCODE+ZSCRIP+1                    ; GET FLAGS BYTE
357D 8401             (           IO.ASM):00169                 ANDA    #1                                ; BIT 0 SET?
357F 270D             (           IO.ASM):00170                 BEQ     INPEX                             ; NO, IGNORE THE FOLLOWING
                      (           IO.ASM):00171         ;        LDA     #$FE                              ; ELSE
                      (           IO.ASM):00172         ;        STA     DEVNUM                            ; POINT TO PRINTER
3581 D653             (           IO.ASM):00173                 LDB     BINDEX                            ; START AT 1ST BUFFER CHAR
                      (           IO.ASM):00174         
                      (           IO.ASM):00175         
3583                  (           IO.ASM):00176         SCROUT:
3583 A680             (           IO.ASM):00177                 LDA     ,X+                               ; GRAB A CHAR FROM BUFFER
3585 3477             (           IO.ASM):00178                 PSHS    A,B,X,Y,U,CC
3587 3F               (           IO.ASM):00179                 SWI
3588 21               (           IO.ASM):00180                 FCB     33                                ;DISPLAY
3589 3577             (           IO.ASM):00181                 PULS    A,B,X,Y,U,CC
358B 5A               (           IO.ASM):00182                 DECB
358C 26F5             (           IO.ASM):00183                 BNE     SCROUT
358E                  (           IO.ASM):00184         INPEX:
                      (           IO.ASM):00185         ;        CLR     DEVNUM                            ; POINT BACK TO SCREEN
358E 9653             (           IO.ASM):00186                 LDA     BINDEX                            ; RETRIEVE # CHARS IN LINE
3590 39               (           IO.ASM):00187                 RTS
                      (           IO.ASM):00188         
3591                  (           IO.ASM):00189         SFLAG
3591 00               (           IO.ASM):00190                 FCB     0                                 ; FLAG TO SAVE SCRIPT STATE
                      (           IO.ASM):00191         
                      (           IO.ASM):00192         
                      (           IO.ASM):00193         ; -------------------
                      (           IO.ASM):00194         ; PRINT A SINGLE CHAR
                      (           IO.ASM):00195         ; -------------------
                      (           IO.ASM):00196         
                      (           IO.ASM):00197         ; ENTRY: ASCII CODE IN [A]
                      (           IO.ASM):00198         
3592                  (           IO.ASM):00199         CHAR:
3592 9755             (           IO.ASM):00200                 STA     IOCHAR                            ; SAVE CHAR HERE
3594 810D             (           IO.ASM):00201                 CMPA    #$0D
3596 2707             (           IO.ASM):00202                 BEQ     >
3598 3477             (           IO.ASM):00203                 PSHS    A,B,X,Y,U,CC
359A 3F               (           IO.ASM):00204                 SWI
359B 21               (           IO.ASM):00205                 FCB     33
359C 3577             (           IO.ASM):00206                 PULS    A,B,X,Y,U,CC
359E 39               (           IO.ASM):00207                 RTS
                      (           IO.ASM):00208         !
359F 3477             (           IO.ASM):00209                 PSHS    A,B,X,Y,U,CC
35A1 3F               (           IO.ASM):00210                 SWI
35A2 21               (           IO.ASM):00211                 FCB     33
35A3 860A             (           IO.ASM):00212                 LDA     #$0A
35A5 3F               (           IO.ASM):00213                 SWI
35A6 21               (           IO.ASM):00214                 FCB     33
35A7 3577             (           IO.ASM):00215                 PULS    A,B,X,Y,U,CC
35A9 39               (           IO.ASM):00216                 RTS
                      (           IO.ASM):00217         
                      (           IO.ASM):00218         
                      (           IO.ASM):00219         
                      (           IO.ASM):00220         ; FALL THROUGH TO ...
                      (           IO.ASM):00221         
                      (           IO.ASM):00222         ; -------------
                      (           IO.ASM):00223         ; PRINT MESSAGE
                      (           IO.ASM):00224         ; -------------
                      (           IO.ASM):00225         
                      (           IO.ASM):00226         ; ENTRY: ADDRESS OF ASCII MESSAGE IN [X]
                      (           IO.ASM):00227         ;        LENGTH OF MESSAGE IN [B]
                      (           IO.ASM):00228         
35AA                  (           IO.ASM):00229         LINE:
35AA D753             (           IO.ASM):00230                 STB     BINDEX                            ; SAVE LENGTH
35AC 5F               (           IO.ASM):00231                 CLRB                                      ; INIT INDEX
                      (           IO.ASM):00232         
35AD                  (           IO.ASM):00233         LN:
35AD A685             (           IO.ASM):00234                 LDA     B,X                               ; GET A CHAR
35AF BD3592           (           IO.ASM):00235                 JSR     CHAR
35B2 5C               (           IO.ASM):00236                 INCB
35B3 D153             (           IO.ASM):00237                 CMPB    BINDEX
35B5 25F6             (           IO.ASM):00238                 BLO     LN
35B7 7E3576           (           IO.ASM):00239                 JMP     TOPRIN                            ; HANDLE SCRIPTING
                      (           IO.ASM):00240         
                      (           IO.ASM):00241         ; ----------------
                      (           IO.ASM):00242         ; CLEAR THE SCREEN
                      (           IO.ASM):00243         ; ----------------
                      (           IO.ASM):00244         
35BA                  (           IO.ASM):00245         CLS:
35BA 3477             (           IO.ASM):00246                 PSHS    A,B,X,Y,U,CC
35BC 3F               (           IO.ASM):00247                 SWI
35BD 18               (           IO.ASM):00248                 FCB     24                                ;String to OS
35BE 1B               (           IO.ASM):00249                 FCB     27
35BF 5B324A00         (           IO.ASM):00250                 FCN     '[2J'
35C3 3577             (           IO.ASM):00251                 PULS    A,B,X,Y,U,CC
35C5 39               (           IO.ASM):00252                 RTS
                      (           IO.ASM):00253         
                      (           IO.ASM):00254         
                      (           IO.ASM):00255         
35C6                  (           IO.ASM):00256         BOLD:
35C6 3477             (           IO.ASM):00257                 PSHS    A,B,X,Y,U,CC
35C8 3F               (           IO.ASM):00258                 SWI
35C9 18               (           IO.ASM):00259                 FCB     24                                ;String to OS
35CA 1B               (           IO.ASM):00260                 FCB     27
35CB 5B316D00         (           IO.ASM):00261                 FCN     '[1m'
35CF 3577             (           IO.ASM):00262                 PULS    A,B,X,Y,U,CC
35D1 39               (           IO.ASM):00263                 RTS
                      (           IO.ASM):00264         
35D2                  (           IO.ASM):00265         UNBOLD:
35D2 3477             (           IO.ASM):00266                 PSHS    A,B,X,Y,U,CC
35D4 3F               (           IO.ASM):00267                 SWI
35D5 18               (           IO.ASM):00268                 FCB     24                                ;String to OS
35D6 1B               (           IO.ASM):00269                 FCB     27
35D7 5B306D00         (           IO.ASM):00270                 FCN     '[0m'
35DB 3577             (           IO.ASM):00271                 PULS    A,B,X,Y,U,CC
35DD 39               (           IO.ASM):00272                 RTS
                      (           IO.ASM):00273         
35DE                  (           IO.ASM):00274         REVERSE:
35DE 3477             (           IO.ASM):00275                 PSHS    A,B,X,Y,U,CC
35E0 3F               (           IO.ASM):00276                 SWI
35E1 18               (           IO.ASM):00277                 FCB     24                                ;String to OS
35E2 1B               (           IO.ASM):00278                 FCB     27
35E3 5B376D00         (           IO.ASM):00279                 FCN     '[7m'
35E7 3577             (           IO.ASM):00280                 PULS    A,B,X,Y,U,CC
35E9 39               (           IO.ASM):00281                 RTS
                      (           IO.ASM):00282         
35EA                  (           IO.ASM):00283         HOME:
35EA 3477             (           IO.ASM):00284                 PSHS    A,B,X,Y,U,CC
35EC 3F               (           IO.ASM):00285                 SWI
35ED 18               (           IO.ASM):00286                 FCB     24                                ;String to OS
35EE 1B               (           IO.ASM):00287                 FCB     27
35EF 5B30303B30304800 (           IO.ASM):00288                 FCN     '[00;00H'
35F7 3577             (           IO.ASM):00289                 PULS    A,B,X,Y,U,CC
35F9 39               (           IO.ASM):00290                 RTS
                      (           IO.ASM):00291         
35FA                  (           IO.ASM):00292         MOVECURSOR:
35FA 3477             (           IO.ASM):00293                 PSHS    A,B,X,Y,U,CC
35FC 3F               (           IO.ASM):00294                 SWI
35FD 18               (           IO.ASM):00295                 FCB     24                                ;String to OS
35FE 1B               (           IO.ASM):00296                 FCB     27
35FF 5B32343B30324800 (           IO.ASM):00297                 FCN     '[24;02H'
3607 3577             (           IO.ASM):00298                 PULS    A,B,X,Y,U,CC
3609 39               (           IO.ASM):00299                 RTS
                      (           IO.ASM):00300         ; --------------
                      (           IO.ASM):00301         ; SOUND HANDLERS
                      (           IO.ASM):00302         ; --------------
                      (           IO.ASM):00303         
360A                  (           IO.ASM):00304         AINIT:
360A 39               (           IO.ASM):00305                 RTS
                      (           IO.ASM):00306         
                      (           IO.ASM):00307         ; DO THE RAZZ
360B                  (           IO.ASM):00308         BOOP:
                      (           IO.ASM):00309         
                      (           IO.ASM):00310         ; put sound boop here
                      (           IO.ASM):00311         
360B 39               (           IO.ASM):00312                 RTS
                      (           IO.ASM):00313         
                      (           IO.ASM):00314         ; TIME DELAY
                      (           IO.ASM):00315         
360C                  (           IO.ASM):00316         DELAY:
360C 8E1000           (           IO.ASM):00317                 LDX     #BFREQ                            ; INIT FREQUENCY
360F                  (           IO.ASM):00318         DELOOP:
360F 301F             (           IO.ASM):00319                 LEAX    -1,X
3611 26FC             (           IO.ASM):00320                 BNE     DELOOP
3613 39               (           IO.ASM):00321                 RTS
                      (           IO.ASM):00322         
                      (           IO.ASM):00323         ;-----------------------------------------------------------------------------
                      (     cubixzip.asm):00070                 INCLUDE SCREEN.ASM
                      (       SCREEN.ASM):00001         ;       PAGE
                      (       SCREEN.ASM):00002         ;       SBTTL "--- SCREEN & PRINTER I/O ---"
                      (       SCREEN.ASM):00003         
                      (       SCREEN.ASM):00004         ; ------------
                      (       SCREEN.ASM):00005         ; RESTART GAME
                      (       SCREEN.ASM):00006         ; ------------
                      (       SCREEN.ASM):00007         
3614                  (       SCREEN.ASM):00008         ZSTART:
3614 BD36DB           (       SCREEN.ASM):00009                 JSR     ZCRLF                             ; FLUSH OUTPUT BUFFER
3617 0F5E             (       SCREEN.ASM):00010                 CLR     SCRIPT                            ; DISABLE SCRIPTING [ASK 5/28/85]
                      (       SCREEN.ASM):00011         ;       JSR     ENTER           ; "PRESS ANY KEY TO CONTINUE"[ASK 5/28/85]
3619 B63F11           (       SCREEN.ASM):00012                 LDA     ZCODE+ZSCRIP+1
361C B73591           (       SCREEN.ASM):00013                 STA     SFLAG
361F 7E3624           (       SCREEN.ASM):00014                 JMP     LUKE                              ; SKIP SCRIPT DISABLE
                      (       SCREEN.ASM):00015         ; FALL THROUGH TO ...
                      (       SCREEN.ASM):00016         
                      (       SCREEN.ASM):00017         ; ---------
                      (       SCREEN.ASM):00018         ; COLDSTART
                      (       SCREEN.ASM):00019         ; ---------
                      (       SCREEN.ASM):00020         
3622                  (       SCREEN.ASM):00021         COLD:
3622 0F5E             (       SCREEN.ASM):00022                 CLR     SCRIPT                            ; DISABLE SCRIPTING
3624                  (       SCREEN.ASM):00023         LUKE:
3624 BD35BA           (       SCREEN.ASM):00024                 JSR     CLS                               ; A CLEAN SLATE
3627 BD35C6           (       SCREEN.ASM):00025                 JSR     BOLD
362A 8E363B           (       SCREEN.ASM):00026                 LDX     #LOADM                            ;
362D C621             (       SCREEN.ASM):00027                 LDB     #LOADML
362F BD39D4           (       SCREEN.ASM):00028                 JSR     DLINE                             ; "LOADING GAME ..."
3632 BD35D2           (       SCREEN.ASM):00029                 JSR     UNBOLD
3635 BD35FA           (       SCREEN.ASM):00030                 JSR     MOVECURSOR
3638 7E2800           (       SCREEN.ASM):00031                 JMP     START                             ; AND DO A WARMSTART
                      (       SCREEN.ASM):00032         
363B                  (       SCREEN.ASM):00033         LOADM:
363B 1B               (       SCREEN.ASM):00034                 FCB     27
363C 5B31303B31304820 (       SCREEN.ASM):00035                 FCC     "[10;10H "
3644 5448452053544F52 (       SCREEN.ASM):00036                 FCC     "THE STORY IS LOADING ..."
     59204953204C4F41
     44494E47202E2E2E
365C                  (       SCREEN.ASM):00037         loadlen:
     0021             (       SCREEN.ASM):00038         LOADML          EQU loadlen-LOADM
                      (       SCREEN.ASM):00039         
                      (       SCREEN.ASM):00040         ; -----
                      (       SCREEN.ASM):00041         ; ERROR
                      (       SCREEN.ASM):00042         ; -----
                      (       SCREEN.ASM):00043         
                      (       SCREEN.ASM):00044         ; ENTRY: ERROR CODE # IN [A]
                      (       SCREEN.ASM):00045         
365C                  (       SCREEN.ASM):00046         INTERR:
365C 0D               (       SCREEN.ASM):00047                 FCB     EOL
365D 494E5445524E414C (       SCREEN.ASM):00048                 FCC     "INTERNAL ERROR #"
     204552524F522023
366D                  (       SCREEN.ASM):00049         interrlen:
     0011             (       SCREEN.ASM):00050         IERRL           EQU interrlen-INTERR
                      (       SCREEN.ASM):00051         
366D                  (       SCREEN.ASM):00052         ZERROR:
366D 3402             (       SCREEN.ASM):00053                 PSHS    A                                 ; SAVE CODE #
366F BD36DB           (       SCREEN.ASM):00054                 JSR     ZCRLF                             ; FLUSH BUFFER
3672 8E365C           (       SCREEN.ASM):00055                 LDX     #INTERR
3675 C611             (       SCREEN.ASM):00056                 LDB     #IERRL
3677 BD35AA           (       SCREEN.ASM):00057                 JSR     LINE                              ; "INTERNAL ERROR #"
367A 3502             (       SCREEN.ASM):00058                 PULS    A                                 ; RETRIEVE CODE #
367C 9740             (       SCREEN.ASM):00059                 STA     TEMP+1
367E 0F3F             (       SCREEN.ASM):00060                 CLR     TEMP
3680 BD3006           (       SCREEN.ASM):00061                 JSR     NUMBER                            ; CONVERT ERROR CODE #
3683 BD3705           (       SCREEN.ASM):00062                 JSR     CR1                               ; AND SHOW IT
                      (       SCREEN.ASM):00063         
                      (       SCREEN.ASM):00064         ; FALL THROUGH TO ...
                      (       SCREEN.ASM):00065         
                      (       SCREEN.ASM):00066         ; ----
                      (       SCREEN.ASM):00067         ; QUIT
                      (       SCREEN.ASM):00068         ; ----
                      (       SCREEN.ASM):00069         
3686                  (       SCREEN.ASM):00070         ZQUIT:
3686 8E3692           (       SCREEN.ASM):00071                 LDX     #ENDSES
3689 C60F             (       SCREEN.ASM):00072                 LDB     #ENDSL
368B BD35AA           (       SCREEN.ASM):00073                 JSR     LINE                              ; "END OF SESSION"
                      (       SCREEN.ASM):00074         
368E 3F               (       SCREEN.ASM):00075                 SWI
368F 00               (       SCREEN.ASM):00076                 FCB     00
                      (       SCREEN.ASM):00077         
                      (       SCREEN.ASM):00078         
3690                  (       SCREEN.ASM):00079         FREEZE:
3690 20FE             (       SCREEN.ASM):00080                 BRA     FREEZE                            ; STOP DEAD
                      (       SCREEN.ASM):00081         
3692                  (       SCREEN.ASM):00082         ENDSES:
3692 454E44204F462053 (       SCREEN.ASM):00083                 FCC     "END OF SESSION"
     455353494F4E
36A0                  (       SCREEN.ASM):00084         VCODE:
36A0 0D               (       SCREEN.ASM):00085                 FCB     EOL                               ; SHARED EOL CHAR
36A1                  (       SCREEN.ASM):00086         endseslen:
     000F             (       SCREEN.ASM):00087         ENDSL           EQU endseslen-ENDSES
                      (       SCREEN.ASM):00088         
                      (       SCREEN.ASM):00089         ; --------------------------
                      (       SCREEN.ASM):00090         ; DISPLAY ZIP VERSION NUMBER
                      (       SCREEN.ASM):00091         ; --------------------------
                      (       SCREEN.ASM):00092         
36A1 3638303920435542 (       SCREEN.ASM):00093                 FCC     "6809 CUBIX VERSION"
     4958205645525349
     4F4E
36B3 0D               (       SCREEN.ASM):00094                 FCB     EOL
36B4                  (       SCREEN.ASM):00095         vcodelen:
     0014             (       SCREEN.ASM):00096         VCODEL          EQU vcodelen-VCODE
                      (       SCREEN.ASM):00097         
36B4                  (       SCREEN.ASM):00098         VERNUM:
36B4 8E36A0           (       SCREEN.ASM):00099                 LDX     #VCODE
36B7 C614             (       SCREEN.ASM):00100                 LDB     #VCODEL
36B9 7E35AA           (       SCREEN.ASM):00101                 JMP     LINE
                      (       SCREEN.ASM):00102         
                      (       SCREEN.ASM):00103         ; -----------------
                      (       SCREEN.ASM):00104         ; PRINT A CHARACTER
                      (       SCREEN.ASM):00105         ; -----------------
                      (       SCREEN.ASM):00106         
36BC                  (       SCREEN.ASM):00107         COUT:
36BC 810D             (       SCREEN.ASM):00108                 CMPA    #EOL                              ; IF THIS IS A CR,
36BE 271B             (       SCREEN.ASM):00109                 BEQ     ZCRLF                             ; HANDLE AS SUCH
36C0 7E34E6           (       SCREEN.ASM):00110                 JMP     OUTCHR
                      (       SCREEN.ASM):00111         
36C3                  (       SCREEN.ASM):00112         MORES:
36C3 5B6D6F72655D     (       SCREEN.ASM):00113                 FCC     "[more]"
36C9                  (       SCREEN.ASM):00114         morlen:
     0006             (       SCREEN.ASM):00115         MOREL           EQU morlen-MORES
36C9                  (       SCREEN.ASM):00116         MCLR:
36C9 080808080808     (       SCREEN.ASM):00117                 FCB     08,08,08,08,08,08
36CF 202020202020     (       SCREEN.ASM):00118                 FCC     "      "
36D5 080808080808     (       SCREEN.ASM):00119                 FCB     08,08,08,08,08,08
36DB                  (       SCREEN.ASM):00120         mclrlen:
     0012             (       SCREEN.ASM):00121         MCLRL           EQU mclrlen-MCLR
                      (       SCREEN.ASM):00122         
                      (       SCREEN.ASM):00123         
                      (       SCREEN.ASM):00124         ; ---------------
                      (       SCREEN.ASM):00125         ; CARRIAGE RETURN
                      (       SCREEN.ASM):00126         ; ---------------
                      (       SCREEN.ASM):00127         
36DB                  (       SCREEN.ASM):00128         ZCRLF:
36DB 0C54             (       SCREEN.ASM):00129                 INC     LINCNT                            ; NEW LINE GOING OUT
36DD 9654             (       SCREEN.ASM):00130                 LDA     LINCNT
36DF 810D             (       SCREEN.ASM):00131                 CMPA    #13                               ; 13 LINES SENT YET?
36E1 2522             (       SCREEN.ASM):00132                 BLO     CR1                               ; NO, KEEP GOING
                      (       SCREEN.ASM):00133         
                      (       SCREEN.ASM):00134         
36E3 860D             (       SCREEN.ASM):00135                 LDA     #$0D
36E5 BD3592           (       SCREEN.ASM):00136                 JSR     CHAR
                      (       SCREEN.ASM):00137         
36E8 BD35C6           (       SCREEN.ASM):00138                 JSR     BOLD
36EB 8E36C3           (       SCREEN.ASM):00139                 LDX     #MORES                            ; "[MORE]"
36EE C606             (       SCREEN.ASM):00140                 LDB     #MOREL
36F0 BD39D4           (       SCREEN.ASM):00141                 JSR     DLINE
36F3 BD35D2           (       SCREEN.ASM):00142                 JSR     UNBOLD
                      (       SCREEN.ASM):00143         
36F6 8D13             (       SCREEN.ASM):00144                 BSR     ZUSL                              ; UPDATE STATUS LINE
36F8 BD34F2           (       SCREEN.ASM):00145                 JSR     GETKEY                            ; GET A KEYPRESS
                      (       SCREEN.ASM):00146         
36FB 8E36C9           (       SCREEN.ASM):00147                 LDX     #MCLR                             ; CLEAR LINE
36FE C612             (       SCREEN.ASM):00148                 LDB     #MCLRL
3700 BD39D4           (       SCREEN.ASM):00149                 JSR     DLINE
                      (       SCREEN.ASM):00150         
3703 0F54             (       SCREEN.ASM):00151                 CLR     LINCNT                            ; RESET LINE COUNTER
                      (       SCREEN.ASM):00152         
3705                  (       SCREEN.ASM):00153         CR1:
3705 860D             (       SCREEN.ASM):00154                 LDA     #$0D
3707 BD3592           (       SCREEN.ASM):00155                 JSR     CHAR
370A 39               (       SCREEN.ASM):00156                 RTS                                       ; AND RETURN
                      (       SCREEN.ASM):00157         
                      (       SCREEN.ASM):00158         ; ------------------
                      (       SCREEN.ASM):00159         ; UPDATE STATUS LINE
                      (       SCREEN.ASM):00160         ; ------------------
                      (       SCREEN.ASM):00161         
370B                  (       SCREEN.ASM):00162         ZUSL:
370B 9651             (       SCREEN.ASM):00163                 LDA     CHRPNT                            ; SAVE ALL Z-STRING VARS
370D D62B             (       SCREEN.ASM):00164                 LDB     STBYTF
370F 109E2C           (       SCREEN.ASM):00165                 LDY     ZSTWRD
3712 3436             (       SCREEN.ASM):00166                 PSHS    X,Y,D
3714 961A             (       SCREEN.ASM):00167                 LDA     MPCH                              ; HIGH BIT OF MPC
3716 D653             (       SCREEN.ASM):00168                 LDB     BINDEX
3718 9E1B             (       SCREEN.ASM):00169                 LDX     MPCM                              ; LOW BYTES OF MPC
371A 109E29           (       SCREEN.ASM):00170                 LDY     CSTEMP                            ; TEMP & PERM TOGETHER!
371D 3436             (       SCREEN.ASM):00171                 PSHS    X,Y,D
                      (       SCREEN.ASM):00172         
                      (       SCREEN.ASM):00173         ; DISPLAY ROOM NAME
                      (       SCREEN.ASM):00174         
371F 0F51             (       SCREEN.ASM):00175                 CLR     CHRPNT                            ; RESET CHAR INDEX
3721 0F5E             (       SCREEN.ASM):00176                 CLR     SCRIPT                            ; DISABLE SCRIPTING
3723 BD35EA           (       SCREEN.ASM):00177                 JSR     HOME
3726 BD35DE           (       SCREEN.ASM):00178                 JSR     REVERSE
                      (       SCREEN.ASM):00179         
3729 8E004F           (       SCREEN.ASM):00180                 LDX     #79                               ;
                      (       SCREEN.ASM):00181         !
372C 8620             (       SCREEN.ASM):00182                 LDA     #SPACE                            ; PRINT A REVERSED LINE
372E BD36BC           (       SCREEN.ASM):00183                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
3731 301F             (       SCREEN.ASM):00184                 DEX
3733 26F7             (       SCREEN.ASM):00185                 BNE     <
3735 BD35EA           (       SCREEN.ASM):00186                 JSR     HOME
                      (       SCREEN.ASM):00187         
3738 8610             (       SCREEN.ASM):00188                 LDA     #$10                              ; GLOBAL VAR #0 (ROOM #)
373A BD29BF           (       SCREEN.ASM):00189                 JSR     VARGET
373D 9640             (       SCREEN.ASM):00190                 LDA     TEMP+1
373F BD2C81           (       SCREEN.ASM):00191                 JSR     PRNTDC                            ; GET SHORT DESC INTO [BUFFER]
                      (       SCREEN.ASM):00192         
3742 8620             (       SCREEN.ASM):00193                 LDA     #SPACE                            ; PRINT A SPACE
3744 BD36BC           (       SCREEN.ASM):00194                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
3747 8620             (       SCREEN.ASM):00195                 LDA     #SPACE                            ; PRINT A SPACE
3749 BD36BC           (       SCREEN.ASM):00196                 JSR     COUT                              ; TO SEPARATE THINGS (BM 12/6/84)
                      (       SCREEN.ASM):00197         
374C 8611             (       SCREEN.ASM):00198                 LDA     #$11                              ; FETCH GLOBAL VARIABLE
374E BD29BF           (       SCREEN.ASM):00199                 JSR     VARGET                            ; #1 (SCORE/HOURS)
3751 0D50             (       SCREEN.ASM):00200                 TST     TIMEFL                            ; TIME MODE?
3753 2607             (       SCREEN.ASM):00201                 BNE     PTIME                             ; YES IF NZ
                      (       SCREEN.ASM):00202         
                      (       SCREEN.ASM):00203         ; PRINT SCORE
                      (       SCREEN.ASM):00204         
3755 BD3006           (       SCREEN.ASM):00205                 JSR     NUMBER                            ; PRINT THE VALUE
3758 862F             (       SCREEN.ASM):00206                 LDA     #$2F                              ; ASCII SLASH
375A 2013             (       SCREEN.ASM):00207                 BRA     MOVEP
                      (       SCREEN.ASM):00208         
                      (       SCREEN.ASM):00209         ; PRINT TIME (HOURS)
                      (       SCREEN.ASM):00210         
375C                  (       SCREEN.ASM):00211         PTIME:
375C 9640             (       SCREEN.ASM):00212                 LDA     TEMP+1
375E 2602             (       SCREEN.ASM):00213                 BNE     PTIME1                            ; 00 IS REALLY 24
3760 8618             (       SCREEN.ASM):00214                 LDA     #24
3762                  (       SCREEN.ASM):00215         PTIME1:
3762 810C             (       SCREEN.ASM):00216                 CMPA    #12
3764 2F04             (       SCREEN.ASM):00217                 BLE     PTIME2                            ; IF HOURS IS GREATER THAN 12,
3766 800C             (       SCREEN.ASM):00218                 SUBA    #12                               ; CONVERT TO 12-HOUR TIME
3768 9740             (       SCREEN.ASM):00219                 STA     TEMP+1
376A                  (       SCREEN.ASM):00220         PTIME2:
376A BD3006           (       SCREEN.ASM):00221                 JSR     NUMBER                            ; SHOW HOURS VALUE
376D 863A             (       SCREEN.ASM):00222                 LDA     #$3A                              ; ASCII COLON
                      (       SCREEN.ASM):00223         
376F                  (       SCREEN.ASM):00224         MOVEP:
376F BD36BC           (       SCREEN.ASM):00225                 JSR     COUT                              ; SEND COLON (OR SLASH)
3772 8612             (       SCREEN.ASM):00226                 LDA     #$12                              ; GLOBAL VAR #2 (MOVES/MINUTES)
3774 BD29BF           (       SCREEN.ASM):00227                 JSR     VARGET
3777 0D50             (       SCREEN.ASM):00228                 TST     TIMEFL                            ; TIME MODE?
3779 272E             (       SCREEN.ASM):00229                 BEQ     PNUM                              ; NO, DO MOVES
                      (       SCREEN.ASM):00230         
                      (       SCREEN.ASM):00231         ; PRINT MINUTES
                      (       SCREEN.ASM):00232         
377B 9640             (       SCREEN.ASM):00233                 LDA     TEMP+1
377D 810A             (       SCREEN.ASM):00234                 CMPA    #10                               ; IF LESS THAN 10 MINUTES,
377F 2405             (       SCREEN.ASM):00235                 BHS     MOVEP1
3781 8630             (       SCREEN.ASM):00236                 LDA     #$30                              ; ADD ASCII ZERO FOR PADDING
3783 BD36BC           (       SCREEN.ASM):00237                 JSR     COUT
                      (       SCREEN.ASM):00238         
3786                  (       SCREEN.ASM):00239         MOVEP1:
3786 BD3006           (       SCREEN.ASM):00240                 JSR     NUMBER                            ; SHOW MINUTES
                      (       SCREEN.ASM):00241         
                      (       SCREEN.ASM):00242         ; PRINT "AM/PM"
                      (       SCREEN.ASM):00243         
3789 8620             (       SCREEN.ASM):00244                 LDA     #SPACE                            ; SEPARATE TIMING
378B BD36BC           (       SCREEN.ASM):00245                 JSR     COUT                              ; FROM "AM/PM"
378E 8611             (       SCREEN.ASM):00246                 LDA     #$11                              ; GLOBAL #1 AGAIN
3790 BD29BF           (       SCREEN.ASM):00247                 JSR     VARGET
3793 9640             (       SCREEN.ASM):00248                 LDA     TEMP+1
3795 810C             (       SCREEN.ASM):00249                 CMPA    #12                               ; PAST NOON?
3797 2404             (       SCREEN.ASM):00250                 BHS     USEPM                             ; YES, IT'S PM
3799 8641             (       SCREEN.ASM):00251                 LDA     #$41                              ; "A"
379B 2002             (       SCREEN.ASM):00252                 BRA     DOM
379D                  (       SCREEN.ASM):00253         USEPM:
379D 8650             (       SCREEN.ASM):00254                 LDA     #$50                              ; "P"
379F                  (       SCREEN.ASM):00255         DOM:
379F BD36BC           (       SCREEN.ASM):00256                 JSR     COUT
37A2 864D             (       SCREEN.ASM):00257                 LDA     #$4D                              ; "M"
37A4 BD36BC           (       SCREEN.ASM):00258                 JSR     COUT
37A7 2003             (       SCREEN.ASM):00259                 BRA     AHEAD                             ; DONE!
                      (       SCREEN.ASM):00260         
                      (       SCREEN.ASM):00261         ; PRINT # MOVES
                      (       SCREEN.ASM):00262         
37A9                  (       SCREEN.ASM):00263         PNUM:
37A9 BD3006           (       SCREEN.ASM):00264                 JSR     NUMBER                            ; SIMPLE, EH?
                      (       SCREEN.ASM):00265         
37AC                  (       SCREEN.ASM):00266         AHEAD:
37AC BD3705           (       SCREEN.ASM):00267                 JSR     CR1                               ; DUMP BUFFER
                      (       SCREEN.ASM):00268         
                      (       SCREEN.ASM):00269         
37AF 3536             (       SCREEN.ASM):00270                 PULS    X,Y,D                             ; RESTORE EVERYTHING
37B1 109F29           (       SCREEN.ASM):00271                 STY     CSTEMP
37B4 9F1B             (       SCREEN.ASM):00272                 STX     MPCM
37B6 D753             (       SCREEN.ASM):00273                 STB     BINDEX
37B8 971A             (       SCREEN.ASM):00274                 STA     MPCH
37BA 3536             (       SCREEN.ASM):00275                 PULS    X,Y,D
37BC 109F2C           (       SCREEN.ASM):00276                 STY     ZSTWRD
37BF D72B             (       SCREEN.ASM):00277                 STB     STBYTF
37C1 9751             (       SCREEN.ASM):00278                 STA     CHRPNT
37C3 035E             (       SCREEN.ASM):00279                 COM     SCRIPT                            ; RE-ENABLE SCRIPTING
37C5 0F1F             (       SCREEN.ASM):00280                 CLR     MPCFLG                            ; MPC NO LONGER VALID
37C7 BD35D2           (       SCREEN.ASM):00281                 JSR     UNBOLD
37CA BD35FA           (       SCREEN.ASM):00282                 JSR     MOVECURSOR
37CD 39               (       SCREEN.ASM):00283                 RTS
                      (     cubixzip.asm):00071                 INCLUDE DISK.ASM
                      (         DISK.ASM):00001         ;       PAGE
                      (         DISK.ASM):00002         ;       SBTTL "--- DISK I/O ---"
                      (         DISK.ASM):00003         
                      (         DISK.ASM):00004         
                      (         DISK.ASM):00005         ; ------------------------
                      (         DISK.ASM):00006         ; READ A Z-BLOCK FROM DISK
                      (         DISK.ASM):00007         ; ------------------------
                      (         DISK.ASM):00008         
                      (         DISK.ASM):00009         ; ENTRY: DRIVE # (0 OR 1) IN [DRIVE]
                      (         DISK.ASM):00010         ;        BLOCK # IN [DBLOCK]
                      (         DISK.ASM):00011         ;        BUFFER ADDRESS IN [DBUFF]
37CE                  (         DISK.ASM):00012         OPENGAMEDSK:
37CE 3F               (         DISK.ASM):00013                 SWI
37CF 0A               (         DISK.ASM):00014                 FCB     10
37D0 102600FB         (         DISK.ASM):00015                 LBNE    DERR2                             ; FILE ERROR
37D4 CEDC00           (         DISK.ASM):00016                 LDU     #INFCB                            ; OPEN FILE
37D7 3F               (         DISK.ASM):00017                 SWI
37D8 37               (         DISK.ASM):00018                 FCB     55
37D9 39               (         DISK.ASM):00019                 RTS
37DA                  (         DISK.ASM):00020         GETDSK:
37DA 3476             (         DISK.ASM):00021                 PSHS    X,Y,U,D                           ; SAVE VARIABLES
37DC CEDC00           (         DISK.ASM):00022                 LDU     #INFCB                            ; REWIND FILE
37DF 3F               (         DISK.ASM):00023                 SWI
37E0 3E               (         DISK.ASM):00024                 FCB     62
37E1 DC4C             (         DISK.ASM):00025                 LDD     DBLOCK                            ; GO TO DBLOCK POSITION
37E3 B73842           (         DISK.ASM):00026                 STA     DTEMP
                      (         DISK.ASM):00027         !
37E6 8100             (         DISK.ASM):00028                 CMPA    #$00                              ; HOW MANY BLOCKS OF $10000 DO WE NEED TO GET
37E8 2718             (         DISK.ASM):00029                 BEQ     GETDSK1                           ; NONE, SKIP
37EA CCFFFF           (         DISK.ASM):00030                 LDD     #$FFFF
37ED CEDC00           (         DISK.ASM):00031                 LDU     #INFCB                            ;
37F0 3F               (         DISK.ASM):00032                 SWI
37F1 3F               (         DISK.ASM):00033                 FCB     63
37F2 CC0001           (         DISK.ASM):00034                 LDD     #1
37F5 CEDC00           (         DISK.ASM):00035                 LDU     #INFCB                            ;
37F8 3F               (         DISK.ASM):00036                 SWI
37F9 3F               (         DISK.ASM):00037                 FCB     63
37FA 7A3842           (         DISK.ASM):00038                 DEC     DTEMP
37FD B63842           (         DISK.ASM):00039                 LDA     DTEMP
3800 20E4             (         DISK.ASM):00040                 BRA     <
3802                  (         DISK.ASM):00041         GETDSK1:
3802 DC4C             (         DISK.ASM):00042                 LDD     DBLOCK                            ; HOW MANY BLOCKS OF <$10000 DO WE NEED TO GET
3804 1F98             (         DISK.ASM):00043                 TFR     B,A
3806 C600             (         DISK.ASM):00044                 LDB     #$00
3808 CEDC00           (         DISK.ASM):00045                 LDU     #INFCB                            ;
380B 3F               (         DISK.ASM):00046                 SWI
380C 3F               (         DISK.ASM):00047                 FCB     63
380D 3F               (         DISK.ASM):00048                 SWI
380E 3B               (         DISK.ASM):00049                 FCB     59
                      (         DISK.ASM):00050         ; READ 256 BYTES
380F DC4C             (         DISK.ASM):00051                 LDD     DBLOCK
3811 C401             (         DISK.ASM):00052                 ANDB    #01
3813 1F98             (         DISK.ASM):00053                 TFR     B,A
3815 C600             (         DISK.ASM):00054                 LDB     #$00
3817 F73842           (         DISK.ASM):00055                 STB     DTEMP
381A C3DC0A           (         DISK.ASM):00056                 ADDD    #INFCB+10
381D 1F02             (         DISK.ASM):00057                 TFR     D,Y                               ; D SHOULD CONTAIN START ADDRESS IN BUFFER
                      (         DISK.ASM):00058         !
381F 1F21             (         DISK.ASM):00059                 TFR     Y,X
3821 A680             (         DISK.ASM):00060                 LDA     ,X+                               ; GET BYTE
3823 1F12             (         DISK.ASM):00061                 TFR     X,Y
3825 9E4A             (         DISK.ASM):00062                 LDX     DBUFF
3827 A784             (         DISK.ASM):00063                 STA     ,X
3829 0C4B             (         DISK.ASM):00064                 INC     DBUFF+1
382B 2602             (         DISK.ASM):00065                 BNE     BUFINC
382D 0C4A             (         DISK.ASM):00066                 INC     DBUFF
382F                  (         DISK.ASM):00067         BUFINC:
382F 7A3842           (         DISK.ASM):00068                 DEC     DTEMP
3832 F63842           (         DISK.ASM):00069                 LDB     DTEMP
3835 C100             (         DISK.ASM):00070                 CMPB    #$00
3837 26E6             (         DISK.ASM):00071                 BNE     <
3839 0C4D             (         DISK.ASM):00072                 INC     DBLOCK+1                          ; POINT TO NEXT Z-BLOCK
383B 2602             (         DISK.ASM):00073                 BNE     REND
383D 0C4C             (         DISK.ASM):00074                 INC     DBLOCK
383F                  (         DISK.ASM):00075         REND:
383F 3576             (         DISK.ASM):00076                 PULS    X,Y,U,D                           ; RESTORE VARIABLES
                      (         DISK.ASM):00077         ;        STX     VAL
                      (         DISK.ASM):00078         ;        STD     TEMP
3841 39               (         DISK.ASM):00079                 RTS
                      (         DISK.ASM):00080         
3842                  (         DISK.ASM):00081         DTEMP
3842 00               (         DISK.ASM):00082                 FCB     00
                      (         DISK.ASM):00083         
                      (         DISK.ASM):00084         
                      (         DISK.ASM):00085         ; -----------------
                      (         DISK.ASM):00086         ; SAVE/RESTORE INIT
                      (         DISK.ASM):00087         ; -----------------
                      (         DISK.ASM):00088         
3843                  (         DISK.ASM):00089         SAVRES:
3843 BD36DB           (         DISK.ASM):00090                 JSR     ZCRLF                             ; FLUSH OUTPUT BUFFER
3846 BD35BA           (         DISK.ASM):00091                 JSR     CLS
3849 0F5E             (         DISK.ASM):00092                 CLR     SCRIPT                            ; DISABLE SCRIPTING
384B 39               (         DISK.ASM):00093                 RTS
                      (         DISK.ASM):00094         
                      (         DISK.ASM):00095         ; ---------
                      (         DISK.ASM):00096         ; SAVE GAME
                      (         DISK.ASM):00097         ; ---------
                      (         DISK.ASM):00098         
384C                  (         DISK.ASM):00099         ZSAVE:
384C 8DF5             (         DISK.ASM):00100                 BSR     SAVRES                            ; INIT THINGS
                      (         DISK.ASM):00101         
384E 18               (         DISK.ASM):00102                 FCB     24                                ;String to OS
384F 0D               (         DISK.ASM):00103                 FCB     13
3850 454E544552204649 (         DISK.ASM):00104                 FCN     'ENTER FILENAME:'
     4C454E414D453A00
3860 3F               (         DISK.ASM):00105                 SWI
3861 03               (         DISK.ASM):00106                 FCB     3                                 ; GET FILENAME
3862 3F               (         DISK.ASM):00107                 SWI
3863 09               (         DISK.ASM):00108                 FCB     9
3864 9653             (         DISK.ASM):00109                 LDA     'S'
3866 A780             (         DISK.ASM):00110                 STA     ,X+
3868 9641             (         DISK.ASM):00111                 LDA     'A'
386A A780             (         DISK.ASM):00112                 STA     ,X+
386C 9656             (         DISK.ASM):00113                 LDA     'V'
386E A780             (         DISK.ASM):00114                 STA     ,X+
3870 CED000           (         DISK.ASM):00115                 LDU     #SAVFCB                           ; OPEN FILE FOR WRITE/CREATE
3873 3F               (         DISK.ASM):00116                 SWI
3874 47               (         DISK.ASM):00117                 FCB     71
                      (         DISK.ASM):00118         
3875 8E3A04           (         DISK.ASM):00119                 LDX     #SING
3878 C607             (         DISK.ASM):00120                 LDB     #SINGL
387A BD39D4           (         DISK.ASM):00121                 JSR     DLINE                             ; "SAVING"
                      (         DISK.ASM):00122         
387D 8E2740           (         DISK.ASM):00123                 LDX     #BUFSAV                           ; POINT TO AUX BUFFER
3880 FC3F02           (         DISK.ASM):00124                 LDD     ZCODE+ZID                         ; GET GAME ID CODE
3883 ED81             (         DISK.ASM):00125                 STD     ,X++                              ; SAVE IN BUFFER
3885 DC27             (         DISK.ASM):00126                 LDD     OZSTAK                            ; OLD STACK POINTER
3887 ED81             (         DISK.ASM):00127                 STD     ,X++
3889 EF81             (         DISK.ASM):00128                 STU     ,X++                              ; AND CURRENT STACK POINTER
388B 9613             (         DISK.ASM):00129                 LDA     ZPCH                              ; HI BYTE OF ZPC
388D A780             (         DISK.ASM):00130                 STA     ,X+
388F DC14             (         DISK.ASM):00131                 LDD     ZPCM                              ; LOW ZPC BYTES
3891 ED84             (         DISK.ASM):00132                 STD     ,X
                      (         DISK.ASM):00133         
3893 8E2700           (         DISK.ASM):00134                 LDX     #LOCALS                           ; (SAVE 512 BYTES -- MORE THAN NEEDED, BUT  . . .)
3896 CED000           (         DISK.ASM):00135                 LDU     #SAVFCB
3899 3F               (         DISK.ASM):00136                 SWI
389A 3C               (         DISK.ASM):00137                 FCB     60
                      (         DISK.ASM):00138         
389B 8E2300           (         DISK.ASM):00139                 LDX     #ZSTACK                           ; SAVE CONTENTS OF STACK (512 BYTES)
389E CED000           (         DISK.ASM):00140                 LDU     #SAVFCB
38A1 3F               (         DISK.ASM):00141                 SWI
38A2 3C               (         DISK.ASM):00142                 FCB     60
                      (         DISK.ASM):00143         
                      (         DISK.ASM):00144         ; SAVE GAME PRELOAD
                      (         DISK.ASM):00145         
38A3 8E3F00           (         DISK.ASM):00146                 LDX     #ZCODE                            ; START OF PRELOAD
38A6 B63F0E           (         DISK.ASM):00147                 LDA     ZCODE+ZPURBT                      ; SIZE OF PRELOAD (MSB, # PAGES)
38A9 1CFE             (         DISK.ASM):00148                 CLC                                       ; DIVIDE BY 2
38AB 46               (         DISK.ASM):00149                 RORA                                      ;
38AC 4C               (         DISK.ASM):00150                 INCA                                      ; ROUND UP
38AD 973F             (         DISK.ASM):00151                 STA     TEMP                              ; USE [TEMP] AS INDEX
                      (         DISK.ASM):00152         
38AF                  (         DISK.ASM):00153         LSAVE:
38AF 3410             (         DISK.ASM):00154                 PSHS    X
38B1 CED000           (         DISK.ASM):00155                 LDU     #SAVFCB
38B4 3F               (         DISK.ASM):00156                 SWI
38B5 3C               (         DISK.ASM):00157                 FCB     60
38B6 3510             (         DISK.ASM):00158                 PULS    X
38B8 1F10             (         DISK.ASM):00159                 TFR     X,D
38BA C30200           (         DISK.ASM):00160                 ADDD    #$200
38BD 1F01             (         DISK.ASM):00161                 TFR     D,X
38BF 0A3F             (         DISK.ASM):00162                 DEC     TEMP                              ; SAVED ENTIRE PRELOAD YET?
38C1 26EC             (         DISK.ASM):00163                 BNE     LSAVE                             ; NO, KEEP SAVING
38C3 CED000           (         DISK.ASM):00164                 LDU     #SAVFCB
38C6 3F               (         DISK.ASM):00165                 SWI
38C7 39               (         DISK.ASM):00166                 FCB     57                                ; CLOSE FILE
38C8 7E39B3           (         DISK.ASM):00167                 JMP     RESUME
                      (         DISK.ASM):00168         
                      (         DISK.ASM):00169         ; *** ERROR #12: DISK ADDRESS RANGE ***
                      (         DISK.ASM):00170         
38CB                  (         DISK.ASM):00171         DSKERR:
38CB 860C             (         DISK.ASM):00172                 LDA     #12
38CD 2002             (         DISK.ASM):00173                 BRA     DSKEX
                      (         DISK.ASM):00174         
                      (         DISK.ASM):00175         ; *** ERROR #14: DISK ACCESS ***
                      (         DISK.ASM):00176         
38CF                  (         DISK.ASM):00177         DERR2:
38CF 860E             (         DISK.ASM):00178                 LDA     #14
38D1                  (         DISK.ASM):00179         DSKEX:
38D1 BD366D           (         DISK.ASM):00180                 JSR     ZERROR
                      (         DISK.ASM):00181         
                      (         DISK.ASM):00182         ; ------------
                      (         DISK.ASM):00183         ; RESTORE GAME
                      (         DISK.ASM):00184         ; ------------
                      (         DISK.ASM):00185         
38D4                  (         DISK.ASM):00186         ZREST:
38D4 BD3843           (         DISK.ASM):00187                 JSR     SAVRES
                      (         DISK.ASM):00188         
38D7 18               (         DISK.ASM):00189                 FCB     24                                ;String to OS
38D8 0D               (         DISK.ASM):00190                 FCB     13
38D9 454E544552204649 (         DISK.ASM):00191                 FCN     'ENTER FILENAME:'
     4C454E414D453A00
38E9 3F               (         DISK.ASM):00192                 SWI
38EA 03               (         DISK.ASM):00193                 FCB     3                                 ; GET FILENAME
38EB 3F               (         DISK.ASM):00194                 SWI
38EC 09               (         DISK.ASM):00195                 FCB     9
38ED 9653             (         DISK.ASM):00196                 LDA     'S'
38EF A780             (         DISK.ASM):00197                 STA     ,X+
38F1 9641             (         DISK.ASM):00198                 LDA     'A'
38F3 A780             (         DISK.ASM):00199                 STA     ,X+
38F5 9656             (         DISK.ASM):00200                 LDA     'V'
38F7 A780             (         DISK.ASM):00201                 STA     ,X+
38F9 2718             (         DISK.ASM):00202                 BEQ     >                                 ; NO FILE ERROR
38FB 18               (         DISK.ASM):00203                 FCB     24                                ;String to OS
38FC 0D               (         DISK.ASM):00204                 FCB     13
38FD 554E41424C452054 (         DISK.ASM):00205                 FCN     'UNABLE TO RESTORE.'
     4F20524553544F52
     452E00
3910 7E38CB           (         DISK.ASM):00206                 JMP     DSKERR
                      (         DISK.ASM):00207         !
3913 CED000           (         DISK.ASM):00208                 LDU     #SAVFCB                           ; OPEN FILE
3916 3F               (         DISK.ASM):00209                 SWI
3917 37               (         DISK.ASM):00210                 FCB     55
3918 3F               (         DISK.ASM):00211                 SWI
3919 3B               (         DISK.ASM):00212                 FCB     59
391A 8E3A0B           (         DISK.ASM):00213                 LDX     #RING
391D C60A             (         DISK.ASM):00214                 LDB     #RINGL
391F BD39D4           (         DISK.ASM):00215                 JSR     DLINE                             ; "RESTORING"
                      (         DISK.ASM):00216         
                      (         DISK.ASM):00217         ; SAVE LOCALS ON MACHINE STACK
                      (         DISK.ASM):00218         ; IN CASE OF ERROR
                      (         DISK.ASM):00219         
3922 8E2700           (         DISK.ASM):00220                 LDX     #LOCALS                           ; POINT TO LOCALS STORAGE
3925 9F4A             (         DISK.ASM):00221                 STX     DBUFF                             ; POINT TO 1ST PAGE TO RESTORE
3927                  (         DISK.ASM):00222         LOCLP:
3927 EC81             (         DISK.ASM):00223                 LDD     ,X++                              ; GRAB A LOCAL
3929 3406             (         DISK.ASM):00224                 PSHS    D                                 ; AND PUSH IT
392B 8C271E           (         DISK.ASM):00225                 CMPX    #LOCALS+30                        ; SAVED 15 LOCALS YET?
392E 25F7             (         DISK.ASM):00226                 BLO     LOCLP                             ; NO, KEEP PUSHING
                      (         DISK.ASM):00227         
3930 8ED00A           (         DISK.ASM):00228                 LDX     #SAVFCB+10                        ; RETRIEVE LOCALS/BUFFER PAGE
3933 108E2700         (         DISK.ASM):00229                 LDY     #LOCALS
3937 C600             (         DISK.ASM):00230                 LDB     #00
                      (         DISK.ASM):00231         !
3939 A680             (         DISK.ASM):00232                 LDA     ,X+
393B A7A0             (         DISK.ASM):00233                 STA     ,Y+
393D 5C               (         DISK.ASM):00234                 INCB
393E 26F9             (         DISK.ASM):00235                 BNE     <
                      (         DISK.ASM):00236         
3940 FC2740           (         DISK.ASM):00237                 LDD     BUFSAV                            ; READ SAVED GAME ID
3943 10B33F02         (         DISK.ASM):00238                 CMPD    ZCODE+ZID                         ; IF IT MATCHES CURRENT GAME ID,
3947 2711             (         DISK.ASM):00239                 BEQ     VERSOK                            ; PROCEED WITH THE RESTORE
                      (         DISK.ASM):00240         
                      (         DISK.ASM):00241         ; WRONG SAVE DISK, ABORT RESTORE
                      (         DISK.ASM):00242         
3949 8E271E           (         DISK.ASM):00243                 LDX     #LOCALS+30                        ; RESTORE PUSHED LOCALS
394C                  (         DISK.ASM):00244         RESLP:
394C 3506             (         DISK.ASM):00245                 PULS    D
394E ED83             (         DISK.ASM):00246                 STD     ,--X
3950 8C2700           (         DISK.ASM):00247                 CMPX    #LOCALS
3953 22F7             (         DISK.ASM):00248                 BHI     RESLP
3955                  (         DISK.ASM):00249         ERRWP:
3955 8D61             (         DISK.ASM):00250                 BSR     TOBOOT                            ; PROMPT FOR GAME DISK
3957 7E2A41           (         DISK.ASM):00251                 JMP     PREDF                             ; PREDICATE FAILS
                      (         DISK.ASM):00252         
395A                  (         DISK.ASM):00253         VERSOK:
395A CC0200           (         DISK.ASM):00254                 LDD     #$200                             ; begin game load
395D CED000           (         DISK.ASM):00255                 LDU     #SAVFCB
3960 3F               (         DISK.ASM):00256                 SWI
3961 40               (         DISK.ASM):00257                 FCB     64
                      (         DISK.ASM):00258         
3962 32E81E           (         DISK.ASM):00259                 LEAS    +30,S                             ; POP OLD LOCALS OFF STACK
3965 FC3F10           (         DISK.ASM):00260                 LDD     ZCODE+ZSCRIP
3968 DD3D             (         DISK.ASM):00261                 STD     VAL                               ; SAVE FLAGS
                      (         DISK.ASM):00262         
396A 8E2300           (         DISK.ASM):00263                 LDX     #ZSTACK                           ; RETRIEVE
396D DD4A             (         DISK.ASM):00264                 STD     DBUFF                             ; CONTENTS OF Z-STACK (512 bytes)
396F CED000           (         DISK.ASM):00265                 LDU     #SAVFCB
3972 3F               (         DISK.ASM):00266                 SWI
3973 3A               (         DISK.ASM):00267                 FCB     58
                      (         DISK.ASM):00268         
3974                  (         DISK.ASM):00269         DOREST:
3974 8E3F00           (         DISK.ASM):00270                 LDX     #ZCODE                            ; NOW RETRIEVE
3977 DD4A             (         DISK.ASM):00271                 STD     DBUFF                             ; 1ST TWO PAGES OF PRELOAD
3979 CED000           (         DISK.ASM):00272                 LDU     #SAVFCB
397C 3F               (         DISK.ASM):00273                 SWI
397D 3A               (         DISK.ASM):00274                 FCB     58
                      (         DISK.ASM):00275         
397E B63F0E           (         DISK.ASM):00276                 LDA     ZCODE+ZPURBT                      ; DETERMINE # PAGES
3981 1CFE             (         DISK.ASM):00277                 CLC
3983 46               (         DISK.ASM):00278                 RORA
3984 4C               (         DISK.ASM):00279                 INCA
3985 973F             (         DISK.ASM):00280                 STA     TEMP                              ; TO RETRIEVE
                      (         DISK.ASM):00281         
3987                  (         DISK.ASM):00282         LREST:
3987 3410             (         DISK.ASM):00283                 PSHS    X
3989 CED000           (         DISK.ASM):00284                 LDU     #SAVFCB
398C 3F               (         DISK.ASM):00285                 SWI
398D 3A               (         DISK.ASM):00286                 FCB     58
398E 3510             (         DISK.ASM):00287                 PULS    X
3990 1F10             (         DISK.ASM):00288                 TFR     X,D
3992 C30200           (         DISK.ASM):00289                 ADDD    #$200
3995 1F01             (         DISK.ASM):00290                 TFR     D,X
3997 0A3F             (         DISK.ASM):00291                 DEC     TEMP
3999 26EC             (         DISK.ASM):00292                 BNE     LREST
                      (         DISK.ASM):00293         
                      (         DISK.ASM):00294         ; RESTORE STATE OF SAVED GAME
                      (         DISK.ASM):00295         
399B 8E2742           (         DISK.ASM):00296                 LDX     #BUFSAV+2                         ; POINT TO SAVED VARIABLES
399E EC81             (         DISK.ASM):00297                 LDD     ,X++
39A0 DD27             (         DISK.ASM):00298                 STD     OZSTAK                            ; RESTORE OLD STACK POINTERS
39A2 EE81             (         DISK.ASM):00299                 LDU     ,X++
39A4 A680             (         DISK.ASM):00300                 LDA     ,X+
39A6 9713             (         DISK.ASM):00301                 STA     ZPCH                              ; HIGH BYTE OF ZPC
39A8 EC84             (         DISK.ASM):00302                 LDD     ,X                                ; LOW BYTES OF ZPC
39AA DD14             (         DISK.ASM):00303                 STD     ZPCM
39AC 0F18             (         DISK.ASM):00304                 CLR     ZPCFLG                            ; PC HAS CHANGED!
                      (         DISK.ASM):00305         
39AE DC3D             (         DISK.ASM):00306                 LDD     VAL                               ; RESTORE FLAGS
39B0 FD3F10           (         DISK.ASM):00307                 STD     ZCODE+ZSCRIP
                      (         DISK.ASM):00308         
                      (         DISK.ASM):00309         ; RESUME GAME AFTER SAVE OR RESTORE
                      (         DISK.ASM):00310         
39B3                  (         DISK.ASM):00311         RESUME:
39B3 8D03             (         DISK.ASM):00312                 BSR     TOBOOT                            ; PROMPT FOR GAME DISK
39B5 7E2A4F           (         DISK.ASM):00313                 JMP     PREDS                             ; PREDICATE SUCCEEDS
                      (         DISK.ASM):00314         
39B8                  (         DISK.ASM):00315         TOBOOT:
39B8 BD39C0           (         DISK.ASM):00316                 JSR     ENTER                             ; "PRESS <ENTER> TO CONTINUE"
39BB 035E             (         DISK.ASM):00317                 COM     SCRIPT                            ; RE-ENABLE SCRIPTING
39BD 7E35BA           (         DISK.ASM):00318                 JMP     CLS                               ; CLEAR SCREEN AND RETURN
                      (         DISK.ASM):00319         
                      (         DISK.ASM):00320         ; ---------------------------
                      (         DISK.ASM):00321         ; "PRESS <ENTER> TO CONTINUE"
                      (         DISK.ASM):00322         ; ---------------------------
                      (         DISK.ASM):00323         
39C0                  (         DISK.ASM):00324         ENTER:
39C0 8E39E8           (         DISK.ASM):00325                 LDX     #PRESS
39C3 C61C             (         DISK.ASM):00326                 LDB     #PRESSL
39C5 D75D             (         DISK.ASM):00327                 STB     CFLAG                             ; ENABLE CURSOR
39C7 BD35AA           (         DISK.ASM):00328                 JSR     LINE                              ; "PRESS <ENTER> TO CONTINUE"
39CA BD34F2           (         DISK.ASM):00329                 JSR     GETKEY                            ; GET A KEY
39CD 0F5D             (         DISK.ASM):00330                 CLR     CFLAG                             ; DISABLE CURSOR
39CF 860D             (         DISK.ASM):00331                 LDA     #EOL
39D1 7E36BC           (         DISK.ASM):00332                 JMP     COUT                              ; DO EOL AND RETURN
                      (         DISK.ASM):00333         
                      (         DISK.ASM):00334         
                      (         DISK.ASM):00335         
                      (         DISK.ASM):00336         ; FALL THROUGH TO ...
                      (         DISK.ASM):00337         
                      (         DISK.ASM):00338         ; --------------------
                      (         DISK.ASM):00339         ; DIRECT SCREEN OUTPUT
                      (         DISK.ASM):00340         ; --------------------
                      (         DISK.ASM):00341         
                      (         DISK.ASM):00342         ; ENTRY: SAME AS "LINE" ROUTINE
                      (         DISK.ASM):00343         
39D4                  (         DISK.ASM):00344         DLINE:
39D4 A680             (         DISK.ASM):00345                 LDA     ,X+
39D6 BD34E6           (         DISK.ASM):00346                 JSR     OUTCHR
39D9 5A               (         DISK.ASM):00347                 DECB
39DA 26F8             (         DISK.ASM):00348                 BNE     DLINE
39DC 39               (         DISK.ASM):00349                 RTS
                      (         DISK.ASM):00350         
                      (         DISK.ASM):00351         
                      (         DISK.ASM):00352         ; ---------------------
                      (         DISK.ASM):00353         ; TEXT FOR SAVE/RESTORE
                      (         DISK.ASM):00354         ; ---------------------
                      (         DISK.ASM):00355         
39DD                  (         DISK.ASM):00356         RES:
39DD 524553544F5245   (         DISK.ASM):00357                 FCC     "RESTORE"
39E4                  (         DISK.ASM):00358         reslen:
     0007             (         DISK.ASM):00359         RESL            EQU reslen-RES
                      (         DISK.ASM):00360         
39E4                  (         DISK.ASM):00361         SAV:
39E4 53415645         (         DISK.ASM):00362                 FCC     "SAVE"
39E8                  (         DISK.ASM):00363         savlen:
     0004             (         DISK.ASM):00364         SAVL            EQU savlen-SAV
                      (         DISK.ASM):00365         
                      (         DISK.ASM):00366         
39E8                  (         DISK.ASM):00367         PRESS:
39E8 5052455353203C45 (         DISK.ASM):00368                 FCC     "PRESS <ENTER> TO CONTINUE."
     4E5445523E20544F
     20434F4E54494E55
     452E
3A02 0D               (         DISK.ASM):00369                 FCB     EOL
3A03 3E               (         DISK.ASM):00370                 FCC     ">"
3A04                  (         DISK.ASM):00371         presslen:
     001C             (         DISK.ASM):00372         PRESSL          EQU presslen-PRESS
                      (         DISK.ASM):00373         
                      (         DISK.ASM):00374         
3A04                  (         DISK.ASM):00375         SING:
3A04 0D               (         DISK.ASM):00376                 FCB     EOL
3A05 534156494E47     (         DISK.ASM):00377                 FCC     "SAVING"
3A0B                  (         DISK.ASM):00378         sinlen:
     0007             (         DISK.ASM):00379         SINGL           EQU sinlen-SING
                      (         DISK.ASM):00380         
3A0B                  (         DISK.ASM):00381         RING:
3A0B 0D               (         DISK.ASM):00382                 FCB     EOL
3A0C 524553544F52494E (         DISK.ASM):00383                 FCC     "RESTORING"
     47
3A15                  (         DISK.ASM):00384         ringlen:
     000A             (         DISK.ASM):00385         RINGL           EQU ringlen-RING
                      (         DISK.ASM):00386         
3A15                  (         DISK.ASM):00387         ENDTST:
3A15 454E44           (         DISK.ASM):00388                 FCC     "END"
                      (     cubixzip.asm):00072         
                      (     cubixzip.asm):00073         ;TITLE "ZIP/6809-B INFOCOM, INC."
                      (     cubixzip.asm):00074                 IF      DEBUG
                      (     cubixzip.asm):00075                     INCLUDE BUGGER.ASM
                      (     cubixzip.asm):00076                 ENDIF
                      (     cubixzip.asm):00077         
                      (     cubixzip.asm):00078                 END

Symbol Table:
[ G] ABSVAL                           2ECF
[ G] ABTEMP                           2ED6
[ G] AHEAD                            37AC
[ G] AINIT                            360A
[ G] ARG1                             0002
[ G] ARG2                             0004
[ G] ARG3                             0006
[ G] ARG4                             0008
[ G] ARGCNT                           0001
[ G] BADKEY                           34ED
[ G] BADOP1                           2955
[ G] BADOP2                           29A3
[ G] BFREQ                            1000
[ G] BINDEX                           0053
[ G] BLINK                            005C
[ G] BOLD                             35C6
[ G] BOOP                             360B
[ G] BRKTBL                           3182
[ G] BS                               0008
[ G] BUFINC                           382F
[ G] BUFSAV                           2740
[ G] CDEL                             3526
[ G] CDELAY                           3523
[ G] CEXIT                            2D1A
[ G] CFLAG                            005D
[ G] CFREQ                            0100
[ G] CHAR                             3592
[ G] CHRPNT                           0051
[ G] CHRTBL                           345A
[ G] CLICK                            351E
[ G] CLS                              35BA
[ G] CNLOOP                           3413
[ G] CNOK                             341B
[ G] CNZS2M                           340E
[ G] CNZSC1                           33D4
[ G] CNZSC3                           33DC
[ G] CNZSL1                           338F
[ G] CNZSL2                           33A0
[ G] CNZSLC                           33B9
[ G] CNZSLE                           343D
[ G] CNZSLO                           33C5
[ G] COLD                             3622
[ G] CONZST                           337F
[ G] COUT                             36BC
[ G] CPSAV                            0052
[ G] CR1                              3705
[ G] CSPERM                           002A
[ G] CSTEMP                           0029
[ G] CYCLE                            005A
[ G] DBLOCK                           004C
[ G] DBUFF                            004A
[ G] DEBUG                            0000
[ G] DECX                             2EFC
[ G] DELAY                            360C
[ G] DELOOP                           360F
[ G] DERR2                            38CF
[ G] DGC                              3014
[ G] DIGCNT                           3012
[ G] DISPX                            2925
[ G] DIVERR                           2F09
[ G] DIVEX                            2ED5
[ G] DIVIDE                           2EAF
[ G] DLINE                            39D4
[ G] DOB2                             2A69
[ G] DOCALL                           2F3D
[ G] DODIS                            2928
[ G] DOEQ                             2F17
[ G] DOM                              379F
[ G] DOREST                           3974
[ G] DOUDIV                           2EC3
[ G] DRIVE                            0049
[ G] DSKERR                           38CB
[ G] DSKEX                            38D1
[ G] DSTART                           0000
[ G] DTEMP                            3842
[ G] DVINIT                           2EA7
[ G] EAR0                             3263
[ G] EAR1                             326B
[ G] EARLY                            3259
[ G] ENDCMP                           281C
[ G] ENDERR                           2817
[ G] ENDLIN                           356F
[ G] ENDOK                            2820
[ G] ENDSES                           3692
[ G] endseslen                        36A1
[ G] ENDSL                            000F
[ G] ENDTST                           3A15
[ G] ENTER                            39C0
[ G] EOL                              000D
[ G] EQBAD                            2F30
[ G] EQOK                             2F33
[ G] ERRWP                            3955
[ G] ETPEX                            2E25
[ G] FALSE                            0000
[ G] FBRK                             3151
[ G] FINDW                            3153
[ G] FIRST1                           2BD8
[ G] FLAGSU                           34A9
[ G] FLEX                             3137
[ G] FLGSU1                           34BC
[ G] FLGSU2                           34C7
[ G] FLGSU3                           34D0
[ G] FLUSHW                           3121
[ G] FREEZE                           3690
[ G] FWL1                             3160
[ G] FWORDS                           0025
[ G] FWSUCC                           317B
[ G] GDRIVE                           0056
[ G] GETBYT                           31C2
[ G] GETDSK                           37DA
[ G] GETDSK1                          3802
[ G] GETKEY                           34F2
[ G] GETLNG                           29B0
[ G] GETMOD                           333B
[ G] GETP1                            2DE9
[ G] GETP2                            2E08
[ G] GETP2A                           2E1F
[ G] GETP2B                           2E18
[ G] GETP3                            2DF7
[ G] GETPT1                           2E2D
[ G] GETPT2                           2E3D
[ G] GETSHT                           29A8
[ G] GETVAR                           29C7
[ G] GETVR1                           29CD
[ G] GETVRG                           29DE
[ G] GETVRL                           29D1
[ G] GETWRD                           3188
[ G] GETZCH                           3347
[ G] GETZH1                           335E
[ G] GETZH2                           3375
[ G] GETZH3                           3371
[ G] GK                               34F4
[ G] GLOBAL                           0021
[ G] GM                               3342
[ G] GOBACK                           3566
[ G] GPOSIT                           0057
[ G] GPT                              2E43
[ G] GTBT0                            31D3
[ G] GTBT1                            31D7
[ G] GTBT2                            31DF
[ G] GTBT3                            31F2
[ G] GTEXIT                           335A
[ G] GTVX                             29D8
[ G] GTZ0                             334D
[ G] HOME                             35EA
[ G] IERRL                            0011
[ G] IHOLD                            005F
[ G] INFCB                            DC00
[ G] INLOOP                           3536
[ G] INPEX                            358E
[ G] INPUT                            352B
[ G] INTERR                           365C
[ G] interrlen                        366D
[ G] IOBUFF                           2200
[ G] IOCHAR                           0055
[ G] KTEST                            3500
[ G] LDPRE                            28A6
[ G] LINCNT                           0054
[ G] LINE                             35AA
[ G] LN                               35AD
[ G] loadlen                          365C
[ G] LOADM                            363B
[ G] LOADML                           0021
[ G] LOCALS                           2700
[ G] LOCLP                            3927
[ G] LREST                            3987
[ G] LRU                              000A
[ G] LRUMAP                           2650
[ G] LSAVE                            38AF
[ G] LUKE                             3624
[ G] MASK                             0043
[ G] MATH                             2E72
[ G] MCLR                             36C9
[ G] MCLRL                            0012
[ G] mclrlen                          36DB
[ G] MEMTOP                           00CF
[ G] MLOOP                            28BD
[ G] MOREL                            0006
[ G] MORES                            36C3
[ G] morlen                           36C9
[ G] MOVECURSOR                       35FA
[ G] MOVEP                            376F
[ G] MOVEP1                           3786
[ G] MPCFLG                           001F
[ G] MPCH                             001A
[ G] MPCL                             001C
[ G] MPCM                             001B
[ G] MPCPNT                           001D
[ G] MSTACK                           21FE
[ G] MSTART                           2100
[ G] MTEMP                            0047
[ G] NBR1                             3148
[ G] NBRKP                            313C
[ G] NBRKS                            0006
[ G] NEXTPC                           3191
[ G] NOMORE                           3556
[ G] NOPS0                            000E
[ G] NOPS1                            0010
[ G] NOPS2                            0019
[ G] NOPSX                            000C
[ G] NORAM                            2866
[ G] NPC0                             31A2
[ G] NPC1                             31A6
[ G] NPC2                             31AE
[ G] NPC3                             31C1
[ G] NUMBER                           3006
[ G] NXTP1                            2E55
[ G] NXTP2                            2E68
[ G] NXTP3                            2E65
[ G] OBJLOC                           34D7
[ G] OP0                              292F
[ G] OP1                              293F
[ G] OP1A                             2948
[ G] OP1B                             2951
[ G] OP1C                             295A
[ G] OP1EX                            295D
[ G] OP2                              2970
[ G] OP2A                             2979
[ G] OP2B                             297C
[ G] OP2C                             298D
[ G] OP2D                             2990
[ G] OP2EX                            2996
[ G] OPCODE                           0000
[ G] OPENGAMEDSK                      37CE
[ G] OPEXT                            28D4
[ G] OPT0                             2AB4
[ G] OPT1                             2AD0
[ G] OPT2                             2AF0
[ G] OPTX                             2B22
[ G] OPX0                             28DD
[ G] OPX1                             28E3
[ G] OPX2                             28EC
[ G] OPX3                             28F5
[ G] OPX4                             2912
[ G] OPXNXT                           28FC
[ G] OUTCHR                           34E6
[ G] OVER                             2A3C
[ G] OZSTAK                           0027
[ G] PAGE                             31F3
[ G] PAGE0                            000E
[ G] PATCH                            31CC
[ G] PBAD                             2D1E
[ G] PDB0                             2A9B
[ G] PDB1                             2AB3
[ G] PG0                              31FA
[ G] PG1                              321F
[ G] PG2                              3235
[ G] PG3                              323D
[ G] PG4                              324A
[ G] PG5                              3254
[ G] PKICK                            3516
[ G] PMAX                             000C
[ G] PNBX                             2A4E
[ G] PNUM                             37A9
[ G] POK                              2D3F
[ G] POPSTK                           2A2C
[ G] PPX                              34A2
[ G] PREDB                            2A55
[ G] PREDB1                           2A74
[ G] PREDB3                           2A81
[ G] PREDF                            2A41
[ G] PREDLB                           2A61
[ G] PREDNB                           2A47
[ G] PREDS                            2A4F
[ G] PRESS                            39E8
[ G] PRESSL                           001C
[ G] presslen                         3A04
[ G] PRNTDC                           2C81
[ G] PRNTN3                           3028
[ G] PRNTN4                           302C
[ G] PROPB                            3474
[ G] PROPL                            3491
[ G] PROPN                            3489
[ G] PROPNX                           349E
[ G] PSHDZ                            2A23
[ G] PSHSTK                           2A21
[ G] PTABLE                           2500
[ G] pth                              31CB
[ G] PTIME                            375C
[ G] PTIME1                           3762
[ G] PTIME2                           376A
[ G] PTP                              2FD8
[ G] PTP1                             2FED
[ G] PTVX                             2A12
[ G] PUTBYT                           29F5
[ G] PUTP1                            2FCA
[ G] PUTP2                            2FDD
[ G] PUTP2A                           2FF5
[ G] PUTVAL                           29F9
[ G] PUTVLG                           2A18
[ G] PUTVLL                           2A0B
[ G] PUTVR1                           2A07
[ G] PZERO                            3038
[ G] PZSTFO                           003C
[ G] PZSTP0                           32AE
[ G] PZSTP1                           32B0
[ G] PZSTR                            328D
[ G] PZSTR1                           32B5
[ G] PZSTR2                           32BD
[ G] PZSTRA                           32CA
[ G] PZSTRF                           32F9
[ G] PZSTRL                           3295
[ G] PZSTRP                           32EF
[ G] PZSTRS                           32DF
[ G] PZSTRT                           32E3
[ G] QKEY                             3502
[ G] RAND1                            0058
[ G] RAND2                            0059
[ G] RBRKP                            3138
[ G] RDEX                             309A
[ G] READL                            3089
[ G] READL2                           30CC
[ G] READL3                           30F2
[ G] REMVC1                           2C63
[ G] REMVC2                           2C78
[ G] REMVEX                           2C7E
[ G] REND                             383F
[ G] RES                              39DD
[ G] RESL                             0007
[ G] reslen                           39E4
[ G] RESLP                            394C
[ G] RESUME                           39B3
[ G] RET0                             29F4
[ G] RET1                             2CA7
[ G] RET2                             2CB0
[ G] RETERR                           2CC8
[ G] REVERSE                          35DE
[ G] RFLIP                            2ECB
[ G] RING                             3A0B
[ G] RINGL                            000A
[ G] ringlen                          3A15
[ G] RL1                              3096
[ G] RL2                              309B
[ G] RL3                              30A4
[ G] RS1                              2000
[ G] RS1E                             200A
[ G] RSIBRK                           30EA
[ G] RTABP                            003A
[ G] SAV                              39E4
[ G] SAVFCB                           D000
[ G] SAVL                             0004
[ G] savlen                           39E8
[ G] SAVRES                           3843
[ G] SCMP                             2D2C
[ G] SCOMP                            2D21
[ G] SCRIPT                           005E
[ G] SCROUT                           3583
[ G] SENDCH                           3547
[ G] SETA0                            2870
[ G] SETNP                            286A
[ G] SETSTR                           327E
[ G] SETWRD                           3275
[ G] SFLAG                            3591
[ G] SIBRKP                           3143
[ G] SING                             3A04
[ G] SINGL                            0007
[ G] sinlen                           3A0B
[ G] SPACE                            0020
[ G] SQUOT                            0045
[ G] SREM                             0046
[ G] ST0                              2823
[ G] ST1A                             2831
[ G] ST1B                             283B
[ G] STABP                            003B
[ G] STAMP                            0011
[ G] START                            2800
[ G] STBYTF                           002B
[ G] SWAP                             0012
[ G] TABS                             2EBD
[ G] TABTOP                           000F
[ G] TDRIVE                           0061
[ G] TEMP                             003F
[ G] TEMP2                            0041
[ G] TIMEFL                           0050
[ G] TOBOOT                           39B8
[ G] TOPRIN                           3576
[ G] TOPSTA                           24FE
[ G] TOSCR                            354A
[ G] TPOSIT                           0060
[ G] TRACK                            004E
[ G] TRUE                             00FF
[ G] TSTEND                           2807
[ G] UDIV                             2EDD
[ G] UDLOOP                           2EE8
[ G] UDNEXT                           2EFB
[ G] UNBOLD                           35D2
[ G] UNDER                            2A37
[ G] USEPM                            379D
[ G] VAL                              003D
[ G] VARGET                           29BF
[ G] VARPUT                           29E7
[ G] VCODE                            36A0
[ G] VCODEL                           0014
[ G] vcodelen                         36B4
[ G] VERNUM                           36B4
[ G] VERSOK                           395A
[ G] VOCAB                            0023
[ G] VSUM                             2B94
[ G] VSUM0                            2BA0
[ G] WNEXT                            316E
[ G] ZADD                             2E6E
[ G] ZB0                              2D55
[ G] ZBAND                            2D5A
[ G] ZBCOM                            2CE9
[ G] ZBEGIN                           0006
[ G] ZBOR                             2D4F
[ G] ZBTST                            2D42
[ G] ZCALL                            2F36
[ G] ZCALL1                           2F66
[ G] ZCALL2                           2F81
[ G] ZCALL3                           2F85
[ G] ZCALL4                           2F9C
[ G] ZCHKSM                           001C
[ G] ZCHR1                            342A
[ G] ZCHR2                            3435
[ G] ZCHRCS                           3420
[ G] ZCHRX                            343C
[ G] ZCODE                            3F00
[ G] ZCODEHIGH                        003F
[ G] ZCRLF                            36DB
[ G] ZDEC                             2C29
[ G] ZDIV                             2E9C
[ G] ZDLESS                           2D06
[ G] ZENDLD                           0004
[ G] ZEQUAL                           2F0E
[ G] ZERROR                           366D
[ G] ZFCLR                            2D81
[ G] ZFIRST                           2BD1
[ G] ZFSET                            2D73
[ G] ZFSETP                           2D62
[ G] ZFWORD                           0018
[ G] ZGET                             2DC0
[ G] ZGETB                            2DD3
[ G] ZGETP                            2DE6
[ G] ZGETPT                           2E2A
[ G] ZGLOBA                           000C
[ G] ZGRTR                            2CFC
[ G] ZID                              0002
[ G] ZIGRTR                           2D0F
[ G] ZIN                              2D32
[ G] ZINC                             2C11
[ G] ZINC1                            2C1B
[ G] ZIP                              2800
[ G] ZJUMP                            2CCD
[ G] ZLENTH                           001A
[ G] ZLESS                            2CF2
[ G] ZLOC                             2BEF
[ G] ZMLOOP                           2E84
[ G] ZMNEXT                           2E94
[ G] ZMOD                             2EA1
[ G] ZMODE                            0001
[ G] ZMOVE                            2D9A
[ G] ZMUL                             2E7D
[ G] ZMVEX                            2DBF
[ G] ZNEXT                            2BC8
[ G] ZNEXTP                           2E4E
[ G] ZNOOP                            2B62
[ G] ZOBJEC                           000A
[ G] ZPAGE                            000D
[ G] ZPCFLG                           0018
[ G] ZPCH                             0013
[ G] ZPCL                             0015
[ G] ZPCM                             0014
[ G] ZPCPNT                           0016
[ G] ZPGTOP                           0060
[ G] ZPOP                             305E
[ G] ZPRB                             2C35
[ G] ZPRC                             2FFD
[ G] ZPRD                             2C7F
[ G] ZPRI                             2B45
[ G] ZPRINT                           2CD7
[ G] ZPRN                             3002
[ G] ZPRR                             2B63
[ G] ZPTSIZ                           2BFF
[ G] ZPURBT                           000E
[ G] ZPURE                            000B
[ G] ZPUSH                            3059
[ G] ZPUT                             2FA7
[ G] ZPUTB                            2FB9
[ G] ZPUTP                            2FC7
[ G] ZQUIT                            3686
[ G] ZRAND                            303D
[ G] ZREAD                            3066
[ G] ZREMOV                           2C3F
[ G] ZREST                            38D4
[ G] ZRET                             2C93
[ G] ZRFALS                           2B42
[ G] ZRSTAK                           2B6A
[ G] ZRT                              2B3C
[ G] ZRTRUE                           2B3A
[ G] ZSAVE                            384C
[ G] ZSCRIP                           0010
[ G] ZSCRN                            2B62
[ G] ZSERIA                           0012
[ G] ZSET                             2D91
[ G] ZSPLIT                           2B62
[ G] ZSTACK                           2300
[ G] ZSTAKL                           00FF
[ G] ZSTART                           3614
[ G] ZSTBUI                           002E
[ G] ZSTBUO                           0034
[ G] ZSTEX                            328C
[ G] ZSTWRD                           002C
[ G] ZSUB                             2E77
[ G] ZUSL                             370B
[ G] ZVALUE                           2CE1
[ G] ZVER                             2B72
[ G] ZVERS                            0000
[ G] ZVOCAB                           0008
[ G] ZZERO                            2BBF
