DUNFIELD 6809 ASSEMBLER: D:ED                                         PAGE: 1

0000                         1  *
0000                         2  * SYSTEM MEMORY LOCATIONS FOR USE BY APPLICATION PROGRAMS
0000                         3  *
2000                         4  OSRAM	EQU	$2000		USER APPLICATION RAM STARTS HEDE
DBFF                         5  OSEND	EQU	$DBFF		LAST LOCATION OF USER (NON-SYSTEM) RAM
D000                         6  OSUTIL	EQU	$D000		RAM FOR UTILITY PROGRAM USAGE
0000                         7  *
0000                         9  *
0000                        10  * ED: A tiny screen editor for VT100 and compatible terminals
0000                        11  *
0000                        12  * Copyright 1983-2005 Dave Dunfield
0000                        13  * All rights reserved.
0000                        14  *
3F00                        15  TEXT	EQU	OSRAM+$1F00	START OF TEXT BUFFER
3EFF                        16  STACK	EQU	TEXT-1		EDITOR STACK
0017                        17  NLINES	EQU	23		# LINES - 1
0000                        18  *
0000                        19  * TEMPORARY STORAGE
0000                        20  *
2800                        21  	ORG	OSRAM+$800
2800                        22  XPOS	RMB	1		CURSOR X POSITION
2801                        23  YPOS	RMB	1		CURSOR Y POSITION
2802                        24  TXTPOS	RMB	2		SCREEN TOP POSITION
2804                        25  OLDPOS	RMB	1		OLD CURSOR POSITION
2805                        26  CURFLG	RMB	1		CURSOR FLAG
2806                        27  INSFLG	RMB	1		INSERT CHARACTER FLAG
2807                        28  TEMP	RMB	2		TEMPORARY STORAGE
2809                        29  SNRPOS	RMB	2		POSITION IN SNARF BUFFER
280B                        30  NAMBUF	RMB	25		SAVED FILENAME
2824                        31  INPBUF	RMB	64		LOTSA SPACE FOR SEARCH
2864                        32  DLBUF	EQU	*		LINE DELETE BUFFER
2900                        33  	ORG	XPOS+256
2900                        34  SNARF	EQU	*		BUFFER FOR DELETE TO BUFFER
2000                        35  	ORG	OSRAM
2000                        36  *
2000                        37  * INITIALIZATION AND STARTUP CODE
2000                        38  *
2000  10 CE 3E FF           39  EDIT	LDS	#STACK		SET UP STACK
2004  81 3F                 40  	CMPA	#'?'		QUERY OPERATION?
2006  26 13                 41  	BNE	EDIT1		NO, ITS OK
2008  3F                    42  	SWI			SOFTWARE INTERRUPT TO DOS
2009  19                    43  	FCB	25		SYSTEM REQUEST NUMBER
200A  55 73 65 3A 20 45 +   44  	FCCZ	'Use: ED <file>'
2019  3F                    45  	SWI			SOFTWARE INTERRUPT TO DOS
201A  00                    46  	FCB	0		SYSTEM REQUEST NUMBER
201B  86 28                 47  EDIT1	LDA	#=XPOS		POSITION
201D  1F 8B                 48  	TFR	A,DP		SET DIRECT PAGE
201F                        49  	SETDP	=XPOS		INFORM ASSEMBLER
201F                        50  * SAVE FILENAME
201F  8E 28 0B              51  	LDX	#NAMBUF		POINT TO NAME BUFFER
2022  A6 A0                 52  SAVNAM	LDA	,Y+		GET CHARACTER FROM INPUT LINE
2024  A7 80                 53  	STA	,X+		SAVE IN FILE BUFFER
2026  81 0D                 54  	CMPA	#$0D		TEST FOR END OF LINE
2028  26 F8                 55  	BNE	SAVNAM		KEEP GOING TILL NAME SAVED
202A  10 8E 28 0B           56  	LDY	#NAMBUF		POINT AT FILENAME
202E  3F                    57  	SWI			SOFTWARE INTERRUPT TO DOS
202F  0A                    58  	FCB	10		SYSTEM REQUEST NUMBER
2030  10 26 01 31           59  	LBNE	ABORT		GIVE UP
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 2

2034  8E 3F 00              60  	LDX	#TEXT		POINT TO TEXT POSITION
2037  9F 02                 61  	STX	TXTPOS		INITIAL POSITION
2039  3F                    62  	SWI			SOFTWARE INTERRUPT TO DOS
203A  44                    63  	FCB	68		SYSTEM REQUEST NUMBER
203B  26 11                 64  	BNE	NEWFIL		NO, IT'S A NEW FILE
203D  8E 3F 00              65  	LDX	#TEXT		POINT TO TEXT AREA
2040  3F                    66  	SWI			SOFTWARE INTERRUPT TO DOS
2041  35                    67  	FCB	53		SYSTEM REQUEST NUMBER
2042  10 26 01 1F           68  	LBNE	ABORT		IF ERROR, GET UPSET
2046  17 06 42              69  	LBSR	CLS		CLEAR SCREEN
2049  17 05 A0              70  	LBSR	REFSCR		REFRESH THE SCREE
204C  20 11                 71  	BRA	NOTNEW		NOT A NEW FILE
204E  17 06 3A              72  NEWFIL	LBSR	CLS		CLEAR SCREEN
2051  86 FF                 73  	LDA	#$FF		END OF FILE MARKER
2053  B7 3F 00              74  	STA	TEXT		INITIALIZE NEW FILE TO ZIP
2056  17 05 93              75  	LBSR	REFSCR		SET UP SCREEN
2059  8E 27 53              76  	LDX	#NEWMSG		MESSAGE TO DISPLAY
205C  17 02 0F              77  	LBSR	ERRMSG		DISPLAY
205F  86 0D                 78  NOTNEW	LDA	#$0D		GET CARRIAGE RETURN
2061  97 64                 79  	STA	DLBUF		CLEAR DELETED LINE
2063  86 FF                 80  	LDA	#$FF		GET END CHARACTER
2065  B7 29 00              81  	STA	SNARF		SAVE IN SNARF BUFFER
2068  97 06                 82  	STA	INSFLG		SET INSERT MODE
206A  CC 29 00              83  	LDD	#SNARF		POINT TO SNARF BUFFER
206D  DD 09                 84  	STD	SNRPOS		SAVE SNARF POSITION
206F  0F 05                 85  	CLR	CURFLG		CLEAR CURSOR FLAG
2071                        86  *
2071                        87  * COMMAND HANDLER
2071                        88  *
2071  0D 05                 89  EDTCMD	TST	CURFLG		WAS LAST COMMAND MOVE CURSOR
2073  26 04                 90  	BNE	NORES		IF SO, DON'T RESET POSITION
2075  96 00                 91  	LDA	XPOS		GET POSITION
2077  97 04                 92  	STA	OLDPOS		RESET POSITION
2079  17 06 22              93  NORES	LBSR	CURPOS		POSITION CURSOR
207C  17 06 3F              94  	LBSR	GETKEY		GET ONE CHARACTER
207F  0F 05                 95  	CLR	CURFLG		INDICATE NO SPECIAL OPERATION
2081  8D 02                 96  	BSR	EXECMD		EXECUTE COMMAND
2083  20 EC                 97  	BRA	EDTCMD		KEEP PROCESSING
2085                        98  *
2085                        99  * EXECUTES AN EDIT COMMAND
2085                       100  *
2085  4D                   101  EXECMD	TSTA			TEST FOR CHARACTER TO INSERT
2086  2B 30                102  	BMI	CURUP		NO, IT'S A COMMAND
2088                       103  *
2088                       104  * NORMAL CHARACTER, INSERT IT INTO TEXT
2088                       105  *
2088  81 0D                106  	CMPA	#$0D		IS IT A CARRIAGE RETURN
208A  27 1C                107  	BEQ	CRSPEC		IF SO, SPECIAL CASE
208C  34 02                108  	PSHS	A		SAVE CHARACTER
208E  17 05 43             109  	LBSR	LOCADR		FIND OUR ADDRESS
2091  2B 08                110  	BMI	GINSCH		IF EOF, INSERT
2093  81 0D                111  	CMPA	#$0D		CARRIAGE RETURN?
2095  27 04                112  	BEQ	GINSCH		DEFINATELY INSERT
2097  0D 06                113  	TST	INSFLG		ARE WE INSERTING
2099  2A 03                114  	BPL	NOINST		IF NOT, DON'T INSERT
209B  17 03 E4             115  GINSCH	LBSR	INSCHR		INSERT CHARACTER
209E  35 02                116  NOINST	PULS	A		RESTORE CHARACTER
20A0  A7 84                117  	STA	,X		INSERT INTO TEXT
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 3

20A2  17 04 26             118  	LBSR	REFLIN		REFRESH THIS LINE
20A5  16 04 44             119  	LBRA	ADVCHR		AND ADVANCE ONE CHARACTER
20A8                       120  * INSERTING CARRIAGE RETURN
20A8  17 05 29             121  CRSPEC	LBSR	LOCADR		GET OUR ADDRESS
20AB  17 03 D4             122  	LBSR	INSCHR		INSERT CHARACTER
20AE  86 0D                123  	LDA	#$0D		GET CARRIAGE RETURN
20B0  A7 84                124  	STA	,X		SAVE IN TEXT
20B2  17 04 04             125  	LBSR	REFBOT		REFRESH BOTTOM OF SCREEN
20B5  16 04 34             126  	LBRA	ADVCHR		AND ADVANCE TO NEXT POSITION
20B8                       127  *
20B8                       128  * PROCESS EDIT COMMAND
20B8                       129  *
20B8                       130  * CURSOR UP COMMAND
20B8                       131  *
20B8  0A 05                132  CURUP	DEC	CURFLG		INDICATE SPECIAL CURSOR MOVE
20BA  84 7F                133  	ANDA	#$7F		CONVERT TO NORMAL CHARACTER
20BC  10 27 04 DB          134  	LBEQ	BAKLIN		IF SO, GO BACK A LINE
20C0                       135  *
20C0                       136  * CURSOR DOWN COMMAND
20C0                       137  *
20C0  4A                   138  	DECA			TEST FOR CURSOR DOWN
20C1  10 27 04 36          139  	LBEQ	ADVLIN		IF SO, GO DOWN
20C5                       140  *
20C5                       141  * CURSOR FORWARD COMMAND
20C5                       142  *
20C5  0F 05                143  	CLR	CURFLG		CLEAR SPECIAL FLAG
20C7  4A                   144  	DECA			TEST FOR CURSOR FORWARD
20C8  10 27 04 20          145  	LBEQ	ADVCHR		IF SO, ADVANCE A CHARACTER
20CC                       146  *
20CC                       147  * CURSOR BACKWARD COMMAND
20CC                       148  *
20CC  4A                   149  	DECA			TEST FOR CURSOR BACKUP
20CD  10 27 04 B2          150  	LBEQ	BAKCHR		IF SO, BACKUP
20D1                       151  *
20D1                       152  * ADVANCE LINE COMMAND
20D1                       153  *
20D1  4A                   154  	DECA			TEST FOR LINE
20D2  26 05                155  	BNE	CMD0		NO, TRY NEXT
20D4  0F 00                156  ALINE	CLR	XPOS		SET POSITION TO ZERO
20D6  16 04 22             157  	LBRA	ADVLIN		ADVANCE A LINE
20D9                       158  *
20D9                       159  * BACK LINE COMMAND
20D9                       160  *
20D9  4A                   161  CMD0	DECA			TEST FOR BACK LINE
20DA  26 09                162  	BNE	CMD1		NO, TRY NEXT COMMAND
20DC  96 00                163  	LDA	XPOS		GET OLD POSITION
20DE  10 27 04 B9          164  	LBEQ	BAKLIN		IF ALREADY AT ZERO, GO BACK A LINE
20E2  0F 00                165  	CLR	XPOS		INDICATE ZERO POSITION
20E4  39                   166  	RTS
20E5                       167  *
20E5                       168  * TOGGLE INSERT COMMAND
20E5                       169  *
20E5  4A                   170  CMD1	DECA			TEST FOR REFRESH COMMAND
20E6  26 0D                171  	BNE	CMD2		NO, TRY NEXT COMMAND
20E8  8E 27 B8             172  	LDX	#INSON		GET INSERT ON MESSAGE
20EB  03 06                173  	COM	INSFLG		CHANGE INSERT FLAG
20ED  2B 03                174  	BMI	INMSG		ISSUE MESSAGE
20EF  8E 27 C2             175  	LDX	#INSOFF		GET INSERT OFF MESSAGE
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 4

20F2  16 01 79             176  INMSG	LBRA	ERRMSG		ISSUE MESSAGE
20F5                       177  *
20F5                       178  * DELETE CHARACTER COMMAND
20F5                       179  *
20F5  4A                   180  CMD2	DECA			TEST FOR DELETE
20F6  26 2A                181  	BNE	CMD3		NO, TRY NEXT COMMAND
20F8  17 04 D9             182  DELGO	LBSR	LOCADR		GET OUR ADDRESS
20FB  17 03 AD             183  	LBSR	DELCHR		DELETE THE CHARACTER
20FE  81 0D                184  	CMPA	#$0D		DID WE DELETE A CARRIAGE RETURN
2100  27 06                185  	BEQ	DELCR		IF SO, SPECIAL CASE
2102  4D                   186  	TSTA			TEST FOR NO DELETE
2103  2B 1C                187  	BMI	DELRTS		IF SO, NO ACTION
2105  16 03 C3             188  	LBRA	REFLIN		REFRESH THIS LINE
2108  1F 10                189  DELCR	TFR	X,D		GET OUR POSITION
210A  10 83 3F 00          190  	CMPD	#TEXT		ARE WE HOME
210E  27 0E                191  	BEQ	NODEOF		IF SO, NO NEED TO DELETE
2110  A6 84                192  	LDA	,X		GET NEXT CHARACTER
2112  2A 0A                193  	BPL	NODEOF		DIDN'T TRY TO DELETE END OF FILE
2114  A7 01                194  	STA	1,X		RESET END OF FILE
2116  86 0D                195  	LDA	#$0D		GET CARRIAGE RETURN
2118  A1 1F                196  	CMPA	-1,X		DO WE ALREADY HAVE A CARRIAGE RETURN THERE?
211A  27 02                197  	BEQ	NODEOF		IF SO, WE ARE OK
211C  A7 84                198  	STA	,X		RESAVE INTO TEXT
211E  16 03 98             199  NODEOF	LBRA	REFBOT		REFRESH SCREEN BOTTOM
2121  39                   200  DELRTS	RTS			QUIT WHILE WE ARE AHEAD
2122                       201  *
2122                       202  * DELETE PREVIOUS COMMAND
2122                       203  *
2122  4A                   204  CMD3	DECA			TEST FOR DELETE PREV
2123  26 08                205  	BNE	CMD4		NO, TRY NEXT
2125  17 04 5B             206  	LBSR	BAKCHR		BACKUP A CHARACTER
2128  17 05 73             207  	LBSR	CURPOS		POSITION CURSOR
212B  20 CB                208  	BRA	DELGO		CONTINUE WITH DELETE
212D                       209  *
212D                       210  * COMMAND COMMAND, PROMPT FOR EDITOR COMMAND
212D                       211  *
212D  4A                   212  CMD4	DECA			TEST FOR QUIT
212E  10 26 01 53          213  	LBNE	CMD5		NO, TRY NEXT COMMAND
2132  17 05 2A             214  	LBSR	CLRCMD		BOTTOM LINE, CLEARED
2135  3F                   215  	SWI			SOFTWARE INTERRUPT TO DOS
2136  18                   216  	FCB	24		SYSTEM REQUEST NUMBER
2137  43 6F 6D 6D 61 6E +  217  	FCCZ	'Command: '
2141  17 04 F9             218  	LBSR	GETCMD		GET COMMAND INPUT
2144  17 05 29             219  	LBSR	CNVBUF		CONVERT TO UPPERCASE
2147  8E 27 2C             220  	LDX	#CMDTAB		POINT TO COMMAND TABLE
214A  3F                   221  	SWI			SOFTWARE INTERRUPT TO DOS
214B  04                   222  	FCB	4		SYSTEM REQUEST NUMBER
214C  27 44                223  	BEQ	REFR1		IF NULL LINE, REFRESH SCREEN
214E  3F                   224  	SWI			SOFTWARE INTERRUPT TO DOS
214F  12                   225  	FCB	18		SYSTEM REQUEST NUMBER
2150  5A                   226  	DECB			TEST FOR EXIT OR QUIT
2151  2B 0E                227  	BMI	QUIT		IF QUIT, GO AWAY
2153  26 25                228  	BNE	APPEND		NO, TRY APPEND FILE COMMAND
2155                       229  * SAVING FILE, FIND OUT HOW MANY BLOCKS TO SAVE
2155  10 8E 28 0B          230  SAVFIL	LDY	#NAMBUF		POINT AT FILENAME
2159  3F                   231  	SWI			SOFTWARE INTERRUPT TO DOS
215A  0A                   232  	FCB	10		SYSTEM REQUEST NUMBER
215B  8D 0A                233  	BSR	SAVOUT		SAVEOUT FILE
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 5

215D  10 26 00 29          234  	LBNE	WAIKEY		ERROR, DON'T EXIT
2161  17 05 27             235  QUIT	LBSR	CLS		CLEAR SCREEN
2164  4F                   236  	CLRA			SET RC=0
2165                       237  * RETURN TO DOS
2165  3F                   238  ABORT	SWI			SOFTWARE INTERRUPT TO DOS
2166  00                   239  	FCB	0		SYSTEM REQUEST NUMBER
2167                       240  *
2167                       241  * SAVES FILE ON DISK
2167                       242  *
2167  17 01 ED             243  SAVOUT	LBSR	FNDEOF		LOCATE END OF FILE
216A  1F 10                244  	TFR	X,D		COPY TO ACC'S
216C  83 3F 01             245  	SUBD	#TEXT+1		CONVERT TO FILE LENGTH
216F  1F 89                246  	TFR	A,B		COPY HIGH TO LOW
2171  4F                   247  	CLRA			CLEAR CARRY
2172  56                   248  	RORB			SHIFT OUT LOW, =*512
2173  5C                   249  	INCB			ADD ONE FOR PARTIAL SECTOR
2174  8E 3F 00             250  	LDX	#TEXT		POINT TO FILE IN MEMORY
2177  3F                   251  	SWI			SOFTWARE INTERRUPT TO DOS
2178  36                   252  	FCB	54		SYSTEM REQUEST NUMBER
2179  39                   253  	RTS
217A                       254  *
217A                       255  * APPENDS A FILE TO THE CURRENT ONE
217A                       256  *
217A  5A                   257  APPEND	DECB			TEST FOR ABBEND
217B  26 1B                258  	BNE	SAVE		NO, TRY SAVE COMMAND
217D  3F                   259  	SWI			SOFTWARE INTERRUPT TO DOS
217E  0A                   260  	FCB	10		SYSTEM REQUEST NUMBER
217F  26 09                261  	BNE	WAIKEY		WAIT IF IT'S INVALID
2181  17 01 D3             262  	LBSR	FNDEOF		LOCATE END OF FILE
2184  30 1F                263  	LEAX	-1,X		BACKUP TO END OF FILE MARKER
2186  3F                   264  	SWI			SOFTWARE INTERRUPT TO DOS
2187  35                   265  	FCB	53		SYSTEM REQUEST NUMBER
2188  27 08                266  	BEQ	REFR1		ALLOW HIM TO SEE ERROR
218A  8E 27 70             267  WAIKEY	LDX	#WAIMSG		POINT AT KEY MESSAGE
218D  3F                   268  	SWI			SOFTWARE INTERRUPT TO DOS
218E  17                   269  	FCB	23		SYSTEM REQUEST NUMBER
218F  17 05 2C             270  	LBSR	GETKEY		WAIT FOR INPUT
2192  17 04 F6             271  REFR1	LBSR	CLS		CLEAR SCREEN
2195  16 04 54             272  	LBRA	REFSCR		AND PERFORM REFRESH
2198                       273  *
2198                       274  * SAVE IN OLD OR NEW FILE
2198                       275  *
2198  5A                   276  SAVE	DECB			TEST FOR SAVE
2199  26 16                277  	BNE	PACK		NO, TRY PACK
219B  3F                   278  	SWI			SOFTWARE INTERRUPT TO DOS
219C  04                   279  	FCB	4		SYSTEM REQUEST NUMBER
219D  26 04                280  	BNE	NEWNAM		IF SO, USE OLD NAME
219F  10 8E 28 0B          281  	LDY	#NAMBUF		POINT AT SAVED NAME
21A3  3F                   282  NEWNAM	SWI			SOFTWARE INTERRUPT TO DOS
21A4  0A                   283  	FCB	10		SYSTEM REQUEST NUMBER
21A5  26 E3                284  	BNE	WAIKEY		NAME IS OK, SAVE FILE
21A7  17 FF BD             285  	LBSR	SAVOUT		SAVE FILE ON DISK
21AA  10 26 FF DC          286  	LBNE	WAIKEY		ERROR, EXIT
21AE  16 04 62             287  	LBRA	CURHOM		HOME CURSOR AND CONTINUE
21B1                       288  *
21B1                       289  * PACK FILE, REMOVE BLANKS AND INSERT TAB CHARACTERS IF POSSIBLE
21B1                       290  *
21B1  5A                   291  PACK	DECB			TEST FOR 'TABS'
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 6

21B2  26 43                292  	BNE	UNPACK		NO, TRY UNPACK
21B4  8E 3F 00             293  	LDX	#TEXT		POINT TO TOP OF FILE
21B7  9F 02                294  	STX	TXTPOS		RESET TEXT POSITION
21B9  1F 12                295  	TFR	X,Y		COPY TO NEXT POINTER
21BB  0F 07                296  GOLIN	CLR	TEMP		INDICATE ON LINE ZERO
21BD  0C 07                297  NOCOM	INC	TEMP		ADVANCE ONE IN LINE
21BF  A6 80                298  	LDA	,X+		GET CHARACTER FROM X
21C1  A7 A0                299  	STA	,Y+		SAVE IN DEST
21C3  2B 30                300  	BMI	ENPAK		END OF PACK
21C5  81 0D                301  	CMPA	#$0D		END OF LINE?
21C7  27 F2                302  	BEQ	GOLIN		IF SO, COULD BE COMMENT ON NEXT LINE
21C9  81 20                303  	CMPA	#' '		IS IT A SPACE?
21CB  26 F0                304  	BNE	NOCOM		NOT A SPACE
21CD  34 10                305  	PSHS	X		SAVE X POINTER
21CF  96 07                306  SKPSPC	LDA	TEMP		TEST FOR AT POSITION
21D1  84 07                307  	ANDA	#7		TEST FOR A TAB POSITION
21D3  27 18                308  	BEQ	TABOK		IF SO, TAB IS OK HERE
21D5  0C 07                309  	INC	TEMP		ADVANCE IN TEXT
21D7  A6 80                310  	LDA	,X+		GET CHARACTER FROM SOURCE
21D9  81 20                311  	CMPA	#' '		SPACE?
21DB  27 F2                312  	BEQ	SKPSPC		KEEP SKIPPING
21DD  35 10                313  	PULS	X		GET POSITION BACK
21DF  A6 80                314  SAVSPC	LDA	,X+		GET CHARACTER FROM LINE
21E1  A7 A0                315  	STA	,Y+		SAVE IN DEST
21E3  81 20                316  	CMPA	#' '		TEST FOR SPACE
21E5  27 F8                317  	BEQ	SAVSPC		FINISH SAVEING THE SPACES
21E7  81 0D                318  	CMPA	#$0D		CARRIAGE RETURN?
21E9  27 D0                319  	BEQ	GOLIN		IF SO, START NEW LINE
21EB  20 D0                320  	BRA	NOCOM		SAVE THIS SPACE
21ED  C6 09                321  TABOK	LDB	#9		GET A TAB CHARACTER
21EF  E7 3F                322  	STB	-1,Y		CHANGE SPACE TO TAB
21F1  35 06                323  	PULS	A,B		FIX UP STACK
21F3  2A C8                324  	BPL	NOCOM		KEEP MOVEING
21F5  20 52                325  ENPAK	BRA	UEOF		REFRESH SCREEN
21F7                       326  *
21F7                       327  * UNPACK TAB SPACES, REPLACING WITH BLANKS
21F7                       328  *
21F7  5A                   329  UNPACK	DECB			TEST FOR 'UNPACK'
21F8  26 57                330  	BNE	DOS		NO, TRY DOS ENTRY
21FA  8E 3F 00             331  	LDX	#TEXT		POINT TO START OF TEXT
21FD  9F 02                332  UGOLIN	STX	TXTPOS		REMEMBER WHERE WE ARE
21FF  0F 07                333  	CLR	TEMP		STARTING ON COLUMN ZERO
2201  10 8E 29 00          334  	LDY	#SNARF		POINT TO SNARF BUFFER
2205  0C 07                335  UMOVL	INC	TEMP		INDICATE ON NEXT POSITION
2207  A6 80                336  	LDA	,X+		GET CHARACTER FROM SOURCE
2209  A7 A0                337  	STA	,Y+		SAVE IN CREATED LINE
220B  2B 3C                338  	BMI	UEOF		END OF FILE
220D  81 09                339  	CMPA	#9		IS IT A TAB?
220F  27 06                340  	BEQ	UTAB		TAB IS SPECIAL CASE
2211  81 0D                341  	CMPA	#$0D		CARRIAGE RETURN?
2213  26 F0                342  	BNE	UMOVL		IF NOT, KEEP MOVEING
2215  20 10                343  	BRA	UCR		HANDLE CARRIAGE RETURN
2217                       344  * TAB, FILL WITH SPACES
2217  86 20                345  UTAB	LDA	#' '		GET SPACE
2219  A7 3F                346  	STA	-1,Y		REPLACE TAB WITH SPACE
221B  D6 07                347  UFILL	LDB	TEMP		GET HORZ POSITION
221D  C4 07                348  	ANDB	#7		TEST FOR TAB STOP
221F  27 E4                349  	BEQ	UMOVL		WE ARE AT A TAB STOP
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 7

2221  A7 A0                350  	STA	,Y+		ADD ONE SPACE TO THE LINE
2223  0C 07                351  	INC	TEMP		INDICATE WE ARE AT THE END
2225  20 F4                352  	BRA	UFILL		KEEP GOING
2227                       353  * CARRIAGE RETURN, END OF LINE
2227  1F 10                354  UCR	TFR	X,D		GET POINTER
2229  93 02                355  	SUBD	TXTPOS		CONVERT TO SIMPLE OFFSET
222B  DD 07                356  	STD	TEMP		SAVE FOR LATER
222D  9E 02                357  	LDX	TXTPOS		GET OUR POSITION
222F  1F 20                358  	TFR	Y,D		GET POSITION IN LINE
2231  83 29 00             359  	SUBD	#SNARF		CONVERT TO SIMPLE OFFSET
2234  93 07                360  	SUBD	TEMP		FIND OUT HOW MANY BYTES MORE
2236  27 03                361  	BEQ	UNOINS		DON'T INSERT IF NO EXTRA
2238  17 02 58             362  	LBSR	INSMUL		INSERT EXTRA SPACE
223B  10 8E 29 00          363  UNOINS	LDY	#SNARF		POINT TO SNARF BUFFER
223F  A6 A0                364  UMOV	LDA	,Y+		GET CHARACTER FROM LINE
2241  A7 80                365  	STA	,X+		SAVE IN DESTINATION LINE
2243  81 0D                366  	CMPA	#$0D		TEST FOR END OF LINE
2245  26 F8                367  	BNE	UMOV		KEEP GOING
2247  20 B4                368  	BRA	UGOLIN		KEEP LOOKING
2249                       369  * END OF FILE, RESET PARAMETERS
2249  86 FF                370  UEOF	LDA	#$FF		GET MARKER
224B  B7 29 00             371  	STA	SNARF		INDICATE NO SNARF BUFFER
224E  16 00 EE             372  	LBRA	TOPF		GO TO TOP OF FILE
2251                       373  *
2251                       374  * TEMPORARY DOS ENTRY
2251                       375  *
2251  5A                   376  DOS	DECB			TEST FOR 'DOS'
2252  26 17                377  	BNE	INVCMD		NO, COMMAND WAS INVALID
2254  17 04 34             378  	LBSR	CLS		CLEAR SCREEN
2257  34 08                379  	PSHS	DP		SAVE DIRECT PAGE REGISTER
2259  3F                   380  	SWI			SOFTWARE INTERRUPT TO DOS
225A  04                   381  	FCB	4		SYSTEM REQUEST NUMBER
225B  26 07                382  	BNE	DOCMD		DO DOS COMMAND
225D  3F                   383  	SWI			SOFTWARE INTERRUPT TO DOS
225E  65                   384  	FCB	101		SYSTEM REQUEST NUMBER
225F  35 08                385  	PULS	DP		RESTORE DIRECT PAGE
2261  16 FF 2E             386  	LBRA	REFR1		REFRESH AND CONTINUE
2264                       387  * COMMAND WAS SUPPLIED
2264  3F                   388  DOCMD	SWI			SOFTWARE INTERRUPT TO DOS
2265  64                   389  	FCB	100		SYSTEM REQUEST NUMBER
2266  35 08                390  	PULS	DP		RESTORE DP
2268  16 FF 1F             391  	LBRA	WAIKEY		WAIT FOR KEY BEFORE RESUMEING
226B                       392  * COMMAND WAS UNRECOGNISED
226B  8E 27 A8             393  INVCMD	LDX	#ICMMSG		INDICATE INVALID COMMAND
226E                       394  *
226E                       395  * ISSUES ERROR MESSAGE ON LINE 23, IN INVERSE VIDEO
226E                       396  *
226E  34 10                397  ERRMSG	PSHS	X		SAVE POINTER TO MESSAGE
2270  17 03 EC             398  	LBSR	CLRCMD		COMMAND LINE & CLEAR
2273  7F 27 E6             399  	CLR	>INVCHR		INSURE WE STOP AT END
2276  8E 27 E2             400  	LDX	#INVON		SET INVERSE VIDEO
2279  3F                   401  	SWI			SOFTWARE INTERRUPT TO DOS
227A  17                   402  	FCB	23		SYSTEM REQUEST NUMBER
227B  35 10                403  	PULS	X		GET MSG POINTER BACK
227D  3F                   404  	SWI			SOFTWARE INTERRUPT TO DOS
227E  17                   405  	FCB	23		SYSTEM REQUEST NUMBER
227F  8E 27 E7             406  	LDX	#INVOFF		SET NORMAL VIDEO
2282  3F                   407  	SWI			SOFTWARE INTERRUPT TO DOS
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 8

2283  17                   408  	FCB	23		SYSTEM REQUEST NUMBER
2284  39                   409  	RTS
2285                       410  *
2285                       411  * PAGE FORWARD C0MMAND
2285                       412  *
2285  4A                   413  CMD5	DECA			TEST FOR PAGE FORWARD COMMAND
2286  26 27                414  	BNE	CMD6		NO, TRY PAGE BACKWARD
2288  9E 02                415  	LDX	TXTPOS		GET TEXT POSITION
228A  C6 16                416  	LDB	#NLINES-1	# LINES TO MOVE
228C  A6 80                417  PAGE	LDA	,X+		GET POSITION
228E  10 2B 02 EB          418  	LBMI	ADVEOF		GONE BEYOND END OF SCREEN
2292  81 0D                419  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
2294  26 F6                420  	BNE	PAGE		KEEP LOOKING
2296  5A                   421  	DECB			REDUCE COUNT
2297  26 F3                422  	BNE	PAGE		KEEP LOOKING
2299  9F 02                423  	STX	TXTPOS		RESAVE TEXT POSITION
229B  A6 80                424  PAGCR	LDA	,X+		GET BYTE FROM TEXT
229D  2B 09                425  	BMI	PAGEOF		END OF FILE IS ON SCREEN
229F  81 0D                426  	CMPA	#$0D		TEST FOR NEW LINE
22A1  26 F8                427  	BNE	PAGCR		KEEP LOOKING
22A3  5C                   428  	INCB			INDICATE ANOTHER LINE
22A4  C1 16                429  	CMPB	#NLINES-1	TEST FOR BEYOND END
22A6  2D F3                430  	BLT	PAGCR		KEEP LOOKING
22A8  D7 01                431  PAGEOF	STB	YPOS		POINT AT EOF LINE
22AA  0F 00                432  	CLR	XPOS		ZERO 'X' POSITION
22AC  16 03 3D             433  	LBRA	REFSCR		REFERESH SCREEN
22AF                       434  *
22AF                       435  * BACK PAGE COMMAND
22AF                       436  *
22AF  4A                   437  CMD6	DECA			TEST FOR BACKUP COMMAND
22B0  26 2A                438  	BNE	CMD7		NO, TRY NEXT
22B2  0F 01                439  PGGO	CLR	YPOS		POSITION TO TOP OF SCREEN
22B4  0F 00                440  	CLR	XPOS		CLEAR 'X' POSITION
22B6  C6 17                441  	LDB	#NLINES		NUMBER OF LINES TO MOVE
22B8  86 FF                442  PGBAK	LDA	#-1		START WITH -1
22BA  97 07                443  	STA	TEMP		ZERO NUMBER OF LINES MOVED
22BC  9E 02                444  	LDX	TXTPOS		GET TOP OF SCREEN POSITION
22BE  8C 3F 00             445  	CMPX	#TEXT		ARE WE AT TOP?
22C1  10 27 02 B8          446  	LBEQ	ADVEOF		IF SO, STOP HERE
22C5  0C 07                447  PGB1	INC	TEMP		ADVANCE COUNT
22C7  8C 3F 00             448  PGB2	CMPX	#TEXT		AT TOP?
22CA  27 0B                449  	BEQ	TOPSCR		YES, STOP
22CC  A6 82                450  	LDA	,-X		BACKUP ONE CHARACTER
22CE  81 0D                451  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
22D0  26 F5                452  	BNE	PGB2		IF NOT, KEEP LOOKING
22D2  5A                   453  	DECB			REDUCE COUNT
22D3  26 F0                454  	BNE	PGB1		KEEP GOING TILL WE FIND
22D5  30 01                455  	LEAX	1,X		ADVANCE TO START OF LINE
22D7  9F 02                456  TOPSCR	STX	TXTPOS		RESAVE POSITION
22D9  16 03 10             457  	LBRA	REFSCR		REFRESH SCREEN
22DC                       458  *
22DC                       459  * DELETE TO END OF LINE
22DC                       460  *
22DC  4A                   461  CMD7	DECA			TEST FOR DELETE END OF LINE
22DD  26 25                462  	BNE	CMD8		NO, TRY NEXT COMMAND
22DF  17 02 F2             463  DELSN	LBSR	LOCADR		LOCATE ADDRESS
22E2  10 2B 02 97          464  	LBMI	ADVEOF		IF SO, ABORT WITH ERROR
22E6  34 10                465  	PSHS	X		SAVE ADDRESS
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 9

22E8  1F 12                466  	TFR	X,Y		COPY FOR ADVANCE
22EA  34 10                467  	PSHS	X		SAVE X REG
22EC  8E 28 64             468  	LDX	#DLBUF		DELETE LINE BUFFER
22EF  A6 A0                469  FINCR	LDA	,Y+		GET CHARACTER
22F1  A7 80                470  	STA	,X+		SAVE IN BUFFER
22F3  81 0D                471  	CMPA	#$0D		TEST FOR END OF LINE
22F5  26 F8                472  	BNE	FINCR		KEEP LOOKING
22F7  35 10                473  	PULS	X		RESTORE X
22F9  A6 A0                474  MOVBAC	LDA	,Y+		GET CHARACTER
22FB  A7 80                475  	STA	,X+		COPY BACK TO LINE
22FD  2A FA                476  	BPL	MOVBAC		KEEP GOING TILL WE FIND
22FF  35 10                477  	PULS	X		GET X VALUE BACK
2301  16 FE 04             478  	LBRA	DELCR		REFRESH AND FIX IF END OF FILE
2304                       479  *
2304                       480  * HELP COMMAND, DISPLAY THE FILE [SYSTEM]ED.HLP
2304                       481  *
2304  4A                   482  CMD8	DECA			TEST FOR HELP
2305  26 35                483  	BNE	CMD9		NO, TRY NEXT COMMAND
2307  DC 00                484  	LDD	XPOS		GET CURSOR POSITIONS
2309  34 06                485  	PSHS	A,B		SAVE CURSOR ADDRESS
230B  10 8E 27 CD          486  	LDY	#HLPFIL		HELP FILENAME
230F  3F                   487  	SWI			SOFTWARE INTERRUPT TO DOS
2310  0A                   488  	FCB	10		SYSTEM REQUEST NUMBER
2311  17 03 77             489  	LBSR	CLS		CLEAR SCREEN
2314  CE 29 00             490  	LDU	#SNARF
2317  3F                   491  	SWI			SOFTWARE INTERRUPT TO DOS
2318  37                   492  	FCB	55		SYSTEM REQUEST NUMBER
2319  26 0E                493  	BNE	WAIHLP		IF ERROR, GO BACK
231B  3F                   494  DISHLP	SWI			SOFTWARE INTERRUPT TO DOS
231C  3B                   495  	FCB	59		SYSTEM REQUEST NUMBER
231D  26 0A                496  	BNE	WAIHLP		END OF HELP DISPLAY
231F  3F                   497  HDISP	SWI			SOFTWARE INTERRUPT TO DOS
2320  21                   498  	FCB	33		SYSTEM REQUEST NUMBER
2321  81 0D                499  	CMPA	#$0D		TEST FOR NEW LINE
2323  26 F6                500  	BNE	DISHLP		DISPLAY NEXT CHARACTER
2325  86 0A                501  	LDA	#$0A		GET LINEFEED
2327  20 F6                502  	BRA	HDISP		DISPLAY WITH NEXT
2329                       503  * WAIT FOR A CHARACTER BEFORE PROCEDING
2329  8E 27 70             504  WAIHLP	LDX	#WAIMSG		MESSAGE
232C  17 FF 3F             505  	LBSR	ERRMSG		DISPLAY MESSAGE
232F  17 03 8C             506  	LBSR	GETKEY		GET A CHARACTER
2332  17 03 56             507  	LBSR	CLS		NEW SCREEN
2335  35 06                508  	PULS	A,B		GET CURSOR POSITION BACK
2337  DD 00                509  	STD	XPOS		RESAVE POSITION
2339  16 02 B0             510  	LBRA	REFSCR		REFRESH SCREEN
233C                       511  *
233C                       512  * TOP OF FILE COMMAND
233C                       513  *
233C  4A                   514  CMD9	DECA			TEST FOR TOF COMMAND
233D  26 09                515  	BNE	CMD10		IF NOT, TRY NEXT
233F  8E 3F 00             516  TOPF	LDX	#TEXT		POINT TO TEXT
2342  0F 01                517  	CLR	YPOS		MOVE TO TOP OF SCREEN
2344  0F 00                518  	CLR	XPOS		ZERO 'X' POSITION
2346  20 8F                519  	BRA	TOPSCR		AND SAVE TOP ADDRESS
2348                       520  *
2348                       521  * BOTTOM OF FILE COMMAND
2348                       522  *
2348  4A                   523  CMD10	DECA			TEST FOR BOT OF FILE KEY
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 10

2349  26 13                524  	BNE	CMD11		NO, TRY NEXT COMMAND
234B  8D 0A                525  	BSR	FNDEOF		FINE END OF FILE
234D  9F 02                526  	STX	TXTPOS		SET SCREEN POSITION
234F  17 FF 60             527  	LBSR	PGGO		SKIP BACK UP SCREEN
2352  96 07                528  	LDA	TEMP		GET # LINES
2354  97 01                529  	STA	YPOS		SET 'Y' POSITION
2356  39                   530  	RTS
2357                       531  * LOCATES END OF FILE. (IN X)
2357  9E 02                532  FNDEOF	LDX	TXTPOS		START AT TOP
2359  A6 80                533  FNDBOT	LDA	,X+		GET POSITION
235B  2A FC                534  	BPL	FNDBOT		KEEP LOOKING
235D  39                   535  	RTS
235E                       536  *
235E                       537  * UNDELETE LINE
235E                       538  *
235E  4A                   539  CMD11	DECA			TEST FOR UNDELETE
235F  26 26                540  	BNE	CMD12		NO, TRY NEXT
2361  17 02 70             541  	LBSR	LOCADR		FIND OUR ADDRESS
2364  10 8E 28 64          542  	LDY	#DLBUF		GET ADDRESS OF BUFFER
2368  5F                   543  	CLRB			START WITH ZERO CHARACTER
2369  5C                   544  INS1	INCB			+1 TO GO
236A  A6 A0                545  	LDA	,Y+		GET CHARACTER
236C  81 0D                546  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
236E  26 F9                547  	BNE	INS1		IF NOT, KEEP LOOKING
2370  4F                   548  	CLRA			SET ZERO HIGH BYTE
2371  17 01 1F             549  	LBSR	INSMUL		GET MULTIPLE SPACES
2374  34 10                550  	PSHS	X		SAVE OUR POSITION
2376  10 8E 28 64          551  	LDY	#DLBUF		GET LINE BUFFER AGAIN
237A  A6 A0                552  INS2	LDA	,Y+		GET CHARACTER
237C  A7 80                553  	STA	,X+		SAVE IN MEMORY
237E  81 0D                554  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
2380  26 F8                555  	BNE	INS2		IF NOT, KEEP LOOKING
2382  35 10                556  	PULS	X		RESTORE OUR POSITION
2384  16 01 32             557  	LBRA	REFBOT		NEW SCREEN
2387                       558  *
2387                       559  * DELETE TO BUFFER COMMAND
2387                       560  *
2387  4A                   561  CMD12	DECA			TEST FOR SNARF
2388  26 18                562  	BNE	CMD13		NO, TRY NEXT
238A  17 FF 52             563  	LBSR	DELSN		DELETE LINE
238D  10 8E 28 64          564  	LDY	#DLBUF		GET DELETE BUFFER
2391  9E 09                565  	LDX	SNRPOS		GET POSITION
2393  A6 A0                566  SAVL	LDA	,Y+		GET CHARACTER FROM DELETE BUFFER
2395  A7 80                567  	STA	,X+		SAVE IN POSITION
2397  81 0D                568  	CMPA	#$0D		TEST FOR END
2399  26 F8                569  	BNE	SAVL		SAVE WHOLE LINE
239B  86 FF                570  	LDA	#$FF		GET END OF FILE
239D  A7 84                571  	STA	,X		SAVE IN BUFFER
239F  9F 09                572  	STX	SNRPOS		RESAVE SNARF POSITION
23A1  39                   573  	RTS
23A2                       574  *
23A2                       575  * INSERT BUFFER COMMAND
23A2                       576  *
23A2  4A                   577  CMD13	DECA			TEST FOR UNSNARF
23A3  26 2F                578  	BNE	CMD14		NO, TRY ANOTHER
23A5  17 02 2C             579  	LBSR	LOCADR		FIND OUR ADDRESS
23A8  10 8E 29 00          580  	LDY	#SNARF		GET ADDRESS OF BUFFER
23AC  34 10                581  	PSHS	X		SAVE OUR POSITION
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 11

23AE  8E FF FF             582  	LDX	#$FFFF		START WITH -1 CHARACTERS
23B1  30 01                583  SINS1	LEAX	1,X		+1 TO GO
23B3  A6 A0                584  	LDA	,Y+		GET CHARACTER
23B5  2A FA                585  	BPL	SINS1		IF NOT, KEEP LOOKING
23B7  1F 10                586  	TFR	X,D		SWAP TO D
23B9  AE E4                587  	LDX	,S		GET X  VALUE BACK
23BB  17 00 D5             588  	LBSR	INSMUL		GET MULTIPLE SPACES
23BE  10 8E 29 00          589  	LDY	#SNARF		GET LINE BUFFER AGAIN
23C2  A6 A0                590  SINS2	LDA	,Y+		GET CHARACTER
23C4  2B 04                591  	BMI	ENDSN		END OF SNARF
23C6  A7 80                592  	STA	,X+		SAVE IN MEMORY
23C8  20 F8                593  	BRA	SINS2		IF NOT, KEEP LOOKING
23CA  CC 29 00             594  ENDSN	LDD	#SNARF		SNARF BUFFER ADDRESS
23CD  DD 09                595  	STD	SNRPOS		RESET POINTER
23CF  35 10                596  	PULS	X		RESTORE OUR POSITION
23D1  16 00 E5             597  	LBRA	REFBOT		NEW SCREEN
23D4                       598  *
23D4                       599  * RESET BUFFER COMMAND
23D4                       600  *
23D4  4A                   601  CMD14	DECA			TEST FOR RESET
23D5  26 0B                602  	BNE	CMD15		NO, TRY NEXT
23D7  CC 29 00             603  	LDD	#SNARF		SNARF NUFFER ADDRESS
23DA  DD 09                604  	STD	SNRPOS		SAVE POSITION
23DC  8E 27 9B             605  	LDX	#RESMSG		BUFFER RESET MESSAGE
23DF  16 FE 8C             606  	LBRA	ERRMSG		DISPLAY MESSAGE
23E2                       607  *
23E2                       608  * ADVANCE TO END OF LINE
23E2                       609  *
23E2  4A                   610  CMD15	DECA			TEST FOR 'DOS'
23E3  26 1A                611  	BNE	CMD16		NO, TRY NEXT
23E5  17 01 EC             612  	LBSR	LOCADR		GET OUR ADDRESS
23E8  81 0D                613  	CMPA	#$0D		ARE ALREADY AT END?
23EA  26 06                614  	BNE	FEOL		NO, SKIP IT
23EC  17 FC E5             615  	LBSR	ALINE		ADVANCE A LINE
23EF  17 01 E2             616  	LBSR	LOCADR		FIND OUR ADDRESS
23F2  A6 80                617  FEOL	LDA	,X+		GET ADDRESS
23F4  2B 08                618  	BMI	EOLFND		IF EOF, STOP
23F6  81 0D                619  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
23F8  27 04                620  	BEQ	EOLFND		IF SO, GO BACK
23FA  0C 00                621  	INC	XPOS		ADVANCE ONE POSITION
23FC  20 F4                622  	BRA	FEOL		KEEP LOOKING
23FE  39                   623  EOLFND	RTS
23FF                       624  *
23FF                       625  * FIND COMMAND
23FF                       626  *
23FF  4A                   627  CMD16	DECA			TEST FOR FIND
2400  26 5A                628  	BNE	CMD17		NO, TRY NEXT COMMAND
2402  17 02 5A             629  	LBSR	CLRCMD		BOTTOM LINE, CLEARED
2405  3F                   630  	SWI			SOFTWARE INTERRUPT TO DOS
2406  18                   631  	FCB	24		SYSTEM REQUEST NUMBER
2407  53 65 61 72 63 68 +  632  	FCCZ	'Search for: '
2414  17 02 26             633  	LBSR	GETCMD		GET INPUT LINE
2417  17 01 BA             634  GOLOOK	LBSR	LOCADR		FIND OUT WHERE WE ARE
241A  10 8E 28 24          635  LOOK	LDY	#INPBUF		POINT TO SEARCH BUFFER
241E  A6 80                636  	LDA	,X+		GET CHARACTER AND ADVANCE
2420  2B 34                637  	BMI	NOFIND		DIDN'T FIND IT
2422  34 10                638  	PSHS	X		SAVE OUR POSITION
2424  A6 A0                639  TST2	LDA	,Y+		GET CHARACTER FROM BUFFER
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 12

2426  2B 08                640  	BMI	FOUND		IF SO, WE FOUND
2428  A1 80                641  	CMPA	,X+		TEST AGAINST SOURCE
242A  27 F8                642  	BEQ	TST2		LOOKS LIKE THIS IS IT
242C  35 10                643  	PULS	X		RESTORE POINTER
242E  20 EA                644  	BRA	LOOK		TRY THIS LOCATION
2430  35 10                645  FOUND	PULS	X		RESTORE POSITION
2432  0F 00                646  	CLR	XPOS		CLEAR CURSOR POSITION
2434  0F 01                647  	CLR	YPOS		TO TOP OF SCREEN
2436  1F 10                648  BAKL	TFR	X,D		SWAP TO US
2438  10 83 3F 00          649  	CMPD	#TEXT		ARE WE THERE
243C  27 0C                650  	BEQ	OKGO		OK
243E  0C 00                651  	INC	XPOS		MOVE OVER ONE
2440  A6 82                652  	LDA	,-X		GET CHARACTER
2442  81 0D                653  	CMPA	#$0D		TEST FOR AT START
2444  26 F0                654  	BNE	BAKL		NO, SAY SO
2446  30 01                655  	LEAX	1,X		ADVANCE AGAIN
2448  0A 00                656  	DEC	XPOS		FIX BECAUSE WE WERE OVER
244A  1F 10                657  OKGO	TFR	X,D		COPY TO D
244C  10 93 02             658  	CMPD	TXTPOS		ARE WE ALREADY THERE?
244F  27 30                659  	BEQ	UNCMD		NO NEED TO UPDATE SCREEN
2451  9F 02                660  	STX	TXTPOS		SAVE TEXT POSITION
2453  16 01 96             661  	LBRA	REFSCR		REFRESH SCREEN
2456  8E 27 8A             662  NOFIND	LDX	#SNFMSG		STRING NOT FOUND MESSAGE
2459  16 FE 12             663  	LBRA	ERRMSG		DISPLAT MESSAGE
245C                       664  *
245C                       665  * FIND NEXT COMMAND
245C                       666  *
245C  4A                   667  CMD17	DECA			IS IT FINDNEXT?
245D  27 B8                668  	BEQ	GOLOOK		IF SO, DO IT
245F                       669  *
245F                       670  * INSERT TAB AS SPACES
245F                       671  *
245F  4A                   672  CMD18	DECA			IS IT TAB?
2460  26 1F                673  	BNE	UNCMD		NO, SKIP IT
2462  17 01 6F             674  	LBSR	LOCADR		FIND CURRENT ADDRESS
2465  5F                   675  	CLRB			START WITH ZERO SPACES
2466  0C 00                676  FNTAB	INC	XPOS		ADVANCE TO NEXT POSITION
2468  5C                   677  	INCB			INDICATE ONE SPACE
2469  96 00                678  	LDA	XPOS		GET X POSITION
246B  84 07                679  	ANDA	#7		TEST FOR AT A TAB STOP
246D  26 F7                680  	BNE	FNTAB		IF NOT, KEEP GOING
246F  34 04                681  	PSHS	B		SAVE COUNT ON STACK
2471  8D 20                682  	BSR	INSMUL		INSERT CHARACTERS
2473  35 04                683  	PULS	B		RESTORE COUNT
2475  86 20                684  	LDA	#' '		GET SPACE
2477  A7 80                685  INSP	STA	,X+		SAVE IN MEMORY
2479  3F                   686  	SWI			SOFTWARE INTERRUPT TO DOS
247A  21                   687  	FCB	33		SYSTEM REQUEST NUMBER
247B  5A                   688  	DECB			REDUCE COUNT
247C  26 F9                689  	BNE	INSP		KEEP INSERTING
247E  16 00 4A             690  	LBRA	REFLIN		REFRESH LINE
2481                       691  * COMMAND WAS NOT RECOGNISED
2481  39                   692  UNCMD	RTS
2482                       693  *
2482                       694  * INSERTS ONE CHARACTER SPACE INTO THE TEXT POINTED TO BY X
2482                       695  *
2482  31 01                696  INSCHR	LEAY	1,X		+1 FOR SECOND INSERT POINTER
2484  E6 84                697  	LDB	,X		GET CHARACTER
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 13

2486  2B 08                698  	BMI	INSEOF		END OF FILE INSERT
2488  A6 A4                699  INSLP	LDA	,Y		GET CHARACTER FROM BEFORE
248A  E7 A0                700  	STB	,Y+		SAVE AGAIN
248C  1F 89                701  	TFR	A,B		COPY TO B FOR LATER
248E  2A F8                702  	BPL	INSLP		IF NOT, KEEP GOING
2490  E7 A4                703  INSEOF	STB	,Y		SET EOF IN TEXT
2492  39                   704  	RTS
2493                       705  *
2493                       706  * INSERTS NUMBERS OF CHARACTER IN B IN LINE POINTED TO BY X
2493                       707  *
2493  34 50                708  INSMUL	PSHS	X,U		SAVE X REGISTER
2495  6D 80                709  FINEF	TST	,X+		GET CHARACTER
2497  2A FC                710  	BPL	FINEF		KEEP LOOKING
2499  33 8B                711  	LEAU	D,X		POINT TO END PLUS NUMBER OF CHARS NEEDED
249B  1F 10                712  	TFR	X,D		COPY TO ACC
249D  A3 E4                713  	SUBD	,S		CONVERT TO SIMPLE NUMBER
249F  1F 02                714  	TFR	D,Y		SAVE IN Y FOR COUNT
24A1  A6 82                715  MOVL	LDA	,-X		GET CHARACTER
24A3  A7 C2                716  	STA	,-U		SAVE FARTHER IN LINE
24A5  31 3F                717  	LEAY	-1,Y		BACKUP COUNT
24A7  26 F8                718  	BNE	MOVL		AND KEEP GOING
24A9  35 D0                719  	PULS	X,U,PC		RESTORE ADDRESS AND RETURN
24AB                       720  *
24AB                       721  * DELETES ONE CHARACTER FROM TEXT POINTED TO BY X
24AB                       722  *
24AB  A6 84                723  DELCHR	LDA	,X		GET CHARACTER WE ARE DELETING
24AD  2B 1B                724  	BMI	DELEOF		SPECIAL CASE
24AF  34 12                725  	PSHS	A,X		SAVE FOR LATER REFERENCE
24B1  A6 01                726  DELLP	LDA	1,X		GET CHARACTER FROM SOURCE
24B3  A7 80                727  	STA	,X+		SAVE IN TEXT
24B5  2A FA                728  	BPL	DELLP		IF NOT, CONTINUE DELETING
24B7  35 92                729  	PULS	A,X,PC		RESTORE REGISTERS
24B9                       730  *
24B9                       731  * REFRESH BOTTOM OF SCREEN FROM CURRENT LOCATION
24B9                       732  *
24B9  DC 00                733  REFBOT	LDD	XPOS		GET POSITION
24BB  34 06                734  	PSHS	A,B		SAVE FOR LATER REFERENCE
24BD  1F 12                735  	TFR	X,Y		COPY OUR POSITION
24BF  C6 17                736  	LDB	#NLINES		LINES/SCREEN
24C1  D0 01                737  	SUBB	YPOS		FIGURE OUT HOW MANY WE HAVE LEFT
24C3  17 01 31             738  	LBSR	DISTXT		REFRESH BOTTOM OF SCREEN
24C6  35 06                739  	PULS	A,B		RESTORE REGISTERS
24C8  DD 00                740  	STD	XPOS		RESTORE CURSOR POSITION
24CA  39                   741  DELEOF	RTS
24CB                       742  *
24CB                       743  * REFRESH CURRENT LINE
24CB                       744  *
24CB  A6 80                745  REFLIN	LDA	,X+		GET CHARACTER FROM SOURCE
24CD  2B 09                746  	BMI	REFL1		DISPLAY END OF FILE
24CF  81 0D                747  	CMPA	#$0D		TEST FOR END OF LINE
24D1  27 16                748  	BEQ	REFL2		OF SO, THATS IT
24D3  17 01 47             749  	LBSR	OUTPRT		OUTPUT IF DISPLAYABLE
24D6  20 F3                750  	BRA	REFLIN		KEEP GOING TILL END OF LINE
24D8  86 0D                751  REFL1	LDA	#$0D		GET CR
24DA  A7 1F                752  	STA	-1,X		INSERT CR
24DC  86 FF                753  	LDA	#$FF		GET EOF MARKER
24DE  A7 84                754  	STA	,X		WRITE IN TEXT
24E0  8D 07                755  	BSR	REFL2		CLEAR END OF LINE
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 14

24E2  3F                   756  	SWI			SOFTWARE INTERRUPT TO DOS
24E3  16                   757  	FCB	22		SYSTEM REQUEST NUMBER
24E4  8E 27 DC             758  	LDX	#EOFMSG		GET MESSAGE
24E7  3F                   759  	SWI			SOFTWARE INTERRUPT TO DOS
24E8  17                   760  	FCB	23		SYSTEM REQUEST NUMBER
24E9  16 01 7D             761  REFL2	LBRA	CLEOL		CLEAR REMAINDER
24EC                       762  *
24EC                       763  * ADVANCES ONE CHARACTER
24EC                       764  *
24EC  17 00 E5             765  ADVCHR	LBSR	LOCADR		FIND OUT POSITION
24EF  81 0D                766  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
24F1  27 06                767  	BEQ	SKPLIN		SKIP TO NEXT LINE
24F3  4D                   768  	TSTA			TEST FOR END OF FILE
24F4  2B 23                769  	BMI	AEOFG		INDICATE ERROR
24F6  0C 00                770  	INC	XPOS		ADVANCE ONE POSITION
24F8  39                   771  	RTS
24F9  0F 00                772  SKPLIN	CLR	XPOS		INDICATE WE ARE AT BEGINNING OF LINE
24FB                       773  *
24FB                       774  * ROLLS SCREEN FORWARD ONE LINE
24FB                       775  *
24FB  17 00 DE             776  ADVLIN	LBSR	LOCLIN		FINDOUR LINE
24FE  A6 84                777  	LDA	,X		GET CHARACTER
2500  2B 17                778  	BMI	AEOFG		IF SO, DISPLAY MESSAGE
2502  96 01                779  	LDA	YPOS		GET Y POSITION
2504  81 16                780  	CMPA	#NLINES-1	TEST FOR AT END
2506  2C 0C                781  	BGE	SROLLD		IF SO, ROLL SCREEN
2508  A6 80                782  NXTL	LDA	,X+		GET CHARACTER
250A  2B 71                783  	BMI	ADVEOF		IF SO, GET UPSET
250C  81 0D                784  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
250E  26 F8                785  	BNE	NXTL		IF NOT, THATS ALL
2510  0C 01                786  	INC	YPOS		SKIP TO NEXT LINE
2512  20 4A                787  	BRA	POSLIN		SKIP TO CHARACTER ON LINE
2514  10 9E 02             788  SROLLD	LDY	TXTPOS		GET POSITION
2517  A6 A0                789  LOKLIN	LDA	,Y+		GET CHARACTER FROM LINE
2519  2B 62                790  AEOFG	BMI	ADVEOF		ADVANCE BEYOND END OF FILE
251B  81 0D                791  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
251D  26 F8                792  	BNE	LOKLIN		KEEP LOOKING
251F  10 9F 02             793  	STY	TXTPOS		RESAVE TEXT POSITION
2522  3F                   794  	SWI			SOFTWARE INTERRUPT TO DOS
2523  18                   795  	FCB	24		SYSTEM REQUEST NUMBER
2524  1B 5B 32 34 3B 30 +  796  	FCB	$1B,'[','2','4',';','0','H'
252B  1B 5B 4A             797  	FCB	$1B,'[','J'
252E  0A                   798  	FCB	$0A
252F  1B 5B 32 33 3B 30 +  799  	FCB	$1B,'[','2','3',';','0','H',0
2537  C6 16                800  	LDB	#NLINES-1	# LINES TO MOVE
2539  A6 A0                801  ADLN	LDA	,Y+		GET LINE
253B  2B 21                802  	BMI	POSLIN		NO END MESSAGE
253D  81 0D                803  	CMPA	#$0D		TEST FOR NEW LINE
253F  26 F8                804  	BNE	ADLN		KEEP LOOKING
2541  5A                   805  	DECB			REDUCE COUNT
2542  26 F5                806  	BNE	ADLN		KEEP LOOKING
2544  1F 21                807  	TFR	Y,X		POINT AT LINE TO DISPLAY
2546  A6 84                808  	LDA	,X		GET CHARACTER
2548  2A 0B                809  	BPL	NOAEOF		END OF FILE WHILE ADVANCEING
254A  86 0D                810  EOFERR	LDA	#$0D		BACK TO START OF LINE
254C  3F                   811  	SWI			SOFTWARE INTERRUPT TO DOS
254D  21                   812  	FCB	33		SYSTEM REQUEST NUMBER
254E  8E 27 DC             813  	LDX	#EOFMSG		POINT TO END OF FILE MESSAGE
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 15

2551  3F                   814  	SWI			SOFTWARE INTERRUPT TO DOS
2552  17                   815  	FCB	23		SYSTEM REQUEST NUMBER
2553  20 09                816  	BRA	POSLIN		KEEP DISPLAYING
2555  A6 80                817  NOAEOF	LDA	,X+		GET CHARACTER FROM TEXT
2557  17 00 C3             818  	LBSR	OUTPRT		DISPLAY IF OK
255A  81 0D                819  	CMPA	#$0D		TEST FOR <CR>
255C  26 F7                820  	BNE	NOAEOF		IF NOT, KEEP GOING
255E                       821  * POSITION CURSOR ON LINE FOLLOWING
255E  8D 7C                822  POSLIN	BSR	LOCLIN		FIND OUR LINE
2560  0D 05                823  	TST	CURFLG		TEST FOR SPECIAL CURSOR POSITION
2562  27 04                824  	BEQ	NORPOS		NORMAL MODE
2564  D6 04                825  	LDB	OLDPOS		GET OLD POSITION
2566  20 02                826  	BRA	SPCPOS		SPECIAL POSITION
2568  D6 00                827  NORPOS	LDB	XPOS		GET X POSITION
256A  27 10                828  SPCPOS	BEQ	THER1		ALREADY THERE
256C  0F 00                829  	CLR	XPOS		SET TO ZERO
256E  A6 80                830  OKMV	LDA	,X+		GET CHARACTER
2570  81 0D                831  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
2572  27 08                832  	BEQ	THER1		ALREADY THERE
2574  4D                   833  	TSTA			TEST FOR $FF (EOF)
2575  2B 05                834  	BMI	THER1		THATS ALL FOLKS
2577  0C 00                835  	INC	XPOS		ADVANCE ONE LOCATION
2579  5A                   836  	DECB			REDUCE OUR COUNT
257A  26 F2                837  	BNE	OKMV		KEEP LOOKING
257C  39                   838  THER1	RTS
257D  8E 27 5C             839  ADVEOF	LDX	#OUTERR		ERROR MESSAGE
2580  16 FC EB             840  	LBRA	ERRMSG		DISPLAY
2583                       841  *
2583                       842  * BACKS UP ONE CHARACTER
2583                       843  *
2583  17 00 56             844  BAKCHR	LBSR	LOCLIN		LOCATE OUR POSITION
2586  D6 00                845  	LDB	XPOS		GET X POSITION
2588  3A                   846  	ABX			OFFSET INTO LINE
2589  8C 3F 00             847  	CMPX	#TEXT		TEST FOR TEXT SPACE
258C  23 EF                848  	BLS	ADVEOF		ERROR
258E  A6 82                849  	LDA	,-X		GET CHARACTER FROM BEHIND
2590  81 0D                850  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
2592  27 03                851  	BEQ	BKUPL		BACKUP A LINE
2594  0A 00                852  	DEC	XPOS		BACKUP IN SOURCE
2596  39                   853  	RTS
2597  86 7F                854  BKUPL	LDA	#127		X POSITION IS VERY HIGH
2599  97 00                855  	STA	XPOS		SET POSITION
259B                       856  *
259B                       857  * ROLLS SCREEN BACKWARD ONE LINE
259B                       858  *
259B  96 01                859  BAKLIN	LDA	YPOS		TEST Y POSITION
259D  27 04                860  	BEQ	SROLLU		ROLL SCREEN UP
259F  0A 01                861  	DEC	YPOS		BACKUP IN SCREEN
25A1  20 BB                862  	BRA	POSLIN		POSITION IN LINE
25A3                       863  * SCROLL SCREEN UPWARD
25A3                       864  * USE THIS VERSION FOR TTYS WHICH SUPPORT BACKWARD SCROLLING
25A3  10 9E 02             865  SROLLU	LDY	TXTPOS		GET OUR POSITION
25A6  31 3F                866  	LEAY	-1,Y		BACKUP PAST END OF LAST LINE
25A8  A6 A2                867  SROLU1	LDA	,-Y		GET CHARACTER FROM LINE
25AA  81 0D                868  	CMPA	#$0D		TEST FOR PREVIOUS LINE
25AC  27 0C                869  	BEQ	SROLU2		IF SO, WE HAVE IT
25AE  1F 20                870  	TFR	Y,D		COPY TO D
25B0  10 83 3E FF          871  	CMPD	#TEXT-1		TEST FOR AT LOCATION 1
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 16

25B4  27 04                872  	BEQ	SROLU2		AT TOP LINE
25B6  25 C5                873  	BLO	ADVEOF		INDICATE ERROR
25B8  20 EE                874  	BRA	SROLU1		KEEP LOOKING
25BA  31 21                875  SROLU2	LEAY	1,Y		ADVANCE TO PROPER PLACE
25BC  10 9F 02             876  	STY	TXTPOS		SAVE TEXT POSITION
25BF  3F                   877  	SWI			SOFTWARE INTERRUPT TO DOS
25C0  18                   878  	FCB	24		SYSTEM REQUEST NUMBER
25C1  1B 5B 48 1B 4D 00    879  	FCB	$1B,'[','H',$1B,'M',0
25C7  17 00 95             880  	LBSR	CLRCMD		CLEAR COMMAND FIELD
25CA  3F                   881  	SWI			SOFTWARE INTERRUPT TO DOS
25CB  18                   882  	FCB	24		SYSTEM REQUEST NUMBER
25CC  1B 5B 48 00          883  	FCB	$1B,'[','H',0
25D0  1F 21                884  	TFR	Y,X		POINT AT LINE TO DISPLAY
25D2  20 81                885  	BRA	NOAEOF		DISPLAY LINE AND POSITION CURSOR
25D4                       886  * USE THIS VERSION FOR TTYS NOT SUPPORTING BACKWARD SCROLL
25D4                       887  *SROLLU	LDB	#NLINES/2	GET # LINES
25D4                       888  *	LBSR	PGBAK		PERFORM BACK PAGE
25D4                       889  *	LDA	TEMP		GET # LINES MOVED
25D4                       890  *	DECA			GOTO ONE HIGHER LINE
25D4                       891  *	BMI	POSLIN		NO LINES MOVED
25D4                       892  *	STA	YPOS		SET POSITION
25D4                       893  *	BRA	POSLIN		POSITION CURSOR
25D4                       894  *
25D4                       895  * LOCATES CURRENT ADDRESS
25D4                       896  *
25D4  8D 06                897  LOCADR	BSR	LOCLIN		GET LINE ADDRESS
25D6  D6 00                898  	LDB	XPOS		GET HORIZ
25D8  3A                   899  	ABX			ADD TO ADDRES
25D9  A6 84                900  	LDA	,X		GET CHARACTER FROM LINE
25DB  39                   901  	RTS
25DC                       902  *
25DC                       903  * LOCATES START OF LINE CURSOR IS ONE
25DC                       904  *
25DC  9E 02                905  LOCLIN	LDX	TXTPOS		START AT TOP OF SCREEN
25DE  D6 01                906  	LDB	YPOS		Y POSITION
25E0  27 09                907  	BEQ	THERE		ALREADY THERE
25E2  A6 80                908  LOCA1	LDA	,X+		GET CHARACTER
25E4  81 0D                909  	CMPA	#$0D		TEST FOR NEXT
25E6  26 FA                910  	BNE	LOCA1		KEEP LOOKING
25E8  5A                   911  	DECB			REDUCE LINE
25E9  26 F7                912  	BNE	LOCA1		KEEP LOOKING TILL WE GET THERE
25EB  39                   913  THERE	RTS
25EC                       914  *
25EC                       915  * REFERESHES THE TERMINAL SCREEN
25EC                       916  *
25EC  10 9E 02             917  REFSCR	LDY	TXTPOS		GET OUR POSITION
25EF  3F                   918  	SWI			SOFTWARE INTERRUPT TO DOS
25F0  18                   919  	FCB	24		SYSTEM REQUEST NUMBER
25F1  1B 5B 48 00          920  	FCB	$1B,'[','H',0
25F5  C6 17                921  	LDB	#NLINES		# LINES TO DISPLAY
25F7  A6 A0                922  DISTXT	LDA	,Y+		GET CHARACTER FROM TEXT
25F9  2B 13                923  	BMI	DISEOF		IF SO, INDICATE END OF FILE
25FB  81 0D                924  	CMPA	#$0D		TEST FOR CARRIAGE RETURN
25FD  27 05                925  	BEQ	DISCR		DISPLAY CARRIAGE RETURN
25FF  17 00 1B             926  	LBSR	OUTPRT		OUTPUT AS DISPLAYABLE CHARACTER
2602  20 F3                927  	BRA	DISTXT		KEEP DISPLAYING
2604  17 00 62             928  DISCR	LBSR	CLEOL		CLEAR END OF LINE
2607  3F                   929  	SWI			SOFTWARE INTERRUPT TO DOS
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 17

2608  16                   930  	FCB	22		SYSTEM REQUEST NUMBER
2609  5A                   931  	DECB			REDUCE COUNT
260A  26 EB                932  	BNE	DISTXT		KEEP DISPLAYING
260C  20 05                933  	BRA	CURHOM		HOME CURSOR AND RETURN
260E  8E 27 DC             934  DISEOF	LDX	#EOFMSG		END OF FILE MESSAGE
2611  3F                   935  	SWI			SOFTWARE INTERRUPT TO DOS
2612  17                   936  	FCB	23		SYSTEM REQUEST NUMBER
2613  3F                   937  CURHOM	SWI			SOFTWARE INTERRUPT TO DOS
2614  18                   938  	FCB	24		SYSTEM REQUEST NUMBER
2615  1B 5B 4A 00          939  	FCB	$1B,'[','J',0
2619  39                   940  	RTS
261A  3F                   941  OUT4	SWI			SOFTWARE INTERRUPT TO DOS
261B  21                   942  	FCB	33		SYSTEM REQUEST NUMBER
261C  39                   943  	RTS
261D                       944  *
261D                       945  * DISPLAYS CHARACTER ON SCREEN IF IT IS PRINTABLE
261D                       946  *
261D  81 0D                947  OUTPRT	CMPA	#$0D		TEST FOR <CR>
261F  27 F9                948  	BEQ	OUT4		IF SO, ALLOW IT TO PRINT
2621  34 12                949  OUTDIF	PSHS	A,X		SAVE REGS
2623  81 7F                950  	CMPA	#$7F		TEST FOR DELETE
2625  27 08                951  	BEQ	OUT2		SPECIAL DELETE NOTATION
2627  81 20                952  	CMPA	#' '		TEST FOR NON-PRINT
2629  2D 06                953  	BLT	OUT3		OK TO DISPLAY
262B  3F                   954  OUT1	SWI			SOFTWARE INTERRUPT TO DOS
262C  21                   955  	FCB	33		SYSTEM REQUEST NUMBER
262D  35 92                956  	PULS	A,X,PC
262F  86 ED                957  OUT2	LDA	#'-'-'@'	GET '-' FOR INVERSE
2631  8B 40                958  OUT3	ADDA	#'@'		CHANGE TO INDICATOR
2633  B7 27 E6             959  	STA	>INVCHR		DISPLAY
2636  8E 27 E2             960  	LDX	#INVON		OUTPUT MESSAGE
2639  3F                   961  	SWI			SOFTWARE INTERRUPT TO DOS
263A  17                   962  	FCB	23		SYSTEM REQUEST NUMBER
263B  35 92                963  	PULS	A,X,PC		GET CHARACTER BACK
263D                       964  *
263D                       965  * GETS AN INPUT LINE FROM THE TERMINAL
263D                       966  *
263D  10 8E 28 24          967  GETCMD	LDY	#INPBUF		POINT TO SEARCH BUFFER
2641  5F                   968  	CLRB			CHARACTER COUNT
2642  17 00 79             969  GETC1	LBSR	GETKEY		GET A KEY
2645  A7 A0                970  	STA	,Y+		SAVE IN BUFFER
2647  2B 05                971  	BMI	GETC2		END OF LINE
2649  8D D6                972  	BSR	OUTDIF		OUTPUT CHARACTER
264B  5C                   973  	INCB			KEEP TRACK OF HOW MANY CHARACTERS WE HAVE
264C  20 F4                974  	BRA	GETC1		KEEP READING
264E  81 88                975  GETC2	CMPA	#$88		TEST FOR DELETE
2650  26 0D                976  	BNE	CLRCMD		END OF INPUT
2652  5A                   977  	DECB			REDUCE COUNT
2653  2B E8                978  	BMI	GETCMD		IF SO, START AGAIN
2655  31 3E                979  	LEAY	-2,Y		BACKUP ONE CHARACTER
2657  3F                   980  	SWI			SOFTWARE INTERRUPT TO DOS
2658  18                   981  	FCB	24		SYSTEM REQUEST NUMBER
2659  08 20 08 00          982  	FCB	8,' ',8,0	DELETE CHARACTER BY WRITING OVER IT
265D  20 E3                983  	BRA	GETC1		KEEP GETTING CHARACTERS
265F  3F                   984  CLRCMD	SWI			SOFTWARE INTERRUPT TO DOS
2660  18                   985  	FCB	24		SYSTEM REQUEST NUMBER
2661  1B 5B 32 34 3B 30 +  986  	FCB	$1B,'[','2','4',';','0','H',0
2669  3F                   987  CLEOL	SWI			SOFTWARE INTERRUPT TO DOS
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 18

266A  18                   988  	FCB	24		SYSTEM REQUEST NUMBER
266B  1B 5B 4B 00          989  	FCB	$1B,'[','K',0
266F  39                   990  	RTS
2670                       991  *
2670                       992  * CONVERT BUFFER CONTENTS TO UPPERCASE, TERMINATED WITH CR
2670                       993  *
2670  10 8E 28 24          994  CNVBUF	LDY	#INPBUF		POINT AT BUFFER
2674  A6 A4                995  CNVBF1	LDA	,Y		GET CHARACTER FROM BUFFER
2676  2B 0A                996  	BMI	LSTBUF		LAST CHARACTER IN BUFFER
2678  81 61                997  	CMPA	#$61		TEST FOR LOWER CASE
267A  2D 02                998  	BLT	NOCHG		IF NOT, IT'S OK
267C  84 DF                999  	ANDA	#$DF		CONVERT TO UPPER
267E  A7 A0               1000  NOCHG	STA	,Y+		SAVE AND INC
2680  20 F2               1001  	BRA	CNVBF1		KEEP CONVERTING
2682  86 0D               1002  LSTBUF	LDA	#$0D		GET CARRIAGE RETURN
2684  A7 A4               1003  	STA	,Y		SAVE IN MEMORY
2686  10 8E 28 24         1004  	LDY	#INPBUF		POINT AT BUFFER
268A  39                  1005  	RTS
268B                      1006  *
268B                      1007  * CLEARS VT100 SCREEN
268B                      1008  *
268B  34 02               1009  CLS	PSHS	A		SAVE REGISTERS
268D  3F                  1010  	SWI			SOFTWARE INTERRUPT TO DOS
268E  18                  1011  	FCB	24		SYSTEM REQUEST NUMBER
268F  1B 5B 48 1B 5B 4A   1012  	FCB	$1B,'[','H',$1B,'[','J'
2695  1B 3D 00            1013  	FCB	$1B,'=',0
2698  0F 00               1014  	CLR	XPOS		ZERO X POSITION
269A  0F 01               1015  	CLR	YPOS		ZERO Y POSITION
269C  35 02               1016  	PULS	A		RESTORE A
269E                      1017  *
269E                      1018  * POSITIONS CURSOR ON VT100
269E                      1019  *
269E  34 06               1020  CURPOS	PSHS	A,B		SAVE REGISTERS
26A0  86 1B               1021  	LDA	#$1B		GET ESCAPE CHARACTER
26A2  3F                  1022  	SWI			SOFTWARE INTERRUPT TO DOS
26A3  21                  1023  	FCB	33		SYSTEM REQUEST NUMBER
26A4  86 5B               1024  	LDA	#'['		GET BRACE
26A6  3F                  1025  	SWI			SOFTWARE INTERRUPT TO DOS
26A7  21                  1026  	FCB	33		SYSTEM REQUEST NUMBER
26A8  D6 01               1027  	LDB	YPOS		GET 'Y' POSITION
26AA  4F                  1028  	CLRA			ZERO HIGH
26AB  5C                  1029  	INCB			ADVANCE
26AC  3F                  1030  	SWI			SOFTWARE INTERRUPT TO DOS
26AD  1A                  1031  	FCB	26		SYSTEM REQUEST NUMBER
26AE  86 3B               1032  	LDA	#';'		SEPERATOR
26B0  3F                  1033  	SWI			SOFTWARE INTERRUPT TO DOS
26B1  21                  1034  	FCB	33		SYSTEM REQUEST NUMBER
26B2  D6 00               1035  	LDB	XPOS		HORZ. POSITION
26B4  4F                  1036  	CLRA			ZERO HIGH
26B5  5C                  1037  	INCB			ADVANCE
26B6  3F                  1038  	SWI			SOFTWARE INTERRUPT TO DOS
26B7  1A                  1039  	FCB	26		SYSTEM REQUEST NUMBER
26B8  86 48               1040  	LDA	#'H'		CM COMMAND
26BA  3F                  1041  	SWI			SOFTWARE INTERRUPT TO DOS
26BB  21                  1042  	FCB	33		SYSTEM REQUEST NUMBER
26BC  35 86               1043  	PULS	A,B,PC		RESTORE REGISTERS AND RETURN
26BE                      1044  *
26BE                      1045  * KEYBOARD INPUT ROUTINE, EVALUATES INPUT CHARACTERS, LOOKING FOR VT100 ESCAPE
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 19

26BE                      1046  * SEQUENCES, AND RETURNS A RESULT AS FOLLOWES:
26BE                      1047  *
26BE                      1048  *   $80 - CURSOR UP COMMAND.		$81 - CURSOR DOWN COMMAND
26BE                      1049  *   $82 - CURSOR FORWARD COMMAND.	$83 - CURSOR BACKWARD COMMAND
26BE                      1050  *   $84 - ADVANCE LINE COMMAND.		$85 - BACKUP LINE COMMAND
26BE                      1051  *   $86 - TOGGLE INSERT MODE.		$87 - DELETE CHARACTER COMMAND
26BE                      1052  *   $88 - DELETE CHARACTER BEFORE CURSOR
26BE                      1053  *   $89 - EXIT EDITOR.			$8A - PAGE FORWARD
26BE                      1054  *   $8B - PAGE BACKWARD.		$8C - DELETE TO END OF LINE
26BE                      1055  *   $8D - KEYPAD HELP.			$8E - GO TO TOP OF FILE
26BE                      1056  *   $8F - GO TO BOTTOM OF FILE.		$90 - UNDELETE LINE
26BE                      1057  *   $91 - DELETE LINE TO BUFFER.	$92 - UNDELETE BUFFER
26BE                      1058  *   $93 - RESET BUFFER POINTER.		$94 - ADVANCE TO END OF LINE
26BE                      1059  *   $95 - FIND KEY.			$96 - FINDNEXT KEY
26BE                      1060  *   $97 - INSERT SPACES TO NEXT TAB STOP
26BE                      1061  *
26BE                      1062  * CONTROL CODES OTHER THAN CARRIAGE-RETURN OR TAB ARE NOT PASSED BACK TO
26BE                      1063  * THE CALLING ROUTINE UNLESS THEY ARE PRECEDED BY A <ESCAPE>
26BE                      1064  *
26BE  34 14               1065  GETKEY	PSHS	B,X		SAVE REGISTERS
26C0  3F                  1066  KEYIN	SWI			SOFTWARE INTERRUPT TO DOS
26C1  22                  1067  	FCB	34		SYSTEM REQUEST NUMBER
26C2  81 7F               1068  	CMPA	#$7F		TEST FOR DELETE KEY
26C4  27 12               1069  	BEQ	DELKEY		NOT DELETE
26C6  81 1B               1070  	CMPA	#$1B		TEST FOR ESCAPE (BEGIN OF SEQUENCE)
26C8  27 16               1071  	BEQ	ESCAPE		NORMAL CHARACTER
26CA  81 0D               1072  	CMPA	#$0D		TEST FOR CR
26CC  27 43               1073  	BEQ	NORCHR		OK TO RETURN
26CE  81 09               1074  	CMPA	#$09		TEST FOR TAB
26D0  27 0A               1075  	BEQ	TABKEY		OK TO SEND BACK
26D2  81 20               1076  	CMPA	#' '		TEST FOR OTHER CHARACTERS
26D4  25 EA               1077  	BLO	KEYIN		IF SO, FORGET ANY CONTROL CODES
26D6  20 39               1078  	BRA	NORCHR		RETURN WITH CHARACTER
26D8  86 88               1079  DELKEY	LDA	#$88		INDICATE DELETE KEY
26DA  20 35               1080  	BRA	NORCHR		NORMAL CHARACTER
26DC  86 97               1081  TABKEY	LDA	#$97		INDICATE TAB KEY
26DE  20 31               1082  	BRA	NORCHR		INDICATE NORMAL
26E0  3F                  1083  ESCAPE	SWI			SOFTWARE INTERRUPT TO DOS
26E1  22                  1084  	FCB	34		SYSTEM REQUEST NUMBER
26E2  81 5B               1085  	CMPA	#'['		CURSOR KEYS
26E4  26 0C               1086  	BNE	NOCUR		NOT A CURSOR KEY
26E6  3F                  1087  	SWI			SOFTWARE INTERRUPT TO DOS
26E7  22                  1088  	FCB	34		SYSTEM REQUEST NUMBER
26E8  80 41               1089  	SUBA	#'A'		CONVERT TO BINARY
26EA  25 D4               1090  	BCS	KEYIN		INVALID, WAIT FOR NEXT KEY
26EC  81 03               1091  	CMPA	#3		TEST FOR OUT OF RANGE
26EE  2E D0               1092  	BGT	KEYIN		INVALID, GET NEXT KEY
26F0  20 1A               1093  	BRA	XLATE		TRANSLATE CHARACTER
26F2  81 4F               1094  NOCUR	CMPA	#'O'		TEST FOR KEYPAD CHARACTER
26F4  26 1B               1095  	BNE	NORCHR		NORMAL CHARACTER
26F6  3F                  1096  	SWI			SOFTWARE INTERRUPT TO DOS
26F7  22                  1097  	FCB	34		SYSTEM REQUEST NUMBER
26F8  80 49               1098  	SUBA	#$49		CONVERT TO BINARY
26FA  81 04               1099  	CMPA	#4		TEST FOR OUT OR RANGE
26FC  2D C2               1100  	BLT	KEYIN		IF SO, IGNORE
26FE  81 0A               1101  	CMPA	#$0A		TEST FOR OUT OF RANGE
2700  2F 0A               1102  	BLE	XLATE		PERFORM TRANSLATION
2702  80 18               1103  	SUBA	#$18		CONVERT TO BINARY
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 20

2704  81 0B               1104  	CMPA	#$B		TEST FOR IN RANGE
2706  2D B8               1105  	BLT	KEYIN		READ NEXT KEY
2708  81 18               1106  	CMPA	#$18		TEST FOR IN RANGE
270A  2E B4               1107  	BGT	KEYIN		NO, IGNORE
270C  8E 27 13            1108  XLATE	LDX	#CNVTAB		CONVERSION TABLE
270F  A6 86               1109  	LDA	A,X		GET CHARACTER
2711  35 94               1110  NORCHR	PULS	B,X,PC		RESTORE REGISTERS
2713                      1111  *
2713                      1112  * KEYCODE CONVERSION TABLE
2713                      1113  *
2713                      1114  * CURSOR MOVEMENT KEYS
2713                      1115  *
2713  80                  1116  CNVTAB	FCB	$80		CURSOR UP KEY
2714  81                  1117  	FCB	$81		CURSOR DOWN
2715  82                  1118  	FCB	$82		CURSOR RIGHT
2716  83                  1119  	FCB	$83		CURSOR LEFT
2717                      1120  * KEYPAD PF KEYS
2717  86                  1121  	FCB	$86		ENTER KEY
2718  FF                  1122  	FCB	$FF		N/A
2719  FF                  1123  	FCB	$FF		N/A
271A  89                  1124  	FCB	$89		PFKEY1
271B  8D                  1125  	FCB	$8D		PFKEY2
271C  95                  1126  	FCB	$95		PFKEY3
271D  8C                  1127  	FCB	$8C		PFKEY4
271E                      1128  * KEYPAD APPLICATION KEYS
271E  87                  1129  	FCB	$87		COMMA KEY
271F  90                  1130  	FCB	$90		DASH KEY
2720  93                  1131  	FCB	$93		DOT KEY
2721  FF                  1132  	FCB	$FF		N/A
2722  84                  1133  	FCB	$84		ZERO KEY
2723  85                  1134  	FCB	$85		ONE KEY
2724  94                  1135  	FCB	$94		TWO KEY
2725  91                  1136  	FCB	$91		THREE KEY
2726  8E                  1137  	FCB	$8E		FOUR KEY
2727  8F                  1138  	FCB	$8F		FIVE KEY
2728  92                  1139  	FCB	$92		SIX KEY
2729  8B                  1140  	FCB	$8B		SEVEN KEY
272A  8A                  1141  	FCB	$8A		EIGHT KEY
272B  96                  1142  	FCB	$96		NINE KEY
272C                      1143  *
272C                      1144  * COMMAND TABLE
272C                      1145  *
272C  84                  1146  CMDTAB	FCB	$84		REQUIRE AT LEAST 'QUIT'
272D  51 55 49 54         1147  	FCC	'QUIT'
2731  82                  1148  	FCB	$82		REQUIRE AT LEAST 'EX'
2732  45 58 49 54         1149  	FCC	'EXIT'
2736  82                  1150  	FCB	$82		REQUIRE AT LEAST 'AP'
2737  41 50 50 45 4E 44   1151  	FCC	'APPEND'
273D  82                  1152  	FCB	$82		REQUIRE AT LEAST 'SA'
273E  53 41 56 45         1153  	FCC	'SAVE'
2742  83                  1154  	FCB	$83		REUQIRE AT LEAST 'TAB'
2743  54 41 42 53         1155  	FCC	'TABS'
2747  83                  1156  	FCB	$83		REQUIRE AT LEAST 'SPA'
2748  53 50 41 43 45 53   1157  	FCC	'SPACES'
274E  82                  1158  	FCB	$82		REQUIRE AT LEAST 'DO'
274F  44 4F 53            1159  	FCC	'DOS'
2752  80                  1160  	FCB	$80		INDICATE END OF TABLE
2753                      1161  *
DUNFIELD 6809 ASSEMBLER: CUBIX SCREEN EDITOR                          PAGE: 21

2753                      1162  * MESSAGES
2753                      1163  *
2753  4E 65 77 20 66 69 + 1164  NEWMSG	FCCZ	'New file'
275C  46 69 6C 65 20 6C + 1165  OUTERR	FCCZ	'File limit reached.'
2770  50 72 65 73 73 20 + 1166  WAIMSG	FCCZ	'Press any Key to Continue'
278A  53 74 72 69 6E 67 + 1167  SNFMSG	FCCZ	'String not found'
279B  42 75 66 66 65 72 + 1168  RESMSG	FCCZ	'Buffer reset'
27A8  55 6E 6B 6E 6F 77 + 1169  ICMMSG	FCCZ	'Unknown Command'
27B8  49 6E 73 65 72 74 + 1170  INSON	FCCZ	'Insert on'
27C2  49 6E 73 65 72 74 + 1171  INSOFF	FCCZ	'Insert off'
27CD  5B 53 59 53 54 45 + 1172  HLPFIL	FCCZ	'[SYSTEM]ED.HLP'	HELP FILE
27DC  5B 45 4F 46 5D 00   1173  EOFMSG	FCCZ	'[EOF]'			END OF FILE MESSAGE
27E2  1B 5B 37 6D         1174  INVON	FCB	$1B,'[','7','m'		TURN ON INVERSE VIDEO
27E6  00                  1175  INVCHR	FCB	0			CHARACTER TO INVERSE
27E7  1B 5B 30 6D 00      1176  INVOFF	FCB	$1B,'[','0','m',0	TURN OFF INVERSE VIDEO
