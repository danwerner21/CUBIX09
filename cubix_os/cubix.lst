                      (        cubix.asm):00001         ;       title   CUBIX 6809 Operating System
                      (        cubix.asm):00002         ;*
                      (        cubix.asm):00003         ;* CUBIX Operating System for the 6809
                      (        cubix.asm):00004         ;*
                      (        cubix.asm):00005         ;* Copyright 1983-2005 Dave Dunfield
                      (        cubix.asm):00006         ;* All rights reserved.
                      (        cubix.asm):00007         ;*
                      (        cubix.asm):00008         ;* asmode=dist OR demo
                      (        cubix.asm):00009         
                      (        cubix.asm):00010                 IFDEF   dist
                      (        cubix.asm):00011         ;* MEMORY LOCATIONS FOR DISTRIBUTION (NON-PORTED) ROM
     E000             (        cubix.asm):00012         ROM             EQU $E000                         ; OS FIRMWARE
     DC00             (        cubix.asm):00013         RAM             EQU ROM-1024                      ; OS LOCAL STORAGE (1K)
     2000             (        cubix.asm):00014         USRRAM          EQU $2000                         ; START OF USER SUPPLIED RAM
     DFFF             (        cubix.asm):00015         USREND          EQU ROM-1                         ; RAMTEST STOPS HERE
                      (        cubix.asm):00016                 ENDIF
                      (        cubix.asm):00017                 IFDEF   demo
                      (        cubix.asm):00018         ;* MEMORY LOCATIONS FOR THE DEMO SYSTEM USING EXAMPLE DRIVERS
0000                  (        cubix.asm):00019         ROM             EQU $E000                         ; OS FORMWARE
0000                  (        cubix.asm):00020         RAM             EQU ROM-1024                      ; OS LOCAL STORAGE
0000                  (        cubix.asm):00021         USRRAM          EQU $2000                         ; START OF USER SUPPLIED RAM
0000                  (        cubix.asm):00022         USREND          EQU ROM-1                         ; RAMTEST STOPS HERE
0000                  (        cubix.asm):00023         dr_file         SET sample.sys
                      (        cubix.asm):00024                 ENDIF
                      (        cubix.asm):00025         ;* MISC CONSTANTS
     0008             (        cubix.asm):00026         NDEV            EQU 8                             ; NUMBER OF SERIAL DEVICES SUPPORTED
     0004             (        cubix.asm):00027         NDSK            EQU 4                             ; # OF DISK DRIVES SUPPORTED
     0000             (        cubix.asm):00028         DIRSEC          EQU 0                             ; DIRECTORY STARTS HERE
     0001             (        cubix.asm):00029         LNKSEC          EQU 1                             ; STARTING LINK SECTOR ON DISK
     00F0             (        cubix.asm):00030         DEFATR          EQU %11110000                     ; DEFAULT FILE ATTRIBUTES
                      (        cubix.asm):00031         ;* RETURN CODES
     0001             (        cubix.asm):00032         RCBOP           EQU 1                             ; BAD OPERAND
     0002             (        cubix.asm):00033         RCNOTF          EQU 2                             ; FILE NOT FOUND
     0003             (        cubix.asm):00034         RCPRO           EQU 3                             ; FILE PROTECTION VIOLATION
     0004             (        cubix.asm):00035         RCORE           EQU 4                             ; NOT OPEN FOR READ
     0005             (        cubix.asm):00036         RCOWE           EQU 5                             ; NOT OPEN FOR WRITE
     0006             (        cubix.asm):00037         RCEOF           EQU 6                             ; END OF FILE ENCOUNTERED
     0007             (        cubix.asm):00038         RCEXI           EQU 7                             ; FILE ALREADY EXISTS
     0008             (        cubix.asm):00039         RCNOS           EQU 8                             ; NO DISK SPACE AVAILABLE
     0009             (        cubix.asm):00040         RCDSK           EQU 9                             ; DISK ERROR
     000A             (        cubix.asm):00041         RCDEV           EQU 10                            ; INVALID DEVICE
     000B             (        cubix.asm):00042         RCDNL           EQU 11                            ; DOWNLOAD FAILURE
     00FF             (        cubix.asm):00043         RCCMD           EQU 255                           ; BAD COMMAND
                      (        cubix.asm):00044         ;* FILE PERMISSIONS
     0080             (        cubix.asm):00045         RPERM           EQU %10000000                     ; READ PERMISSION
     0040             (        cubix.asm):00046         WPERM           EQU %01000000                     ; WRITE PERMISSION
     0020             (        cubix.asm):00047         EPERM           EQU %00100000                     ; EXECUTE PERMISSION
     0010             (        cubix.asm):00048         DPERM           EQU %00010000                     ; DELETE PERMISSION
                      (        cubix.asm):00049         ;* DISK CONTROL BLOCK DESCRIPTION
                      (        cubix.asm):00050                 ORG     0
0000                  (        cubix.asm):00051         DRIVE
0000                  (        cubix.asm):00052                 RMB     1                                 ; DRIVE ID
0001                  (        cubix.asm):00053         NCYL
0001                  (        cubix.asm):00054                 RMB     1                                 ; # TRACKS
0002                  (        cubix.asm):00055         NHEAD
0002                  (        cubix.asm):00056                 RMB     1                                 ; # HEADS
0003                  (        cubix.asm):00057         NSEC
0003                  (        cubix.asm):00058                 RMB     1                                 ; # SECTORS/TRACK
0004                  (        cubix.asm):00059         CYL
0004                  (        cubix.asm):00060                 RMB     1                                 ; CURRENT CYLINDER
0005                  (        cubix.asm):00061         HEAD
0005                  (        cubix.asm):00062                 RMB     1                                 ; CURRENT HEAD
0006                  (        cubix.asm):00063         SEC
0006                  (        cubix.asm):00064                 RMB     1                                 ; CURRENT SECTOR
     0007             (        cubix.asm):00065         CSIZE           EQU *
                      (        cubix.asm):00066         ;* DIRECTORY ENTRY DESCRIPTION
                      (        cubix.asm):00067                 ORG     0
0000                  (        cubix.asm):00068         DPREFIX
0000                  (        cubix.asm):00069                 RMB     8                                 ; DIRECTORY PREFIX
0008                  (        cubix.asm):00070         DNAME
0008                  (        cubix.asm):00071                 RMB     8                                 ; FILENAME
0010                  (        cubix.asm):00072         DTYPE
0010                  (        cubix.asm):00073                 RMB     3                                 ; FILETYPE
0013                  (        cubix.asm):00074         DDADR
0013                  (        cubix.asm):00075                 RMB     2                                 ; DISK ADDRESS
0015                  (        cubix.asm):00076         DRADR
0015                  (        cubix.asm):00077                 RMB     2                                 ; RUN ADDRESS
0017                  (        cubix.asm):00078         DATTR
0017                  (        cubix.asm):00079                 RMB     1                                 ; FILE ATTRIBUTES
                      (        cubix.asm):00080         ;* FILE CONTROL BLOCK DESCRIPTION
                      (        cubix.asm):00081                 ORG     0
0000                  (        cubix.asm):00082         OTYPE
0000                  (        cubix.asm):00083                 RMB     1                                 ; TYPE OF OPEN (READ/WRITE ETC.)
0001                  (        cubix.asm):00084         ODRIVE
0001                  (        cubix.asm):00085                 RMB     1                                 ; DRIVE FILE IS ON
0002                  (        cubix.asm):00086         OFIRST
0002                  (        cubix.asm):00087                 RMB     2                                 ; FIRST SECTOR IN ILE
0004                  (        cubix.asm):00088         OSECTOR
0004                  (        cubix.asm):00089                 RMB     2                                 ; SECTOR BEING READ/WRITTEN
0006                  (        cubix.asm):00090         OLSTSEC
0006                  (        cubix.asm):00091                 RMB     2                                 ; LAST SECTOR READ/WRITTEN
0008                  (        cubix.asm):00092         OOFFSET
0008                  (        cubix.asm):00093                 RMB     2                                 ; OFFSET INTO SERIAL BUFFER
     000A             (        cubix.asm):00094         OSIZ            EQU *
                      (        cubix.asm):00095         ;* RAM VARIABLES
                      (        cubix.asm):00096                 ORG     RAM
DC00                  (        cubix.asm):00097         INBUFF
DC00                  (        cubix.asm):00098                 RMB     80                                ; INPUT BUFFER
     DC50             (        cubix.asm):00099         IRAM            EQU *                             ; START OF INITIALIZED RAM
DC50                  (        cubix.asm):00100         DCTRL
DC50                  (        cubix.asm):00101                 RMB     CSIZE*NDSK                        ; DRIVE CONTROL BLOCKS
DC6C                  (        cubix.asm):00102         CONIN
DC6C                  (        cubix.asm):00103                 RMB     1                                 ; SELECTED CONSOLE INPUT
DC6D                  (        cubix.asm):00104         CONOUT
DC6D                  (        cubix.asm):00105                 RMB     1                                 ; SELECTED CONSOLE OUTPUT
                      (        cubix.asm):00106         ;* DITAB MARKS START OF VECTOR TABLE
                      (        cubix.asm):00107         ;* SERIAL DEVICE DRIVERS
DC6E                  (        cubix.asm):00108         DITAB
DC6E                  (        cubix.asm):00109                 RMB     NDEV*2                            ; DEVICE INPUT DRIVERS
DC7E                  (        cubix.asm):00110         DOTAB
DC7E                  (        cubix.asm):00111                 RMB     NDEV*2                            ; DEVICE OUTPUT DRIVERS
                      (        cubix.asm):00112         ;* DISK DRIVERS
DC8E                  (        cubix.asm):00113         XHOME
DC8E                  (        cubix.asm):00114                 RMB     2                                 ; DISK HOME HEAD ROUTINE
DC90                  (        cubix.asm):00115         XRDSEC
DC90                  (        cubix.asm):00116                 RMB     2                                 ; DISK READ SECTOR ROUTINE
DC92                  (        cubix.asm):00117         XWRSEC
DC92                  (        cubix.asm):00118                 RMB     2                                 ; DISK WRITE SECTOR ROUTINE
DC94                  (        cubix.asm):00119         XFORMAT
DC94                  (        cubix.asm):00120                 RMB     2                                 ; DISK FORMAT ROUTINE
                      (        cubix.asm):00121         ;* MACHINE VECTORS
DC96                  (        cubix.asm):00122         SWIVEC
DC96                  (        cubix.asm):00123                 RMB     2                                 ; SWI HANDLER VECTOR
DC98                  (        cubix.asm):00124         SWI2VEC
DC98                  (        cubix.asm):00125                 RMB     2                                 ; SWI2 INTERRUPT VECTOR
DC9A                  (        cubix.asm):00126         SWI3VEC
DC9A                  (        cubix.asm):00127                 RMB     2                                 ; SWI3 INTERRUPT VECTOR
DC9C                  (        cubix.asm):00128         IRQVEC
DC9C                  (        cubix.asm):00129                 RMB     2                                 ; IRQ HANDLER VECTOR
DC9E                  (        cubix.asm):00130         FIRQVEC
DC9E                  (        cubix.asm):00131                 RMB     2                                 ; FIRQ HANDLER VECTOR
DCA0                  (        cubix.asm):00132         NMIVEC
DCA0                  (        cubix.asm):00133                 RMB     2                                 ; NMI HANDLER VECTOR
                      (        cubix.asm):00134         ;* MSGFLG MARKS START OF FLAG TABLES
DCA2                  (        cubix.asm):00135         MSGFLG
DCA2                  (        cubix.asm):00136                 RMB     1                                 ; MESSAGE ENABLED FLAG
DCA3                  (        cubix.asm):00137         DBGFLG
DCA3                  (        cubix.asm):00138                 RMB     1                                 ; DEBUG FLAG
DCA4                  (        cubix.asm):00139         TRCFLG
DCA4                  (        cubix.asm):00140                 RMB     1                                 ; TRACE ENABLED FLAG
     0003             (        cubix.asm):00141         NUMFLG          EQU 3                             ; # FLAGS SUPPORTED
                      (        cubix.asm):00142         ;* DEFAULT DIRECTORY
DCA5                  (        cubix.asm):00143         DEFDRV
DCA5                  (        cubix.asm):00144                 RMB     1                                 ; DEFAULT DRIVE
DCA6                  (        cubix.asm):00145         DEFDIR
DCA6                  (        cubix.asm):00146                 RMB     8                                 ; DEFAULT DIRECTORY
                      (        cubix.asm):00147         ;* SYSTEM DIRECTORY
DCAE                  (        cubix.asm):00148         SYSDRV
DCAE                  (        cubix.asm):00149                 RMB     1                                 ; SYSTEM DRIVE
DCAF                  (        cubix.asm):00150         SYSDIR
DCAF                  (        cubix.asm):00151                 RMB     8                                 ; SYSTEM DIRECTORY
                      (        cubix.asm):00152         ;* NON-INITIALIZED GLOBAL RAM
DCB7                  (        cubix.asm):00153         FDRIVE
DCB7                  (        cubix.asm):00154                 RMB     1                                 ; CURRENT DISK DRIVE
DCB8                  (        cubix.asm):00155         PREFIX
DCB8                  (        cubix.asm):00156                 RMB     8                                 ; DIRECTORY PREFIX
DCC0                  (        cubix.asm):00157         FNAME
DCC0                  (        cubix.asm):00158                 RMB     8                                 ; FILENAME
DCC8                  (        cubix.asm):00159         FTYPE
DCC8                  (        cubix.asm):00160                 RMB     3                                 ; FILETYPE
DCCB                  (        cubix.asm):00161         TEMP
DCCB                  (        cubix.asm):00162                 RMB     2                                 ; TEMPORARY STORAGE
DCCD                  (        cubix.asm):00163         TEMP1
DCCD                  (        cubix.asm):00164                 RMB     2                                 ; MORE TEMPORARY STORAGE
DCCF                  (        cubix.asm):00165         TEMP2
DCCF                  (        cubix.asm):00166                 RMB     2                                 ;STILL MORE
DCD1                  (        cubix.asm):00167         TEMP3
DCD1                  (        cubix.asm):00168                 RMB     2                                 ;STILL MORE
DCD3                  (        cubix.asm):00169         TEMP4
DCD3                  (        cubix.asm):00170                 RMB     2                                 ;STILL MORE
DCD5                  (        cubix.asm):00171         SAVB
DCD5                  (        cubix.asm):00172                 RMB     1                                 ;CALLERS 'B' REGISTER
DCD6                  (        cubix.asm):00173         SAVX
DCD6                  (        cubix.asm):00174                 RMB     2                                 ;CALLERS 'X' REGISTER
DCD8                  (        cubix.asm):00175         SAVY
DCD8                  (        cubix.asm):00176                 RMB     2                                 ;CALLERS 'Y' REGISTER
DCDA                  (        cubix.asm):00177         SAVDRV
DCDA                  (        cubix.asm):00178                 RMB     1                                 ;CALLERS ACTIVE DRIVE
DCDB                  (        cubix.asm):00179         SAVSTK
DCDB                  (        cubix.asm):00180                 RMB     2                                 ;CALLERS STACK POINTER
DCDD                  (        cubix.asm):00181         WRKCHG
DCDD                  (        cubix.asm):00182                 RMB     1                                 ;WORK SECTOR CHANGED
DCDE                  (        cubix.asm):00183         WRKDRV
DCDE                  (        cubix.asm):00184                 RMB     1                                 ;CURRENT WORK SECTOR DRIVE
DCDF                  (        cubix.asm):00185         WRKSEC
DCDF                  (        cubix.asm):00186                 RMB     2                                 ;CURRENT WORK SECTOR
DCE1                  (        cubix.asm):00187         CMDDRV
DCE1                  (        cubix.asm):00188                 RMB     1                                 ;CURRENT COMMAND FILE DRIVE
DCE2                  (        cubix.asm):00189         CMDSEC
DCE2                  (        cubix.asm):00190                 RMB     2                                 ;CURRENTLY OPEN COMMAND FILE SECTOR
DCE4                  (        cubix.asm):00191         CMDOFF
DCE4                  (        cubix.asm):00192                 RMB     2                                 ;OFFSET INTO COMMAND FILE SECTOR
DCE6                  (        cubix.asm):00193         CMDSTK
DCE6                  (        cubix.asm):00194                 RMB     2                                 ;COMMAND PROCESSOR STACK PTR
DCE8                  (        cubix.asm):00195         CMDRC
DCE8                  (        cubix.asm):00196                 RMB     1                                 ;COMMAND FILE RETURN CODES
DCE9                  (        cubix.asm):00197         OLDSTK
DCE9                  (        cubix.asm):00198                 RMB     2                                 ;STACK FROM BEFORE TEMP ENTRY
DCEB                  (        cubix.asm):00199         SDRIVE
DCEB                  (        cubix.asm):00200                 RMB     1                                 ;CURRENTLY SELECTED DRIVE
DCEC                  (        cubix.asm):00201         ERRCNT
DCEC                  (        cubix.asm):00202                 RMB     1                                 ;DISK ERROR RETRY COUNT
DCED                  (        cubix.asm):00203         CMDBUF
DCED                  (        cubix.asm):00204                 RMB     80                                ;COMMAND BUFFER PARAMETER SAVE AREA
     DE00             (        cubix.asm):00205         STACK           EQU RAM+512                       ;SYSTEM STACK
     DE00             (        cubix.asm):00206         WRKSPC          EQU STACK                         ;WORK AREA
                      (        cubix.asm):00207         ;*
                      (        cubix.asm):00208                 ORG     ROM
                      (        cubix.asm):00209         ;* MISC FIXED CONSTANTS
E000                  (        cubix.asm):00210         ROMCHK
E000 FFFF             (        cubix.asm):00211                 FDB     $FFFF                             ;BLANK SPACE TO INSERT CHECKSUM
                      (        cubix.asm):00212                 IFDEF   test
                      (        cubix.asm):00213                 LDD     #ssr
                      (        cubix.asm):00214                 STD     >tvector
                      (        cubix.asm):00215                 JMP     begin
                      (        cubix.asm):00216                 ENDIF
E002                  (        cubix.asm):00217         MBASE
E002 2000             (        cubix.asm):00218                 FDB     USRRAM                            ;BASE MEMORY ADDRESS
                      (        cubix.asm):00219         ;*
                      (        cubix.asm):00220         ;* HARDWARE INITIALIZATION ROUTINE
                      (        cubix.asm):00221         ;*
E004                  (        cubix.asm):00222         DOINIT
E004 108EDC50         (        cubix.asm):00223                 LDY     #IRAM                             ;POINT TO INITIALIZED RAM
E008 7EF92C           (        cubix.asm):00224                 JMP     HWINIT                            ;INIT HARDWARE
                      (        cubix.asm):00225         ;*
                      (        cubix.asm):00226         ;* APPLICATION PROGRAM INTERFACE
                      (        cubix.asm):00227         ;*
E00B                  (        cubix.asm):00228         SSR
E00B F7DCD5           (        cubix.asm):00229                 STB     >SAVB                             ;APPLICS SAVED 'B'
E00E BFDCD6           (        cubix.asm):00230                 STX     >SAVX                             ;APPLICS SAVED 'X'
E011 10BFDCD8         (        cubix.asm):00231                 STY     >SAVY                             ;APPLICS SAVED 'Y'
E015 F6DCEB           (        cubix.asm):00232                 LDB     >SDRIVE                           ;GET DOS DRIVE
E018 F7DCDA           (        cubix.asm):00233                 STB     >SAVDRV                           ;SET SAVED DRIVE
E01B 316A             (        cubix.asm):00234                 LEAY    10,S                              ;ADDR OF SAVED PC
E01D AEA4             (        cubix.asm):00235                 LDX     ,Y                                ;GET IT
E01F E680             (        cubix.asm):00236                 LDB     ,X+                               ;GET OPERAND BYTE
E021 AFA4             (        cubix.asm):00237                 STX     ,Y                                ;SAVE UPDATED PC
E023 C16F             (        cubix.asm):00238                 CMPB    #NUMSSR                           ;IS IT A VALID CALL #
E025 2437             (        cubix.asm):00239                 BHS     INVSSR                            ;INVALID CALL
E027 58               (        cubix.asm):00240                 ASLB                                      ;DOUBLE FOR TWO BYTE ENTRIES
E028 8EF84E           (        cubix.asm):00241                 LDX     #SSRTAB                           ;OFFSET TO IT
E02B 3A               (        cubix.asm):00242                 ABX                                       ;UNSIGNED ADD
E02C EC84             (        cubix.asm):00243                 LDD     ,X                                ;GET ADDRESS
E02E FDDCCB           (        cubix.asm):00244                 STD     >TEMP                             ;SAVE SO WE CAN EXEC
E031 10BFDCDB         (        cubix.asm):00245                 STY     >SAVSTK                           ;SAVE STACK POINTER
E035 B6DCA3           (        cubix.asm):00246                 LDA     >DBGFLG                           ;DEBUGGING?
E038 2606             (        cubix.asm):00247                 BNE     DBGSSR                            ;YES, OUTPUT DATA
E03A 357F             (        cubix.asm):00248                 PULS    CC,A,B,DP,X,Y,U                   ;RESTORE APPLICS REGS
E03C 6E9FDCCB         (        cubix.asm):00249                 JMP     [TEMP]                            ;EXECUTE SYSTEM CALL
E040                  (        cubix.asm):00250         DBGSSR
E040 BDE541           (        cubix.asm):00251                 JSR     WRLIN                             ;OUTPUT LINE
E043 53535220         (        cubix.asm):00252                 FCC     'SSR '
E047 00               (        cubix.asm):00253                 FCB     $00
E048 AEA4             (        cubix.asm):00254                 LDX     ,Y                                ;RECOVER PC
E04A E61F             (        cubix.asm):00255                 LDB     -1,X                              ;GET NUMBER BACK
E04C BDE470           (        cubix.asm):00256                 JSR     WRDEC8                            ;OUTPUT
E04F BDE541           (        cubix.asm):00257                 JSR     WRLIN
E052 202D20           (        cubix.asm):00258                 FCC     ' - '
E055 00               (        cubix.asm):00259                 FCB     $00
E056 357F             (        cubix.asm):00260                 PULS    CC,A,B,DP,X,Y,U
E058 8D33             (        cubix.asm):00261                 BSR     DMPREG1                           ;DISPLAY REGS
E05A 6E9FDCCB         (        cubix.asm):00262                 JMP     [TEMP]
E05E                  (        cubix.asm):00263         INVSSR
E05E 1F24             (        cubix.asm):00264                 TFR     Y,S                               ;FIX STACK
E060 BDE541           (        cubix.asm):00265                 JSR     WRLIN                             ;OUTPUT LINE
E063 496E76616C696420 (        cubix.asm):00266                 FCC     'Invalid SSR '
     53535220
E06F 00               (        cubix.asm):00267                 FCB     $00
E070 BDE470           (        cubix.asm):00268                 JSR     WRDEC8                            ;OUTPUT
E073 BDE541           (        cubix.asm):00269                 JSR     WRLIN                             ;OUTPUT LINE
E076 2061742024       (        cubix.asm):00270                 FCC     ' at $'
E07B 00               (        cubix.asm):00271                 FCB     $00
E07C ECE1             (        cubix.asm):00272                 LDD     ,S++                              ;GET ADDR
E07E 830002           (        cubix.asm):00273                 SUBD    #2                                ;BACK TO ADDRESS
E081 BDE538           (        cubix.asm):00274                 JSR     WRHEXW                            ;OUTPUT
E084 BDE57B           (        cubix.asm):00275                 JSR     LFCR                              ;NEW LINE
E087 7EE1B9           (        cubix.asm):00276                 JMP     DOSKCM                            ;RE-ENTER, INSURE NO COMMAND
E08A                  (        cubix.asm):00277         DMPREG
E08A 8D01             (        cubix.asm):00278                 BSR     DMPREG1                           ;BSR SO PC ON STACK,4
E08C 39               (        cubix.asm):00279                 RTS
                      (        cubix.asm):00280         ;* DEBUG ROUTINE
E08D                  (        cubix.asm):00281         DMPREG1
E08D 3407             (        cubix.asm):00282                 PSHS    CC,A,B                            ;SAVE REGS
E08F BDE541           (        cubix.asm):00283                 JSR     WRLIN                             ;OUTPUT MESSAGE
E092 50433D           (        cubix.asm):00284                 FCC     'PC='
E095 00               (        cubix.asm):00285                 FCB     $00
E096 EC65             (        cubix.asm):00286                 LDD     5,S                               ;GET PC
E098 830002           (        cubix.asm):00287                 SUBD    #2                                ;BACK UP TO SSR ADDRESS
E09B BDE538           (        cubix.asm):00288                 JSR     WRHEXW                            ;OUTPUT HEX WORD
E09E BDE541           (        cubix.asm):00289                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0A1 2043433D         (        cubix.asm):00290                 FCC     ' CC='
E0A5 00               (        cubix.asm):00291                 FCB     $00
E0A6 A6E4             (        cubix.asm):00292                 LDA     ,S                                ;GET CONDITION CODE
E0A8 BDE54D           (        cubix.asm):00293                 JSR     WRHEX                             ;OUTPUT HEX BYTE
E0AB BDE541           (        cubix.asm):00294                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0AE 2044503D         (        cubix.asm):00295                 FCC     ' DP='
E0B2 00               (        cubix.asm):00296                 FCB     $00
E0B3 1FB8             (        cubix.asm):00297                 TFR     DP,A                              ;GET DIRECT PAGE
E0B5 BDE54D           (        cubix.asm):00298                 JSR     WRHEX                             ;OUTPUT HEX BYTE
E0B8 BDE541           (        cubix.asm):00299                 JSR     WRLIN                             ;OUTPUT MESSAHE
E0BB 20413D           (        cubix.asm):00300                 FCC     ' A='
E0BE 00               (        cubix.asm):00301                 FCB     $00
E0BF A661             (        cubix.asm):00302                 LDA     1,S                               ;GET SAVED 'A'
E0C1 BDE54D           (        cubix.asm):00303                 JSR     WRHEX                             ;OUTPUT HEX BYTE
E0C4 BDE541           (        cubix.asm):00304                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0C7 20423D           (        cubix.asm):00305                 FCC     ' B='
E0CA 00               (        cubix.asm):00306                 FCB     $00
E0CB A662             (        cubix.asm):00307                 LDA     2,S                               ;GET SAVED 'B'
E0CD BDE54D           (        cubix.asm):00308                 JSR     WRHEX                             ;OUTPUT HEX BYTE
E0D0 BDE541           (        cubix.asm):00309                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0D3 20583D           (        cubix.asm):00310                 FCC     ' X='
E0D6 00               (        cubix.asm):00311                 FCB     $00
E0D7 1F10             (        cubix.asm):00312                 TFR     X,D                               ;GET 'X'
E0D9 BDE538           (        cubix.asm):00313                 JSR     WRHEXW                            ;OUTPUT HEX WORD
E0DC BDE541           (        cubix.asm):00314                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0DF 20593D           (        cubix.asm):00315                 FCC     ' Y='
E0E2 00               (        cubix.asm):00316                 FCB     $00
E0E3 1F20             (        cubix.asm):00317                 TFR     Y,D                               ;GET 'Y'
E0E5 BDE538           (        cubix.asm):00318                 JSR     WRHEXW                            ;OUTPUT HEX WORD
E0E8 BDE541           (        cubix.asm):00319                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0EB 20553D           (        cubix.asm):00320                 FCC     ' U='
E0EE 00               (        cubix.asm):00321                 FCB     $00
E0EF 1F30             (        cubix.asm):00322                 TFR     U,D                               ;GET 'U'
E0F1 BDE538           (        cubix.asm):00323                 JSR     WRHEXW                            ;OUTPUT HEX WORD
E0F4 BDE541           (        cubix.asm):00324                 JSR     WRLIN                             ;OUTPUT MESSAGE
E0F7 20533D           (        cubix.asm):00325                 FCC     ' S='
E0FA 00               (        cubix.asm):00326                 FCB     $00
E0FB 1F40             (        cubix.asm):00327                 TFR     S,D                               ;GET 'S'
E0FD C30007           (        cubix.asm):00328                 ADDD    #7                                ;DISCOUNT WHAT WE STACKED
E100 BDE538           (        cubix.asm):00329                 JSR     WRHEXW                            ;OUTPUT HEX WORD
E103 BDE57B           (        cubix.asm):00330                 JSR     LFCR                              ;OUTPUT NEW LINE
E106 3587             (        cubix.asm):00331                 PULS    CC,A,B,PC                         ;RESTORE & RETURN
                      (        cubix.asm):00332         ;*
                      (        cubix.asm):00333         ;* ZERO WORK RAM & INIT HARDWARE DEVICES
                      (        cubix.asm):00334         ;*
E108                  (        cubix.asm):00335         BEGIN
E108 10CEDE00         (        cubix.asm):00336                 LDS     #STACK                            ;SET UP SYSTEM STACK
                      (        cubix.asm):00337         ;        IFDEF   epc
                      (        cubix.asm):00338         ;        CLR     $1400                             ;clear ram page
                      (        cubix.asm):00339         ;        ENDIF
                      (        cubix.asm):00340         ;        LDX     #RAM                              ;POINT TO START OF RAM
                      (        cubix.asm):00341         ;BEG1
                      (        cubix.asm):00342         ;        CLR     ,X+                               ;ZERO IT
                      (        cubix.asm):00343         ;        CMPX    #STACK                            ;AT END?
                      (        cubix.asm):00344         ;        BLO     BEG1                              ;CONTINUE
E10C BDE004           (        cubix.asm):00345                 JSR     DOINIT                            ;INITIALIZE HARDWARE
E10F BDE618           (        cubix.asm):00346                 JSR     PURGE1                            ;INITIALIZE WORK SECTOR
                      (        cubix.asm):00347         ;        CLR     >ERRCNT                           ;INDICATE NO ERRORS
                      (        cubix.asm):00348         ;        IFNDEF  test
                      (        cubix.asm):00349         ;;* PERFORM CHECKSUM TEST OF ROM
                      (        cubix.asm):00350         ;        JSR     WRLIN                             ;OUTPUT MESSAGE
                      (        cubix.asm):00351         ;        FCC     'ROM... '
                      (        cubix.asm):00352         ;        LDX     #ROMCHK+2                         ;CHECKSUM STARTS HERE
                      (        cubix.asm):00353         ;        CLRA                                      ;ZERO HIGH
                      (        cubix.asm):00354         ;        CLRB                                      ;ZERO LOW
                      (        cubix.asm):00355         ;ROMT1
                      (        cubix.asm):00356         ;        ADDB    ,X+                               ;ADD IN ONE BYTE
                      (        cubix.asm):00357         ;        ADCA    #0                                ;INSURE HIGH INCREMENTS
                      (        cubix.asm):00358         ;        CMPX    #0                                ;AT END OF ROM?
                      (        cubix.asm):00359         ;        BNE     ROMT1                             ;NO, KEEP TRYING
                      (        cubix.asm):00360         ;        CMPD    >ROMCHK                           ;DOES CHECKSUM MATCH?
                      (        cubix.asm):00361         ;        BEQ     ROMT2                             ;YES, ITS OK
                      (        cubix.asm):00362         ;;* ROM TEST FAILED
                      (        cubix.asm):00363         ;        JSR     WRMSG                             ;OUTPUT MESSAGE
                      (        cubix.asm):00364         ;        FCC     'Failed'
                      (        cubix.asm):00365         ;        DEC     >ERRCNT                           ;SET FLAG, INDICATE ERROR
                      (        cubix.asm):00366         ;        BRA     ROMT3
                      (        cubix.asm):00367         ;* ROM TEST PASSED
                      (        cubix.asm):00368         ;ROMT2
                      (        cubix.asm):00369         ;        BSR     SPASS                             ;DISPLAY PASSED MESSAGE
                      (        cubix.asm):00370         ;        ENDIF
                      (        cubix.asm):00371         ;;* PERFORM WALKING BIT TEST OF RAM
                      (        cubix.asm):00372         ;ROMT3
                      (        cubix.asm):00373         ;        JSR     WRLIN                             ;OUTPUT MESSAGE
                      (        cubix.asm):00374         ;        FCC     'RAM... '
                      (        cubix.asm):00375         ;        LDX     >MBASE                            ;GET BASE RAM ADDRESS
                      (        cubix.asm):00376         ;RAMT1
                      (        cubix.asm):00377         ;        LDA     ,X                                ;GET ORIGINAL DATA BYTE
                      (        cubix.asm):00378         ;        LDB     #%10000000                        ;BEGIN WITH LEFTMOST BIT
                      (        cubix.asm):00379         ;RAMT2
                      (        cubix.asm):00380         ;        STB     ,X                                ;WRITE TEST PATTERN
                      (        cubix.asm):00381         ;        CMPB    ,X                                ;DOES IT MATCH
                      (        cubix.asm):00382         ;        BNE     RAMT5                             ;NO, FAILED
                      (        cubix.asm):00383         ;        LSRB                                      ;SHIFT BIT
                      (        cubix.asm):00384         ;        BNE     RAMT2                             ;DO NEXT BIT
                      (        cubix.asm):00385         ;        STA     ,X+                               ;RESTORE ORIGINAL DATA
                      (        cubix.asm):00386         ;;* ON EVEN PAGE BOUNDARYS, TEST FOR ABORT KEY
                      (        cubix.asm):00387         ;        TFR     X,D                               ;GET ADDRESS
                      (        cubix.asm):00388         ;        TSTB                                      ;EVEN BOUNDARY?
                      (        cubix.asm):00389         ;        BNE     RAMT3                             ;NO, DON'T TEST
                      (        cubix.asm):00390         ;        JSR     TSTCHR                            ;ANY CHARACTERS RECEIVED?
                      (        cubix.asm):00391         ;        CMPA    #$1B                              ;ESCAPE ABORTS?
                      (        cubix.asm):00392         ;        BEQ     RAMT4                             ;ABORT RAM TEST
                      (        cubix.asm):00393         ;;* CONTINUE TILL AT END OF USER RAM
                      (        cubix.asm):00394         ;RAMT3
                      (        cubix.asm):00395         ;        CMPX    #USREND                           ;ARE WE OVER?
                      (        cubix.asm):00396         ;        BLO     RAMT1                             ;NO, ITS OK
                      (        cubix.asm):00397         ;;* FINISHED, RAM TEST PASSED
                      (        cubix.asm):00398         ;        BSR     SPASS                             ;INDICATE SUCCESS
                      (        cubix.asm):00399         ;        BRA     HELLO                             ;AND PROCEED
                      (        cubix.asm):00400         ;* DISPLAY 'PASSED' MESSAGE
                      (        cubix.asm):00401         ;SPASS
                      (        cubix.asm):00402         ;        JSR     WRMSG                             ;OUTPUT MESSAGE
                      (        cubix.asm):00403         ;        FCC     'Passed'
                      (        cubix.asm):00404         ;        RTS
                      (        cubix.asm):00405         ;;* RAM TEST ABORTED BY ESCAPE
                      (        cubix.asm):00406         ;RAMT4
                      (        cubix.asm):00407         ;        JSR     WRMSG                             ;OUTPUT MESSAGE
                      (        cubix.asm):00408         ;        FCC     'Aborted'
                      (        cubix.asm):00409         ;        BRA     RAMT6                             ;AND CONTINUE
                      (        cubix.asm):00410         ;;* RAM TEST FAILED,
                      (        cubix.asm):00411         ;RAMT5
                      (        cubix.asm):00412         ;        STA     ,X                                ;RESAVE OLD VALUE
                      (        cubix.asm):00413         ;        JSR     WRLIN                             ;OUTPUT FAILED MESSAGE
                      (        cubix.asm):00414         ;        FCC     'Failed at $'
                      (        cubix.asm):00415         ;        TFR     X,D                               ;GET ADDRESS
                      (        cubix.asm):00416         ;        JSR     WRHEXW                            ;DISPLAY IN HEX
                      (        cubix.asm):00417         ;        JSR     LFCR                              ;NEW LINE
                      (        cubix.asm):00418         ;RAMT6
                      (        cubix.asm):00419         ;        DEC     >ERRCNT                           ;INDICATE ERRORS
                      (        cubix.asm):00420         ;* ISSUE HEARALD MESSAGE & START THE BALL ROLLING
E112                  (        cubix.asm):00421         HELLO
E112 BDE571           (        cubix.asm):00422                 JSR     WRMSG
E115 0A               (        cubix.asm):00423                 FCB     $0A
E116 4355424958207665 (        cubix.asm):00424                 FCC     'CUBIX version 1.5'
     7273696F6E20312E
     35
E127 0A0D0A           (        cubix.asm):00425                 FCB     $0A,$0D,$0A
E12A 436F707972696768 (        cubix.asm):00426                 FCC     'Copyright 1983-2005 Dave Dunfield'
     7420313938332D32
     3030352044617665
     2044756E6669656C
     64
E14B 0A0D             (        cubix.asm):00427                 FCB     $0A,$0D
E14D 416C6C2072696768 (        cubix.asm):00428                 FCC     'All rights reserved'
     7473207265736572
     766564
E160 0A0D00           (        cubix.asm):00429                 FCB     $0A,$0D,0
                      (        cubix.asm):00430         
                      (        cubix.asm):00431         
                      (        cubix.asm):00432         
                      (        cubix.asm):00433         
                      (        cubix.asm):00434         ; prep the hdd!
                      (        cubix.asm):00435         ;        LDY     #$0201
                      (        cubix.asm):00436         ;prp0:
                      (        cubix.asm):00437         ;        DEY
                      (        cubix.asm):00438         ;        LDA     #$FF
                      (        cubix.asm):00439         ;        STA     HSTBUF,y
                      (        cubix.asm):00440         ;        CMPY    #$0000
                      (        cubix.asm):00441         ;        BNE     prp0;
                      (        cubix.asm):00442         ;
                      (        cubix.asm):00443         ;        LDY     #$00ff
                      (        cubix.asm):00444         ;prp1:
                      (        cubix.asm):00445         ;       DEY
                      (        cubix.asm):00446         ;      PSHS    y
                      (        cubix.asm):00447         ;     LDA     #$03
                      (        cubix.asm):00448         ;    STA     DRIVE,U
                      (        cubix.asm):00449         ;   LDA     #$00
                      (        cubix.asm):00450         ;STA     HEAD,U
                      (        cubix.asm):00451         ;LDA     #$00
                      (        cubix.asm):00452         ;STA     CYL,U
                      (        cubix.asm):00453         ;TFR     y,a
                      (        cubix.asm):00454         ;STA     SEC,U
                      (        cubix.asm):00455         ;LDX     #HSTBUF
                      (        cubix.asm):00456         ;JSR     IDE_WRITE_SECTOR
                      (        cubix.asm):00457         ;PULS    y
                      (        cubix.asm):00458         ;CMPY    #$0000
                      (        cubix.asm):00459         ;BNE     prp1
                      (        cubix.asm):00460         
                      (        cubix.asm):00461         
                      (        cubix.asm):00462         
                      (        cubix.asm):00463         
                      (        cubix.asm):00464         
                      (        cubix.asm):00465         
                      (        cubix.asm):00466         
                      (        cubix.asm):00467         ;* IF NO ERRORS, EXECUTE THE STARTUP FILE
E163 B6DCEC           (        cubix.asm):00468                 LDA     >ERRCNT                           ;GET ERROR FLAG
E166 2618             (        cubix.asm):00469                 BNE     CMD                               ;ERRORS, DO NOT EXECUTE
E168 108EF6FA         (        cubix.asm):00470                 LDY     #IPLFILE                          ;POINT TO IPL FILE
E16C BDE36A           (        cubix.asm):00471                 JSR     GETNAM                            ;GET FILE NAME
E16F CEE180           (        cubix.asm):00472                 LDU     #CMD                              ;ADDRESS TO RETURN TO
E172 3440             (        cubix.asm):00473                 PSHS    U                                 ;SAVE ON STACK (FAKE JSR)
E174 10FFDCDB         (        cubix.asm):00474                 STS     >SAVSTK                           ;SAVE STACK INCASE ERROR
E178 BDE685           (        cubix.asm):00475                 JSR     LOCDIR                            ;LOCATE FILE IN DIRECTORY
E17B 2603             (        cubix.asm):00476                 BNE     CMD                               ;NOT FOUND, REPORT ERROR
E17D 7EE24E           (        cubix.asm):00477                 JMP     EXE3                              ;EXECUTE FILE
                      (        cubix.asm):00478         ;*
                      (        cubix.asm):00479         ;* COMMAND INTERPRETER
                      (        cubix.asm):00480         ;*
E180                  (        cubix.asm):00481         CMD
E180 10CEDE00         (        cubix.asm):00482                 LDS     #STACK                            ;SET UP STACK
E184 BDE626           (        cubix.asm):00483                 JSR     WRTST                             ;WRITE OUT WORK SECTOR IF MODIFIED
E187 BDE498           (        cubix.asm):00484                 JSR     GLINE                             ;GET LINE OF INPUT
E18A 8D34             (        cubix.asm):00485                 BSR     EXECMD                            ;EXECUTE COMMAND
E18C                  (        cubix.asm):00486         RCRET
E18C 27F2             (        cubix.asm):00487                 BEQ     CMD                               ;NO RETURN CODE TO DISPLAY
E18E 1F89             (        cubix.asm):00488                 TFR     A,B                               ;WRITE IT
E190 BDE541           (        cubix.asm):00489                 JSR     WRLIN                             ;OUTPUT MESSAGE
E193 52633D           (        cubix.asm):00490                 FCC     'Rc='
E196 00               (        cubix.asm):00491                 FCB     $00
E197 BDE470           (        cubix.asm):00492                 JSR     WRDEC8                            ;OUTPUT IN DECIMAL
E19A BDE57B           (        cubix.asm):00493                 JSR     LFCR                              ;NEW LINE
E19D 20E1             (        cubix.asm):00494                 BRA     CMD                               ;GET NEXT COMMAND
                      (        cubix.asm):00495         ;* RE-ENTRY POINT
E19F                  (        cubix.asm):00496         REENT
E19F 3401             (        cubix.asm):00497                 PSHS    CC                                ;SAVE CC
E1A1 8E0000           (        cubix.asm):00498                 LDX     #0                                ;GET A ZERO
E1A4 BFDCE9           (        cubix.asm):00499                 STX     >OLDSTK                           ;CLEAR RETURN STACK
E1A7 BEDCE6           (        cubix.asm):00500                 LDX     >CMDSTK                           ;GET CMD STACK
E1AA 2604             (        cubix.asm):00501                 BNE     CMDGO                             ;KEEP IT GOING
E1AC 3501             (        cubix.asm):00502                 PULS    CC                                ;RESTORE CC
E1AE 20DC             (        cubix.asm):00503                 BRA     RCRET                             ;AND CONTINUE
E1B0                  (        cubix.asm):00504         CMDGO
E1B0 3501             (        cubix.asm):00505                 PULS    CC
E1B2 7EF571           (        cubix.asm):00506                 JMP     CMDRET                            ;RETURN TO COMMAND
                      (        cubix.asm):00507         ;* TEMPORARY DOS ENTRY
E1B5                  (        cubix.asm):00508         TMPENT
E1B5 10FFDCE9         (        cubix.asm):00509                 STS     >OLDSTK                           ;SAVE OLD STACK
E1B9                  (        cubix.asm):00510         DOSKCM
E1B9 4F               (        cubix.asm):00511                 CLRA
E1BA 5F               (        cubix.asm):00512                 CLRB
E1BB FDDCE6           (        cubix.asm):00513                 STD     >CMDSTK                           ;ZERO COMAND STACK
E1BE 20C0             (        cubix.asm):00514                 BRA     CMD                               ;CONTINUE
                      (        cubix.asm):00515         ;*
                      (        cubix.asm):00516         ;* EXECUTE DOS COMMAND(Y)
                      (        cubix.asm):00517         ;*
E1C0                  (        cubix.asm):00518         EXECMD
E1C0 10FFDCDB         (        cubix.asm):00519                 STS     >SAVSTK                           ;SAVE STACK POINTER
E1C4 B6DCEB           (        cubix.asm):00520                 LDA     >SDRIVE                           ;GET DISK DRIVE
E1C7 B7DCDA           (        cubix.asm):00521                 STA     >SAVDRV                           ;SAVE SELECTED DRIVE
E1CA BDE4CF           (        cubix.asm):00522                 JSR     SKIP                              ;LOOK FOR NULL COMMAND
E1CD 271A             (        cubix.asm):00523                 BEQ     NULCMD                            ;DON'T EXECUTE NULL
E1CF 10BFDCCF         (        cubix.asm):00524                 STY     >TEMP2                            ;SAVED POINTER TO COMMAND
E1D3 8140             (        cubix.asm):00525                 CMPA    #'@'                              ;EXECUTE COMMAND FILE?
E1D5 10271287         (        cubix.asm):00526                 LBEQ    COMFIL                            ;DO IT
E1D9 8EF7DC           (        cubix.asm):00527                 LDX     #CMDNAM                           ;POINT TO COMMAND TABLE
E1DC BDE4F8           (        cubix.asm):00528                 JSR     TLOOK                             ;LOOK FOR IT
E1DF C10E             (        cubix.asm):00529                 CMPB    #NUMCMD                           ;IS IT OVER?
E1E1 2434             (        cubix.asm):00530                 BHS     EXE                               ;YES, TRY USER DEFINED
E1E3 58               (        cubix.asm):00531                 ASLB                                      ;TWO BYTE ENTRIES
E1E4 8EF832           (        cubix.asm):00532                 LDX     #CMDADR                           ;GET COMMAND ADDRESSES
E1E7 6E95             (        cubix.asm):00533                 JMP     [B,X]                             ;EXECUTE COMMAND
E1E9                  (        cubix.asm):00534         NULCMD
E1E9 39               (        cubix.asm):00535                 RTS
                      (        cubix.asm):00536         ;*
                      (        cubix.asm):00537         ;* RUN COMMAND
                      (        cubix.asm):00538         ;*
E1EA                  (        cubix.asm):00539         RUN
E1EA BDE289           (        cubix.asm):00540                 JSR     GETSNA                            ;GET FILENAME
E1ED                  (        cubix.asm):00541         RUN1
E1ED 8645             (        cubix.asm):00542                 LDA     #'E'                              ;GET TYPE
E1EF C658             (        cubix.asm):00543                 LDB     #'X'                              ;GET TYPE
E1F1 ED81             (        cubix.asm):00544                 STD     ,X++                              ;SAVE IT
E1F3 A784             (        cubix.asm):00545                 STA     ,X                                ;WRITE IT
E1F5 BDE64C           (        cubix.asm):00546                 JSR     LOCERR                            ;DOES IT EXIST
                      (        cubix.asm):00547         ;* FILE HAS BEEN FOUND, EXECUTE
E1F8                  (        cubix.asm):00548         RUN2
E1F8 A68817           (        cubix.asm):00549                 LDA     DATTR,X                           ;GET ATTRIBUTES
E1FB 8520             (        cubix.asm):00550                 BITA    #EPERM                            ;CAN WE EXECUTE?
E1FD 1027069F         (        cubix.asm):00551                 LBEQ    PROERR                            ;NO, REPORT ERROR
E201 EC8813           (        cubix.asm):00552                 LDD     DDADR,X                           ;GET DISK ADDRESS
E204 AE8815           (        cubix.asm):00553                 LDX     DRADR,X                           ;GET RUN ADDRESS
E207 BFDCCD           (        cubix.asm):00554                 STX     >TEMP1                            ;SAVE
E20A BDEE60           (        cubix.asm):00555                 JSR     LCHAIN                            ;LOAD THE CHAIN
E20D F6DCEB           (        cubix.asm):00556                 LDB     >SDRIVE                           ;GET OUR CURRENT DRIVE
E210 BDE4CF           (        cubix.asm):00557                 JSR     SKIP                              ;SKIP TO COMMANDS
E213 6E9FDCCD         (        cubix.asm):00558                 JMP     [TEMP1]                           ;PASS CONTROL TO HIM
                      (        cubix.asm):00559         ;*
                      (        cubix.asm):00560         ;* COMMAND WAS NOT RECOGNIZED, SEARCH SYSTEM DIRECTORY LOOKING
                      (        cubix.asm):00561         ;* FOR FILE WITH NAME MATCHING COMMAND.
                      (        cubix.asm):00562         ;*
E217                  (        cubix.asm):00563         EXE
E217 7FDCCD           (        cubix.asm):00564                 CLR     >TEMP1                            ;INDICATE IMPLIED RUN
E21A 8EDCAE           (        cubix.asm):00565                 LDX     #SYSDRV                           ;PT TO SYSTEM DIRECTORY (& DRIVE)
E21D BDE3A6           (        cubix.asm):00566                 JSR     GETDIR1                           ;GET DIR & DRIVE
E220 8D6F             (        cubix.asm):00567                 BSR     NAMGET                            ;GET NAME
E222 862A             (        cubix.asm):00568                 LDA     #'*'                              ;WILDCARD
E224 A784             (        cubix.asm):00569                 STA     ,X                                ;SAVE TYPE
E226 B6DCB7           (        cubix.asm):00570                 LDA     >FDRIVE                           ;GET FILENAME DRIVE
E229 B7DCEB           (        cubix.asm):00571                 STA     >SDRIVE                           ;SELECT DRIVE
E22C CC0000           (        cubix.asm):00572                 LDD     #DIRSEC                           ;GET DIRECTORY SECTOR
E22F                  (        cubix.asm):00573         EXE1
E22F BDE5EF           (        cubix.asm):00574                 JSR     RDWRK                             ;READ A WORK SECTOR
E232                  (        cubix.asm):00575         EXE2
E232 BDE316           (        cubix.asm):00576                 JSR     COMNAM                            ;DOES IT MATCH
E235 2717             (        cubix.asm):00577                 BEQ     EXE3                              ;YES, IT DOES
                      (        cubix.asm):00578         ;* NAMES DON'T MATCH, ADVANCE TO NEXT ENTRY
E237 308820           (        cubix.asm):00579                 LEAX    32,X                              ;NEXT
E23A 8CE000           (        cubix.asm):00580                 CMPX    #WRKSPC+512                       ;OVER?
E23D 25F3             (        cubix.asm):00581                 BLO     EXE2                              ;NO, KEEP LOOKING
E23F FCDCDF           (        cubix.asm):00582                 LDD     >WRKSEC                           ;GET SECTOR
E242 BDE5D2           (        cubix.asm):00583                 JSR     FNDLNK                            ;LOCATE LINK
E245 26E8             (        cubix.asm):00584                 BNE     EXE1                              ;READ IT & LOOK
                      (        cubix.asm):00585         ;* COMMAND IS INVALID, REPORT ERROR
E247                  (        cubix.asm):00586         BADCMD
E247 8EF704           (        cubix.asm):00587                 LDX     #UNCMD                            ;PT TO MESSAGE
E24A 86FF             (        cubix.asm):00588                 LDA     #RCCMD                            ;GET RC
E24C 2062             (        cubix.asm):00589                 BRA     ERRMRC                            ;REPORT ERROR
                      (        cubix.asm):00590         ;* COMMAND MATCHES FILENAME, CHECK TYPE FOR EXECUTE
E24E                  (        cubix.asm):00591         EXE3
E24E A68812           (        cubix.asm):00592                 LDA     DTYPE+2,X                         ;GET TYPE
E251 B7DCCA           (        cubix.asm):00593                 STA     >FTYPE+2                          ;SAVE IT
E254 EC8810           (        cubix.asm):00594                 LDD     DTYPE,X                           ;GET REST OF TYPE
E257 FDDCC8           (        cubix.asm):00595                 STD     >FTYPE                            ;SAVE IT
                      (        cubix.asm):00596         ;* WE HAVE FOUND EXECUTABLE FILE
E25A 10834000         (        cubix.asm):00597                 CMPD    #'@'*256                          ;IS IT A COMMAND FILE?
E25E 10271213         (        cubix.asm):00598                 LBEQ    COMGO                             ;YES, EXECUTE
E262 8145             (        cubix.asm):00599                 CMPA    #'E'                              ;'EX'?
E264 2609             (        cubix.asm):00600                 BNE     EXE4                              ;NO, LOOK FOR CMD PROC
E266 C158             (        cubix.asm):00601                 CMPB    #'X'                              ;'EX'?
E268 2605             (        cubix.asm):00602                 BNE     EXE4                              ;NO, LOOK FOR CMD PROC
E26A A18812           (        cubix.asm):00603                 CMPA    DTYPE+2,X                         ;INSURE ITS 'EXE'
E26D 2789             (        cubix.asm):00604                 BEQ     RUN2                              ;YES, EXECUTE
                      (        cubix.asm):00605         ;* UNKNOWN FILETYPE, TRY FOR USER COMMAND PROCESSOR
E26F                  (        cubix.asm):00606         EXE4
E26F 1F12             (        cubix.asm):00607                 TFR     X,Y                               ;'Y' POINTS TO DIR ENTRY
E271 8EDCC0           (        cubix.asm):00608                 LDX     #FNAME                            ;POINT TO TYPE
E274 ED81             (        cubix.asm):00609                 STD     ,X++                              ;SAVE IT
E276 A6A812           (        cubix.asm):00610                 LDA     DTYPE+2,Y                         ;GET LAST CHR
E279 A780             (        cubix.asm):00611                 STA     ,X+                               ;SAVE IT
E27B                  (        cubix.asm):00612         EXE5
E27B 6F80             (        cubix.asm):00613                 CLR     ,X+                               ;CLEAR IT
E27D 8CDCC8           (        cubix.asm):00614                 CMPX    #FNAME+8                          ;OVER?
E280 25F9             (        cubix.asm):00615                 BLO     EXE5                              ;ALL OUT
E282 10BEDCCF         (        cubix.asm):00616                 LDY     >TEMP2                            ;RESTORE COMMAND POINTER
E286 7EE1ED           (        cubix.asm):00617                 JMP     RUN1                              ;TRY THIS ONE
                      (        cubix.asm):00618         ;*
                      (        cubix.asm):00619         ;* GET FILENAME WITHOUT TYPE, NORMAL DEFAULT
                      (        cubix.asm):00620         ;*
E289                  (        cubix.asm):00621         GETSNA
E289 BDE3A3           (        cubix.asm):00622                 JSR     GETDIR                            ;GET DIRECTORY
E28C                  (        cubix.asm):00623         GETSN0
E28C 86FF             (        cubix.asm):00624                 LDA     #$FF                              ;FLAG
E28E B7DCCD           (        cubix.asm):00625                 STA     >TEMP1                            ;SET IT
E291                  (        cubix.asm):00626         NAMGET
E291 C608             (        cubix.asm):00627                 LDB     #8                                ;MAX EIGHT CHARS
E293                  (        cubix.asm):00628         GETSN1
E293 BDE4DC           (        cubix.asm):00629                 JSR     TSTERM                            ;TERMINATOR?
E296 2706             (        cubix.asm):00630                 BEQ     GOPAD                             ;YES, QUIT
E298 812F             (        cubix.asm):00631                 CMPA    #'/'                              ;SPECIAL TERMINATOR
E29A 2605             (        cubix.asm):00632                 BNE     GETSN2
E29C 313F             (        cubix.asm):00633                 LEAY    -1,Y                              ;BACKUP TO SLASH
E29E                  (        cubix.asm):00634         GOPAD
E29E 7EE39C           (        cubix.asm):00635                 JMP     PAD
E2A1                  (        cubix.asm):00636         GETSN2
E2A1 A780             (        cubix.asm):00637                 STA     ,X+                               ;SAVE IT
E2A3 5A               (        cubix.asm):00638                 DECB                                      ;BACKUP
E2A4 2AED             (        cubix.asm):00639                 BPL     GETSN1                            ;MORE
E2A6 7DDCCD           (        cubix.asm):00640                 TST     >TEMP1                            ;WERE WE 'RUN'ING
E2A9 279C             (        cubix.asm):00641                 BEQ     BADCMD                            ;NO,
                      (        cubix.asm):00642         ;*
                      (        cubix.asm):00643         ;* INVALID OPERAND
                      (        cubix.asm):00644         ;*
E2AB                  (        cubix.asm):00645         BADOPR
E2AB 8EF719           (        cubix.asm):00646                 LDX     #BADOPM                           ;MESSAGE
E2AE 8601             (        cubix.asm):00647                 LDA     #RCBOP                            ;RETURN CODE
                      (        cubix.asm):00648         ;*
                      (        cubix.asm):00649         ;* ISSUE ERROR MESSAGE & RETURN TO CALLER WITH RETURN CODE
                      (        cubix.asm):00650         ;*
E2B0                  (        cubix.asm):00651         ERRMRC
E2B0 3401             (        cubix.asm):00652                 PSHS    CC                                ;SAVE IT
                      (        cubix.asm):00653         ;* VERIFY CONSOLE DEVICE IS VALID & RESET IF NOT
E2B2 F6DC6D           (        cubix.asm):00654                 LDB     >CONOUT                           ;GET OUTPUT
E2B5 C108             (        cubix.asm):00655                 CMPB    #NDEV                             ;IN RANGE
E2B7 240A             (        cubix.asm):00656                 BHS     ERRM1                             ;NO - ERROR
E2B9 108EDC7E         (        cubix.asm):00657                 LDY     #DOTAB                            ;POINT TO TABLE
E2BD 58               (        cubix.asm):00658                 ASLB                                      ;X2
E2BE 10AEA5           (        cubix.asm):00659                 LDY     B,Y                               ;INSTALLED?
E2C1 2605             (        cubix.asm):00660                 BNE     ERRM2                             ;YES, ITS OK
E2C3                  (        cubix.asm):00661         ERRM1
E2C3 C601             (        cubix.asm):00662                 LDB     #1                                ;DEFAULT DEVICE
E2C5 F7DC6D           (        cubix.asm):00663                 STB     >CONOUT                           ;RESET INPUT
E2C8                  (        cubix.asm):00664         ERRM2
E2C8 F6DC6C           (        cubix.asm):00665                 LDB     >CONIN                            ;GET INPUT
E2CB C108             (        cubix.asm):00666                 CMPB    #NDEV                             ;IN RANGE
E2CD 240A             (        cubix.asm):00667                 BHS     ERRM3                             ;NO - ERROR
E2CF 108EDC6E         (        cubix.asm):00668                 LDY     #DITAB                            ;POINT TO TABLE
E2D3 58               (        cubix.asm):00669                 ASLB                                      ;X2
E2D4 10AEA5           (        cubix.asm):00670                 LDY     B,Y                               ;INSTALLED?
E2D7 2605             (        cubix.asm):00671                 BNE     ERRM4                             ;YES, ITS OK
E2D9                  (        cubix.asm):00672         ERRM3
E2D9 C601             (        cubix.asm):00673                 LDB     #1                                ;DEFAULT DEVICE
E2DB F7DC6C           (        cubix.asm):00674                 STB     >CONIN                            ;RESET INPUT
E2DE                  (        cubix.asm):00675         ERRM4
E2DE 7DDCA2           (        cubix.asm):00676                 TST     >MSGFLG                           ;ARE MESSAGES ENABLED
E2E1 2706             (        cubix.asm):00677                 BEQ     NOEMSG                            ;NO, DON'T OUTPUT
E2E3 BDE567           (        cubix.asm):00678                 JSR     WRSTR                             ;OUTPUT
E2E6 BDE57B           (        cubix.asm):00679                 JSR     LFCR                              ;NEW LINE
E2E9                  (        cubix.asm):00680         NOEMSG
E2E9 3501             (        cubix.asm):00681                 PULS    CC                                ;RESTORE CC
                      (        cubix.asm):00682         ;* RETURN TO CALLER WITH NO ERROR MESSAGE
E2EB                  (        cubix.asm):00683         ERRRET
E2EB 3401             (        cubix.asm):00684                 PSHS    CC                                ;SAVE CC
E2ED F6DCDA           (        cubix.asm):00685                 LDB     >SAVDRV                           ;GET SAVED DRIVE
E2F0 F7DCEB           (        cubix.asm):00686                 STB     >SDRIVE                           ;RESET SELECTED DRIVE
E2F3 BEDCD6           (        cubix.asm):00687                 LDX     >SAVX                             ;RESTORE 'X'
E2F6 10BEDCD8         (        cubix.asm):00688                 LDY     >SAVY                             ;RESTORE 'Y'
E2FA F6DCD5           (        cubix.asm):00689                 LDB     >SAVB                             ;RESTORE 'B'
E2FD 3501             (        cubix.asm):00690                 PULS    CC                                ;RESTORE CONDITION CODES
E2FF 2705             (        cubix.asm):00691                 BEQ     ZERORC                            ;ITS ZERO
E301 10FEDCDB         (        cubix.asm):00692                 LDS     >SAVSTK                           ;GET SAVED SP
E305 39               (        cubix.asm):00693                 RTS
E306                  (        cubix.asm):00694         ZERORC
E306 10FEDCDB         (        cubix.asm):00695                 LDS     >SAVSTK                           ;GET STACK
E30A 1A04             (        cubix.asm):00696                 ORCC    #%00000100                        ;SET 'Z'
E30C 39               (        cubix.asm):00697                 RTS
                      (        cubix.asm):00698         ;*
                      (        cubix.asm):00699         ;* GET FILE WITHOUT TYPE, DEFAULT TO SYSTEM
                      (        cubix.asm):00700         ;*
E30D                  (        cubix.asm):00701         GETSYS
E30D 8EDCAE           (        cubix.asm):00702                 LDX     #SYSDRV                           ;DEFAULT IS SYSTEM
                      (        cubix.asm):00703         ;*
                      (        cubix.asm):00704         ;* GET FILENAME WITHOUR TYPE, DEFAULT(X)
                      (        cubix.asm):00705         ;*
E310                  (        cubix.asm):00706         GETSDI
E310 BDE3A6           (        cubix.asm):00707                 JSR     GETDIR1                           ;GET NAME
E313 7EE28C           (        cubix.asm):00708                 JMP     GETSN0                            ;GET FILENAME
                      (        cubix.asm):00709         ;*
                      (        cubix.asm):00710         ;* COMPARES NAME(X) TO SAVED FILENAME
                      (        cubix.asm):00711         ;*
E316                  (        cubix.asm):00712         COMNAM
E316 3436             (        cubix.asm):00713                 PSHS    A,B,X,Y                           ;SAVE REGS
E318 108EDCB8         (        cubix.asm):00714                 LDY     #PREFIX                           ;POINT TO SAVED
E31C A684             (        cubix.asm):00715                 LDA     ,X                                ;INSURE NAME IS NOT NULL
E31E 2603             (        cubix.asm):00716                 BNE     NOTNUL                            ;ITS NOT,
E320 4A               (        cubix.asm):00717                 DECA                                      ;GET FF
E321 2010             (        cubix.asm):00718                 BRA     CEND                              ;QUIT
E323                  (        cubix.asm):00719         NOTNUL
E323 C608             (        cubix.asm):00720                 LDB     #8                                ;EIGHT CHARS NI PREFIX
E325 8D0E             (        cubix.asm):00721                 BSR     COMX                              ;COMPARE
E327 260A             (        cubix.asm):00722                 BNE     CEND                              ;NOT SAME, EXIT
E329 C608             (        cubix.asm):00723                 LDB     #8                                ;EIGHT CHARS IN NAME
E32B 8D08             (        cubix.asm):00724                 BSR     COMX                              ;COMPARE
E32D 2604             (        cubix.asm):00725                 BNE     CEND                              ;NOT SAME
E32F C603             (        cubix.asm):00726                 LDB     #3                                ;THREE CHARS IN TYPE
E331 8D02             (        cubix.asm):00727                 BSR     COMX                              ;COMPARE
E333                  (        cubix.asm):00728         CEND
E333 35B6             (        cubix.asm):00729                 PULS    A,B,X,Y,PC                        ;GO HOME
E335                  (        cubix.asm):00730         COMX
E335 A6A0             (        cubix.asm):00731                 LDA     ,Y+                               ;GET CHAR FROM SAVED
E337 812A             (        cubix.asm):00732                 CMPA    #'*'                              ;WILDCARD?
E339 2708             (        cubix.asm):00733                 BEQ     RNXT                              ;RETURN WITH TRUE
E33B A180             (        cubix.asm):00734                 CMPA    ,X+                               ;DOES IT MATCH
E33D 2606             (        cubix.asm):00735                 BNE     RNXT1                             ;NO, FAIL
E33F 5A               (        cubix.asm):00736                 DECB                                      ;BACKUP
E340 26F3             (        cubix.asm):00737                 BNE     COMX                              ;OK
E342 39               (        cubix.asm):00738                 RTS
E343                  (        cubix.asm):00739         RNXT
E343 3001             (        cubix.asm):00740                 LEAX    1,X
E345                  (        cubix.asm):00741         RNXT1
E345 5A               (        cubix.asm):00742                 DECB                                      ;REDUCE COUNT
E346 2704             (        cubix.asm):00743                 BEQ     BRET                              ;DONE, QUIT
E348 3121             (        cubix.asm):00744                 LEAY    1,Y                               ;ADVANCE
E34A 20F7             (        cubix.asm):00745                 BRA     RNXT                              ;AND CONTINUE
E34C                  (        cubix.asm):00746         BRET
E34C 812A             (        cubix.asm):00747                 CMPA    #'*'                              ;WUZ IT WILDCARD
E34E 39               (        cubix.asm):00748                 RTS
                      (        cubix.asm):00749         ;*
                      (        cubix.asm):00750         ;* TEST SAVED FILENAME FOR VALIDITY AS A SINGLE FILE
                      (        cubix.asm):00751         ;*
E34F                  (        cubix.asm):00752         VALID
E34F 3416             (        cubix.asm):00753                 PSHS    A,B,X                             ;SAVE REGS
E351 C613             (        cubix.asm):00754                 LDB     #19                               ;LENGTH OF NAME
E353 8EDCB8           (        cubix.asm):00755                 LDX     #PREFIX                           ;POINT TO NAME
E356                  (        cubix.asm):00756         VALTST
E356 A680             (        cubix.asm):00757                 LDA     ,X+                               ;GETCHAR
E358 812A             (        cubix.asm):00758                 CMPA    #'*'                              ;WILDCARD
E35A 2704             (        cubix.asm):00759                 BEQ     RETNZ                             ;INVALID
E35C 5A               (        cubix.asm):00760                 DECB                                      ;BACKUP
E35D 26F7             (        cubix.asm):00761                 BNE     VALTST                            ;CONTINUE
E35F 4F               (        cubix.asm):00762                 CLRA                                      ;ZERO RETURN CODE
E360                  (        cubix.asm):00763         RETNZ
E360 4D               (        cubix.asm):00764                 TSTA                                      ;SET 'Z' FLAG
E361 3596             (        cubix.asm):00765                 PULS    A,B,X,PC
                      (        cubix.asm):00766         ;*
                      (        cubix.asm):00767         ;* GET FILENAME & INSURE ITS VALID
                      (        cubix.asm):00768         ;*
E363                  (        cubix.asm):00769         GETVAL
E363 8D05             (        cubix.asm):00770                 BSR     GETNAM                            ;GET FILENAME
E365 8DE8             (        cubix.asm):00771                 BSR     VALID                             ;TEST FOR VALID
E367 2620             (        cubix.asm):00772                 BNE     BADOP2                            ;INVALID, ERROR
E369 39               (        cubix.asm):00773                 RTS
                      (        cubix.asm):00774         ;*
                      (        cubix.asm):00775         ;* GET A FILENAME FROM INPUT LINE
                      (        cubix.asm):00776         ;*
E36A                  (        cubix.asm):00777         GETNAM
E36A 8D37             (        cubix.asm):00778                 BSR     GETDIR                            ;GET DRIVE & DIRECTORY
E36C                  (        cubix.asm):00779         GFNAM
E36C C608             (        cubix.asm):00780                 LDB     #8                                ;EIGHT CHARS/NAME
E36E                  (        cubix.asm):00781         GF1
E36E 8D26             (        cubix.asm):00782                 BSR     VALCHR                            ;GET CHAR
E370 812E             (        cubix.asm):00783                 CMPA    #'.'                              ;SEPERATOR?
E372 2707             (        cubix.asm):00784                 BEQ     GFTYP                             ;YES
E374 A780             (        cubix.asm):00785                 STA     ,X+                               ;SAVE IT
E376 5A               (        cubix.asm):00786                 DECB                                      ;BACKUP
E377 2AF5             (        cubix.asm):00787                 BPL     GF1                               ;KEEP GOING
E379 200E             (        cubix.asm):00788                 BRA     BADOP2                            ;ERROR
E37B                  (        cubix.asm):00789         GFTYP
E37B 8D1F             (        cubix.asm):00790                 BSR     PAD                               ;PAD FILENAME
E37D C603             (        cubix.asm):00791                 LDB     #3                                ;THREE CHARS/TYPE
E37F                  (        cubix.asm):00792         GF2
E37F BDE4DC           (        cubix.asm):00793                 JSR     TSTERM                            ;GET CHAR
E382 2708             (        cubix.asm):00794                 BEQ     GF3                               ;HIT END
E384 A780             (        cubix.asm):00795                 STA     ,X+                               ;SAVE IT
E386 5A               (        cubix.asm):00796                 DECB                                      ;REDUCE COUNT
E387 2AF6             (        cubix.asm):00797                 BPL     GF2                               ;KEEP GOING
E389                  (        cubix.asm):00798         BADOP2
E389 7EE2AB           (        cubix.asm):00799                 JMP     BADOPR                            ;ERROR
E38C                  (        cubix.asm):00800         GF3
E38C 8D0E             (        cubix.asm):00801                 BSR     PAD                               ;ZERO IT
E38E BDE4CF           (        cubix.asm):00802                 JSR     SKIP                              ;TO NEXT
E391 8EDCB8           (        cubix.asm):00803                 LDX     #PREFIX                           ;POINT TO IT
E394 4F               (        cubix.asm):00804                 CLRA                                      ;ZERO RC
E395 39               (        cubix.asm):00805                 RTS
                      (        cubix.asm):00806         ;* ABORT IF CHARACTER INVALID
E396                  (        cubix.asm):00807         VALCHR
E396 BDE4DC           (        cubix.asm):00808                 JSR     TSTERM                            ;TEST FOR CHAR OK
E399 27EE             (        cubix.asm):00809                 BEQ     BADOP2                            ;INVALID
E39B 39               (        cubix.asm):00810                 RTS
                      (        cubix.asm):00811         ;* PADS NAME WITH BLANKS UNTILL 'B' IS ZERO
E39C                  (        cubix.asm):00812         PAD
E39C 5A               (        cubix.asm):00813                 DECB                                      ;BACKUP COUNT
E39D 2B51             (        cubix.asm):00814                 BMI     GETD5                             ;THATS ALL
E39F 6F80             (        cubix.asm):00815                 CLR     ,X+                               ;CLEAR IT
E3A1 20F9             (        cubix.asm):00816                 BRA     PAD
                      (        cubix.asm):00817         ;*
                      (        cubix.asm):00818         ;* GETS A DRIVE AND DIRECTORY FROM THE INPUT LINE
                      (        cubix.asm):00819         ;*
E3A3                  (        cubix.asm):00820         GETDIR
E3A3 8EDCA5           (        cubix.asm):00821                 LDX     #DEFDRV                           ;PT TO IT
E3A6                  (        cubix.asm):00822         GETDIR1
E3A6 A680             (        cubix.asm):00823                 LDA     ,X+                               ;GET DEFAULT DRIVE
E3A8 B7DCB7           (        cubix.asm):00824                 STA     >FDRIVE                           ;SET IT
E3AB BDE4CF           (        cubix.asm):00825                 JSR     SKIP                              ;ADVANCE
E3AE 270B             (        cubix.asm):00826                 BEQ     GETD1                             ;END OF LINE, NO DRIVE SPEC
E3B0 E621             (        cubix.asm):00827                 LDB     1,Y                               ;GET NEXT CHAR
E3B2 C13A             (        cubix.asm):00828                 CMPB    #':'                              ;IS IT A DRIVE SPEC?
E3B4 2605             (        cubix.asm):00829                 BNE     GETD1                             ;NO, IGNORE IT
E3B6 8D3D             (        cubix.asm):00830                 BSR     GETDRV1                           ;GET DRIVE ID
E3B8 B7DCB7           (        cubix.asm):00831                 STA     >FDRIVE                           ;SET DRIVE ID
E3BB                  (        cubix.asm):00832         GETD1
E3BB 3420             (        cubix.asm):00833                 PSHS    Y                                 ;SAVE
E3BD 1F12             (        cubix.asm):00834                 TFR     X,Y                               ;SET UP PTR TO DEFAULT
E3BF 8EDCB8           (        cubix.asm):00835                 LDX     #PREFIX                           ;POINT TO PREFIX
E3C2 C608             (        cubix.asm):00836                 LDB     #8                                ;MOVE EIGHT
E3C4                  (        cubix.asm):00837         GETD2
E3C4 A6A0             (        cubix.asm):00838                 LDA     ,Y+                               ;GET FROM DEFAULT
E3C6 A780             (        cubix.asm):00839                 STA     ,X+                               ;SAVE IN NAME
E3C8 5A               (        cubix.asm):00840                 DECB                                      ;REDUCE COUNT
E3C9 26F9             (        cubix.asm):00841                 BNE     GETD2                             ;MOVE EM ALL
E3CB 3520             (        cubix.asm):00842                 PULS    Y                                 ;RESTORE
E3CD A6A4             (        cubix.asm):00843                 LDA     ,Y                                ;GET CHAR
E3CF 815B             (        cubix.asm):00844                 CMPA    #'['                              ;DIRECTORY ID
E3D1 261D             (        cubix.asm):00845                 BNE     GETD5                             ;NO, SKIP IT
E3D3 8EDCB8           (        cubix.asm):00846                 LDX     #PREFIX                           ;POINT TO PREFIX
E3D6 3121             (        cubix.asm):00847                 LEAY    1,Y                               ;ADVANCE
E3D8 C608             (        cubix.asm):00848                 LDB     #8                                ;UP TO EIGHT CHARS
E3DA                  (        cubix.asm):00849         GETD3
E3DA BDE396           (        cubix.asm):00850                 JSR     VALCHR                            ;GET CHAR, INSURE VALID
E3DD 815D             (        cubix.asm):00851                 CMPA    #']'                              ;CLOSING?
E3DF 2708             (        cubix.asm):00852                 BEQ     GETD4                             ;YES
E3E1 A780             (        cubix.asm):00853                 STA     ,X+                               ;SAVE IT
E3E3 5A               (        cubix.asm):00854                 DECB                                      ;BACKUP
E3E4 2AF4             (        cubix.asm):00855                 BPL     GETD3                             ;KEEP GOING
E3E6                  (        cubix.asm):00856         BADOP1
E3E6 7EE2AB           (        cubix.asm):00857                 JMP     BADOPR
E3E9                  (        cubix.asm):00858         GETD4
E3E9 8DB1             (        cubix.asm):00859                 BSR     PAD                               ;PAD WITH BLANKS
E3EB 7DDCB8           (        cubix.asm):00860                 TST     >PREFIX                           ;IS IT NULL
E3EE 27F6             (        cubix.asm):00861                 BEQ     BADOP1                            ;INVALID
E3F0                  (        cubix.asm):00862         GETD5
E3F0 4F               (        cubix.asm):00863                 CLRA
E3F1 39               (        cubix.asm):00864                 RTS
                      (        cubix.asm):00865         ;* GET A DRIVE & RETURN IN A
E3F2                  (        cubix.asm):00866         GETDRV
E3F2 BDE4CF           (        cubix.asm):00867                 JSR     SKIP                              ;ADVANCE TO OPERAND
E3F5                  (        cubix.asm):00868         GETDRV1
E3F5 ECA1             (        cubix.asm):00869                 LDD     ,Y++                              ;GET DATA
E3F7 C13A             (        cubix.asm):00870                 CMPB    #':'                              ;COLON
E3F9 26EB             (        cubix.asm):00871                 BNE     BADOP1                            ;NO
E3FB 8041             (        cubix.asm):00872                 SUBA    #'A'                              ;CONVERT
E3FD 8104             (        cubix.asm):00873                 CMPA    #4                                ;IN RANGE
E3FF 24E5             (        cubix.asm):00874                 BHS     BADOP1                            ;NO
E401 1A04             (        cubix.asm):00875                 ORCC    #4                                ;SET 'Z'
E403 39               (        cubix.asm):00876                 RTS
                      (        cubix.asm):00877         ;*
                      (        cubix.asm):00878         ;* GETS A VALUE (DECIMAL OR HEX) FROM INPUT LINE
                      (        cubix.asm):00879         ;*
E404                  (        cubix.asm):00880         GETNUM
E404 BDE4CF           (        cubix.asm):00881                 JSR     SKIP                              ;SKIP TO DATA
E407 27DD             (        cubix.asm):00882                 BEQ     BADOP1                            ;INVALID
E409 8124             (        cubix.asm):00883                 CMPA    #'$'                              ;HEX?
E40B 2643             (        cubix.asm):00884                 BNE     GETDV                             ;NO, GET DECIMAL
E40D 3121             (        cubix.asm):00885                 LEAY    1,Y                               ;ADVANCE TO NEXT
                      (        cubix.asm):00886         ;*
                      (        cubix.asm):00887         ;* GETS A 16 BIT HEX NUMBER FOR X FROM THE INPUT LINE.
                      (        cubix.asm):00888         ;*
E40F                  (        cubix.asm):00889         GETHEX
E40F BDE4CF           (        cubix.asm):00890                 JSR     SKIP                              ;GET CHARACTER
E412 27D2             (        cubix.asm):00891                 BEQ     BADOP1                            ;INDICATE BAD OPERAND
E414                  (        cubix.asm):00892         GETHV
E414 8E0000           (        cubix.asm):00893                 LDX     #0                                ;START WITH ZERO
E417                  (        cubix.asm):00894         GETL1
E417 BDE4DC           (        cubix.asm):00895                 JSR     TSTERM                            ;TEST FOR TERMINATOR
E41A 2728             (        cubix.asm):00896                 BEQ     HEXEND                            ;IF SO, THIS IS IT
E41C 8030             (        cubix.asm):00897                 SUBA    #'0'                              ;CONVERT TO BINARY
E41E 810A             (        cubix.asm):00898                 CMPA    #10                               ;TEST FOR > '9'
E420 250A             (        cubix.asm):00899                 BLO     DIGOK                             ;IF NOT, DIGIT IS OK
E422 8111             (        cubix.asm):00900                 CMPA    #$11                              ;TEST FOR < 'A'
E424 2DC0             (        cubix.asm):00901                 BLT     BADOP1                            ;OPERAND IS INVALID
E426 8007             (        cubix.asm):00902                 SUBA    #7                                ;CONVERT TO ASCII
E428 8110             (        cubix.asm):00903                 CMPA    #$10                              ;TEST FOR 0-F
E42A 24BA             (        cubix.asm):00904                 BHS     BADOP1                            ;IF NOT, DIGIT IS BAD
E42C                  (        cubix.asm):00905         DIGOK
E42C B7DCCC           (        cubix.asm):00906                 STA     >TEMP+1                           ;SAVE FOR LATER
E42F 8605             (        cubix.asm):00907                 LDA     #5                                ;SHIFT FOUR TIMES
E431 B7DCCB           (        cubix.asm):00908                 STA     >TEMP                             ;SAVE COUNTER
E434                  (        cubix.asm):00909         DSHFT
E434 1F10             (        cubix.asm):00910                 TFR     X,D                               ;COPY TO X
E436 308B             (        cubix.asm):00911                 LEAX    D,X                               ;MULTIPLY BY 2, = 1 BIT SHIFT
E438 7ADCCB           (        cubix.asm):00912                 DEC     >TEMP                             ;REDUCE COUNT
E43B 26F7             (        cubix.asm):00913                 BNE     DSHFT                             ;KEEP SHIFTING
E43D FADCCC           (        cubix.asm):00914                 ORB     >TEMP+1                           ;STICK ON EXTRA DIGIT
E440 1F01             (        cubix.asm):00915                 TFR     D,X                               ;COPY BACK TO X
E442 20D3             (        cubix.asm):00916                 BRA     GETL1                             ;GET NEXT DIGIT
E444                  (        cubix.asm):00917         HEXEND
E444 BDE4CF           (        cubix.asm):00918                 JSR     SKIP                              ;ADVANCE TO NEXT OPERAND
E447 4F               (        cubix.asm):00919                 CLRA                                      ;INDICATE ZERO RETURN CODE
E448 39               (        cubix.asm):00920                 RTS
                      (        cubix.asm):00921         ;*
                      (        cubix.asm):00922         ;* GETS A DECIMAL NUMBER FROM THE TERMINAL.
                      (        cubix.asm):00923         ;*
E449                  (        cubix.asm):00924         GETDEC
E449 BDE4CF           (        cubix.asm):00925                 JSR     SKIP                              ;SKIP TO START OF OPERAND.
E44C 1027FE5B         (        cubix.asm):00926                 LBEQ    BADOPR                            ;IF INVALID, GO BACK.
E450                  (        cubix.asm):00927         GETDV
E450 8E0000           (        cubix.asm):00928                 LDX     #0                                ;START WITH ZERO.
E453                  (        cubix.asm):00929         DECDIG
E453 BDE4DC           (        cubix.asm):00930                 JSR     TSTERM                            ;TEST FOR TERMINATOR
E456 27EC             (        cubix.asm):00931                 BEQ     HEXEND                            ;IF THATS ALL, FORGET IT.
E458 8030             (        cubix.asm):00932                 SUBA    #'0'                              ;CONVERT TO BINARY.
E45A 8109             (        cubix.asm):00933                 CMPA    #9                                ;TEST FOR INVALID.
E45C 1022FE4B         (        cubix.asm):00934                 LBHI    BADOPR                            ;AGAIN, INVALID OPERAND.
E460 3402             (        cubix.asm):00935                 PSHS    A                                 ;SAVE ACC.
E462 CC000A           (        cubix.asm):00936                 LDD     #10                               ;MUL BY 10
E465 BDF689           (        cubix.asm):00937                 JSR     MUL16                             ;D=D*X
E468 EBE0             (        cubix.asm):00938                 ADDB    ,S+                               ;ADD IN DIGIT
E46A 8900             (        cubix.asm):00939                 ADCA    #0                                ;INSURE HIGH GOES
E46C 1F01             (        cubix.asm):00940                 TFR     D,X                               ;COPY TO RESULT
E46E 20E3             (        cubix.asm):00941                 BRA     DECDIG                            ;GET NEXT
                      (        cubix.asm):00942         ;*
E470                  (        cubix.asm):00943         WRDEC8
E470 4F               (        cubix.asm):00944                 CLRA                                      ;DISPLAY 8 BIT BUMBER (B) IN DECIMAL
                      (        cubix.asm):00945         ;*
                      (        cubix.asm):00946         ;* DISPLAYS 16 BIT NUMBER IN D AS A DECIMAL NUMBER,
                      (        cubix.asm):00947         ;*
E471                  (        cubix.asm):00948         WRDEC
E471 3436             (        cubix.asm):00949                 PSHS    A,B,X,Y                           ;SAVE X-Y REGISTERS
E473 108E0000         (        cubix.asm):00950                 LDY     #0                                ;START WITH ZERO CHARACTERS
E477 1F01             (        cubix.asm):00951                 TFR     D,X                               ;SET UP STARTING VALUE
E479                  (        cubix.asm):00952         WRDE1
E479 CC000A           (        cubix.asm):00953                 LDD     #10                               ;DIVIDE BY 10
E47C BDF6A9           (        cubix.asm):00954                 JSR     DIV16                             ;X=X/D, D=REMAINDER
E47F 3404             (        cubix.asm):00955                 PSHS    B                                 ;SAVE REMAINDER
E481 3121             (        cubix.asm):00956                 LEAY    1,Y                               ;INDICATE ANOTHER ON STACK
E483 8C0000           (        cubix.asm):00957                 CMPX    #0                                ;ANY MORE?
E486 26F1             (        cubix.asm):00958                 BNE     WRDE1                             ;NO, CONTINUE
E488                  (        cubix.asm):00959         WRDE2
E488 3502             (        cubix.asm):00960                 PULS    A                                 ;GET DIGIT BACK
E48A 8B30             (        cubix.asm):00961                 ADDA    #'0'                              ;CONVERT TO PRINTABLE FORM
E48C BDE58D           (        cubix.asm):00962                 JSR     PUTCHR                            ;DISPLAY DECIMAL DIGIT
E48F 313F             (        cubix.asm):00963                 LEAY    -1,Y                              ;REDUCE COUNT
E491 26F5             (        cubix.asm):00964                 BNE     WRDE2                             ;IF NOT END, CONTINUE DISPLAYING
E493 35B6             (        cubix.asm):00965                 PULS    A,B,X,Y,PC                        ;RESTORE INDEX REG'S
                      (        cubix.asm):00966         ;*
                      (        cubix.asm):00967         ;* GETS AND BUFFERS A LINE FROM THE TERMINAL, ON EXIT, Y REGISTER
                      (        cubix.asm):00968         ;* POINTS TO LINE IN BUFFER.
                      (        cubix.asm):00969         ;*
E495                  (        cubix.asm):00970         GLFCR
E495 BDE57B           (        cubix.asm):00971                 JSR     LFCR                              ;START A NEW LINE
E498                  (        cubix.asm):00972         GLINE
E498 862A             (        cubix.asm):00973                 LDA     #'*'                              ;GET PROMPT CHARACTER
E49A BDE58D           (        cubix.asm):00974                 JSR     PUTCHR                            ;DISPLAY
E49D                  (        cubix.asm):00975         GLNOP
E49D 108EDC00         (        cubix.asm):00976                 LDY     #INBUFF                           ;POINT TO INPUT BUFFER
E4A1                  (        cubix.asm):00977         GLINE1
E4A1 1F20             (        cubix.asm):00978                 TFR     Y,D                               ;GET POINTER INTO BUFFER
E4A3 C150             (        cubix.asm):00979                 CMPB    #80                               ;TEST FOR OVER LIMIT
E4A5 22EE             (        cubix.asm):00980                 BHI     GLFCR                             ;INDICATE ERROR
E4A7 BDE5CD           (        cubix.asm):00981                 JSR     GETCHR                            ;GET CHARACTER FROM CONSOLE
E4AA 817F             (        cubix.asm):00982                 CMPA    #$7F                              ;TEST FOR DELETE
E4AC 2704             (        cubix.asm):00983                 BEQ     GLINE2                            ;YES, PERFORM DELETE
E4AE 8108             (        cubix.asm):00984                 CMPA    #8                                ;TEST FOR BACKSPACE
E4B0 260B             (        cubix.asm):00985                 BNE     GLINE3                            ;DON'T DELETE
E4B2                  (        cubix.asm):00986         GLINE2
E4B2 313F             (        cubix.asm):00987                 LEAY    -1,Y                              ;DELETE A CHARACTER
E4B4 BDE541           (        cubix.asm):00988                 JSR     WRLIN                             ;OUTPUT MESSAGE
E4B7 08200800         (        cubix.asm):00989                 FCB     8,' ',8,0                         ;WIPE PREVIOUS CHARACTER
E4BB 20E4             (        cubix.asm):00990                 BRA     GLINE1                            ;GET NEXT CHARACTER
E4BD                  (        cubix.asm):00991         GLINE3
E4BD BDE58D           (        cubix.asm):00992                 JSR     PUTCHR                            ;ECHO CHARACTER
E4C0 8D2B             (        cubix.asm):00993                 BSR     TOUPPER                           ;CONVERT TO UPPERCASE
E4C2 A7A0             (        cubix.asm):00994                 STA     ,Y+                               ;SAVE IN BUFFER
E4C4 810D             (        cubix.asm):00995                 CMPA    #$0D                              ;TEST FOR END OF LINE
E4C6 26D9             (        cubix.asm):00996                 BNE     GLINE1                            ;GET NEXT CHARACTER
E4C8 108EDC00         (        cubix.asm):00997                 LDY     #INBUFF                           ;POINT TO BUFFER
E4CC 7EE57B           (        cubix.asm):00998                 JMP     LFCR                              ;START A NEW LINE
                      (        cubix.asm):00999         ;*
                      (        cubix.asm):01000         ;* SKIPS TO NEXT NON-BLANK CHARACTER IN INPUT LINE. AND TESTS IT FOR <CR>.
                      (        cubix.asm):01001         ;*
E4CF                  (        cubix.asm):01002         SKIP
E4CF A6A0             (        cubix.asm):01003                 LDA     ,Y+                               ;GET CHARACTER
E4D1 8120             (        cubix.asm):01004                 CMPA    #' '                              ;TEST FOR BLANK
E4D3 27FA             (        cubix.asm):01005                 BEQ     SKIP                              ;IF SO, KEEP LOOKING
E4D5 6DA2             (        cubix.asm):01006                 TST     ,-Y                               ;BACKUP & TEST FOR ZERO
E4D7 2702             (        cubix.asm):01007                 BEQ     SKRTS                             ;YES, END WITH 'Z' SET
E4D9 810D             (        cubix.asm):01008                 CMPA    #$0D                              ;TEST FOR CARRIAGE RETURN
E4DB                  (        cubix.asm):01009         SKRTS
E4DB 39               (        cubix.asm):01010                 RTS
                      (        cubix.asm):01011         ;*
                      (        cubix.asm):01012         ;* TESTS FOR VALID TERMINATOR CHARACTERS.
                      (        cubix.asm):01013         ;*
E4DC                  (        cubix.asm):01014         TSTERM
E4DC A6A0             (        cubix.asm):01015                 LDA     ,Y+                               ;GET CHARACTER AND ADVANCE
E4DE 2708             (        cubix.asm):01016                 BEQ     TSTE1                             ;IF NULL, INDICATE TERMINATOR
E4E0 8120             (        cubix.asm):01017                 CMPA    #' '                              ;TEST FOR SPACE
E4E2 2708             (        cubix.asm):01018                 BEQ     TRET                              ;IF SO, QUIT
E4E4 810D             (        cubix.asm):01019                 CMPA    #$0D                              ;IS IT A CARRIAGE RETURN
E4E6 2604             (        cubix.asm):01020                 BNE     TRET                              ;IF NOT, DON'T BACK UP
E4E8                  (        cubix.asm):01021         TSTE1
E4E8 313F             (        cubix.asm):01022                 LEAY    -1,Y                              ;BACK UP SO WE DON'T GO BEYOND
E4EA 1A04             (        cubix.asm):01023                 ORCC    #%00000100                        ;SET 'Z'
E4EC                  (        cubix.asm):01024         TRET
E4EC 39               (        cubix.asm):01025                 RTS
                      (        cubix.asm):01026         ;*
                      (        cubix.asm):01027         ;* CONVERT THE CHARACTER IN 'A' TO UPPER CASE
                      (        cubix.asm):01028         ;*
E4ED                  (        cubix.asm):01029         TOUPPER
E4ED 8161             (        cubix.asm):01030                 CMPA    #'A'+$20                          ;ALREADY UPPERCASE?
E4EF 25FB             (        cubix.asm):01031                 BLO     TRET                              ;YES, ITS OK
E4F1 817A             (        cubix.asm):01032                 CMPA    #'Z'+$20                          ;ALREADY UPPERCASE?
E4F3 22F7             (        cubix.asm):01033                 BHI     TRET                              ;YES, ITS OK
E4F5 845F             (        cubix.asm):01034                 ANDA    #%01011111                        ;CONVERT TO UPPERCASE
E4F7 39               (        cubix.asm):01035                 RTS
                      (        cubix.asm):01036         ;*
                      (        cubix.asm):01037         ;* LOOKS UP WORD(Y) IN TABLE(X). INDEX OF COMMAND IN TABLE IS
                      (        cubix.asm):01038         ;* RETURNED IN THE B REGISTER, WITH ZERO BEING THE FIRST COMMAND.
                      (        cubix.asm):01039         ;* FOR INFORMATION ON THE COMMAND TABLE FORMAT, SEE COMMAND TABLE.
                      (        cubix.asm):01040         ;*
E4F8                  (        cubix.asm):01041         TLOOK
E4F8 5F               (        cubix.asm):01042                 CLRB                                      ;START WITH ZERO ENTRY
E4F9 8DD4             (        cubix.asm):01043                 BSR     SKIP                              ;SKIP LEADING BLANKS
E4FB                  (        cubix.asm):01044         TLOOK1
E4FB A680             (        cubix.asm):01045                 LDA     ,X+                               ;GET CHAR FROM FILE
E4FD 2AFC             (        cubix.asm):01046                 BPL     TLOOK1                            ;ADVANCE TO CONTROL BYTE
E4FF 301F             (        cubix.asm):01047                 LEAX    -1,X                              ;BACKUP TO IT
E501 3420             (        cubix.asm):01048                 PSHS    Y                                 ;SAVE POSITION
E503 847F             (        cubix.asm):01049                 ANDA    #$7F                              ;REMOVE FLAG BIT
E505 272C             (        cubix.asm):01050                 BEQ     TLOOK6                            ;END OF TABLE ENCOUNTERED
E507 B7DCCB           (        cubix.asm):01051                 STA     >TEMP                             ;SAVE FOR LATER REF
E50A                  (        cubix.asm):01052         TLOOK2
E50A 3001             (        cubix.asm):01053                 LEAX    1,X                               ;ADVANCE IN TABLE
E50C 7ADCCB           (        cubix.asm):01054                 DEC     >TEMP                             ;REDUCE COUNT
E50F A684             (        cubix.asm):01055                 LDA     ,X                                ;GET CHAR
E511 8DDA             (        cubix.asm):01056                 BSR     TOUPPER                           ;CONVERT TO UPPERCASE
E513 B7DCCC           (        cubix.asm):01057                 STA     >TEMP+1                           ;SAVE FOR LATER
E516 8DC4             (        cubix.asm):01058                 BSR     TSTERM                            ;TEST FOR TERMINATOR
E518 2714             (        cubix.asm):01059                 BEQ     TLOOK5                            ;IF SO, TEST IT
E51A B1DCCC           (        cubix.asm):01060                 CMPA    >TEMP+1                           ;TEST FOR SAME AS TABLE ENTRY
E51D 27EB             (        cubix.asm):01061                 BEQ     TLOOK2                            ;IF SO, IT'S OK
E51F 812F             (        cubix.asm):01062                 CMPA    #'/'                              ;SLASH?
E521 2709             (        cubix.asm):01063                 BEQ     TLOOK4                            ;YES, ACCEPT IT
E523 813D             (        cubix.asm):01064                 CMPA    #'='                              ;EQUALS?
E525 2705             (        cubix.asm):01065                 BEQ     TLOOK4                            ;ACCEPT IT AS WELL
                      (        cubix.asm):01066         ;* THIS ENTRY NOT FOUND, SKIP TO NEXT ONE
E527                  (        cubix.asm):01067         TLOOK3
E527 3520             (        cubix.asm):01068                 PULS    Y                                 ;RESTORE COMMAND POINTER
E529 5C               (        cubix.asm):01069                 INCB                                      ;INC. INDICATOR
E52A 20CF             (        cubix.asm):01070                 BRA     TLOOK1                            ;TRY NEXT ENTRY
E52C                  (        cubix.asm):01071         TLOOK4
E52C 313F             (        cubix.asm):01072                 LEAY    -1,Y                              ;BACKUP TO SPECIAL CHAR
E52E                  (        cubix.asm):01073         TLOOK5
E52E BADCCB           (        cubix.asm):01074                 ORA     >TEMP                             ;TEST FOR MINIMUM NUMBER OF CHARS
E531 2AF4             (        cubix.asm):01075                 BPL     TLOOK3                            ;IF NOT, SKIP THIS COMMAND
E533                  (        cubix.asm):01076         TLOOK6
E533 8D9A             (        cubix.asm):01077                 BSR     SKIP                              ;SKIP TO OPERANDS
E535 5D               (        cubix.asm):01078                 TSTB                                      ;SET FLAG IS ZERO
E536 3590             (        cubix.asm):01079                 PULS    X,PC                              ;CLEAN UP STACK
                      (        cubix.asm):01080         ;*
                      (        cubix.asm):01081         ;* OUTPUT NUMBER IN 'D' TO CONSOLE IN HEX
                      (        cubix.asm):01082         ;*
E538                  (        cubix.asm):01083         WRHEXW
E538 8D13             (        cubix.asm):01084                 BSR     WRHEX                             ;OUTPUT
E53A 1E89             (        cubix.asm):01085                 EXG     A,B                               ;SWAP
E53C 8D0F             (        cubix.asm):01086                 BSR     WRHEX                             ;OUTPUT
E53E 1E89             (        cubix.asm):01087                 EXG     A,B                               ;BACK
E540 39               (        cubix.asm):01088                 RTS
                      (        cubix.asm):01089         ;*
                      (        cubix.asm):01090         ;* WRITE MESSAGE, NO CARRIAGE RETURN AT END
                      (        cubix.asm):01091         ;*
E541                  (        cubix.asm):01092         WRLIN
E541 3410             (        cubix.asm):01093                 PSHS    X                                 ;SAVE X
E543 AE62             (        cubix.asm):01094                 LDX     2,S                               ;GET ADDRESS BACK
E545 8D20             (        cubix.asm):01095                 BSR     WRSTR                             ;OUTPUT
E547 AF62             (        cubix.asm):01096                 STX     2,S                               ;RESAVE
E549 1A04             (        cubix.asm):01097                 ORCC    #%00000100                        ;ZERO RETURN CODE
E54B 3590             (        cubix.asm):01098                 PULS    X,PC
                      (        cubix.asm):01099         ;*
                      (        cubix.asm):01100         ;* OUTPUT 'A' NUMBER TO CONSOLE IN HEX
                      (        cubix.asm):01101         ;*
E54D                  (        cubix.asm):01102         WRHEX
E54D 3402             (        cubix.asm):01103                 PSHS    A                                 ;SAVE IT
E54F 44               (        cubix.asm):01104                 LSRA                                      ;SHIFT
E550 44               (        cubix.asm):01105                 LSRA                                      ;HIGH NIBBLE
E551 44               (        cubix.asm):01106                 LSRA                                      ;INTO
E552 44               (        cubix.asm):01107                 LSRA                                      ;LOW NIBBLE
E553 8D06             (        cubix.asm):01108                 BSR     HOUT                              ;HIGH
E555 A6E4             (        cubix.asm):01109                 LDA     ,S                                ;GET LOW
E557 8D02             (        cubix.asm):01110                 BSR     HOUT                              ;OUTPUT
E559 3582             (        cubix.asm):01111                 PULS    A,PC                              ;RESTORE IT
                      (        cubix.asm):01112         ;* OUTPUT NIBBLE IN HEX
E55B                  (        cubix.asm):01113         HOUT
E55B 840F             (        cubix.asm):01114                 ANDA    #%00001111                        ;REMOVE HIGH
E55D 8B30             (        cubix.asm):01115                 ADDA    #'0'                              ;CONVERT
E55F 8139             (        cubix.asm):01116                 CMPA    #'9'                              ;OK?
E561 232A             (        cubix.asm):01117                 BLS     PUTCHR                            ;OK, OUTPUT
E563 8B07             (        cubix.asm):01118                 ADDA    #7                                ;CONVERT TO 'A'-'F'
E565 2026             (        cubix.asm):01119                 BRA     PUTCHR                            ;OUTPUT
                      (        cubix.asm):01120         ;*
                      (        cubix.asm):01121         ;* WRITE STRING(X) TO CONSOLE
                      (        cubix.asm):01122         ;*
E567                  (        cubix.asm):01123         WRSTR
E567 3402             (        cubix.asm):01124                 PSHS    A                                 ;SAVE A
E569                  (        cubix.asm):01125         WRST1
E569 A680             (        cubix.asm):01126                 LDA     ,X+                               ;GET CHAR
E56B 271E             (        cubix.asm):01127                 BEQ     WRST2                             ;END, QUIT
E56D 8D1E             (        cubix.asm):01128                 BSR     PUTCHR                            ;OUTPUT
E56F 20F8             (        cubix.asm):01129                 BRA     WRST1                             ;CONTINUE
                      (        cubix.asm):01130         ;*
                      (        cubix.asm):01131         ;* OUTPUT MESSAGE TO CONSOLE
                      (        cubix.asm):01132         ;*
E571                  (        cubix.asm):01133         WRMSG
E571 3410             (        cubix.asm):01134                 PSHS    X                                 ;SAVE X
E573 AE62             (        cubix.asm):01135                 LDX     2,S                               ;GET RETURN ADDRESS
E575 8DF0             (        cubix.asm):01136                 BSR     WRSTR                             ;OUTPUT STRING
E577 AF62             (        cubix.asm):01137                 STX     2,S                               ;RESAVE NEW RETURN ADDR
E579 3510             (        cubix.asm):01138                 PULS    X                                 ;RESTORE X
                      (        cubix.asm):01139         ;*
                      (        cubix.asm):01140         ;* OUTPUT LFCR TO CONSOLE
                      (        cubix.asm):01141         ;*
E57B                  (        cubix.asm):01142         LFCR
E57B 3402             (        cubix.asm):01143                 PSHS    A                                 ;SAVE IT
E57D 860A             (        cubix.asm):01144                 LDA     #$0A                              ;GET LF
E57F 8D0C             (        cubix.asm):01145                 BSR     PUTCHR                            ;OUTPUT
E581 860D             (        cubix.asm):01146                 LDA     #$0D                              ;GET CR
E583 2004             (        cubix.asm):01147                 BRA     SPC1                              ;CONTINUE
                      (        cubix.asm):01148         ;*
                      (        cubix.asm):01149         ;* OUTPUT SPACE TO CONSOLE
                      (        cubix.asm):01150         ;*
E585                  (        cubix.asm):01151         SPACE
E585 3402             (        cubix.asm):01152                 PSHS    A                                 ;SAVE ACCA
E587 8620             (        cubix.asm):01153                 LDA     #' '                              ;GET SPACE
E589                  (        cubix.asm):01154         SPC1
E589 8D02             (        cubix.asm):01155                 BSR     PUTCHR                            ;OUTPUT
E58B                  (        cubix.asm):01156         WRST2
E58B 3582             (        cubix.asm):01157                 PULS    A,PC                              ;RESTORE
                      (        cubix.asm):01158         ;*
                      (        cubix.asm):01159         ;* WRITE CHARACTER(A) TO CONSOLE DEVICE
                      (        cubix.asm):01160         ;*
E58D                  (        cubix.asm):01161         PUTCHR
E58D 3416             (        cubix.asm):01162                 PSHS    A,B,X                             ;SAVE REGS
E58F F6DC6D           (        cubix.asm):01163                 LDB     >CONOUT                           ;GET CONSOLE OUTPUT DEVICE
E592 2002             (        cubix.asm):01164                 BRA     WRDEV1                            ;PROCEDE WITH OUTPUT
                      (        cubix.asm):01165         ;*
                      (        cubix.asm):01166         ;* WRITE CHARACTER(A) TO DEVICE(B)
                      (        cubix.asm):01167         ;*
E594                  (        cubix.asm):01168         WRDEV
E594 3416             (        cubix.asm):01169                 PSHS    A,B,X                             ;SAVE REGS
E596                  (        cubix.asm):01170         WRDEV1
E596 C108             (        cubix.asm):01171                 CMPB    #NDEV                             ;CHECK FOR IN RANGE
E598 240D             (        cubix.asm):01172                 BHS     BADDEV                            ;INDICATE INVALID
E59A 8EDC7E           (        cubix.asm):01173                 LDX     #DOTAB                            ;POINT TO STATUS TABLE
E59D 58               (        cubix.asm):01174                 ASLB                                      ;X2 FOR TWO BYTE ENTRIES
E59E AE85             (        cubix.asm):01175                 LDX     B,X                               ;GET DEVICE DRIVER ADDRESS
E5A0 2705             (        cubix.asm):01176                 BEQ     BADDEV                            ;INDICATE INVALID DEVICE
E5A2 AD84             (        cubix.asm):01177                 JSR     ,X                                ;EXECUTE OUTPUT DRIVER
E5A4 4F               (        cubix.asm):01178                 CLRA                                      ;ZERO RETURN CODE
E5A5 3596             (        cubix.asm):01179                 PULS    A,B,X,PC                          ;RESTORE & RETURN
                      (        cubix.asm):01180         ;*
                      (        cubix.asm):01181         ;* BAD DEVICE SPECIFIED
                      (        cubix.asm):01182         ;*
E5A7                  (        cubix.asm):01183         BADDEV
E5A7 8EF7B7           (        cubix.asm):01184                 LDX     #DEVMSG                           ;POINT TO DEVICE MESSAGE
E5AA 860A             (        cubix.asm):01185                 LDA     #RCDEV                            ;BAD DEVICE RETURN CODE
E5AC 7EE2B0           (        cubix.asm):01186                 JMP     ERRMRC                            ;EXIT WITH ERROR
                      (        cubix.asm):01187         ;*
                      (        cubix.asm):01188         ;* READ A CHARACTER FROM DEVICE (B)
                      (        cubix.asm):01189         ;*
E5AF                  (        cubix.asm):01190         RDDEV
E5AF 8D03             (        cubix.asm):01191                 BSR     TSTDEV                            ;TEST FOR CHAR
E5B1 26FC             (        cubix.asm):01192                 BNE     RDDEV                             ;WAIT FOR IT
E5B3 39               (        cubix.asm):01193                 RTS
                      (        cubix.asm):01194         ;*
                      (        cubix.asm):01195         ;* TEST FOR CHARACTER FROM DEVICE(B)
                      (        cubix.asm):01196         ;*
E5B4                  (        cubix.asm):01197         TSTDEV
E5B4 3414             (        cubix.asm):01198                 PSHS    B,X                               ;SAVE REGS
E5B6                  (        cubix.asm):01199         TSTDE1
E5B6 C108             (        cubix.asm):01200                 CMPB    #NDEV                             ;DEVICE IN RANGE?
E5B8 24ED             (        cubix.asm):01201                 BHS     BADDEV                            ;INDICATE INVALUD
E5BA 8EDC6E           (        cubix.asm):01202                 LDX     #DITAB                            ;POINT TO STATUS TABLE
E5BD 58               (        cubix.asm):01203                 ASLB                                      ;X2 FOR TWO BYTE ENTRIES
E5BE AE85             (        cubix.asm):01204                 LDX     B,X                               ;GET DEVICE DRIVER ADDRESS
E5C0 27E5             (        cubix.asm):01205                 BEQ     BADDEV                            ;INDICATE INVALID
E5C2 AD84             (        cubix.asm):01206                 JSR     ,X                                ;EXECUTE INPUT DRIVER
E5C4 3594             (        cubix.asm):01207                 PULS    B,X,PC                            ;RESTORE & RETURN
                      (        cubix.asm):01208         ;*
                      (        cubix.asm):01209         ;* TEST FOR A CHARACTER FROM THE CONSOLE DEVICE
                      (        cubix.asm):01210         ;*
E5C6                  (        cubix.asm):01211         TSTCHR
E5C6 3414             (        cubix.asm):01212                 PSHS    B,X                               ;SAVE REGS
E5C8 F6DC6C           (        cubix.asm):01213                 LDB     >CONIN                            ;GET INPUT DEVICE
E5CB 20E9             (        cubix.asm):01214                 BRA     TSTDE1                            ;AND CONTINUE
                      (        cubix.asm):01215         ;*
                      (        cubix.asm):01216         ;* READ A CHARACTER FROM CONSOLE
                      (        cubix.asm):01217         ;*
E5CD                  (        cubix.asm):01218         GETCHR
E5CD 8DF7             (        cubix.asm):01219                 BSR     TSTCHR                            ;TEST FOR CHAR
E5CF 26FC             (        cubix.asm):01220                 BNE     GETCHR                            ;INDICATE NONE
E5D1 39               (        cubix.asm):01221                 RTS
                      (        cubix.asm):01222         ;*
                      (        cubix.asm):01223         ;* INCLUDE ALL OTHER SUB-SYSTEMS
                      (        cubix.asm):01224         ;*
                      (        cubix.asm):01225                 INCLUDE filesys.os                        ;FILE SYSTEM MANAGMENT
                      (       filesys.os):00001         ;*
                      (       filesys.os):00002         ;* CUBIX File System management routines
                      (       filesys.os):00003         ;*
                      (       filesys.os):00004         ;* LOCATE NEXT WORK SECTOR IN CHAIN
                      (       filesys.os):00005         ;*
E5D2                  (       filesys.os):00006         FNDLNK
E5D2 3402             (       filesys.os):00007                 PSHS    A
E5D4 58               (       filesys.os):00008                 LSLB                                      ;DOUBLE FOR
E5D5 49               (       filesys.os):00009                 ROLA                                      ;TWO BYTE ID'S
E5D6 8401             (       filesys.os):00010                 ANDA    #$01                              ;MASK OFF BITS (512/SECTOR)
E5D8 C3DE00           (       filesys.os):00011                 ADDD    #WRKSPC                           ;POINT TO WORKSPACE
E5DB 1F01             (       filesys.os):00012                 TFR     D,X                               ;SET UP POINTER
E5DD 3504             (       filesys.os):00013                 PULS    B                                 ;RESTORE HIGH ID
E5DF CB01             (       filesys.os):00014                 ADDB    #LNKSEC                           ;ADVANCE TO LINK SECTOR
E5E1 4F               (       filesys.os):00015                 CLRA                                      ;ZERO HIGH
E5E2 3410             (       filesys.os):00016                 PSHS    X                                 ;SAVE PTR
E5E4 8D09             (       filesys.os):00017                 BSR     RDWRK                             ;READ WORK SECTOR
E5E6 3510             (       filesys.os):00018                 PULS    X                                 ;RESTORE
E5E8 EC84             (       filesys.os):00019                 LDD     ,X                                ;GET DATA
E5EA 1083FFFF         (       filesys.os):00020                 CMPD    #$FFFF                            ;END OF FILE?
E5EE                  (       filesys.os):00021         GRTS
E5EE 39               (       filesys.os):00022                 RTS
                      (       filesys.os):00023         ;*
                      (       filesys.os):00024         ;* READ WORK SECTOR FROM DISK
                      (       filesys.os):00025         ;*
E5EF                  (       filesys.os):00026         RDWRK
E5EF 3402             (       filesys.os):00027                 PSHS    A                                 ;SAVE ACCA
E5F1 8EDE00           (       filesys.os):00028                 LDX     #WRKSPC                           ;POINT TO IT
E5F4 B6DCEB           (       filesys.os):00029                 LDA     >SDRIVE                           ;CURRENT DRIVE
E5F7 B1DCDE           (       filesys.os):00030                 CMPA    >WRKDRV                           ;ARE WE ON IT?
E5FA 2608             (       filesys.os):00031                 BNE     RDW1                              ;WRITE IT CHANGED
E5FC A6E4             (       filesys.os):00032                 LDA     ,S                                ;RESTORE SECTOR ID
E5FE 10B3DCDF         (       filesys.os):00033                 CMPD    >WRKSEC                           ;DO WE ALREADY HAVE IT?
E602 2710             (       filesys.os):00034                 BEQ     RRTS                              ;YES, ITS OK
E604                  (       filesys.os):00035         RDW1
E604 8D20             (       filesys.os):00036                 BSR     WRTST                             ;WRITE IF NESSARY
E606 B6DCEB           (       filesys.os):00037                 LDA     >SDRIVE                           ;GET DRIVE
E609 B7DCDE           (       filesys.os):00038                 STA     >WRKDRV                           ;SET WORK DRIVE
E60C A6E4             (       filesys.os):00039                 LDA     ,S                                ;RESTORE SECTOR ID
E60E FDDCDF           (       filesys.os):00040                 STD     >WRKSEC                           ;SET IT UP
E611 BDEAD2           (       filesys.os):00041                 JSR     RDISK                             ;READ DISK
E614                  (       filesys.os):00042         RRTS
E614 3582             (       filesys.os):00043                 PULS    A,PC
                      (       filesys.os):00044         ;*
                      (       filesys.os):00045         ;* PURGE OPEN WORK SECTOR, INSURE IT GETS WRITTEN. SET
                      (       filesys.os):00046         ;* SAVED SECTOR TO $FFFF, SO WE FORCE NEW READ
                      (       filesys.os):00047         ;*
E616                  (       filesys.os):00048         PURGE
E616 8D0E             (       filesys.os):00049                 BSR     WRTST                             ;WRITE IF NESSARY
E618                  (       filesys.os):00050         PURGE1
E618 3406             (       filesys.os):00051                 PSHS    A,B                               ;SAVE REGISTERS
E61A CCFFFF           (       filesys.os):00052                 LDD     #$FFFF                            ;GET NON-EXISTANT
E61D FDDCDF           (       filesys.os):00053                 STD     >WRKSEC                           ;SET WORK SECTOR
E620 B7DCDE           (       filesys.os):00054                 STA     >WRKDRV                           ;SET WORK DRIVE
E623 4F               (       filesys.os):00055                 CLRA    SET 'Z'
E624 3586             (       filesys.os):00056                 PULS    A,B,PC
                      (       filesys.os):00057         ;*
                      (       filesys.os):00058         ;* WRITE WORK SECTOR IF IT HAS BEEN CHANGED
                      (       filesys.os):00059         ;*
E626                  (       filesys.os):00060         WRTST
E626 7DDCDD           (       filesys.os):00061                 TST     >WRKCHG                           ;HAS IT CHANGED?
E629 27C3             (       filesys.os):00062                 BEQ     GRTS                              ;NO, SKIP IT
                      (       filesys.os):00063         ;*
                      (       filesys.os):00064         ;* WRITE WORK SECTOR BACK TO DISK
                      (       filesys.os):00065         ;*
E62B                  (       filesys.os):00066         WRWRK
E62B 3416             (       filesys.os):00067                 PSHS    A,B,X                             ;SAVE REGS
E62D B6DCEB           (       filesys.os):00068                 LDA     >SDRIVE                           ;GET SELECTED DRIVE
E630 3402             (       filesys.os):00069                 PSHS    A                                 ;SAVE IT
E632 B6DCDE           (       filesys.os):00070                 LDA     >WRKDRV                           ;GET WORK DRIVE
E635 B7DCEB           (       filesys.os):00071                 STA     >SDRIVE                           ;SET IT UP
E638 FCDCDF           (       filesys.os):00072                 LDD     >WRKSEC                           ;GET ID
E63B 8EDE00           (       filesys.os):00073                 LDX     #WRKSPC                           ;POINT TO WORKSPACE
E63E BDEB05           (       filesys.os):00074                 JSR     WDISK                             ;WRITE IT
E641 7FDCDD           (       filesys.os):00075                 CLR     >WRKCHG                           ;INDICTE FRESH
E644 3502             (       filesys.os):00076                 PULS    A                                 ;RESTORE DRIVE
E646 B7DCEB           (       filesys.os):00077                 STA     >SDRIVE                           ;RESAVE
E649 4F               (       filesys.os):00078                 CLRA                                      ;ZERO RETURN
E64A 3596             (       filesys.os):00079                 PULS    A,B,X,PC
                      (       filesys.os):00080         ;*
                      (       filesys.os):00081         ;* LOCATE  FILE, ISSUE ERROR MESSAGE IF NOT FOUND
                      (       filesys.os):00082         ;*
E64C                  (       filesys.os):00083         LOCERR
                      (       filesys.os):00084         
E64C 8D37             (       filesys.os):00085                 BSR     LOCDIR                            ;LOOK IT UP
E64E 2758             (       filesys.os):00086                 BEQ     FILFND                            ;FINE, RETURN
                      (       filesys.os):00087         
                      (       filesys.os):00088         ;* ATTEMPT TO OPEN FILE FAILED, NOT FOUND
E650                  (       filesys.os):00089         NOTFND
E650 108EF734         (       filesys.os):00090                 LDY     #NOTMSG                           ;INDICATE NOT FOUND
E654 8602             (       filesys.os):00091                 LDA     #RCNOTF                           ;NOT FOUND RC
                      (       filesys.os):00092         ;* PROCESS FOR FILE RELATED ERRORS
E656                  (       filesys.os):00093         FILERR
E656 3403             (       filesys.os):00094                 PSHS    A,CC                              ;SAVE A & CC
E658 7DDCA2           (       filesys.os):00095                 TST     >MSGFLG                           ;MESSAGES ENABLED
E65B 2721             (       filesys.os):00096                 BEQ     NOFMSG                            ;NO, SKIP IT
E65D BDE541           (       filesys.os):00097                 JSR     WRLIN                             ;OUTPUT MESSAGE
E660 4572726F72207072 (       filesys.os):00098                 FCC     'Error processing file: '
     6F63657373696E67
     2066696C653A20
E677 00               (       filesys.os):00099                 FCB     $00
E678 BDE6CA           (       filesys.os):00100                 JSR     SHOSAV                            ;DISPLAY IT
E67B BDE57B           (       filesys.os):00101                 JSR     LFCR
E67E                  (       filesys.os):00102         NOFMSG
E67E 1F21             (       filesys.os):00103                 TFR     Y,X                               ;COPY IT
E680 3503             (       filesys.os):00104                 PULS    A,CC                              ;RESTORE CONDITIONS
E682 7EE2B0           (       filesys.os):00105                 JMP     ERRMRC                            ;OUTPUT MESSAGE
                      (       filesys.os):00106         ;*
                      (       filesys.os):00107         ;* LOCATE A FILE IN THE DIRECTORY, LEAVES 'X' POINTING AT IT
                      (       filesys.os):00108         ;*
E685                  (       filesys.os):00109         LOCDIR
E685 B6DCB7           (       filesys.os):00110                 LDA     >FDRIVE                           ;GET FILES DRIVE ID
E688 B7DCEB           (       filesys.os):00111                 STA     >SDRIVE                           ;SAVE IT
E68B CC0000           (       filesys.os):00112                 LDD     #DIRSEC                           ;STARTING SECTOR OF DIR
E68E                  (       filesys.os):00113         LOCSEC
E68E BDE5EF           (       filesys.os):00114                 JSR     RDWRK                             ;READ IT
E691                  (       filesys.os):00115         LOCFIL
                      (       filesys.os):00116         
E691 BDE316           (       filesys.os):00117                 JSR     COMNAM                            ;DOES IT MATCH
E694 2712             (       filesys.os):00118                 BEQ     FILFND                            ;YES
E696 308820           (       filesys.os):00119                 LEAX    32,X                              ;ADVANCE TO NEXT
E699 8CE000           (       filesys.os):00120                 CMPX    #WRKSPC+512                       ;OVER?
E69C 25F3             (       filesys.os):00121                 BLO     LOCFIL                            ;KEEP LOOKING
E69E FCDCDF           (       filesys.os):00122                 LDD     >WRKSEC                           ;GET SECTOR
E6A1 BDE5D2           (       filesys.os):00123                 JSR     FNDLNK                            ;GET ITS LINK
E6A4 26E8             (       filesys.os):00124                 BNE     LOCSEC                            ;MORE TO FIND
E6A6 8602             (       filesys.os):00125                 LDA     #RCNOTF                           ;FILE NOT FOUND
E6A8                  (       filesys.os):00126         FILFND
E6A8 39               (       filesys.os):00127                 RTS
                      (       filesys.os):00128         ;*
                      (       filesys.os):00129         ;* DISPLAY DIRECTORY USING SAVED FILENAME AS A MASK
                      (       filesys.os):00130         ;*
E6A9                  (       filesys.os):00131         DISDIR
E6A9 8DA1             (       filesys.os):00132                 BSR     LOCERR                            ;LOCATE FILE
E6AB                  (       filesys.os):00133         SHOME
E6AB 8D30             (       filesys.os):00134                 BSR     SHONAM                            ;OUTPUT NAME
E6AD BDE57B           (       filesys.os):00135                 JSR     LFCR                              ;NEW LINE
E6B0                  (       filesys.os):00136         NOSHO
E6B0 308820           (       filesys.os):00137                 LEAX    32,X                              ;NEXT ENTRY
E6B3 8CE000           (       filesys.os):00138                 CMPX    #WRKSPC+512                       ;OVER?
E6B6 250B             (       filesys.os):00139                 BLO     SHOFIL                            ;MORE TO GO
E6B8 FCDCDF           (       filesys.os):00140                 LDD     >WRKSEC                           ;GET WORKSECTOR
E6BB BDE5D2           (       filesys.os):00141                 JSR     FNDLNK                            ;LOCATE LINK
E6BE 27E8             (       filesys.os):00142                 BEQ     FILFND                            ;NO, QUIT
E6C0 BDE5EF           (       filesys.os):00143                 JSR     RDWRK                             ;READ NEW SECTOR
E6C3                  (       filesys.os):00144         SHOFIL
E6C3 BDE316           (       filesys.os):00145                 JSR     COMNAM                            ;DOES IT MATCH?
E6C6 26E8             (       filesys.os):00146                 BNE     NOSHO                             ;DON'T OUTPUT
E6C8 20E1             (       filesys.os):00147                 BRA     SHOME                             ;DISPLAY IT
                      (       filesys.os):00148         
                      (       filesys.os):00149         ;*
                      (       filesys.os):00150         ;* SHOW SAVED FILENAME
                      (       filesys.os):00151         ;*
E6CA                  (       filesys.os):00152         SHOSAV
E6CA 3416             (       filesys.os):00153                 PSHS    A,B,X                             ;SAVE REGS
E6CC 8EDCB7           (       filesys.os):00154                 LDX     #FDRIVE                           ;POINT TO IT
E6CF A680             (       filesys.os):00155                 LDA     ,X+                               ;GET DRIVE ID
E6D1 8B41             (       filesys.os):00156                 ADDA    #'A'                              ;OFFSET
E6D3 BDE58D           (       filesys.os):00157                 JSR     PUTCHR
E6D6 863A             (       filesys.os):00158                 LDA     #':'
E6D8 BDE58D           (       filesys.os):00159                 JSR     PUTCHR
E6DB 2002             (       filesys.os):00160                 BRA     SHON1                             ;DISPLAY IT
                      (       filesys.os):00161         ;*
                      (       filesys.os):00162         ;* DISPLAYS FILENAME(X) IN DIRECTORY FORMAT
                      (       filesys.os):00163         ;*
E6DD                  (       filesys.os):00164         SHONAM
E6DD 3416             (       filesys.os):00165                 PSHS    A,B,X                             ;SAVE REGISTERS
E6DF                  (       filesys.os):00166         SHON1
E6DF 865B             (       filesys.os):00167                 LDA     #'['                              ;OPENING BRACKET
E6E1 BDE58D           (       filesys.os):00168                 JSR     PUTCHR                            ;OUTPUT
E6E4 8D12             (       filesys.os):00169                 BSR     DISP8                             ;DISPLAY IT
E6E6 865D             (       filesys.os):00170                 LDA     #']'                              ;CLOSING BRACKET
E6E8 BDE58D           (       filesys.os):00171                 JSR     PUTCHR                            ;OUTPUT
E6EB 8D0B             (       filesys.os):00172                 BSR     DISP8                             ;DISPLAY NAME
E6ED 862E             (       filesys.os):00173                 LDA     #'.'
E6EF BDE58D           (       filesys.os):00174                 JSR     PUTCHR
E6F2 C603             (       filesys.os):00175                 LDB     #3                                ;TYPE IS THREE
E6F4 8D04             (       filesys.os):00176                 BSR     DISPX
E6F6 3596             (       filesys.os):00177                 PULS    A,B,X,PC
E6F8                  (       filesys.os):00178         DISP8
E6F8 C608             (       filesys.os):00179                 LDB     #8                                ;8 CHARS FOR PREFIX AND TYPE
E6FA                  (       filesys.os):00180         DISPX
E6FA A680             (       filesys.os):00181                 LDA     ,X+                               ;GET CHAR
E6FC 2703             (       filesys.os):00182                 BEQ     SHRT                              ;SHORT, ADVANCE
E6FE BDE58D           (       filesys.os):00183                 JSR     PUTCHR                            ;DISPLAY
E701                  (       filesys.os):00184         SHRT
E701 5A               (       filesys.os):00185                 DECB                                      ;REDUCE COUNT
E702 26F6             (       filesys.os):00186                 BNE     DISPX                             ;KEEP GOING
E704 39               (       filesys.os):00187                 RTS
                      (       filesys.os):00188         ;*
                      (       filesys.os):00189         ;* CALCULATE DRIVE SIZE IN 'D'
                      (       filesys.os):00190         ;*
E705                  (       filesys.os):00191         CURSIZ
E705 B6DCEB           (       filesys.os):00192                 LDA     >SDRIVE                           ;GET SELECTED DRIVE
E708                  (       filesys.os):00193         DRVSIZ
E708 3440             (       filesys.os):00194                 PSHS    U
E70A BDEAFC           (       filesys.os):00195                 JSR     GETCTL1                           ;GET CONTROL BLOCK
E70D E643             (       filesys.os):00196                 LDB     NSEC,U                            ;GET # SECS/TRACK
E70F A642             (       filesys.os):00197                 LDA     NHEAD,U                           ;GET # HEADS
E711 3D               (       filesys.os):00198                 MUL                                       ;GET SECS/CYLINDER
E712 A641             (       filesys.os):00199                 LDA     NCYL,U                            ;GET # CYLINDERS
E714 3D               (       filesys.os):00200                 MUL                                       ;CALCULATE TOTAL SIZE
E715 35C0             (       filesys.os):00201                 PULS    U,PC                              ;RETURN
                      (       filesys.os):00202         ;*
                      (       filesys.os):00203         ;* CREATES A FILE
                      (       filesys.os):00204         ;*
E717                  (       filesys.os):00205         CREATE
E717 BDE34F           (       filesys.os):00206                 JSR     VALID                             ;OK AS SINGLE FLE
E71A 1026FB8D         (       filesys.os):00207                 LBNE    BADOPR                            ;NO, INVALID
E71E BDE685           (       filesys.os):00208                 JSR     LOCDIR                            ;LOOK FOR IT
E721 2609             (       filesys.os):00209                 BNE     CRE1                              ;ITS OK
                      (       filesys.os):00210         ;* FILE ALREADY EXISTS
E723                  (       filesys.os):00211         FEXISTS
E723 108EF743         (       filesys.os):00212                 LDY     #EXIMSG                           ;FILE EXISTS
E727 8607             (       filesys.os):00213                 LDA     #RCEXI                            ;EXISTS
E729 7EE656           (       filesys.os):00214                 JMP     FILERR                            ;INDICATE ERROR
E72C                  (       filesys.os):00215         CRE1
E72C 8D6F             (       filesys.os):00216                 BSR     FRESEC                            ;ALLOCATE A SECTOR
E72E FDDCCD           (       filesys.os):00217                 STD     >TEMP1                            ;SAVE IT
E731 CC0000           (       filesys.os):00218                 LDD     #DIRSEC                           ;DIRECTORY STARTS HERE
E734                  (       filesys.os):00219         CRE2
E734 BDE5EF           (       filesys.os):00220                 JSR     RDWRK                             ;READ WORK SECTOR
E737 C610             (       filesys.os):00221                 LDB     #16                               ;ENTRIES/SECTOR
E739                  (       filesys.os):00222         CRE3
E739 6D84             (       filesys.os):00223                 TST     ,X                                ;IS IT FREE?
E73B 2732             (       filesys.os):00224                 BEQ     CRE6                              ;YES, PUT IT HERE
E73D 308820           (       filesys.os):00225                 LEAX    32,X                              ;ADVANCE TO NEXT
E740 5A               (       filesys.os):00226                 DECB                                      ;REDUCE COUNT
E741 26F6             (       filesys.os):00227                 BNE     CRE3                              ;KEEP LOOKING
E743 FCDCDF           (       filesys.os):00228                 LDD     >WRKSEC                           ;GET DIRECTORY SEC ID
E746 BDE5D2           (       filesys.os):00229                 JSR     FNDLNK                            ;FIND LINK
E749 26E9             (       filesys.os):00230                 BNE     CRE2                              ;AND KEEP GOING
E74B FCDCCD           (       filesys.os):00231                 LDD     >TEMP1                            ;GET OUR FREE SECTOR
E74E ED84             (       filesys.os):00232                 STD     ,X                                ;POINT DIRECTORY AT IT
E750 BDE794           (       filesys.os):00233                 JSR     CHGWRK                            ;INDICATE WE CHANGED
E753 3406             (       filesys.os):00234                 PSHS    A,B                               ;SAVE ID
E755 8D46             (       filesys.os):00235                 BSR     FRESEC                            ;GET FREE
E757 FDDCCD           (       filesys.os):00236                 STD     >TEMP1                            ;SAVE NEW FREE
E75A BDE62B           (       filesys.os):00237                 JSR     WRWRK                             ;WRITE WORK SECTOR
E75D 3506             (       filesys.os):00238                 PULS    A,B                               ;RESTORE DIRECTORY SECTOR ID
E75F FDDCDF           (       filesys.os):00239                 STD     >WRKSEC                           ;INDICATE CURRENT WORKSECTOR
E762 8EDE00           (       filesys.os):00240                 LDX     #WRKSPC                           ;PT TO IT
E765                  (       filesys.os):00241         CRE5
E765 6F80             (       filesys.os):00242                 CLR     ,X+                               ;CLEAR IT
E767 8CE000           (       filesys.os):00243                 CMPX    #WRKSPC+512                       ;ARE WE OVER
E76A 25F9             (       filesys.os):00244                 BLO     CRE5                              ;DO ALL
E76C 8EDE00           (       filesys.os):00245                 LDX     #WRKSPC                           ;PT TO IT AGAIN
E76F                  (       filesys.os):00246         CRE6
E76F 3420             (       filesys.os):00247                 PSHS    Y                                 ;SAVE
E771 108EDCB8         (       filesys.os):00248                 LDY     #PREFIX                           ;PT TO SAVED NAME
E775 C613             (       filesys.os):00249                 LDB     #19                               ;19 CHARS IN NAME
E777                  (       filesys.os):00250         CRE7
E777 A6A0             (       filesys.os):00251                 LDA     ,Y+                               ;GET CHAR
E779 A780             (       filesys.os):00252                 STA     ,X+                               ;SAVE IN ENTRY
E77B 5A               (       filesys.os):00253                 DECB                                      ;REDUCE COUNT
E77C 26F9             (       filesys.os):00254                 BNE     CRE7                              ;CONTINUE
E77E 3520             (       filesys.os):00255                 PULS    Y                                 ;RESTORE
E780 3088ED           (       filesys.os):00256                 LEAX    -19,X                             ;BACK TO START
E783 FCDCD3           (       filesys.os):00257                 LDD     >TEMP4                            ;GET LOAD ADDRESS
E786 ED8815           (       filesys.os):00258                 STD     DRADR,X                           ;SET IT,
E789 86F0             (       filesys.os):00259                 LDA     #DEFATR                           ;GET DEF ATTRIBUTES
E78B A78817           (       filesys.os):00260                 STA     DATTR,X                           ;SET THEM
E78E FCDCCD           (       filesys.os):00261                 LDD     >TEMP1                            ;GET DISK ADDRESS
E791 ED8813           (       filesys.os):00262                 STD     DDADR,X                           ;SET IT
                      (       filesys.os):00263         ;*
                      (       filesys.os):00264         ;* SET WORK SECTOR CHANGED FLAG
                      (       filesys.os):00265         ;*
E794                  (       filesys.os):00266         CHGWRK
E794 7FDCDD           (       filesys.os):00267                 CLR     >WRKCHG
E797 7ADCDD           (       filesys.os):00268                 DEC     >WRKCHG                           ;SET IT
E79A 1A04             (       filesys.os):00269                 ORCC    #4                                ;SET 'Z'
E79C 39               (       filesys.os):00270                 RTS
                      (       filesys.os):00271         ;*
                      (       filesys.os):00272         ;* LOCATE A FREE SECTOR ON THE DISK, CLAIM IT AND SET
                      (       filesys.os):00273         ;* FLAG TO $FFFF (END OF FILE). ATEMPT TO ALLOCATE IN SECTOR
                      (       filesys.os):00274         ;* WHICH AS ALREADY LOADED IN ORDER TO REDUCE DISK I/O.
                      (       filesys.os):00275         ;*
E79D                  (       filesys.os):00276         FRESEC
E79D BDE705           (       filesys.os):00277                 JSR     CURSIZ                            ;CALCULATE SIZE OF DISK
E7A0 FDDCCB           (       filesys.os):00278                 STD     >TEMP                             ;SAVE IT
E7A3 830001           (       filesys.os):00279                 SUBD    #1                                ;CONVERT TO HIGHEST SECTOR ID
E7A6 8B01             (       filesys.os):00280                 ADDA    #LNKSEC                           ;COMPUTE LARGEST LINK SECTOR # (D/256+LNK)
E7A8 3402             (       filesys.os):00281                 PSHS    A                                 ;SAVE
E7AA 7DDCDF           (       filesys.os):00282                 TST     >WRKSEC                           ;LOW?
E7AD 260E             (       filesys.os):00283                 BNE     FRES1                             ;NO LINK IN CORE
E7AF F6DCE0           (       filesys.os):00284                 LDB     >WRKSEC+1                         ;GET SECTOR ID
E7B2 B1DCE0           (       filesys.os):00285                 CMPA    >WRKSEC+1                         ;IS IT IN RANGE?
E7B5 2506             (       filesys.os):00286                 BLO     FRES1                             ;NO LINK IN CORE
E7B7 C101             (       filesys.os):00287                 CMPB    #LNKSEC                           ;IN RANGE?
E7B9 2502             (       filesys.os):00288                 BLO     FRES1                             ;NO LINK IN CORE
E7BB 8D11             (       filesys.os):00289                 BSR     FNDFRE                            ;LOOK FOR IT
E7BD                  (       filesys.os):00290         FRES1
E7BD C601             (       filesys.os):00291                 LDB     #LNKSEC                           ;LOOK IN FIRST
E7BF                  (       filesys.os):00292         FRES2
E7BF 8D0D             (       filesys.os):00293                 BSR     FNDFRE                            ;LOOK FOR IT
E7C1 5C               (       filesys.os):00294                 INCB    ADVANCE
E7C2 E1E4             (       filesys.os):00295                 CMPB    ,S                                ;ARE WE OVER?
E7C4 23F9             (       filesys.os):00296                 BLS     FRES2                             ;NO, LEEP GOING
                      (       filesys.os):00297         ;* NO DISK SPACE AVAILABLE
E7C6                  (       filesys.os):00298         NOSPAC
E7C6 8EF757           (       filesys.os):00299                 LDX     #NOSMSG                           ;NO SPACE
E7C9 8608             (       filesys.os):00300                 LDA     #RCNOS                            ;RETURN CODE
E7CB 7EE2B0           (       filesys.os):00301                 JMP     ERRMRC                            ;REPORT ERROR
                      (       filesys.os):00302         ;* LOOK FOR FREE SECTOR
E7CE                  (       filesys.os):00303         FNDFRE
E7CE 4F               (       filesys.os):00304                 CLRA                                      ;HIGH ADDRESS TO ZERO
E7CF 3434             (       filesys.os):00305                 PSHS    B,X,Y                             ;SAVE REGS
E7D1 BDE5EF           (       filesys.os):00306                 JSR     RDWRK                             ;READ WORK SECTOR
E7D4                  (       filesys.os):00307         FNDF1
E7D4 EC81             (       filesys.os):00308                 LDD     ,X++                              ;IS IT FREE
E7D6 2707             (       filesys.os):00309                 BEQ     FNDF3                             ;YES
E7D8 8CE000           (       filesys.os):00310                 CMPX    #WRKSPC+512                       ;OVER?
E7DB 25F7             (       filesys.os):00311                 BLO     FNDF1                             ;NO, KEEP LOOKING
E7DD                  (       filesys.os):00312         FNDF2
E7DD 35B4             (       filesys.os):00313                 PULS    B,X,Y,PC                          ;GO HOME
E7DF                  (       filesys.os):00314         FNDF3
E7DF 1F10             (       filesys.os):00315                 TFR     X,D                               ;GET VALUE
E7E1 83DE02           (       filesys.os):00316                 SUBD    #WRKSPC+2                         ;CONVERT TO BYTE OFFSET
E7E4 44               (       filesys.os):00317                 LSRA                                      ;CONVERT ADDRESS IN WS
E7E5 56               (       filesys.os):00318                 RORB                                      ;TO SECTOR # IN WS
E7E6 A6E4             (       filesys.os):00319                 LDA     ,S                                ;GET SECTOR ID BACK
E7E8 8001             (       filesys.os):00320                 SUBA    #LNKSEC                           ;CONVERT TO PURE SECTOR #
E7EA 10B3DCCB         (       filesys.os):00321                 CMPD    >TEMP                             ;WITHIN DISK SIZE?
E7EE 24ED             (       filesys.os):00322                 BHS     FNDF2                             ;NO, RETURN WITH BAD NEWS
E7F0 3261             (       filesys.os):00323                 LEAS    1,S                               ;SKIP SAVED 'B' REGISTER
E7F2 108EFFFF         (       filesys.os):00324                 LDY     #$FFFF                            ;GET SECTOR IN USE FLAG
E7F6 10AF1E           (       filesys.os):00325                 STY     -2,X                              ;WRITE IT
E7F9 3530             (       filesys.os):00326                 PULS    X,Y                               ;RESTORE REGS
E7FB 3263             (       filesys.os):00327                 LEAS    3,S                               ;CLEAR UP STACK
E7FD 2095             (       filesys.os):00328                 BRA     CHGWRK                            ;INDICATE CHANGED
                      (       filesys.os):00329         ;*
                      (       filesys.os):00330         ;* OPEN A FILE FOR READ
                      (       filesys.os):00331         ;*
E7FF                  (       filesys.os):00332         OPENR
E7FF 3414             (       filesys.os):00333                 PSHS    B,X                               ;SAVE REGS
E801 BDE896           (       filesys.os):00334                 JSR     LOCRED                            ;DOES IT EXIST
E804 EC8813           (       filesys.os):00335                 LDD     DDADR,X                           ;GET DISK ADDRESS
E807 ED42             (       filesys.os):00336                 STD     OFIRST,U                          ;SAVE IT
E809 ED44             (       filesys.os):00337                 STD     OSECTOR,U                         ;INDICATE CURRENT SECTOR
E80B 4F               (       filesys.os):00338                 CLRA
E80C 5F               (       filesys.os):00339                 CLRB                                      ;ZERO OFFSET
E80D ED48             (       filesys.os):00340                 STD     OOFFSET,U                         ;INDICATE OFFSET INTO FILE
E80F ED46             (       filesys.os):00341                 STD     OLSTSEC,U                         ;INDICATE THIS IS FIRST
E811 F6DCB7           (       filesys.os):00342                 LDB     >FDRIVE                           ;GET FILE DRIVE
E814 8601             (       filesys.os):00343                 LDA     #1                                ;INDICATE FILE OPEN/READ
E816 EDC4             (       filesys.os):00344                 STD     OTYPE,U                           ;INDICATE
E818 B6DCDA           (       filesys.os):00345                 LDA     >SAVDRV                           ;GET PREVIOUS DRIVE
E81B B7DCEB           (       filesys.os):00346                 STA     >SDRIVE                           ;RESET IT
E81E 4F               (       filesys.os):00347                 CLRA                                      ;ZERO RC
E81F 3594             (       filesys.os):00348                 PULS    B,X,PC
                      (       filesys.os):00349         ;*
                      (       filesys.os):00350         ;* READ CHARACTER FROM FILE
                      (       filesys.os):00351         ;*
E821                  (       filesys.os):00352         READC
E821 3414             (       filesys.os):00353                 PSHS    B,X                               ;SAVE REGS
E823 304A             (       filesys.os):00354                 LEAX    OSIZ,U                            ;OFFSET TO DATA
E825 A641             (       filesys.os):00355                 LDA     ODRIVE,U                          ;GET DRIVE
E827 B7DCEB           (       filesys.os):00356                 STA     >SDRIVE                           ;SELECT
E82A EC48             (       filesys.os):00357                 LDD     OOFFSET,U                         ;GET OFFSET
E82C 2612             (       filesys.os):00358                 BNE     REC1                              ;NON-ZERO, ITS OK
E82E A6C4             (       filesys.os):00359                 LDA     OTYPE,U                           ;GET OPEN TYPE
E830 4A               (       filesys.os):00360                 DECA                                      ;OPEN FOR READ?
E831 2676             (       filesys.os):00361                 BNE     ORERR                             ;NO, REPORT ERROR
E833 EC44             (       filesys.os):00362                 LDD     OSECTOR,U                         ;GET SECTOR
E835 1083FFFF         (       filesys.os):00363                 CMPD    #$FFFF                            ;END OF FILE?
E839 2776             (       filesys.os):00364                 BEQ     EOF                               ;YES, REPORT ERROR
E83B BDEAD2           (       filesys.os):00365                 JSR     RDISK                             ;READ IT IN
E83E EC48             (       filesys.os):00366                 LDD     OOFFSET,U                         ;RESTORE OFFSET
E840                  (       filesys.os):00367         REC1
E840 308B             (       filesys.os):00368                 LEAX    D,X                               ;OFFSET TO CHAR
E842 C30001           (       filesys.os):00369                 ADDD    #1                                ;ADVANCE
E845 10830200         (       filesys.os):00370                 CMPD    #512                              ;ARE WE OVER
E849 250F             (       filesys.os):00371                 BLO     REC2                              ;NO, ITS OK
E84B 3410             (       filesys.os):00372                 PSHS    X                                 ;SAVE 'X'
E84D EC44             (       filesys.os):00373                 LDD     OSECTOR,U                         ;GET SECTOR
E84F ED46             (       filesys.os):00374                 STD     OLSTSEC,U                         ;SAVE LAST SECTOR
E851 BDE5D2           (       filesys.os):00375                 JSR     FNDLNK                            ;LOOK UP ITS LINK
E854 ED44             (       filesys.os):00376                 STD     OSECTOR,U                         ;SAVE NEW SECTOR
E856 3510             (       filesys.os):00377                 PULS    X                                 ;RESTORE PTR TO CAHR
E858 4F               (       filesys.os):00378                 CLRA
E859 5F               (       filesys.os):00379                 CLRB
E85A                  (       filesys.os):00380         REC2
E85A ED48             (       filesys.os):00381                 STD     OOFFSET,U                         ;NEW OFFSET
E85C B6DCDA           (       filesys.os):00382                 LDA     >SAVDRV                           ;GET PREVIOUS DRIVE
E85F B7DCEB           (       filesys.os):00383                 STA     >SDRIVE                           ;RESET IT
E862 A680             (       filesys.os):00384                 LDA     ,X+                               ;GET CHARACTER
E864 81FF             (       filesys.os):00385                 CMPA    #$FF                              ;END OF FILE?
E866 2749             (       filesys.os):00386                 BEQ     EOF                               ;YES
E868 1A04             (       filesys.os):00387                 ORCC    #4                                ;INDICATE SUCESS
E86A 3594             (       filesys.os):00388                 PULS    B,X,PC
                      (       filesys.os):00389         ;*
                      (       filesys.os):00390         ;* READ A BLOCK FROM A FILE
                      (       filesys.os):00391         ;*
E86C                  (       filesys.os):00392         READB
E86C 3414             (       filesys.os):00393                 PSHS    B,X                               ;SAVE REGS
E86E A6C4             (       filesys.os):00394                 LDA     OTYPE,U                           ;GET OPEN TYPE
E870 4A               (       filesys.os):00395                 DECA                                      ;OPEN READ?
E871 2636             (       filesys.os):00396                 BNE     ORERR                             ;NO, REPORT ERROR
E873 A641             (       filesys.os):00397                 LDA     ODRIVE,U
E875 B7DCEB           (       filesys.os):00398                 STA     >SDRIVE                           ;SET DRIVE
E878 EC44             (       filesys.os):00399                 LDD     OSECTOR,U
E87A 1083FFFF         (       filesys.os):00400                 CMPD    #$FFFF                            ;END OF FILE?
E87E 2731             (       filesys.os):00401                 BEQ     EOF
E880 ED46             (       filesys.os):00402                 STD     OLSTSEC,U                         ;SAVE LAST
E882 BDEAD2           (       filesys.os):00403                 JSR     RDISK                             ;READ IT
E885 BDE5D2           (       filesys.os):00404                 JSR     FNDLNK                            ;FIND ITS LINK
E888 ED44             (       filesys.os):00405                 STD     OSECTOR,U                         ;RESAVE
E88A B6DCDA           (       filesys.os):00406                 LDA     >SAVDRV                           ;GET PREVIOUS DRIVE
E88D B7DCEB           (       filesys.os):00407                 STA     >SDRIVE                           ;RESET SYSTEM DRIVE
E890 4F               (       filesys.os):00408                 CLRA
E891 5F               (       filesys.os):00409                 CLRB
E892 ED48             (       filesys.os):00410                 STD     OOFFSET,U                         ;CLEAR OFFSET
E894 3594             (       filesys.os):00411                 PULS    B,X,PC
                      (       filesys.os):00412         ;*
                      (       filesys.os):00413         ;* LOOK UP FILE WITH INTENT TO READ
                      (       filesys.os):00414         ;*
E896                  (       filesys.os):00415         LOCRED
E896 BDE64C           (       filesys.os):00416                 JSR     LOCERR                            ;FIND IT
E899 A68817           (       filesys.os):00417                 LDA     DATTR,X                           ;GET ATTRS
E89C 8580             (       filesys.os):00418                 BITA    #RPERM                            ;CAN WE READ?
E89E 2635             (       filesys.os):00419                 BNE     CLOC2                             ;YES, ITS OK
                      (       filesys.os):00420         ;* FILE PROTECTON VIOLATION
E8A0                  (       filesys.os):00421         PROERR
E8A0 108EF79D         (       filesys.os):00422                 LDY     #PROMSG                           ;MESSAGE
E8A4 8603             (       filesys.os):00423                 LDA     #RCPRO                            ;PROTECTION VIOLATION
E8A6 7EE656           (       filesys.os):00424                 JMP     FILERR                            ;FILE ERROR
                      (       filesys.os):00425         ;* ATTEMPT TO READ FILE NOT OPEN FOR READ
E8A9                  (       filesys.os):00426         ORERR
E8A9 8EF76E           (       filesys.os):00427                 LDX     #OREMSG
E8AC 8604             (       filesys.os):00428                 LDA     #RCORE
E8AE 7EE2B0           (       filesys.os):00429                 JMP     ERRMRC
                      (       filesys.os):00430         ;* ATTEMPT TO READ PAST EOF
E8B1                  (       filesys.os):00431         EOF
E8B1 8606             (       filesys.os):00432                 LDA     #RCEOF
E8B3 7EE2EB           (       filesys.os):00433                 JMP     ERRRET
                      (       filesys.os):00434         ;*
                      (       filesys.os):00435         ;* REWIND A FILE
                      (       filesys.os):00436         ;*
E8B6                  (       filesys.os):00437         REWIND
E8B6 3406             (       filesys.os):00438                 PSHS    A,B                               ;SAVE REGS
E8B8 EC42             (       filesys.os):00439                 LDD     OFIRST,U                          ;GET FIRST SECTOR ID
E8BA ED44             (       filesys.os):00440                 STD     OSECTOR,U                         ;POINT TO IT
E8BC 4F               (       filesys.os):00441                 CLRA
E8BD 5F               (       filesys.os):00442                 CLRB
E8BE ED48             (       filesys.os):00443                 STD     OOFFSET,U                         ;SET OFFSET
E8C0 ED46             (       filesys.os):00444                 STD     OLSTSEC,U                         ;INDICATE THIS IS FIRST
E8C2 3586             (       filesys.os):00445                 PULS    A,B,PC
                      (       filesys.os):00446         ;*
                      (       filesys.os):00447         ;* LOOKUP A FILE WITH INTENT TO WRITE
                      (       filesys.os):00448         ;*
E8C4                  (       filesys.os):00449         LOCWRI
E8C4 BDE685           (       filesys.os):00450                 JSR     LOCDIR                            ;LOOK FOR IT
E8C7 2705             (       filesys.os):00451                 BEQ     CLOC1                             ;IT EXISTS
E8C9 BDE717           (       filesys.os):00452                 JSR     CREATE                            ;CREATE IT
E8CC 2007             (       filesys.os):00453                 BRA     CLOC2                             ;AND RETURN
E8CE                  (       filesys.os):00454         CLOC1
E8CE A68817           (       filesys.os):00455                 LDA     DATTR,X                           ;GET ATTRIBUTES
E8D1 8540             (       filesys.os):00456                 BITA    #WPERM                            ;CAN WE WRITE?
E8D3 27CB             (       filesys.os):00457                 BEQ     PROERR                            ;PROTECTON VIOLATION
E8D5                  (       filesys.os):00458         CLOC2
E8D5 FCDCDF           (       filesys.os):00459                 LDD     >WRKSEC                           ;GET DIRECTORY SECT
E8D8 1A04             (       filesys.os):00460                 ORCC    #$04                              ;SET 'Z'
E8DA 39               (       filesys.os):00461                 RTS
                      (       filesys.os):00462         ;*
                      (       filesys.os):00463         ;* OPEN A FILE FOR WRITE
                      (       filesys.os):00464         ;*
E8DB                  (       filesys.os):00465         OPENW
E8DB 3414             (       filesys.os):00466                 PSHS    B,X                               ;SAVE REGS
E8DD 8DE5             (       filesys.os):00467                 BSR     LOCWRI                            ;DOES IT EXIST
E8DF EC8813           (       filesys.os):00468                 LDD     DDADR,X                           ;GET DISK ADDRESS
E8E2 ED42             (       filesys.os):00469                 STD     OFIRST,U                          ;SAVE IT
E8E4 ED44             (       filesys.os):00470                 STD     OSECTOR,U                         ;INDICATE CURRENT SECTOR
E8E6 4F               (       filesys.os):00471                 CLRA
E8E7 5F               (       filesys.os):00472                 CLRB                                      ;ZERO OFFSET
E8E8 ED48             (       filesys.os):00473                 STD     OOFFSET,U                         ;INDICATE OFFSET INTO FILE
E8EA ED46             (       filesys.os):00474                 STD     OLSTSEC,U                         ;INDICATE THIS IS FIRST SECTOR
E8EC B6DCB7           (       filesys.os):00475                 LDA     >FDRIVE                           ;GET FILE DRIVE
E8EF A741             (       filesys.os):00476                 STA     ODRIVE,U                          ;SET IT UP
E8F1 8602             (       filesys.os):00477                 LDA     #2                                ;INDICATE FILE OPEN/WRITE
E8F3 A7C4             (       filesys.os):00478                 STA     OTYPE,U                           ;INDICATE
E8F5 B6DCDA           (       filesys.os):00479                 LDA     >SAVDRV
E8F8 B7DCEB           (       filesys.os):00480                 STA     >SDRIVE
E8FB 4F               (       filesys.os):00481                 CLRA    ZERO RC
E8FC 3594             (       filesys.os):00482                 PULS    B,X,PC
                      (       filesys.os):00483         ;*
                      (       filesys.os):00484         ;* WRITE CHARACTER TO A FILE
                      (       filesys.os):00485         ;*
E8FE                  (       filesys.os):00486         WRITEC
E8FE 3416             (       filesys.os):00487                 PSHS    A,B,X                             ;SAVE REGS
E900 304A             (       filesys.os):00488                 LEAX    OSIZ,U                            ;POINT TO DATA
E902 EC48             (       filesys.os):00489                 LDD     OOFFSET,U                         ;GET OFFSET
E904 10830200         (       filesys.os):00490                 CMPD    #512                              ;ARE WE OVER?
E908 2504             (       filesys.os):00491                 BLO     WRC1                              ;NO, ITS OK
E90A 8D19             (       filesys.os):00492                 BSR     WRITEB                            ;OUTPUT THE BLOCK
E90C EC48             (       filesys.os):00493                 LDD     OOFFSET,U                         ;GET OFFSET
E90E                  (       filesys.os):00494         WRC1
E90E 308B             (       filesys.os):00495                 LEAX    D,X                               ;POINT TO CHAR
E910 C30001           (       filesys.os):00496                 ADDD    #1                                ;INCREMENT
E913 ED48             (       filesys.os):00497                 STD     OOFFSET,U                         ;RESAVE
E915 A6E4             (       filesys.os):00498                 LDA     ,S                                ;GET CHAR BACK
E917 A784             (       filesys.os):00499                 STA     ,X                                ;WRITE IN BUFFER
E919 1A04             (       filesys.os):00500                 ORCC    #4                                ;INDICATE SUCESS
E91B 3596             (       filesys.os):00501                 PULS    A,B,X,PC
                      (       filesys.os):00502         ;* ATTEMPT TO WRITE FILE NOT OPEN FOR WRITE
E91D                  (       filesys.os):00503         OWERR
E91D 8EF785           (       filesys.os):00504                 LDX     #OWEMSG
E920 8605             (       filesys.os):00505                 LDA     #RCOWE
E922 7EE2B0           (       filesys.os):00506                 JMP     ERRMRC
                      (       filesys.os):00507         ;*
                      (       filesys.os):00508         ;* WRITE A BLOCK TO A FILE
                      (       filesys.os):00509         ;*
E925                  (       filesys.os):00510         WRITEB
E925 3414             (       filesys.os):00511                 PSHS    B,X                               ;SAVE REGS
E927 A6C4             (       filesys.os):00512                 LDA     OTYPE,U                           ;GET TYPE
E929 8102             (       filesys.os):00513                 CMPA    #2                                ;WRITE?
E92B 26F0             (       filesys.os):00514                 BNE     OWERR                             ;NO, INVALID
E92D A641             (       filesys.os):00515                 LDA     ODRIVE,U                          ;GET DRIVE
E92F B7DCEB           (       filesys.os):00516                 STA     >SDRIVE                           ;SELECT DRIVE
E932 EC44             (       filesys.os):00517                 LDD     OSECTOR,U                         ;GET SECTOR
E934 1083FFFF         (       filesys.os):00518                 CMPD    #$FFFF                            ;ARE WE PAST END?
E938 2613             (       filesys.os):00519                 BNE     WRB1                              ;NO, ITS OK
E93A BDE79D           (       filesys.os):00520                 JSR     FRESEC                            ;GET A SECTOR
E93D 3406             (       filesys.os):00521                 PSHS    A,B                               ;SAVE IT
E93F EC46             (       filesys.os):00522                 LDD     OLSTSEC,U                         ;GET LAST SECTOR
E941 BDE5D2           (       filesys.os):00523                 JSR     FNDLNK                            ;GET ITS LINK
E944 3506             (       filesys.os):00524                 PULS    A,B                               ;RESTORE
E946 ED84             (       filesys.os):00525                 STD     ,X                                ;SAVE IT
E948 BDE794           (       filesys.os):00526                 JSR     CHGWRK                            ;INDICATE SECTOR CHANGED
E94B AE61             (       filesys.os):00527                 LDX     1,S                               ;RESTORE MEMORY POINTER
E94D                  (       filesys.os):00528         WRB1
E94D ED46             (       filesys.os):00529                 STD     OLSTSEC,U                         ;SAVE LAST SECTOR
E94F BDEB05           (       filesys.os):00530                 JSR     WDISK                             ;WRITE THE SECTOR
E952 BDE5D2           (       filesys.os):00531                 JSR     FNDLNK                            ;LOCATE LINK
E955 ED44             (       filesys.os):00532                 STD     OSECTOR,U                         ;SAVE ID OF NEXT SECTOR
E957 B6DCDA           (       filesys.os):00533                 LDA     >SAVDRV                           ;GET PREVIOUS DRIVE
E95A B7DCEB           (       filesys.os):00534                 STA     >SDRIVE                           ;RESET DRIVE ID
E95D 4F               (       filesys.os):00535                 CLRA
E95E 5F               (       filesys.os):00536                 CLRB
E95F ED48             (       filesys.os):00537                 STD     OOFFSET,U                         ;INDICATE NO CHAR WRITE
E961 3594             (       filesys.os):00538                 PULS    B,X,PC
                      (       filesys.os):00539         ;*
                      (       filesys.os):00540         ;* CLOSE OPEN FILE
                      (       filesys.os):00541         ;*
E963                  (       filesys.os):00542         CLOSE
E963 3414             (       filesys.os):00543                 PSHS    B,X                               ;SAVE REGS
E965 A6C4             (       filesys.os):00544                 LDA     OTYPE,U                           ;GET TYPE
E967 8102             (       filesys.os):00545                 CMPA    #2                                ;OPEN FOR WRITE?
E969 2639             (       filesys.os):00546                 BNE     CLO4                              ;NO, SKIP IT
                      (       filesys.os):00547         ;* UPDATE LAST SECTOR IF ANY DATA, OR FIRST IN FILE
E96B A641             (       filesys.os):00548                 LDA     ODRIVE,U                          ;GET DRIVE ID
E96D B7DCEB           (       filesys.os):00549                 STA     >SDRIVE                           ;SELECT IT
E970 EC48             (       filesys.os):00550                 LDD     OOFFSET,U                         ;DATA IN LAST SECT?
E972 2604             (       filesys.os):00551                 BNE     CLO0                              ;YES, WRITE IT
E974 AE46             (       filesys.os):00552                 LDX     OLSTSEC,U                         ;GET SECTOR
E976 2617             (       filesys.os):00553                 BNE     CLO3                              ;IS A LAST, OK
                      (       filesys.os):00554         ;* CLEAR REMAINING SECTOR TO ZERO
E978                  (       filesys.os):00555         CLO0
E978 304A             (       filesys.os):00556                 LEAX    OSIZ,U                            ;PT TO AREA
E97A 308B             (       filesys.os):00557                 LEAX    D,X                               ;ADVANCE TO DATA AREA
E97C                  (       filesys.os):00558         CLO1
E97C 10830200         (       filesys.os):00559                 CMPD    #512                              ;ARE WE OVER?
E980 2409             (       filesys.os):00560                 BHS     CLO2                              ;YES, STOP
E982 6F84             (       filesys.os):00561                 CLR     ,X                                ;SET TO ZERO
E984 6380             (       filesys.os):00562                 COM     ,X+                               ;& CONVERT TO FF
E986 C30001           (       filesys.os):00563                 ADDD    #1                                ;ADVANCE
E989 20F1             (       filesys.os):00564                 BRA     CLO1                              ;AND CONTINUE
                      (       filesys.os):00565         ;* WRITE IT TO THE DISK
E98B                  (       filesys.os):00566         CLO2
E98B 304A             (       filesys.os):00567                 LEAX    OSIZ,U                            ;OFFSET AGAIN
E98D 8D96             (       filesys.os):00568                 BSR     WRITEB                            ;WRITE IT
                      (       filesys.os):00569         ;* MARK LAST SECTOR WRITTEN AS EOF
E98F                  (       filesys.os):00570         CLO3
E98F EC46             (       filesys.os):00571                 LDD     OLSTSEC,U                         ;ITS NOW LAST ONE
E991 BDE5D2           (       filesys.os):00572                 JSR     FNDLNK                            ;GET ITS LINK
E994 CCFFFF           (       filesys.os):00573                 LDD     #$FFFF                            ;EOF MARKER
E997 ED84             (       filesys.os):00574                 STD     ,X                                ;WRITE IT
                      (       filesys.os):00575         ;* IF NOT LAST SECTOR IN FILE, RELEASE REST
E999 EC44             (       filesys.os):00576                 LDD     OSECTOR,U                         ;GET SECTOR
E99B 1083FFFF         (       filesys.os):00577                 CMPD    #$FFFF                            ;LAST ONE IN FILE?
E99F 2703             (       filesys.os):00578                 BEQ     CLO4                              ;IS OK
E9A1 BDEDB1           (       filesys.os):00579                 JSR     UNCHAIN                           ;REMOVE SECTOR LINKS
E9A4                  (       filesys.os):00580         CLO4
E9A4 6FC4             (       filesys.os):00581                 CLR     OTYPE,U                           ;INDICATE FILE IS CLOSED
E9A6 B6DCDA           (       filesys.os):00582                 LDA     >SAVDRV                           ;RESET DRIVE
E9A9 B7DCEB           (       filesys.os):00583                 STA     >SDRIVE
E9AC 4F               (       filesys.os):00584                 CLRA
E9AD 3594             (       filesys.os):00585                 PULS    B,X,PC                            ;GO HOME
                      (       filesys.os):00586         ;*
                      (       filesys.os):00587         ;* SEEK ABSOLUTE FROM START OF FILE
                      (       filesys.os):00588         ;*
E9AF                  (       filesys.os):00589         SEEKABS
E9AF BDE8B6           (       filesys.os):00590                 JSR     REWIND                            ;BACK TO START
                      (       filesys.os):00591         ;*
                      (       filesys.os):00592         ;* SEEK FORWARD RELATIVE
                      (       filesys.os):00593         ;*
E9B2                  (       filesys.os):00594         SEEKREL
E9B2 3416             (       filesys.os):00595                 PSHS    A,B,X                             ;SAVE SECTOR ID
E9B4 E6C4             (       filesys.os):00596                 LDB     OTYPE,U                           ;GET TYPE
E9B6 5A               (       filesys.os):00597                 DECB                                      ;OPEN FOR READ?
E9B7 1026FEEE         (       filesys.os):00598                 LBNE    ORERR                             ;NO, REPORT ERROR
E9BB A641             (       filesys.os):00599                 LDA     ODRIVE,U                          ;GET DRIVE
E9BD B7DCEB           (       filesys.os):00600                 STA     >SDRIVE                           ;SELECT IT
E9C0 EC48             (       filesys.os):00601                 LDD     OOFFSET,U                         ;GET OFFSET?
E9C2 E3E4             (       filesys.os):00602                 ADDD    ,S                                ;ADD OFFSET
                      (       filesys.os):00603         ;* ADVANCE TILL WE ARE ON CORRECT SECTOR
E9C4                  (       filesys.os):00604         SEEK1
E9C4 10830200         (       filesys.os):00605                 CMPD    #512                              ;ARE WE OVER?
E9C8 251A             (       filesys.os):00606                 BLO     SEEK2                             ;NO, SET OFFSET & EXIT
E9CA 3406             (       filesys.os):00607                 PSHS    A,B                               ;SAVE ID
E9CC EC44             (       filesys.os):00608                 LDD     OSECTOR,U                         ;GET NEXT SECTOR
E9CE 1083FFFF         (       filesys.os):00609                 CMPD    #$FFFF                            ;END OF FILE?
E9D2 1027FEDB         (       filesys.os):00610                 LBEQ    EOF                               ;ERROR
E9D6 ED46             (       filesys.os):00611                 STD     OLSTSEC,U                         ;SET AS OLD
E9D8 BDE5D2           (       filesys.os):00612                 JSR     FNDLNK                            ;LOOKUP LINK
E9DB ED44             (       filesys.os):00613                 STD     OSECTOR,U                         ;SAVE PTR TO NEXT
E9DD 3506             (       filesys.os):00614                 PULS    A,B                               ;RESTORE IT
E9DF 830200           (       filesys.os):00615                 SUBD    #512                              ;INDICATE WE ADVANCED
E9E2 20E0             (       filesys.os):00616                 BRA     SEEK1                             ;CONTINUE
                      (       filesys.os):00617         ;* SKIPPED SECTORS, IF NON-ZERO OFFSET, READ IN DATA
E9E4                  (       filesys.os):00618         SEEK2
E9E4 ED48             (       filesys.os):00619                 STD     OOFFSET,U                         ;SET OFFSET
E9E6 270F             (       filesys.os):00620                 BEQ     SEEK3                             ;ZERO, DON'T READ DATA
E9E8 EC44             (       filesys.os):00621                 LDD     OSECTOR,U                         ;GET SECTOR
E9EA 1083FFFF         (       filesys.os):00622                 CMPD    #$FFFF                            ;EOF?
E9EE 1027FEBF         (       filesys.os):00623                 LBEQ    EOF                               ;YES, ERROR
E9F2 304A             (       filesys.os):00624                 LEAX    OSIZ,U                            ;ADVANCE TO DATA
E9F4 BDEAD2           (       filesys.os):00625                 JSR     RDISK                             ;READ A BLOCK
E9F7                  (       filesys.os):00626         SEEK3
E9F7 B6DCDA           (       filesys.os):00627                 LDA     >SAVDRV                           ;GET DRIVE
E9FA B7DCEB           (       filesys.os):00628                 STA     >SDRIVE                           ;SET IT
E9FD 4F               (       filesys.os):00629                 CLRA    ZERO RC
E9FE 3596             (       filesys.os):00630                 PULS    A,B,X,PC                          ;BACK TO END
                      (       filesys.os):00631         ;*
                      (       filesys.os):00632         ;* REPORT POSITION IN FILE
                      (       filesys.os):00633         ;*
EA00                  (       filesys.os):00634         FTELL
EA00 3430             (       filesys.os):00635                 PSHS    X,Y                               ;SAVE REGS
EA02 A641             (       filesys.os):00636                 LDA     ODRIVE,U                          ;GET DRIVE
EA04 B7DCEB           (       filesys.os):00637                 STA     >SDRIVE                           ;SELECT IT
EA07 108E0000         (       filesys.os):00638                 LDY     #0                                ;START AT POSITION ZERO
EA0B EC42             (       filesys.os):00639                 LDD     OFIRST,U                          ;GET ID OF FIRST
EA0D                  (       filesys.os):00640         FTEL1
EA0D 10A344           (       filesys.os):00641                 CMPD    OSECTOR,U                         ;ARE WE THERE?
EA10 2709             (       filesys.os):00642                 BEQ     FTEL2                             ;YES
EA12 31A90200         (       filesys.os):00643                 LEAY    512,Y                             ;ADVANCE 1 SECTOR SIZE
EA16 BDE5D2           (       filesys.os):00644                 JSR     FNDLNK                            ;LOCATE LINK
EA19 26F2             (       filesys.os):00645                 BNE     FTEL1                             ;TRY THIS ONE
EA1B                  (       filesys.os):00646         FTEL2
EA1B EC48             (       filesys.os):00647                 LDD     OOFFSET,U                         ;GET OFFSET
EA1D 3420             (       filesys.os):00648                 PSHS    Y                                 ;SAVE 'Y'
EA1F E3E1             (       filesys.os):00649                 ADDD    ,S++                              ;INCLUDE IN RESULT
EA21 3402             (       filesys.os):00650                 PSHS    A
EA23 B6DCDA           (       filesys.os):00651                 LDA     >SAVDRV                           ;GET DRIVE
EA26 B7DCEB           (       filesys.os):00652                 STA     >SDRIVE
EA29 4F               (       filesys.os):00653                 CLRA    'Z' RC
EA2A 35B2             (       filesys.os):00654                 PULS    A,X,Y,PC
                      (       filesys.os):00655         ;*
                      (       filesys.os):00656         ;* SUSPEND FILE OPERATION
                      (       filesys.os):00657         ;*
EA2C                  (       filesys.os):00658         SUSPEND
EA2C 3506             (       filesys.os):00659                 PULS    A,B                               ;GET PC FROM STACK
EA2E FDDCD3           (       filesys.os):00660                 STD     >TEMP4                            ;SAVE RETURN ADDRESS
EA31 EC46             (       filesys.os):00661                 LDD     OLSTSEC,U                         ;GET LAST SECTOR
EA33 AE48             (       filesys.os):00662                 LDX     OOFFSET,U                         ;GET OFFSET
EA35 10AE42           (       filesys.os):00663                 LDY     OFIRST,U                          ;GET FIRST SECT
EA38 3436             (       filesys.os):00664                 PSHS    A,B,X,Y                           ;SAVE IT
EA3A ECC4             (       filesys.os):00665                 LDD     OTYPE,U                           ;GET TYPE&DRIVE
EA3C 3406             (       filesys.os):00666                 PSHS    A,B                               ;SAVE IT
EA3E 8102             (       filesys.os):00667                 CMPA    #2                                ;WUZ IT WRITE?
EA40 262D             (       filesys.os):00668                 BNE     SUSP2                             ;DON'T SAVE
EA42 8C0000           (       filesys.os):00669                 CMPX    #0                                ;ZERO OFFSET
                      (       filesys.os):00670         
EA45 2728             (       filesys.os):00671                 BEQ     SUSP2                             ;DON'T SAVE
                      (       filesys.os):00672         ;* CHARACTER WRITE, WITH NON-ZERO OFFSET
EA47 A641             (       filesys.os):00673                 LDA     ODRIVE,U                          ;GET DRIVE
EA49 B7DCEB           (       filesys.os):00674                 STA     >SDRIVE                           ;SELECT IT
EA4C EC44             (       filesys.os):00675                 LDD     OSECTOR,U                         ;GET SECTOR
EA4E 1083FFFF         (       filesys.os):00676                 CMPD    #$FFFF                            ;OK TO WRITE?
EA52 2610             (       filesys.os):00677                 BNE     SUSP1                             ;ITS OK
EA54 BDE79D           (       filesys.os):00678                 JSR     FRESEC                            ;GRAB A SECTOR
EA57 3406             (       filesys.os):00679                 PSHS    A,B                               ;SAVE ID
EA59 EC46             (       filesys.os):00680                 LDD     OLSTSEC,U                         ;GET LAST
EA5B BDE5D2           (       filesys.os):00681                 JSR     FNDLNK                            ;GET ITS LINK
EA5E 3506             (       filesys.os):00682                 PULS    A,B                               ;RESTORE ID OF FREE
EA60 ED84             (       filesys.os):00683                 STD     ,X                                ;SET IT
EA62 ED44             (       filesys.os):00684                 STD     OSECTOR,U                         ;SET UP NEW SECTOR
EA64                  (       filesys.os):00685         SUSP1
EA64 304A             (       filesys.os):00686                 LEAX    OSIZ,U                            ;SET UP PTR
EA66 BDEB05           (       filesys.os):00687                 JSR     WDISK                             ;OUTPUT SECTOR TO DISK
EA69 B6DCDA           (       filesys.os):00688                 LDA     >SAVDRV                           ;GET DRIVE
EA6C B7DCEB           (       filesys.os):00689                 STA     >SDRIVE                           ;RESET IT
EA6F                  (       filesys.os):00690         SUSP2
EA6F BEDCD6           (       filesys.os):00691                 LDX     >SAVX                             ;RESTORE X
EA72 10BEDCD8         (       filesys.os):00692                 LDY     >SAVY                             ;RESTORE Y
EA76 F6DCD5           (       filesys.os):00693                 LDB     >SAVB                             ;RESTORE B
EA79 4F               (       filesys.os):00694                 CLRA    ZERO RC
EA7A 6E9FDCD3         (       filesys.os):00695                 JMP     [TEMP4]                           ;GOT FOR TI
                      (       filesys.os):00696         ;*
                      (       filesys.os):00697         ;* RESUME FILE OPERATION
                      (       filesys.os):00698         ;*
EA7E                  (       filesys.os):00699         RESUME
EA7E 3506             (       filesys.os):00700                 PULS    A,B                               ;GET PC
EA80 FDDCD3           (       filesys.os):00701                 STD     >TEMP4                            ;SAVE RETURN ADDRESS
EA83 3506             (       filesys.os):00702                 PULS    A,B                               ;RESTORE REGS
EA85 EDC4             (       filesys.os):00703                 STD     OTYPE,U                           ;RESTORE TYPE
EA87 F7DCEB           (       filesys.os):00704                 STB     >SDRIVE                           ;SELECT DRIVE
EA8A 3536             (       filesys.os):00705                 PULS    A,B,X,Y                           ;RESTORE REST
EA8C AF48             (       filesys.os):00706                 STX     OOFFSET,U                         ;SET OFFSET
EA8E 10AF42           (       filesys.os):00707                 STY     OFIRST,U                          ;SET FIRST
                      (       filesys.os):00708         ;* IF OLSTSEC IS ZERO, NO READ/WRITE TO DISK YET, OSECTOR IS FIRST IN FILE
EA91 ED46             (       filesys.os):00709                 STD     OLSTSEC,U                         ;RESET LAST SECTOR
EA93 2605             (       filesys.os):00710                 BNE     RESU1                             ;ITS OK
EA95 10AF44           (       filesys.os):00711                 STY     OSECTOR,U                         ;SET CURRENT SECTOR
EA98 2005             (       filesys.os):00712                 BRA     RESU2                             ;CONTINUE
                      (       filesys.os):00713         ;* ELSE OSECTOR IS NEXT AFTER OLSTSEC
EA9A                  (       filesys.os):00714         RESU1
EA9A BDE5D2           (       filesys.os):00715                 JSR     FNDLNK                            ;GET LINK
EA9D ED44             (       filesys.os):00716                 STD     OSECTOR,U                         ;SET UP NEXT SECTOR
                      (       filesys.os):00717         ;* CHECK FOR ACTUAL SECTOR IN MEMORY
EA9F                  (       filesys.os):00718         RESU2
EA9F EC48             (       filesys.os):00719                 LDD     OOFFSET,U                         ;CHAR OPERATIONS?
EAA1 2707             (       filesys.os):00720                 BEQ     RESU3                             ;NO, ALL IS OK
                      (       filesys.os):00721         ;* NON-ZERO OFFSET, SECTOR MUST BE READ INTO RAM
EAA3 EC44             (       filesys.os):00722                 LDD     OSECTOR,U                         ;GET SECTOR
EAA5 304A             (       filesys.os):00723                 LEAX    OSIZ,U                            ;ADVANCE TO BUFFER
EAA7 BDEAD2           (       filesys.os):00724                 JSR     RDISK                             ;READ IN SECTOR
EAAA                  (       filesys.os):00725         RESU3
EAAA B6DCDA           (       filesys.os):00726                 LDA     >SAVDRV                           ;RESTORE DRIVE
EAAD B7DCEB           (       filesys.os):00727                 STA     >SDRIVE                           ;RESET IT
EAB0 20B2             (       filesys.os):00728                 BRA     SUSP1                             ;RETURN TO CALLER
                      (       filesys.os):00729         ;*
                      (       filesys.os):00730         ;* CALCULATE CYLINDER, SECTOR, AND HEAD FROM ABSOLUTE SECTOR NUMBER
                      (       filesys.os):00731         ;*
EAB2                  (       filesys.os):00732         SECTOR
EAB2 3416             (       filesys.os):00733                 PSHS    A,B,X                             ;SAVE SECTOR ID
EAB4 1F01             (       filesys.os):00734                 TFR     D,X                               ;SECT ID IN 'X'
EAB6 A643             (       filesys.os):00735                 LDA     NSEC,U                            ;GET SECTORS/TRACK
EAB8 E642             (       filesys.os):00736                 LDB     NHEAD,U                           ;GET # HEADS
EABA 3D               (       filesys.os):00737                 MUL                                       ;CALCULATE SECTORS/CYLINDER
EABB BDF6A9           (       filesys.os):00738                 JSR     DIV16                             ;X=CYLINDER ID, D=SECTOR IN CYLINDER
EABE 6F45             (       filesys.os):00739                 CLR     HEAD,U                            ;ASSUME HEAD 0
EAC0                  (       filesys.os):00740         SEC1
EAC0 E143             (       filesys.os):00741                 CMPB    NSEC,U                            ;WHICH HEAD?
EAC2 2506             (       filesys.os):00742                 BLO     SEC2                              ;ASSUMPTION CORRECT
EAC4 E043             (       filesys.os):00743                 SUBB    NSEC,U                            ;CONVERT
EAC6 6C45             (       filesys.os):00744                 INC     HEAD,U                            ;ADVANCE TO NEXT HEAD
EAC8 20F6             (       filesys.os):00745                 BRA     SEC1                              ;TRY AGAIN
EACA                  (       filesys.os):00746         SEC2
EACA E746             (       filesys.os):00747                 STB     SEC,U                             ;INDICATE SECTOR
EACC 1F10             (       filesys.os):00748                 TFR     X,D                               ;GET CYLINDER ID
EACE E744             (       filesys.os):00749                 STB     CYL,U                             ;SAVE CYLINDER ID
EAD0 3596             (       filesys.os):00750                 PULS    A,B,X,PC
                      (       filesys.os):00751         ;*
                      (       filesys.os):00752         ;* READ SECTOR BY SECTOR ID(D) TO MEMORY(X)
                      (       filesys.os):00753         ;*
EAD2                  (       filesys.os):00754         RDISK
EAD2 3476             (       filesys.os):00755                 PSHS    A,B,X,Y,U                         ;SAVE REGISTERS
EAD4 7FDCEC           (       filesys.os):00756                 CLR     >ERRCNT                           ;ZERO ERROR COUNT
EAD7 8D20             (       filesys.os):00757                 BSR     GETCTL                            ;SET UP 'U'
EAD9                  (       filesys.os):00758         RTRY1
EAD9 ECE4             (       filesys.os):00759                 LDD     ,S                                ;GET SECTOR
EADB 8DD5             (       filesys.os):00760                 BSR     SECTOR                            ;CALCULATE CYLINDER, HEAD & SECTOR
EADD                  (       filesys.os):00761         RTRY2
EADD AE62             (       filesys.os):00762                 LDX     2,S                               ;RESTORE 'X'
EADF BDF6DA           (       filesys.os):00763                 JSR     RDSEC                             ;ATTEMPT READ
EAE2 2713             (       filesys.os):00764                 BEQ     RDONE                             ;SUCESS, ITS OK
EAE4 7CDCEC           (       filesys.os):00765                 INC     >ERRCNT                           ;ADVANCE
EAE7 F6DCEC           (       filesys.os):00766                 LDB     >ERRCNT                           ;GET VALUE
EAEA C105             (       filesys.os):00767                 CMPB    #5                                ;TOO MANY ERRORS?
EAEC 273C             (       filesys.os):00768                 BEQ     HDE                               ;YES, SKIP IT
EAEE C103             (       filesys.os):00769                 CMPB    #3                                ;TIME FOR RE-SEEK?
EAF0 26EB             (       filesys.os):00770                 BNE     RTRY2                             ;NO, DON'T RE-SEEK
EAF2 BDF6D0           (       filesys.os):00771                 JSR     HOME                              ;RECALIBRATE
EAF5 20E2             (       filesys.os):00772                 BRA     RTRY1                             ;AND RESEEK
EAF7                  (       filesys.os):00773         RDONE
EAF7 35F6             (       filesys.os):00774                 PULS    A,B,X,Y,U,PC
                      (       filesys.os):00775         ;*
                      (       filesys.os):00776         ;* GET DRIVE(A) CONTROL BLOCK IN 'D' & 'U'
                      (       filesys.os):00777         ;*
EAF9                  (       filesys.os):00778         GETCTL
EAF9 B6DCEB           (       filesys.os):00779                 LDA     >SDRIVE                           ;GET SELECTED DRIVE
EAFC                  (       filesys.os):00780         GETCTL1
EAFC C607             (       filesys.os):00781                 LDB     #CSIZE                            ;SIZE OF EACH BLOCK
EAFE 3D               (       filesys.os):00782                 MUL                                       ;CALCULATE OFFSET
EAFF C3DC50           (       filesys.os):00783                 ADDD    #DCTRL                            ;OFFSET TO DATA AREA
EB02 1F03             (       filesys.os):00784                 TFR     D,U                               ;SET UP U
EB04 39               (       filesys.os):00785                 RTS
                      (       filesys.os):00786         ;*
                      (       filesys.os):00787         ;* WRITE SECTOR BY SECTOR ID(D) TO MEMORY(X)
                      (       filesys.os):00788         ;*
EB05                  (       filesys.os):00789         WDISK
EB05 3476             (       filesys.os):00790                 PSHS    A,B,X,Y,U                         ;SAVE REGISTERS
EB07 7FDCEC           (       filesys.os):00791                 CLR     >ERRCNT                           ;ZERO ERROR COUNT
EB0A 8DED             (       filesys.os):00792                 BSR     GETCTL                            ;SET UP 'U'
EB0C                  (       filesys.os):00793         WTRY1
EB0C ECE4             (       filesys.os):00794                 LDD     ,S                                ;GET SECTOR
EB0E 8DA2             (       filesys.os):00795                 BSR     SECTOR                            ;CALCULATE CYLINDER, HEAD & SECTOR
EB10                  (       filesys.os):00796         WTRY2
EB10 AE62             (       filesys.os):00797                 LDX     2,S                               ;RESTORE 'X'
EB12 BDF6DE           (       filesys.os):00798                 JSR     WRSEC                             ;ATTEMPT WRITE
EB15 27E0             (       filesys.os):00799                 BEQ     RDONE                             ;SUCCESS, ITS OK
EB17 7CDCEC           (       filesys.os):00800                 INC     >ERRCNT                           ;ADVANCE
EB1A F6DCEC           (       filesys.os):00801                 LDB     >ERRCNT                           ;GET VALUE
EB1D C105             (       filesys.os):00802                 CMPB    #5                                ;TOO MANY ERRORS?
EB1F 2709             (       filesys.os):00803                 BEQ     HDE                               ;YES, SKIP IT
EB21 C103             (       filesys.os):00804                 CMPB    #3                                ;TIME FOR RE-SEEK
EB23 26EB             (       filesys.os):00805                 BNE     WTRY2                             ;NO, DON'T RE-SEEK
EB25 BDF6D0           (       filesys.os):00806                 JSR     HOME                              ;RECALIBRATE
EB28 20E2             (       filesys.os):00807                 BRA     WTRY1                             ;AND RESEEK
                      (       filesys.os):00808         ;* REPORT DISK ERROR
EB2A                  (       filesys.os):00809         HDE
EB2A B7DCCB           (       filesys.os):00810                 STA     >TEMP                             ;SAVE ERROR CODE
EB2D 3576             (       filesys.os):00811                 PULS    A,B,X,Y,U                         ;RESTORE REGS CUZ 'U' NOT SAVED
EB2F 10B3DCDF         (       filesys.os):00812                 CMPD    >WRKSEC                           ;WAS IT WORK SECTOR?
EB33 2612             (       filesys.os):00813                 BNE     HDE1                              ;NO, ITS NOT
EB35 3402             (       filesys.os):00814                 PSHS    A                                 ;SAVE A
EB37 B6DCEB           (       filesys.os):00815                 LDA     >SDRIVE                           ;GET CURRENT DRIVE
EB3A B1DCDE           (       filesys.os):00816                 CMPA    >WRKDRV                           ;ON WORK DRIVE?
EB3D 3502             (       filesys.os):00817                 PULS    A                                 ;RESTORE A
EB3F 2606             (       filesys.os):00818                 BNE     HDE1                              ;NOT WORK DRIVE
EB41 BDE618           (       filesys.os):00819                 JSR     PURGE1                            ;INSURE NO WORK SECTOR IN CORE
EB44 7FDCDD           (       filesys.os):00820                 CLR     >WRKCHG                           ;INSURE NO UPDATE RECORDED
EB47                  (       filesys.os):00821         HDE1
EB47 BDE541           (       filesys.os):00822                 JSR     WRLIN                             ;OUTPUT STRING
EB4A 4572726F72206163 (       filesys.os):00823                 FCC     'Error accessing block '
     63657373696E6720
     626C6F636B20
EB60 00               (       filesys.os):00824                 FCB     $00
EB61 BDE471           (       filesys.os):00825                 JSR     WRDEC                             ;DISPLAY BLOCK
EB64 BDE541           (       filesys.os):00826                 JSR     WRLIN                             ;OUTPUT STRING
EB67 206F6E2064726976 (       filesys.os):00827                 FCC     ' on drive: '
     653A20
EB72 00               (       filesys.os):00828                 FCB     $00
EB73 B6DCEB           (       filesys.os):00829                 LDA     >SDRIVE                           ;GET DRIVE ID
EB76 8B41             (       filesys.os):00830                 ADDA    #'A'                              ;OFFSET
EB78 BDE58D           (       filesys.os):00831                 JSR     PUTCHR
EB7B BDE57B           (       filesys.os):00832                 JSR     LFCR                              ;NEW LINE
EB7E 8EEB9B           (       filesys.os):00833                 LDX     #DETAB                            ;PT TO TABLE
EB81                  (       filesys.os):00834         HDE2
EB81 7ADCCB           (       filesys.os):00835                 DEC     >TEMP                             ;REDUCE ERROR COUNT
EB84 270A             (       filesys.os):00836                 BEQ     HDE4                              ;THIS IS IT
EB86                  (       filesys.os):00837         HDE3
EB86 A680             (       filesys.os):00838                 LDA     ,X+                               ;GET CHAR
EB88 26FC             (       filesys.os):00839                 BNE     HDE3                              ;KEEP LOOKING
EB8A A684             (       filesys.os):00840                 LDA     ,X                                ;MORE?
EB8C 26F3             (       filesys.os):00841                 BNE     HDE2                              ;NO, ERROR
EB8E 3001             (       filesys.os):00842                 LEAX    1,X                               ;SKIP MARKER
EB90                  (       filesys.os):00843         HDE4
EB90 BDE567           (       filesys.os):00844                 JSR     WRSTR                             ;OUTPUT STRING
EB93 BDE57B           (       filesys.os):00845                 JSR     LFCR                              ;NEW LINE
EB96 8609             (       filesys.os):00846                 LDA     #RCDSK                            ;INDICATE DISK ERROR
EB98 7EE2EB           (       filesys.os):00847                 JMP     ERRRET                            ;RETURN
                      (       filesys.os):00848         ;* DISK ERROR MESSAGES
EB9B                  (       filesys.os):00849         DETAB
EB9B 4469736B20666F72 (       filesys.os):00850                 FCC     'Disk format error'
     6D6174206572726F
     72
EBAC 00               (       filesys.os):00851                 FCB     $00
EBAD 4261642073656374 (       filesys.os):00852                 FCC     'Bad sector'
     6F72
EBB7 00               (       filesys.os):00853                 FCB     $00
EBB8 536563746F72206E (       filesys.os):00854                 FCC     'Sector not found'
     6F7420666F756E64
EBC8 00               (       filesys.os):00855                 FCB     $00
EBC9 4469736B20777269 (       filesys.os):00856                 FCC     'Disk write protected'
     74652070726F7465
     63746564
EBDD 00               (       filesys.os):00857                 FCB     $00
EBDE 00               (       filesys.os):00858                 FCB     0                                 ;END OF TABLE
EBDF 4469736B20737973 (       filesys.os):00859                 FCC     'Disk system error'
     74656D206572726F
     72
EBF0 00               (       filesys.os):00860                 FCB     $00
                      (        cubix.asm):01226                 INCLUDE command.os                        ;INTERNAL COMMANDS
                      (       command.os):00001         ;*
                      (       command.os):00002         ;* CUBIX Internal (built in) command handlers
                      (       command.os):00003         ;*
                      (       command.os):00004         ;* FORMAT COMMAND
                      (       command.os):00005         ;*
EBF1                  (       command.os):00006         INIT
EBF1 BDE616           (       command.os):00007                 JSR     PURGE                             ;INSURE NO DISK I/O IN PROG
EBF4 BDE3F2           (       command.os):00008                 JSR     GETDRV                            ;GET DRIVE ID
EBF7 B7DCEB           (       command.os):00009                 STA     >SDRIVE                           ;SELECT IT
EBFA BDEAF9           (       command.os):00010                 JSR     GETCTL                            ;PT 'U' TO CTRL BLOCK
EBFD CC0203           (       command.os):00011                 LDD     #$0203                            ;DEFAULT INTERLEAVE & ALLOCATION
EC00 FDDCD3           (       command.os):00012                 STD     >TEMP4                            ;SAVE IT
                      (       command.os):00013         ;* GET FORMAT OPERANDS
EC03                  (       command.os):00014         INI00
EC03 BDE4CF           (       command.os):00015                 JSR     SKIP                              ;ANY MORE OPERANDS?
EC06 2728             (       command.os):00016                 BEQ     INI1                              ;NO, THTS ALL
EC08 8EF3FB           (       command.os):00017                 LDX     #INITAB                           ;POINT TO TABLE
EC0B BDF0B6           (       command.os):00018                 JSR     TLOOKE                            ;GET DATA
EC0E 3404             (       command.os):00019                 PSHS    B                                 ;SAVE ID
EC10 BDE404           (       command.os):00020                 JSR     GETNUM                            ;GET VALUE
EC13 3502             (       command.os):00021                 PULS    A                                 ;RESTORE A
EC15 4D               (       command.os):00022                 TSTA    INTERLEAVE?
EC16 2605             (       command.os):00023                 BNE     INI01                             ;NO
EC18 F7DCD3           (       command.os):00024                 STB     >TEMP4                            ;SAVE INTERLEAVE
EC1B 20E6             (       command.os):00025                 BRA     INI00                             ;TRY FOR NEXT
EC1D                  (       command.os):00026         INI01
EC1D 4A               (       command.os):00027                 DECA    DIRECTORY?
EC1E 2605             (       command.os):00028                 BNE     INI02                             ;NO, USE STANDARD OPTIONS
EC20 F7DCD4           (       command.os):00029                 STB     >TEMP4+1                          ;SET DIRECTORY ALLOCATION
EC23 20DE             (       command.os):00030                 BRA     INI00                             ;TRY FOR NEXT
EC25                  (       command.os):00031         INI02
EC25 4A               (       command.os):00032                 DECA    CONVERT
EC26 8103             (       command.os):00033                 CMPA    #3                                ;IN RANGE?
EC28 1022F67F         (       command.os):00034                 LBHI    BADOPR                            ;NO, REPORT ERROR
EC2C E7C6             (       command.os):00035                 STB     A,U                               ;SET UP DRIVE
EC2E 20D3             (       command.os):00036                 BRA     INI00                             ;TRY FOR NEXT
                      (       command.os):00037         ;* DISPLAY FORMAT
EC30                  (       command.os):00038         INI1
EC30 BDE541           (       command.os):00039                 JSR     WRLIN
EC33 466F726D61747469 (       command.os):00040                 FCC     'Formatting '
     6E6720
EC3E 00               (       command.os):00041                 FCB     $00
EC3F B6DCEB           (       command.os):00042                 LDA     >SDRIVE
EC42 BDF203           (       command.os):00043                 JSR     SHODRV                            ;SHOW THE DISK
EC45 8EF3FB           (       command.os):00044                 LDX     #INITAB                           ;POINT TO TABLE
EC48 4F               (       command.os):00045                 CLRA                                      ;DISPLAY INTERLEAVE
EC49 F6DCD3           (       command.os):00046                 LDB     >TEMP4                            ;GET INTERLEAVE FACTOR
EC4C BDF242           (       command.os):00047                 JSR     SHODRB                            ;DISPLAY IT
EC4F 8601             (       command.os):00048                 LDA     #1                                ;DISPLAY DIRECTORY EXTENSION
EC51 F6DCD4           (       command.os):00049                 LDB     >TEMP4+1                          ;GET DIRECTORY EXTENSION
EC54 BDF23C           (       command.os):00050                 JSR     SHODRA                            ;DISPLAY IT
EC57 BDE541           (       command.os):00051                 JSR     WRLIN                             ;MESSAGE
EC5A 0A0D             (       command.os):00052                 FCB     $0A,$0D                           ;NEW LINE
EC5C 4F6B3F20         (       command.os):00053                 FCC     'Ok? '
EC60 00               (       command.os):00054                 FCB     $00
EC61 BDE5CD           (       command.os):00055                 JSR     GETCHR
EC64 BDE58D           (       command.os):00056                 JSR     PUTCHR                            ;ECHO
EC67 84DF             (       command.os):00057                 ANDA    #$DF                              ;GET IT
EC69 8159             (       command.os):00058                 CMPA    #'Y'
EC6B 1026F90C         (       command.os):00059                 LBNE    LFCR
EC6F BDE57B           (       command.os):00060                 JSR     LFCR                              ;NEW LINE
                      (       command.os):00061         ;* FORMAT PHYSICAL DISK
EC72 B6DCD3           (       command.os):00062                 LDA     >TEMP4                            ;GET INTERLEAVE FACTOR
EC75 BDF6CC           (       command.os):00063                 JSR     FORMAT                            ;FORMAT THE DISK
EC78 B6DCD4           (       command.os):00064                 LDA     >TEMP4+1                          ;GET DIRECTORY ALLOC
EC7B B7DCD3           (       command.os):00065                 STA     >TEMP4                            ;LOCAL COPY OF DIR ALLOC
                      (       command.os):00066         ;* SET UP DIRECTORY & LINK TABLE ON DISK
EC7E 8EDE00           (       command.os):00067                 LDX     #WRKSPC                           ;POINT TO IT
EC81                  (       command.os):00068         INI2
EC81 6F80             (       command.os):00069                 CLR     ,X+                               ;CLEAR ONE
EC83 8CE000           (       command.os):00070                 CMPX    #WRKSPC+512                       ;ARE WE OVER?
EC86 25F9             (       command.os):00071                 BLO     INI2                              ;NO, KEEP CLEARING
                      (       command.os):00072         ;* WRITE BASE DIRECTORY SECTOR
EC88 8EDE00           (       command.os):00073                 LDX     #WRKSPC                           ;PT BACK TO IT
EC8B CC0000           (       command.os):00074                 LDD     #DIRSEC                           ;DIRECTORY SECTOR
EC8E BDEB05           (       command.os):00075                 JSR     WDISK                             ;WRITE DIRECTORY (NO FILES)
                      (       command.os):00076         ;* WRITE NON-BASE LINK SECTORS
EC91 BDE705           (       command.os):00077                 JSR     CURSIZ                            ;GET SIZE OF CURRENT DRIVE
EC94 830001           (       command.os):00078                 SUBD    #1                                ;CONVERT TO HIGHEST SECTOR ID
EC97 1F89             (       command.os):00079                 TFR     A,B                               ;COPY A&B = D/256(ENTRIES/LINKSEC)
EC99 FDDCD1           (       command.os):00080                 STD     >TEMP3                            ;SAVE FOR LATER
EC9C CC0002           (       command.os):00081                 LDD     #LNKSEC+1                         ;POINT TO LINK SECTOR
EC9F                  (       command.os):00082         INI3
EC9F 7ADCD2           (       command.os):00083                 DEC     >TEMP3+1                          ;REDUCE COUNT
ECA2 2B08             (       command.os):00084                 BMI     INI4                              ;END
ECA4 BDEB05           (       command.os):00085                 JSR     WDISK                             ;WRITE IT
ECA7 C30001           (       command.os):00086                 ADDD    #1                                ;NEXT SECTOR
ECAA 20F3             (       command.os):00087                 BRA     INI3                              ;KEEP GOING
                      (       command.os):00088         ;* WRITE NON-BASE DIRECTORY SECTORS
ECAC                  (       command.os):00089         INI4
ECAC 7ADCD3           (       command.os):00090                 DEC     >TEMP4                            ;BACKUP
ECAF 2B08             (       command.os):00091                 BMI     INI5                              ;THATS ALL
ECB1 BDEB05           (       command.os):00092                 JSR     WDISK                             ;WRITE IT
ECB4 C30001           (       command.os):00093                 ADDD    #1                                ;NEXT ONE
ECB7 20F3             (       command.os):00094                 BRA     INI4                              ;DO EM ALL
                      (       command.os):00095         ;* WRITE BASE LINK SECTOR
ECB9                  (       command.os):00096         INI5
ECB9 CCFFFF           (       command.os):00097                 LDD     #$FFFF                            ;END OF CHAIN INDICATOR
ECBC ED84             (       command.os):00098                 STD     DIRSEC*2,X                        ;SET DIRECTORY FREE
ECBE 3002             (       command.os):00099                 LEAX    LNKSEC*2,X                        ;OFFSET TO IT
ECC0 CC0002           (       command.os):00100                 LDD     #LNKSEC+1                         ;POINT TO LINK SECTOR
ECC3                  (       command.os):00101         INI6
ECC3 7ADCD1           (       command.os):00102                 DEC     >TEMP3                            ;REDUCE COUNT
ECC6 2B07             (       command.os):00103                 BMI     INI7                              ;END
ECC8 ED81             (       command.os):00104                 STD     ,X++                              ;WRITE IT OUT
ECCA C30001           (       command.os):00105                 ADDD    #1                                ;ADVANCE
ECCD 20F4             (       command.os):00106                 BRA     INI6                              ;DO EM ALL
ECCF                  (       command.os):00107         INI7
ECCF 3406             (       command.os):00108                 PSHS    A,B                               ;SAVE SECTOR ID
ECD1 7DDCD4           (       command.os):00109                 TST     >TEMP4+1                          ;ANY ADDITIONAL DIR?
ECD4 2703             (       command.os):00110                 BEQ     INI8                              ;NO
ECD6 FDDE00           (       command.os):00111                 STD     >2*DIRSEC+WRKSPC                  ;SET IT
ECD9                  (       command.os):00112         INI8
ECD9 CCFFFF           (       command.os):00113                 LDD     #$FFFF                            ;END OF CHAIN INDICATOR
ECDC ED81             (       command.os):00114                 STD     ,X++                              ;CLOSE OFF LINKS
ECDE 3506             (       command.os):00115                 PULS    A,B                               ;RESTORE SECTOR ID
ECE0                  (       command.os):00116         INI9
ECE0 7ADCD4           (       command.os):00117                 DEC     >TEMP4+1                          ;REDUCE COUNT
ECE3 2B07             (       command.os):00118                 BMI     INI10                             ;EXIT
ECE5 C30001           (       command.os):00119                 ADDD    #1                                ;NEXT SECTOR
ECE8 ED81             (       command.os):00120                 STD     ,X++                              ;SET LINK FOR DIRECTORY
ECEA 20F4             (       command.os):00121                 BRA     INI9                              ;DO EM ALL
ECEC                  (       command.os):00122         INI10
ECEC CCFFFF           (       command.os):00123                 LDD     #$FFFF                            ;END OF CHAIN INDICATOR
ECEF ED1E             (       command.os):00124                 STD     -2,X                              ;CLOSE OFF DIRECTORY
ECF1 8EDE00           (       command.os):00125                 LDX     #WRKSPC                           ;RESET
ECF4 CC0001           (       command.os):00126                 LDD     #LNKSEC                           ;PT TO IT
ECF7 7EEB05           (       command.os):00127                 JMP     WDISK                             ;WRITE TO DISK
                      (       command.os):00128         ;*
                      (       command.os):00129         ;* READ DISK COMMAND
                      (       command.os):00130         ;*
ECFA                  (       command.os):00131         CREAD
ECFA BDE3F2           (       command.os):00132                 JSR     GETDRV
ECFD B7DCEB           (       command.os):00133                 STA     >SDRIVE
ED00 BDE404           (       command.os):00134                 JSR     GETNUM                            ;GET SECTOR ID
ED03 3410             (       command.os):00135                 PSHS    X                                 ;SAVE
ED05 BDE40F           (       command.os):00136                 JSR     GETHEX                            ;GET MEMORY ADDRESS
ED08 3410             (       command.os):00137                 PSHS    X                                 ;SAVE
ED0A 8E0001           (       command.os):00138                 LDX     #1                                ;DEFAULT TO ONE
ED0D BDE4CF           (       command.os):00139                 JSR     SKIP                              ;ADVANCE
ED10 2703             (       command.os):00140                 BEQ     CRD1                              ;NO MORE
ED12 BDE404           (       command.os):00141                 JSR     GETNUM                            ;GET # SECTORS
ED15                  (       command.os):00142         CRD1
ED15 1F12             (       command.os):00143                 TFR     X,Y                               ;SET UP COUNTER
ED17 3510             (       command.os):00144                 PULS    X                                 ;RESTORE MEM ADDR
ED19 3506             (       command.os):00145                 PULS    A,B                               ;RESTORE SECTOR ID
ED1B                  (       command.os):00146         CRD2
ED1B BDEAD2           (       command.os):00147                 JSR     RDISK                             ;READ IT
ED1E 30890200         (       command.os):00148                 LEAX    512,X                             ;NEXT LOCATION
ED22 C30001           (       command.os):00149                 ADDD    #1                                ;NEXT SECTOR
ED25 313F             (       command.os):00150                 LEAY    -1,Y                              ;REDUCE COUNT
ED27 26F2             (       command.os):00151                 BNE     CRD2
ED29 39               (       command.os):00152                 RTS
                      (       command.os):00153         ;*
                      (       command.os):00154         ;* WRITE DISK COMMAND
                      (       command.os):00155         ;*
ED2A                  (       command.os):00156         CWRITE
ED2A BDE3F2           (       command.os):00157                 JSR     GETDRV
ED2D B7DCEB           (       command.os):00158                 STA     >SDRIVE
ED30 BDE404           (       command.os):00159                 JSR     GETNUM                            ;GET SECTOR ID
ED33 3410             (       command.os):00160                 PSHS    X                                 ;SAVE
ED35 BDE40F           (       command.os):00161                 JSR     GETHEX                            ;GET MEMORY ADDRESS
ED38 3410             (       command.os):00162                 PSHS    X                                 ;SAVE
ED3A 8E0001           (       command.os):00163                 LDX     #1                                ;DEFAULT TO ONE
ED3D BDE4CF           (       command.os):00164                 JSR     SKIP                              ;ADVANCE
ED40 2703             (       command.os):00165                 BEQ     CWR1                              ;NO MORE
ED42 BDE404           (       command.os):00166                 JSR     GETNUM                            ;GET # SECTORS
ED45                  (       command.os):00167         CWR1
ED45 1F12             (       command.os):00168                 TFR     X,Y                               ;SET UP COUNTER
ED47 3510             (       command.os):00169                 PULS    X                                 ;RESTORE MEM ADDR
ED49 3506             (       command.os):00170                 PULS    A,B                               ;RESTORE SECTOR ID
ED4B                  (       command.os):00171         CWR2
ED4B BDEB05           (       command.os):00172                 JSR     WDISK                             ;WRITE IT
ED4E 30890200         (       command.os):00173                 LEAX    512,X                             ;NEXT LOCATION
ED52 C30001           (       command.os):00174                 ADDD    #1                                ;NEXT SECTOR
ED55 313F             (       command.os):00175                 LEAY    -1,Y                              ;REDUCE COUNT
ED57 26F2             (       command.os):00176                 BNE     CWR2
ED59 39               (       command.os):00177                 RTS
                      (       command.os):00178         ;*
                      (       command.os):00179         ;* 'FILES' COMMAND, DISPLAY DISK DIRECTORY
                      (       command.os):00180         ;*
ED5A                  (       command.os):00181         FILES
ED5A 8EDCB8           (       command.os):00182                 LDX     #PREFIX                           ;POINT TO FILENAME
ED5D C613             (       command.os):00183                 LDB     #19                               ;CLEAR 19 CHARS
ED5F                  (       command.os):00184         FIL1
ED5F 6F80             (       command.os):00185                 CLR     ,X+
ED61 5A               (       command.os):00186                 DECB
ED62 26FB             (       command.os):00187                 BNE     FIL1
ED64 862A             (       command.os):00188                 LDA     #'*'                              ;WILDCARD
ED66 B7DCC0           (       command.os):00189                 STA     >PREFIX+8
ED69 B7DCC8           (       command.os):00190                 STA     >PREFIX+16
ED6C 3420             (       command.os):00191                 PSHS    Y                                 ;SAVE CMD PTR
ED6E BDE3A3           (       command.os):00192                 JSR     GETDIR                            ;GET DIRECTORY NAME
ED71 BDE4DC           (       command.os):00193                 JSR     TSTERM                            ;ANY MORE?
ED74 3520             (       command.os):00194                 PULS    Y                                 ;RESTORE Y
ED76 2703             (       command.os):00195                 BEQ     FIL2                              ;NO, DISPAY
ED78 BDE36A           (       command.os):00196                 JSR     GETNAM                            ;GET FULL FILE PATTERN
ED7B                  (       command.os):00197         FIL2
ED7B 7EE6A9           (       command.os):00198                 JMP     DISDIR                            ;OUTPUT IT
                      (       command.os):00199         ;*
                      (       command.os):00200         ;* 'CREATE' COMMAND, CREATE A FILE
                      (       command.os):00201         ;*
ED7E                  (       command.os):00202         CREFIL
ED7E FCE002           (       command.os):00203                 LDD     >MBASE                            ;DEFAULT LOAD ADDRESS
ED81 FDDCD3           (       command.os):00204                 STD     >TEMP4                            ;SAVE IT
ED84 BDE363           (       command.os):00205                 JSR     GETVAL                            ;GET FILENAME
ED87 BDE4CF           (       command.os):00206                 JSR     SKIP                              ;MORE OPERANDS?
ED8A 2706             (       command.os):00207                 BEQ     CREF1                             ;NO, SKIP IT
ED8C BDE40F           (       command.os):00208                 JSR     GETHEX                            ;GET VALUE
ED8F BFDCD3           (       command.os):00209                 STX     >TEMP4                            ;SAVE IT
ED92                  (       command.os):00210         CREF1
ED92 7EE717           (       command.os):00211                 JMP     CREATE                            ;MAKE THE FILE
                      (       command.os):00212         ;*
                      (       command.os):00213         ;* 'DELETE' COMMAND
                      (       command.os):00214         ;*
ED95                  (       command.os):00215         DELFIL
ED95 BDE36A           (       command.os):00216                 JSR     GETNAM                            ;GET FILENAME
ED98                  (       command.os):00217         DELETE
ED98 BDE64C           (       command.os):00218                 JSR     LOCERR                            ;LOOK IT UP
ED9B BDE34F           (       command.os):00219                 JSR     VALID                             ;VALID AS A SINGLE?
ED9E 262C             (       command.os):00220                 BNE     MULDEL                            ;NO.
EDA0 A68817           (       command.os):00221                 LDA     DATTR,X                           ;GET ATTRIBUTES
EDA3 8510             (       command.os):00222                 BITA    #DPERM                            ;CAN WE DELETE
EDA5 1027FAF7         (       command.os):00223                 LBEQ    PROERR                            ;NO, REPORT ERROR
EDA9 6F84             (       command.os):00224                 CLR     ,X                                ;INDICATE THIS ENTRY FREE
EDAB BDE794           (       command.os):00225                 JSR     CHGWRK                            ;MARK IT AS CHANGED
EDAE EC8813           (       command.os):00226                 LDD     DDADR,X                           ;GET DISK ADDRESS
                      (       command.os):00227         ;* RELEASE ALL CAHINED SECTORS
EDB1                  (       command.os):00228         UNCHAIN
EDB1 BDE5D2           (       command.os):00229                 JSR     FNDLNK                            ;LOCATE ITS LINK
EDB4 270F             (       command.os):00230                 BEQ     UNC1                              ;LAST ONE
EDB6 10830000         (       command.os):00231                 CMPD    #0                                ;DID WE GET LOOSE SOMEHOW
EDBA 2709             (       command.os):00232                 BEQ     UNC1                              ;STOP
EDBC 6F84             (       command.os):00233                 CLR     ,X                                ;ZERO THE ENTRY...
EDBE 6F01             (       command.os):00234                 CLR     1,X                               ;MAKEING IT FREE
EDC0 BDE794           (       command.os):00235                 JSR     CHGWRK                            ;INDICATE WE CHANGED
EDC3 20EC             (       command.os):00236                 BRA     UNCHAIN                           ;CONTINUE
EDC5                  (       command.os):00237         UNC1
EDC5 6F84             (       command.os):00238                 CLR     ,X
EDC7 6F01             (       command.os):00239                 CLR     1,X
EDC9 7EE794           (       command.os):00240                 JMP     CHGWRK                            ;END OF DELETE
                      (       command.os):00241         ;* FILENAME CONTAINED WILDCARDS, PROMPT FOR EACH FILE
EDCC                  (       command.os):00242         MULDEL
EDCC CC0000           (       command.os):00243                 LDD     #DIRSEC                           ;DIRECTORY STARTS HERE
EDCF                  (       command.os):00244         MULD1
EDCF BDE5EF           (       command.os):00245                 JSR     RDWRK                             ;READ WORK SECTOR
EDD2                  (       command.os):00246         MULD2
EDD2 BDE316           (       command.os):00247                 JSR     COMNAM                            ;IS THIS ONE?
EDD5 2654             (       command.os):00248                 BNE     MULD3                             ;NO
EDD7 BDE6DD           (       command.os):00249                 JSR     SHONAM                            ;DISPLAY
EDDA A68817           (       command.os):00250                 LDA     DATTR,X                           ;GET ATTRIBUTES
EDDD 8510             (       command.os):00251                 BITA    #DPERM                            ;CAN WE DELETE
EDDF 2610             (       command.os):00252                 BNE     MULD5                             ;YES WE CAN
EDE1 BDE571           (       command.os):00253                 JSR     WRMSG                             ;OUTPUT MESSAGE
EDE4 2050726F74656374 (       command.os):00254                 FCC     ' Protected'
     6564
EDEE 00               (       command.os):00255                 FCB     $00
EDEF 203A             (       command.os):00256                 BRA     MULD3
EDF1                  (       command.os):00257         MULD5
EDF1 BDE541           (       command.os):00258                 JSR     WRLIN                             ;OUTPUT MESSAGE
EDF4 2028592F4E2F5129 (       command.os):00259                 FCC     ' (Y/N/Q)?'
     3F
EDFD 00               (       command.os):00260                 FCB     $00
EDFE BDE5CD           (       command.os):00261                 JSR     GETCHR                            ;GET CHAR
EE01 BDE58D           (       command.os):00262                 JSR     PUTCHR                            ;ECHO
EE04 BDE57B           (       command.os):00263                 JSR     LFCR                              ;NEW LINE
EE07 84DF             (       command.os):00264                 ANDA    #$DF                              ;CONVERT TO UPPER
EE09 8151             (       command.os):00265                 CMPA    #'Q'                              ;QUIT?
EE0B 272E             (       command.os):00266                 BEQ     MULD4
EE0D 8159             (       command.os):00267                 CMPA    #'Y'                              ;DO WE KILL?
EE0F 261A             (       command.os):00268                 BNE     MULD3                             ;NO
EE11 6F84             (       command.os):00269                 CLR     ,X                                ;ZAP IT
EE13 BDE794           (       command.os):00270                 JSR     CHGWRK                            ;INDICATE CHANGED
EE16 3414             (       command.os):00271                 PSHS    B,X                               ;SAVE REGS
EE18 FCDCDF           (       command.os):00272                 LDD     >WRKSEC                           ;GET WORK SECTOR
EE1B FDDCCD           (       command.os):00273                 STD     >TEMP1                            ;SAVE
EE1E EC8813           (       command.os):00274                 LDD     DDADR,X                           ;GET DISK ADDRESS
EE21 8D8E             (       command.os):00275                 BSR     UNCHAIN                           ;RELEASE
EE23 FCDCCD           (       command.os):00276                 LDD     >TEMP1                            ;GET SECTOR BACK
EE26 BDE5EF           (       command.os):00277                 JSR     RDWRK                             ;RE-READ
EE29 3514             (       command.os):00278                 PULS    B,X
EE2B                  (       command.os):00279         MULD3
EE2B 308820           (       command.os):00280                 LEAX    32,X                              ;ADVANCE TO NEXT
EE2E 8CE000           (       command.os):00281                 CMPX    #WRKSPC+512                       ;ARE WE OVER?
EE31 259F             (       command.os):00282                 BLO     MULD2                             ;NO
EE33 FCDCDF           (       command.os):00283                 LDD     >WRKSEC                           ;GET SECTOR ID
EE36 BDE5D2           (       command.os):00284                 JSR     FNDLNK                            ;LOOK FOR LINK
EE39 2694             (       command.os):00285                 BNE     MULD1
EE3B                  (       command.os):00286         MULD4
EE3B 39               (       command.os):00287                 RTS
                      (       command.os):00288         ;*
                      (       command.os):00289         ;* BINARY LOAD A FILE AT MEMORY(X)
                      (       command.os):00290         ;*
EE3C                  (       command.os):00291         BLOAD
EE3C 3410             (       command.os):00292                 PSHS    X                                 ;SAVE ADDRESS
EE3E BDE896           (       command.os):00293                 JSR     LOCRED                            ;LOOKUP FILE
EE41 EC8813           (       command.os):00294                 LDD     DDADR,X                           ;GET DISK ADDRESS
EE44 3510             (       command.os):00295                 PULS    X                                 ;RESTORE MEMORY ADDRESS
EE46 2018             (       command.os):00296                 BRA     LCHAIN                            ;LOAD IN THE CHAIN
                      (       command.os):00297         ;*
                      (       command.os):00298         ;* 'LOAD' COMMAND, LOADS A FILE INTO MEMORY
                      (       command.os):00299         ;*
EE48                  (       command.os):00300         LODFIL
EE48 BDE363           (       command.os):00301                 JSR     GETVAL                            ;GET FILENAME
EE4B BDE896           (       command.os):00302                 JSR     LOCRED                            ;INSURE IT EXISTS
EE4E EC8813           (       command.os):00303                 LDD     DDADR,X                           ;GET DISK ADDRESS
EE51 3406             (       command.os):00304                 PSHS    A,B                               ;SAVE
EE53 AE8815           (       command.os):00305                 LDX     DRADR,X                           ;GET RUN ADDRESS
EE56 BDE4CF           (       command.os):00306                 JSR     SKIP                              ;ANY MORE OPERANDS
EE59 2703             (       command.os):00307                 BEQ     LODF1                             ;NO, CONTINUE
EE5B BDE40F           (       command.os):00308                 JSR     GETHEX                            ;GET ADDRESS
EE5E                  (       command.os):00309         LODF1
EE5E 3506             (       command.os):00310                 PULS    A,B                               ;RESTORE DISK ADDR
                      (       command.os):00311         ;* LOAD A CHAIN OF SECTORS
EE60                  (       command.os):00312         LCHAIN
EE60 BDEAD2           (       command.os):00313                 JSR     RDISK                             ;READ DISK
EE63 30890200         (       command.os):00314                 LEAX    512,X                             ;MOVE TO NEXT ADDRESS
EE67 3410             (       command.os):00315                 PSHS    X                                 ;SAVE PTR
EE69 BDE5D2           (       command.os):00316                 JSR     FNDLNK                            ;LOOKUP LINK
EE6C 3510             (       command.os):00317                 PULS    X                                 ;RESTORE
EE6E 26F0             (       command.os):00318                 BNE     LCHAIN                            ;KEEP GOING
EE70                  (       command.os):00319         OKRET
EE70 39               (       command.os):00320                 RTS
                      (       command.os):00321         ;*
                      (       command.os):00322         ;* BINARY SAVE OF A FILE FROM MEMORY(X) FOR # SECTORS(D)
                      (       command.os):00323         ;*
EE71                  (       command.os):00324         BSAVE
EE71 BFDCD3           (       command.os):00325                 STX     >TEMP4                            ;SET LOAD ADDRESS
EE74 FDDCD1           (       command.os):00326                 STD     >TEMP3                            ;SAVE # SECTORS
EE77 200F             (       command.os):00327                 BRA     SAVF1                             ;PERFORM SAVE
                      (       command.os):00328         ;*
                      (       command.os):00329         ;* 'SAVE' COMMAND, SAVES A FILE AS A BLOCK
                      (       command.os):00330         ;*
EE79                  (       command.os):00331         SAVFIL
EE79 BDE363           (       command.os):00332                 JSR     GETVAL                            ;GET FILENAME
EE7C BDE40F           (       command.os):00333                 JSR     GETHEX                            ;GET START ADDRESS
EE7F BFDCD3           (       command.os):00334                 STX     >TEMP4                            ;SET UP DEFAULT LOAD-ADR
EE82 BDE404           (       command.os):00335                 JSR     GETNUM                            ;GET # SECTORS
EE85 BFDCD1           (       command.os):00336                 STX     >TEMP3                            ;SAVE LENGTH
EE88                  (       command.os):00337         SAVF1
EE88 7DDCD2           (       command.os):00338                 TST     >TEMP3+1                          ;TEST FOR INVALID LENMGTH
EE8B 1027F41C         (       command.os):00339                 LBEQ    BADOPR                            ;INVALID
EE8F BDE8C4           (       command.os):00340                 JSR     LOCWRI                            ;OPEN FILE, WE WILL WRITE IT
EE92 EC8813           (       command.os):00341                 LDD     DDADR,X                           ;GET DISK ADDRESS
EE95                  (       command.os):00342         SAVF2
EE95 FDDCCF           (       command.os):00343                 STD     >TEMP2                            ;SAVE SECTOR ID
EE98 BEDCD3           (       command.os):00344                 LDX     >TEMP4                            ;GET LOAD ADDRESS
EE9B BDEB05           (       command.os):00345                 JSR     WDISK                             ;WRITE THE SECTOR
                      (       command.os):00346         
EE9E 30890200         (       command.os):00347                 LEAX    512,X                             ;ADVANCE 1 BLOCK
EEA2 BFDCD3           (       command.os):00348                 STX     >TEMP4                            ;NEW LOAD ADDRESS
EEA5 FCDCCF           (       command.os):00349                 LDD     >TEMP2                            ;GET OPEN SECTOR
EEA8 7ADCD2           (       command.os):00350                 DEC     >TEMP3+1                          ;REDUCE NUMBER
EEAB 2719             (       command.os):00351                 BEQ     SAVF3                             ;QUIT IF DONE
EEAD BDE5D2           (       command.os):00352                 JSR     FNDLNK                            ;LOOK UP ITS LINK
EEB0 26E3             (       command.os):00353                 BNE     SAVF2                             ;THERE IS SPACE, ITS OK
EEB2 BDE79D           (       command.os):00354                 JSR     FRESEC                            ;GET A FREE SECTOR
EEB5 3406             (       command.os):00355                 PSHS    A,B                               ;SAVE ID
EEB7 FCDCCF           (       command.os):00356                 LDD     >TEMP2                            ;GET OPEN SECTOR
EEBA BDE5D2           (       command.os):00357                 JSR     FNDLNK                            ;GET LINK BACK
EEBD 3506             (       command.os):00358                 PULS    A,B                               ;GET NEW SECT BACK
EEBF ED84             (       command.os):00359                 STD     ,X                                ;SET LINK CHAIN
EEC1 BDE794           (       command.os):00360                 JSR     CHGWRK                            ;INDICATE CHANGED
EEC4 20CF             (       command.os):00361                 BRA     SAVF2                             ;WRITE NEXT SECTOR
EEC6                  (       command.os):00362         SAVF3
EEC6 BDE5D2           (       command.os):00363                 JSR     FNDLNK                            ;LOK UP LINK
EEC9 27A5             (       command.os):00364                 BEQ     OKRET                             ;NO FURTHER LINKS
EECB 3406             (       command.os):00365                 PSHS    A,B                               ;SAVE REGS
EECD CCFFFF           (       command.os):00366                 LDD     #$FFFF                            ;GET END OF FILE MARKER
EED0 ED84             (       command.os):00367                 STD     ,X                                ;MARK SECTOR
EED2 B7DCDD           (       command.os):00368                 STA     >WRKCHG                           ;INDICATE CHANGED
EED5 3506             (       command.os):00369                 PULS    A,B                               ;GET CHAINED SECTOR BACK
EED7 7EEDB1           (       command.os):00370                 JMP     UNCHAIN                           ;SET IT FREE
                      (       command.os):00371         ;*
                      (       command.os):00372         ;* 'RETURN' COMMAND
                      (       command.os):00373         ;*
EEDA                  (       command.os):00374         RETURN
EEDA FCDCE9           (       command.os):00375                 LDD     >OLDSTK                           ;GET OLD STACK
EEDD 2704             (       command.os):00376                 BEQ     NOSUSP                            ;NONE, SKIP IT
EEDF 1F04             (       command.os):00377                 TFR     D,S                               ;SET UP STACK
EEE1 4F               (       command.os):00378                 CLRA                                      ;ZERO IT
EEE2 39               (       command.os):00379                 RTS
EEE3                  (       command.os):00380         NOSUSP
EEE3 BDE571           (       command.os):00381                 JSR     WRMSG                             ;OUTPUT MESSAGE
EEE6 4E6F207375737065 (       command.os):00382                 FCC     'No suspended program'
     6E6465642070726F
     6772616D
EEFA 00               (       command.os):00383                 FCB     $00
EEFB 10FEDCDB         (       command.os):00384                 LDS     >SAVSTK                           ;RESTORE STACK
EEFF                  (       command.os):00385         DNLRTS
EEFF 4F               (       command.os):00386                 CLRA                                      ;ZERO RC
EF00 39               (       command.os):00387                 RTS
                      (       command.os):00388         ;*
                      (       command.os):00389         ;* 'DOWNLOAD' COMMAND
                      (       command.os):00390         ;*
EF01                  (       command.os):00391         DNLD
EF01 BDF0EF           (       command.os):00392                 JSR     GETDEV                            ;GET DEVICE ID
EF04 F7DCCF           (       command.os):00393                 STB     >TEMP2                            ;SAVE IT
EF07 7FDCD2           (       command.os):00394                 CLR     >TEMP3+1                          ;ZERO COUNT
EF0A CCFFFF           (       command.os):00395                 LDD     #$FFFF                            ;INIT LOW ADDR
EF0D FDDCD3           (       command.os):00396                 STD     >TEMP4                            ;SAVE LOW ADDRESS
EF10 4F               (       command.os):00397                 CLRA
EF11 5F               (       command.os):00398                 CLRB
EF12 3406             (       command.os):00399                 PSHS    A,B                               ;SAVE HIGH ADDR
EF14                  (       command.os):00400         DNL0
EF14 860D             (       command.os):00401                 LDA     #$0D
EF16 BDE58D           (       command.os):00402                 JSR     PUTCHR                            ;OUTPUT
EF19 B6DCD2           (       command.os):00403                 LDA     >TEMP3+1
EF1C BDE54D           (       command.os):00404                 JSR     WRHEX                             ;OUTPUT IN HEX
EF1F 7CDCD2           (       command.os):00405                 INC     >TEMP3+1
EF22 8D28             (       command.os):00406                 BSR     DNL1                              ;DOWNLOAD RECORD
EF24 2608             (       command.os):00407                 BNE     DNLEND                            ;END, QUIT
EF26 ACE4             (       command.os):00408                 CMPX    ,S                                ;HIGEST YET?
EF28 23EA             (       command.os):00409                 BLS     DNL0                              ;NO, SKIP
EF2A AFE4             (       command.os):00410                 STX     ,S                                ;SAVE HIGH
EF2C 20E6             (       command.os):00411                 BRA     DNL0                              ;OK, KEEP GOING
EF2E                  (       command.os):00412         DNLEND
EF2E BDE57B           (       command.os):00413                 JSR     LFCR                              ;NEW LINE
EF31 3506             (       command.os):00414                 PULS    A,B                               ;GET HIGEST
EF33 B3DCD3           (       command.os):00415                 SUBD    >TEMP4                            ;CALCULATE SIZE
EF36 830001           (       command.os):00416                 SUBD    #1                                ;CONVERT
EF39 44               (       command.os):00417                 LSRA                                      ;/512, CONVERT TO # SECTORS
EF3A 4C               (       command.os):00418                 INCA    CONVERT
EF3B B7DCD2           (       command.os):00419                 STA     >TEMP3+1                          ;SAVE LENGTH
EF3E BDE4CF           (       command.os):00420                 JSR     SKIP                              ;OPERAND?
EF41 27BC             (       command.os):00421                 BEQ     DNLRTS                            ;NO FILE TO SAVE INTO
EF43 BDE363           (       command.os):00422                 JSR     GETVAL                            ;GET FILENAME
EF46 7EEE88           (       command.os):00423                 JMP     SAVF1                             ;PERFORM SAVE
                      (       command.os):00424         ;* DOWNLOAD A RECORD FROM A DEVICE
EF49                  (       command.os):00425         DNLDEV
EF49 B7DCCF           (       command.os):00426                 STA     >TEMP2                            ;SAVE DEVICE ID
EF4C                  (       command.os):00427         DNL1
EF4C 8D5B             (       command.os):00428                 BSR     RDDLC                             ;GET CHAR
EF4E 8153             (       command.os):00429                 CMPA    #'S'                              ;START OF RECORD?
EF50 26FA             (       command.os):00430                 BNE     DNL1                              ;NO
EF52 8D55             (       command.os):00431                 BSR     RDDLC                             ;GET NEXT CHAR
EF54 8130             (       command.os):00432                 CMPA    #'0'                              ;HEADER?
EF56 27F4             (       command.os):00433                 BEQ     DNL1                              ;IGNORE
EF58 8139             (       command.os):00434                 CMPA    #'9'                              ;END OF FILE
EF5A 2603             (       command.os):00435                 BNE     DNL2                              ;YES, END OF FILE
EF5C 8606             (       command.os):00436                 LDA     #RCEOF
EF5E 39               (       command.os):00437                 RTS
EF5F                  (       command.os):00438         DNL2
EF5F 8131             (       command.os):00439                 CMPA    #'1'                              ;DATA RECORD
EF61 263E             (       command.os):00440                 BNE     LODERR                            ;INVALID
EF63 8D4A             (       command.os):00441                 BSR     GETBYT                            ;GET LENGTH
EF65 B7DCD0           (       command.os):00442                 STA     >TEMP2+1                          ;START CKSUM
EF68 8003             (       command.os):00443                 SUBA    #3                                ;CONVERT
EF6A B7DCD1           (       command.os):00444                 STA     >TEMP3                            ;SAVE LENGTH
EF6D 8D40             (       command.os):00445                 BSR     GETBYT                            ;GET HIGH ADDR
EF6F 3402             (       command.os):00446                 PSHS    A                                 ;SAVE
EF71 8D3C             (       command.os):00447                 BSR     GETBYT                            ;GET LOW ADDR
EF73 1F89             (       command.os):00448                 TFR     A,B                               ;SAVE
EF75 ABE4             (       command.os):00449                 ADDA    ,S                                ;ADD HIGH
EF77 BBDCD0           (       command.os):00450                 ADDA    >TEMP2+1                          ;& CKSUM
EF7A B7DCD0           (       command.os):00451                 STA     >TEMP2+1                          ;RESAVE
EF7D 3502             (       command.os):00452                 PULS    A                                 ;RESTORE
EF7F 1F01             (       command.os):00453                 TFR     D,X                               ;SET UP PTR
EF81 10B3DCD3         (       command.os):00454                 CMPD    >TEMP4                            ;HIGHER?
EF85 2403             (       command.os):00455                 BHS     DNL3                              ;YES
EF87 FDDCD3           (       command.os):00456                 STD     >TEMP4                            ;NEW VALUE
EF8A                  (       command.os):00457         DNL3
EF8A 8D23             (       command.os):00458                 BSR     GETBYT                            ;GET BYTE
EF8C A780             (       command.os):00459                 STA     ,X+                               ;SAVE IT
EF8E BBDCD0           (       command.os):00460                 ADDA    >TEMP2+1                          ;INCL CKSUM
EF91 B7DCD0           (       command.os):00461                 STA     >TEMP2+1                          ;RESAVE CKSUM
EF94 7ADCD1           (       command.os):00462                 DEC     >TEMP3                            ;REDUCE LENGTH
EF97 26F1             (       command.os):00463                 BNE     DNL3                              ;GET FULL REC.
EF99 8D14             (       command.os):00464                 BSR     GETBYT                            ;GET CKSUM
EF9B BBDCD0           (       command.os):00465                 ADDA    >TEMP2+1                          ;+ CALC CKSUM
EF9E 4C               (       command.os):00466                 INCA    TEST FOR OK
EF9F 271A             (       command.os):00467                 BEQ     DNL4                              ;YES, GET NEXT REC
EFA1                  (       command.os):00468         LODERR
EFA1 8EF7C6           (       command.os):00469                 LDX     #DNLMSG                           ;PT TO ERROR MESSAGE
EFA4 860B             (       command.os):00470                 LDA     #RCDNL                            ;RETURN CODE
EFA6 7EE2B0           (       command.os):00471                 JMP     ERRMRC                            ;RETURN
EFA9                  (       command.os):00472         RDDLC
EFA9 F6DCCF           (       command.os):00473                 LDB     >TEMP2                            ;GET DEV
EFAC 7EE5AF           (       command.os):00474                 JMP     RDDEV                             ;GET CHAR
EFAF                  (       command.os):00475         GETBYT
EFAF 8D0B             (       command.os):00476                 BSR     GETNIB                            ;GET IT
EFB1 48               (       command.os):00477                 LSLA
EFB2 48               (       command.os):00478                 LSLA
EFB3 48               (       command.os):00479                 LSLA
EFB4 48               (       command.os):00480                 LSLA
EFB5 3402             (       command.os):00481                 PSHS    A
EFB7 8D03             (       command.os):00482                 BSR     GETNIB
EFB9 AAE0             (       command.os):00483                 ORA     ,S+
EFBB                  (       command.os):00484         DNL4
EFBB 39               (       command.os):00485                 RTS
EFBC                  (       command.os):00486         GETNIB
EFBC 8DEB             (       command.os):00487                 BSR     RDDLC                             ;GET CHAR
EFBE 8030             (       command.os):00488                 SUBA    #'0'                              ;CONVERT
EFC0 8109             (       command.os):00489                 CMPA    #9                                ;OK?
EFC2 230A             (       command.os):00490                 BLS     GETN1                             ;YES
EFC4 8111             (       command.os):00491                 CMPA    #$11                              ;<A
EFC6 25D9             (       command.os):00492                 BLO     LODERR                            ;INVALID
EFC8 8007             (       command.os):00493                 SUBA    #7                                ;CONVERT
EFCA 8110             (       command.os):00494                 CMPA    #$10                              ;IN RANGE
EFCC 24D3             (       command.os):00495                 BHS     LODERR                            ;INVALID
EFCE                  (       command.os):00496         GETN1
EFCE 39               (       command.os):00497                 RTS
                      (       command.os):00498         ;*
                      (       command.os):00499         ;* 'CONNECT' COMMAND
                      (       command.os):00500         ;*
EFCF                  (       command.os):00501         CNCT
EFCF BDF0EF           (       command.os):00502                 JSR     GETDEV                            ;GET DEVICE
EFD2 F7DCCF           (       command.os):00503                 STB     >TEMP2                            ;SAVE
EFD5                  (       command.os):00504         CNC1
EFD5 BDE5C6           (       command.os):00505                 JSR     TSTCHR                            ;TEST FOR CHAR FROM CONSOLE
EFD8 260C             (       command.os):00506                 BNE     CNC2                              ;NO, NONE
EFDA 811B             (       command.os):00507                 CMPA    #$1B                              ;ESCAPE?
EFDC 1027F59B         (       command.os):00508                 LBEQ    LFCR                              ;IF SO, EXIT
EFE0 F6DCCF           (       command.os):00509                 LDB     >TEMP2                            ;GET DEVICE BACK
EFE3 BDE594           (       command.os):00510                 JSR     WRDEV                             ;OUTPUT TO DEVICE
EFE6                  (       command.os):00511         CNC2
EFE6 F6DCCF           (       command.os):00512                 LDB     >TEMP2                            ;GET DEVICE ID
EFE9 BDE5B4           (       command.os):00513                 JSR     TSTDEV                            ;TEST FOR CHARACTER
EFEC 26E7             (       command.os):00514                 BNE     CNC1                              ;NO CHAR RECEIVED
EFEE BDE58D           (       command.os):00515                 JSR     PUTCHR                            ;WRITE TO CONSOLE
EFF1 20E2             (       command.os):00516                 BRA     CNC1                              ;CONTINUE
                      (       command.os):00517         ;*
                      (       command.os):00518         ;* 'SET' COMMAND
                      (       command.os):00519         ;*
EFF3                  (       command.os):00520         SET
EFF3 8EF373           (       command.os):00521                 LDX     #SETTAB                           ;POINT TO TABLE
EFF6 BDE4F8           (       command.os):00522                 JSR     TLOOK                             ;LOOK IT UP
EFF9 BDE4CF           (       command.os):00523                 JSR     SKIP                              ;ADVANCE
EFFC 2777             (       command.os):00524                 BEQ     BADOP3                            ;INVALID
EFFE 8EF3B6           (       command.os):00525                 LDX     #SETADR
F001 58               (       command.os):00526                 ASLB
F002 6E95             (       command.os):00527                 JMP     [B,X]
                      (       command.os):00528         ;* SET DEFAULT
F004                  (       command.os):00529         SET0
F004 BDE3A3           (       command.os):00530                 JSR     GETDIR                            ;GET DEFAULT DIR
F007 BDE4CF           (       command.os):00531                 JSR     SKIP                              ;ANY MORE INFO
F00A 2669             (       command.os):00532                 BNE     BADOP3
F00C                  (       command.os):00533         SETDEF
F00C 3436             (       command.os):00534                 PSHS    A,B,X,Y                           ;SAVE REGS
F00E 8EDCA5           (       command.os):00535                 LDX     #DEFDRV                           ;POINT TO DEFAULT
F011 2010             (       command.os):00536                 BRA     MOVDIR                            ;MOVE IT
                      (       command.os):00537         ;* SET COMMAND
F013                  (       command.os):00538         SET1
F013 8EDCAE           (       command.os):00539                 LDX     #SYSDRV                           ;DEFAULT FROM SYSTEM
F016 BDE3A6           (       command.os):00540                 JSR     GETDIR1                           ;GET DIR
F019 BDE4CF           (       command.os):00541                 JSR     SKIP
F01C 2657             (       command.os):00542                 BNE     BADOP3
F01E                  (       command.os):00543         SETCMD
F01E 3436             (       command.os):00544                 PSHS    A,B,X,Y                           ;SAVE REGS
F020 8EDCAE           (       command.os):00545                 LDX     #SYSDRV                           ;POINT TO IT
F023                  (       command.os):00546         MOVDIR
F023 108EDCB7         (       command.os):00547                 LDY     #FDRIVE                           ;POINT TO FILENAME
F027 C609             (       command.os):00548                 LDB     #9                                ;MOVE 9 CHARS
F029                  (       command.os):00549         MOVD1
F029 A6A0             (       command.os):00550                 LDA     ,Y+                               ;GET 1
F02B A780             (       command.os):00551                 STA     ,X+                               ;SAVE IT
F02D 5A               (       command.os):00552                 DECB
F02E 26F9             (       command.os):00553                 BNE     MOVD1                             ;CONTINUE
F030 35B6             (       command.os):00554                 PULS    A,B,X,Y,PC
                      (       command.os):00555         ;* SET FILE
F032                  (       command.os):00556         SET2
F032 BDE363           (       command.os):00557                 JSR     GETVAL                            ;GET NAME
F035 BDE64C           (       command.os):00558                 JSR     LOCERR                            ;LOOK IT UP
F038                  (       command.os):00559         SETF0
F038 3410             (       command.os):00560                 PSHS    X                                 ;SAVE PTR
F03A 8EF3E2           (       command.os):00561                 LDX     #SFTAB                            ;PT TO TABLE
F03D BDF0B6           (       command.os):00562                 JSR     TLOOKE                            ;LOOK IT UP
F040 5D               (       command.os):00563                 TSTB                                      ;IS IT SET LOADADDRESS
F041 260C             (       command.os):00564                 BNE     SETF1                             ;NO, TRY SOMETHING ELSE
F043 BDE40F           (       command.os):00565                 JSR     GETHEX                            ;GET ADDRESS
F046 1F10             (       command.os):00566                 TFR     X,D                               ;COPY
F048 3510             (       command.os):00567                 PULS    X                                 ;RESTORE
F04A ED8815           (       command.os):00568                 STD     DRADR,X                           ;SAVE
F04D 200A             (       command.os):00569                 BRA     SETF2                             ;TEST FOR END
F04F                  (       command.os):00570         SETF1
F04F 5A               (       command.os):00571                 DECB
F050 2623             (       command.os):00572                 BNE     BADOP3
F052 8D0D             (       command.os):00573                 BSR     GETATR                            ;GET ATTRIBUTES
F054 3510             (       command.os):00574                 PULS    X                                 ;RESTORE
F056 A78817           (       command.os):00575                 STA     DATTR,X                           ;SAVE
F059                  (       command.os):00576         SETF2
F059 BDE4CF           (       command.os):00577                 JSR     SKIP                              ;ADVANCE
F05C 26DA             (       command.os):00578                 BNE     SETF0
F05E 7EE794           (       command.os):00579                 JMP     CHGWRK                            ;INDICATE WE CHANGED
                      (       command.os):00580         ;* GET FILE ATTRIBUTES FROM COMMAND LINE
F061                  (       command.os):00581         GETATR
F061 4F               (       command.os):00582                 CLRA    CLEAR IT
F062 3416             (       command.os):00583                 PSHS    A,B,X                             ;SAVE ON STACK
F064                  (       command.os):00584         GETA1
F064 8EF080           (       command.os):00585                 LDX     #ATRTAB                           ;POINT TO TABLE
F067 BDE4DC           (       command.os):00586                 JSR     TSTERM                            ;GET CHARACTER
F06A 2712             (       command.os):00587                 BEQ     GETA4                             ;END
F06C C680             (       command.os):00588                 LDB     #%10000000                        ;START WITH FIRST ATTR
F06E                  (       command.os):00589         GETA2
F06E A180             (       command.os):00590                 CMPA    ,X+                               ;IS THIS IT?
F070 2706             (       command.os):00591                 BEQ     GETA3                             ;YES
F072 54               (       command.os):00592                 LSRB                                      ;SHIFT IT
F073 26F9             (       command.os):00593                 BNE     GETA2                             ;MORE
F075                  (       command.os):00594         BADOP3
F075 7EE2AB           (       command.os):00595                 JMP     BADOPR                            ;REPORT ERROR
F078                  (       command.os):00596         GETA3
F078 EAE4             (       command.os):00597                 ORB     ,S                                ;INCLUDE IN ATTRIBUTES
F07A E7E4             (       command.os):00598                 STB     ,S                                ;RESAVE
F07C 20E6             (       command.os):00599                 BRA     GETA1                             ;AND CONTINUE
F07E                  (       command.os):00600         GETA4
F07E 3596             (       command.os):00601                 PULS    A,B,X,PC                          ;RESTORE REGS
F080                  (       command.os):00602         ATRTAB
F080 525745443F3F3F3F (       command.os):00603                 FCC     'RWED????'                        ;AVAILABLE ATTRIBUTE BITS
                      (       command.os):00604         ;*
                      (       command.os):00605         ;* SET DRIVE COMMAND
                      (       command.os):00606         ;*
F088                  (       command.os):00607         SET3
F088 BDE616           (       command.os):00608                 JSR     PURGE                             ;INSURE ALL WRITTEN
F08B BDE3F2           (       command.os):00609                 JSR     GETDRV                            ;GET DRIVE ID
F08E B7DCEB           (       command.os):00610                 STA     >SDRIVE                           ;SELECT IT
F091 BDEAF9           (       command.os):00611                 JSR     GETCTL                            ;GET CTRL BLOCK
F094 3420             (       command.os):00612                 PSHS    Y                                 ;SAVE CMD POINTER
F096 BDF6D0           (       command.os):00613                 JSR     HOME                              ;HOME HEAD
F099 3520             (       command.os):00614                 PULS    Y                                 ;RESTORE CMD POINTER
F09B                  (       command.os):00615         CHGDRV
F09B 8EF41A           (       command.os):00616                 LDX     #SDTAB                            ;POINT TO TABLE
F09E BDF0B6           (       command.os):00617                 JSR     TLOOKE                            ;LOOK FOR IT
F0A1 3404             (       command.os):00618                 PSHS    B                                 ;SAVE
F0A3 BDE404           (       command.os):00619                 JSR     GETNUM                            ;GET IT
F0A6 1F10             (       command.os):00620                 TFR     X,D                               ;GET NUMBER
F0A8 3502             (       command.os):00621                 PULS    A                                 ;RESTORE
F0AA 8103             (       command.os):00622                 CMPA    #3                                ;VALID?
F0AC 22C7             (       command.os):00623                 BHI     BADOP3                            ;ERROR
F0AE E7C6             (       command.os):00624                 STB     A,U                               ;SET IT
F0B0 BDE4CF           (       command.os):00625                 JSR     SKIP                              ;AT END?
F0B3 26E6             (       command.os):00626                 BNE     CHGDRV                            ;NO
F0B5 39               (       command.os):00627                 RTS
                      (       command.os):00628         ;*
                      (       command.os):00629         ;* LOOKUP TABLE ENTRY & INSURE IT ENDS WITH '='
                      (       command.os):00630         ;*
F0B6                  (       command.os):00631         TLOOKE
F0B6 BDE4F8           (       command.os):00632                 JSR     TLOOK                             ;LOOKUP ENTRY
F0B9 A6A0             (       command.os):00633                 LDA     ,Y+                               ;GET NEXT CHAR
F0BB 813D             (       command.os):00634                 CMPA    #'='                              ;IS IT EQUALS?
F0BD 26B6             (       command.os):00635                 BNE     BADOP3                            ;REPORT ERROR
F0BF 39               (       command.os):00636                 RTS
                      (       command.os):00637         ;*
                      (       command.os):00638         ;* SET MEMORY
                      (       command.os):00639         ;*
F0C0                  (       command.os):00640         SET4
F0C0 BDE40F           (       command.os):00641                 JSR     GETHEX                            ;GET ADDRESS
F0C3                  (       command.os):00642         ST1
F0C3 3410             (       command.os):00643                 PSHS    X                                 ;SAVE ADDR
F0C5 BDE40F           (       command.os):00644                 JSR     GETHEX                            ;GET DATA
F0C8 1F10             (       command.os):00645                 TFR     X,D                               ;SAVE IT
F0CA 3510             (       command.os):00646                 PULS    X                                 ;RECOVER
F0CC E780             (       command.os):00647                 STB     ,X+                               ;SAVE IT
F0CE BDE4CF           (       command.os):00648                 JSR     SKIP                              ;END OF LINE?
F0D1 26F0             (       command.os):00649                 BNE     ST1                               ;CONTINUE
F0D3 39               (       command.os):00650                 RTS
                      (       command.os):00651         ;* SET CONSOLE
F0D4                  (       command.os):00652         SET5
F0D4 8EF449           (       command.os):00653                 LDX     #IOTAB                            ;POINT TO TABLE
F0D7 BDF0B6           (       command.os):00654                 JSR     TLOOKE                            ;LOOK IT UP
F0DA C102             (       command.os):00655                 CMPB    #2                                ;OVER?
F0DC 2497             (       command.os):00656                 BHS     BADOP3                            ;INVALID
F0DE 3404             (       command.os):00657                 PSHS    B                                 ;SAVE ID
F0E0 8D0D             (       command.os):00658                 BSR     GETDEV                            ;GET DEVICE NUMBER
F0E2 3502             (       command.os):00659                 PULS    A                                 ;GET ID BACK
F0E4 8EDC6C           (       command.os):00660                 LDX     #CONIN
F0E7 E786             (       command.os):00661                 STB     A,X                               ;SET IT
F0E9 BDE4CF           (       command.os):00662                 JSR     SKIP
F0EC 26E6             (       command.os):00663                 BNE     SET5
F0EE 39               (       command.os):00664                 RTS
                      (       command.os):00665         ;* GET A DEVICE ID FROM THE CONSOLE
F0EF                  (       command.os):00666         GETDEV
F0EF BDE404           (       command.os):00667                 JSR     GETNUM                            ;GET DECIMAL NUMBER
F0F2 8C0008           (       command.os):00668                 CMPX    #NDEV                             ;IS IT OVER THE LIMIT
F0F5 1024F4AE         (       command.os):00669                 LBHS    BADDEV                            ;YES, REPORT ERROR
F0F9 1F10             (       command.os):00670                 TFR     X,D                               ;'B' = DEVICE ID
F0FB 39               (       command.os):00671                 RTS
                      (       command.os):00672         ;* SET FLAG ON/OFF
F0FC                  (       command.os):00673         STFLAG
F0FC 54               (       command.os):00674                 LSRB                                      ;CONVERT BACK
F0FD 3404             (       command.os):00675                 PSHS    B                                 ;SAVE
F0FF 8EF441           (       command.os):00676                 LDX     #OOTAB                            ;PT TO IT
F102 BDE4F8           (       command.os):00677                 JSR     TLOOK                             ;LOOKUP IN TABLE
F105 3502             (       command.os):00678                 PULS    A                                 ;RESTORE VECT NUM
F107 5D               (       command.os):00679                 TSTB                                      ;IS IT OFF?
F108 270B             (       command.os):00680                 BEQ     CLRFLG                            ;YES, CLEAR IT
F10A 5A               (       command.os):00681                 DECB                                      ;IS IT ON
F10B 1026F19C         (       command.os):00682                 LBNE    BADOPR                            ;NO, ITS INVALID
                      (       command.os):00683         ;* SET AN OS FLAG
F10F                  (       command.os):00684         SETFLG
F10F 3414             (       command.os):00685                 PSHS    B,X
F111 C6FF             (       command.os):00686                 LDB     #$FF
F113 2003             (       command.os):00687                 BRA     GOFLG
                      (       command.os):00688         ;* CLEAR A OS FLAG
F115                  (       command.os):00689         CLRFLG
F115 3414             (       command.os):00690                 PSHS    B,X
F117 5F               (       command.os):00691                 CLRB
F118                  (       command.os):00692         GOFLG
F118 8103             (       command.os):00693                 CMPA    #NUMFLG
F11A 1024F18D         (       command.os):00694                 LBHS    BADOPR
F11E 8EDCA2           (       command.os):00695                 LDX     #MSGFLG
F121 3086             (       command.os):00696                 LEAX    A,X
F123 A684             (       command.os):00697                 LDA     ,X
F125 E784             (       command.os):00698                 STB     ,X
F127 1A04             (       command.os):00699                 ORCC    #4
F129 3594             (       command.os):00700                 PULS    B,X,PC
                      (       command.os):00701         ;*
                      (       command.os):00702         ;* SHOW COMMAND
                      (       command.os):00703         ;*
F12B                  (       command.os):00704         SHOW
F12B 8EF373           (       command.os):00705                 LDX     #SETTAB                           ;POINT TO IT
F12E BDE4F8           (       command.os):00706                 JSR     TLOOK                             ;LOOK FOR IT
F131 58               (       command.os):00707                 LSLB
F132 8EF3CC           (       command.os):00708                 LDX     #SHOADR
F135 6E95             (       command.os):00709                 JMP     [B,X]
                      (       command.os):00710         ;* SHOW DEFAULT
F137                  (       command.os):00711         SHOW0
F137 8EDCA5           (       command.os):00712                 LDX     #DEFDRV                           ;PT TO IT
F13A 2003             (       command.os):00713                 BRA     SDCMD                             ;SHOW IT
F13C                  (       command.os):00714         SHOW1
F13C 8EDCAE           (       command.os):00715                 LDX     #SYSDRV                           ;PT TO IT
F13F                  (       command.os):00716         SDCMD
F13F A680             (       command.os):00717                 LDA     ,X+                               ;GET DRIVE ID
F141 8B41             (       command.os):00718                 ADDA    #'A'                              ;CONVERT
F143 BDE58D           (       command.os):00719                 JSR     PUTCHR
F146 BDE541           (       command.os):00720                 JSR     WRLIN
F149 3A5B             (       command.os):00721                 FCC     ':['
F14B 00               (       command.os):00722                 FCB     $00
F14C C608             (       command.os):00723                 LDB     #8
F14E                  (       command.os):00724         SDC1
F14E A680             (       command.os):00725                 LDA     ,X+
F150 2703             (       command.os):00726                 BEQ     SDC2
F152 BDE58D           (       command.os):00727                 JSR     PUTCHR
F155                  (       command.os):00728         SDC2
F155 5A               (       command.os):00729                 DECB
F156 26F6             (       command.os):00730                 BNE     SDC1
F158 865D             (       command.os):00731                 LDA     #']'
F15A BDE58D           (       command.os):00732                 JSR     PUTCHR
F15D 7EE57B           (       command.os):00733                 JMP     LFCR                              ;EXIT
                      (       command.os):00734         ;* SHOW FILE
F160                  (       command.os):00735         SHOW2
F160 BDE363           (       command.os):00736                 JSR     GETVAL                            ;GET NAME
F163 BDE64C           (       command.os):00737                 JSR     LOCERR                            ;LOOK IT UP
F166 BDE541           (       command.os):00738                 JSR     WRLIN
F169 46696C653A20     (       command.os):00739                 FCC     'File: '
F16F 00               (       command.os):00740                 FCB     $00
F170 BDE6DD           (       command.os):00741                 JSR     SHONAM                            ;OUTPUT
F173 BDE541           (       command.os):00742                 JSR     WRLIN
F176 0A0D             (       command.os):00743                 FCB     $0A,$0D
F178 4469736B20616464 (       command.os):00744                 FCC     'Disk address='
     726573733D
F185 00               (       command.os):00745                 FCB     $00
F186 EC8813           (       command.os):00746                 LDD     DDADR,X
F189 BDE471           (       command.os):00747                 JSR     WRDEC
F18C BDE541           (       command.os):00748                 JSR     WRLIN
F18F 2C204C6F61642061 (       command.os):00749                 FCC     ', Load address=$'
     6464726573733D24
F19F 00               (       command.os):00750                 FCB     $00
F1A0 EC8815           (       command.os):00751                 LDD     DRADR,X
F1A3 BDE538           (       command.os):00752                 JSR     WRHEXW
F1A6 BDE541           (       command.os):00753                 JSR     WRLIN
F1A9 2C2050726F746563 (       command.os):00754                 FCC     ', Protection='
     74696F6E3D
F1B6 00               (       command.os):00755                 FCB     $00
F1B7 E68817           (       command.os):00756                 LDB     DATTR,X
F1BA 108EF080         (       command.os):00757                 LDY     #ATRTAB
F1BE                  (       command.os):00758         SH21
F1BE A6A0             (       command.os):00759                 LDA     ,Y+
F1C0 58               (       command.os):00760                 LSLB
F1C1 2403             (       command.os):00761                 BCC     SH22
F1C3 BDE58D           (       command.os):00762                 JSR     PUTCHR
F1C6                  (       command.os):00763         SH22
F1C6 5D               (       command.os):00764                 TSTB
F1C7 26F5             (       command.os):00765                 BNE     SH21
F1C9 BDE57B           (       command.os):00766                 JSR     LFCR
F1CC 108E0000         (       command.os):00767                 LDY     #0                                ;0 BLOCKS
F1D0 EC8813           (       command.os):00768                 LDD     DDADR,X
F1D3                  (       command.os):00769         SH23
F1D3 3121             (       command.os):00770                 LEAY    1,Y                               ;ADVANCE
F1D5 BDE5D2           (       command.os):00771                 JSR     FNDLNK                            ;LOOK UP LINK
F1D8 26F9             (       command.os):00772                 BNE     SH23                              ;FIND EM ALL
F1DA BDE541           (       command.os):00773                 JSR     WRLIN
F1DD 46696C6520636F6E (       command.os):00774                 FCC     'File contains '
     7461696E7320
F1EB 00               (       command.os):00775                 FCB     $00
F1EC 1F20             (       command.os):00776                 TFR     Y,D
F1EE BDE471           (       command.os):00777                 JSR     WRDEC
F1F1 BDE571           (       command.os):00778                 JSR     WRMSG
F1F4 20626C6F636B2873 (       command.os):00779                 FCC     ' block(s).'
     292E
F1FE 00               (       command.os):00780                 FCB     $00
F1FF 39               (       command.os):00781                 RTS
                      (       command.os):00782         ;* SHOW DISK FORMAT
F200                  (       command.os):00783         SHOW3
F200 BDE3F2           (       command.os):00784                 JSR     GETDRV
F203                  (       command.os):00785         SHODRV
F203 3442             (       command.os):00786                 PSHS    A,U                               ;SAVE REGISTERS
F205 BDEAFC           (       command.os):00787                 JSR     GETCTL1                           ;GET DRIVE CONTROL BLOCK
F208 BDE541           (       command.os):00788                 JSR     WRLIN                             ;OUTPUT MESSAGE
F20B 44726976653A20   (       command.os):00789                 FCC     'Drive: '
F212 00               (       command.os):00790                 FCB     $00
F213 A6E4             (       command.os):00791                 LDA     ,S                                ;GET DRIVE ID
F215 8B41             (       command.os):00792                 ADDA    #'A'                              ;CONVERT TO DRIVE ID
F217 BDE58D           (       command.os):00793                 JSR     PUTCHR                            ;OUTPUT IT
F21A BDE57B           (       command.os):00794                 JSR     LFCR                              ;NEW LINE
F21D 8EF41A           (       command.os):00795                 LDX     #SDTAB                            ;POINT TO TABLE
F220 4F               (       command.os):00796                 CLRA                                      ;DISPLAY ADDRESS
F221 E6C4             (       command.os):00797                 LDB     DRIVE,U                           ;GET DRIVE ID
F223 8D1D             (       command.os):00798                 BSR     SHODRB                            ;DISPLAY IT
F225 8601             (       command.os):00799                 LDA     #1                                ;DISPLAY CYLINDERS
F227 E641             (       command.os):00800                 LDB     NCYL,U                            ;GET # CYLINDERS
F229 8D11             (       command.os):00801                 BSR     SHODRA                            ;DISPLAY IT
F22B 8602             (       command.os):00802                 LDA     #2                                ;DISPLAY HEADS
F22D E642             (       command.os):00803                 LDB     NHEAD,U                           ;GET # HEADS
F22F 8D0B             (       command.os):00804                 BSR     SHODRA                            ;DISPLAY IT
F231 8603             (       command.os):00805                 LDA     #3                                ;DISPLAY SECTORS/TRACK
F233 E643             (       command.os):00806                 LDB     NSEC,U                            ;GET # SECTORS/TRACK
F235 8D05             (       command.os):00807                 BSR     SHODRA                            ;DISPLAY IT
F237 3542             (       command.os):00808                 PULS    A,U                               ;RESTORE REGS
F239 7EE57B           (       command.os):00809                 JMP     LFCR                              ;NEW LINE
                      (       command.os):00810         
F23C                  (       command.os):00811         SHODRA
F23C BDE541           (       command.os):00812                 JSR     WRLIN                             ;OUTPUT MESSAGE
F23F 2C20             (       command.os):00813                 FCC     ', '                              ;STRING
F241 00               (       command.os):00814                 FCB     $00
F242                  (       command.os):00815         SHODRB
F242 8D08             (       command.os):00816                 BSR     SHOTAB                            ;DISPLAY TABLE ENTRY
F244 863D             (       command.os):00817                 LDA     #'='                              ;GET FOLLOWING '='
F246 BDE58D           (       command.os):00818                 JSR     PUTCHR                            ;OUTPUT IT
F249 7EE470           (       command.os):00819                 JMP     WRDEC8                            ;AND DISPLAY VALUE
                      (       command.os):00820         ;*
                      (       command.os):00821         ;* DISPLAY ENTRY(A) IN TABLE(X)
                      (       command.os):00822         ;*
F24C                  (       command.os):00823         SHOTAB
F24C 3414             (       command.os):00824                 PSHS    B,X                               ;SAVE REGS
F24E 4C               (       command.os):00825                 INCA                                      ;ADVANCE FOR COUNT
F24F                  (       command.os):00826         SHOT1
F24F E680             (       command.os):00827                 LDB     ,X+                               ;GET CHAR FROM TABLE
F251 2AFC             (       command.os):00828                 BPL     SHOT1                             ;NOT FLAG, KEEP LOOKING
F253 C47F             (       command.os):00829                 ANDB    #%01111111                        ;IS IT LAST ONE?
F255 270F             (       command.os):00830                 BEQ     SHOT4                             ;YES, RETURN NOT-FOUND
F257 4A               (       command.os):00831                 DECA                                      ;IS THIS IT?
F258 26F5             (       command.os):00832                 BNE     SHOT1                             ;NO, KEEP LOOKING
F25A                  (       command.os):00833         SHOT2
F25A A680             (       command.os):00834                 LDA     ,X+                               ;GET CHAR
F25C 2B05             (       command.os):00835                 BMI     SHOT3                             ;END, EXIT
F25E BDE58D           (       command.os):00836                 JSR     PUTCHR                            ;DISPLAY
F261 20F7             (       command.os):00837                 BRA     SHOT2                             ;DO NEXT
F263                  (       command.os):00838         SHOT3
F263 4F               (       command.os):00839                 CLRA    ZERO RC
F264 3594             (       command.os):00840                 PULS    B,X,PC
F266                  (       command.os):00841         SHOT4
F266 8601             (       command.os):00842                 LDA     #RCBOP                            ;INVALID OPERAND PASSED
F268 3594             (       command.os):00843                 PULS    B,X,PC                            ;RETURN
                      (       command.os):00844         ;* SHOW CONSOLE I/O ASSIGNMENTS
F26A                  (       command.os):00845         SHOW5
F26A 8EF449           (       command.os):00846                 LDX     #IOTAB                            ;POINT TO TABLE
F26D 4F               (       command.os):00847                 CLRA                                      ;DISPLAY INPUT
F26E F6DC6C           (       command.os):00848                 LDB     >CONIN                            ;GET INPUT
F271 8DCF             (       command.os):00849                 BSR     SHODRB                            ;DISPLAY IT
F273 8601             (       command.os):00850                 LDA     #1                                ;DISPLAY OUTPUT
F275 F6DC6D           (       command.os):00851                 LDB     >CONOUT                           ;GET OUTPUT
F278 8DC2             (       command.os):00852                 BSR     SHODRA                            ;DISPLAY IT
F27A 7EE57B           (       command.os):00853                 JMP     LFCR                              ;NEW LINE
                      (       command.os):00854         ;* DISPLAY FLAGS
F27D                  (       command.os):00855         SHFLAG
F27D 54               (       command.os):00856                 LSRB
F27E 1F98             (       command.os):00857                 TFR     B,A                               ;COPY
F280 8EF373           (       command.os):00858                 LDX     #SETTAB                           ;POINT TO TABLE
F283 8DC7             (       command.os):00859                 BSR     SHOTAB                            ;DISPLAY IT
F285 863D             (       command.os):00860                 LDA     #'='                              ;GET EQUALS SIGN
F287 BDE58D           (       command.os):00861                 JSR     PUTCHR                            ;OUTPUT IT
F28A 8EDCA2           (       command.os):00862                 LDX     #MSGFLG                           ;PT TO AREA
F28D A685             (       command.os):00863                 LDA     B,X                               ;GET FLAG VALUE
F28F 2702             (       command.os):00864                 BEQ     SHOOFF                            ;OFF, SHOW IT
F291 8601             (       command.os):00865                 LDA     #1                                ;CONVERT TO ON
F293                  (       command.os):00866         SHOOFF
F293 8EF441           (       command.os):00867                 LDX     #OOTAB                            ;POINT TO ON/OFF TABLE
F296 8DB4             (       command.os):00868                 BSR     SHOTAB                            ;OUTPUT TABLE ENTRY
F298 7EE57B           (       command.os):00869                 JMP     LFCR                              ;NEW LINE & EXIT
                      (       command.os):00870         ;*
                      (       command.os):00871         ;* SHOW MEMORY COMAND
                      (       command.os):00872         ;*
F29B                  (       command.os):00873         SHOW4
F29B BDE40F           (       command.os):00874                 JSR     GETHEX                            ;     GET STARTING ADDRESS
F29E 3410             (       command.os):00875                 PSHS    X                                 ;SAVE IT
F2A0 BDE4CF           (       command.os):00876                 JSR     SKIP                              ;     MORE OPERANDS?
F2A3 2703             (       command.os):00877                 BEQ     EX1                               ;NO, THATS IT
F2A5 BDE40F           (       command.os):00878                 JSR     GETHEX                            ;     GET ENDING ADDRESS
F2A8                  (       command.os):00879         EX1
F2A8 BFDCCD           (       command.os):00880                 STX     >TEMP1                            ;     SAVE ADDR
F2AB 3510             (       command.os):00881                 PULS    X                                 ;GET STARTING BACK
F2AD                  (       command.os):00882         EX2
F2AD 1F10             (       command.os):00883                 TFR     X,D                               ;GET ADDRESS
F2AF BDE538           (       command.os):00884                 JSR     WRHEXW                            ;     DISPLAY
F2B2 C610             (       command.os):00885                 LDB     #16                               ;16 BYTES/LINE
F2B4                  (       command.os):00886         EX3
F2B4 C503             (       command.os):00887                 BITB    #3                                ;BOUNDARY?
F2B6 2603             (       command.os):00888                 BNE     EX4
F2B8 BDE585           (       command.os):00889                 JSR     SPACE                             ;EXTRA SPACE
F2BB                  (       command.os):00890         EX4
F2BB BDE585           (       command.os):00891                 JSR     SPACE                             ;OUTPUT SPACE
F2BE A680             (       command.os):00892                 LDA     ,X+                               ;GET DATA
F2C0 BDE54D           (       command.os):00893                 JSR     WRHEX                             ;OUTPUT
F2C3 5A               (       command.os):00894                 DECB                                      ;BACKUP COUNT
F2C4 26EE             (       command.os):00895                 BNE     EX3                               ;DO EM ALL
F2C6 C604             (       command.os):00896                 LDB     #4
F2C8                  (       command.os):00897         EX5
F2C8 BDE585           (       command.os):00898                 JSR     SPACE                             ;MORE SPACES
F2CB 5A               (       command.os):00899                 DECB
F2CC 26FA             (       command.os):00900                 BNE     EX5
F2CE 3010             (       command.os):00901                 LEAX    -16,X                             ;BACKUP
F2D0 C610             (       command.os):00902                 LDB     #16
F2D2                  (       command.os):00903         EX6
F2D2 A680             (       command.os):00904                 LDA     ,X+
F2D4 8120             (       command.os):00905                 CMPA    #' '                              ;SPACE?
F2D6 2504             (       command.os):00906                 BLO     EX7
F2D8 817F             (       command.os):00907                 CMPA    #$7F                              ;DELETE
F2DA 2502             (       command.os):00908                 BLO     EX8                               ;OK
F2DC                  (       command.os):00909         EX7
F2DC 862E             (       command.os):00910                 LDA     #'.'                              ;INDICATE BAD
F2DE                  (       command.os):00911         EX8
F2DE BDE58D           (       command.os):00912                 JSR     PUTCHR                            ;OUTPUT
F2E1 5A               (       command.os):00913                 DECB    BACKUP
F2E2 26EE             (       command.os):00914                 BNE     EX6                               ;CONTINUE
F2E4 BDE57B           (       command.os):00915                 JSR     LFCR                              ;NEW LINE
F2E7 BDE5C6           (       command.os):00916                 JSR     TSTCHR
F2EA 2705             (       command.os):00917                 BEQ     EX9
F2EC BCDCCD           (       command.os):00918                 CMPX    >TEMP1                            ;PAST END?
F2EF 23BC             (       command.os):00919                 BLS     EX2                               ;NO, KEEP GOING
F2F1                  (       command.os):00920         EX9
F2F1 4F               (       command.os):00921                 CLRA
F2F2 39               (       command.os):00922                 RTS
                      (       command.os):00923         ;* SHOW FREE
F2F3                  (       command.os):00924         SHOW6
F2F3 BDE3F2           (       command.os):00925                 JSR     GETDRV                            ;GET DRIVE ID
F2F6 B7DCEB           (       command.os):00926                 STA     >SDRIVE                           ;SELECT IT
F2F9 8D3E             (       command.os):00927                 BSR     CALFRE                            ;CALCULATE SIZE & FREE
F2FB BDE541           (       command.os):00928                 JSR     WRLIN                             ;OUTPUT MESSAGE
F2FE 447269766520     (       command.os):00929                 FCC     'Drive '
F304 00               (       command.os):00930                 FCB     $00
F305 B6DCEB           (       command.os):00931                 LDA     >SDRIVE                           ;GET DRIVE ID
F308 8B41             (       command.os):00932                 ADDA    #'A'                              ;CONVERT TO PRINTABLE
F30A BDE58D           (       command.os):00933                 JSR     PUTCHR                            ;DISPLAY
F30D BDE541           (       command.os):00934                 JSR     WRLIN                             ;OUTPUT MESSAGE
F310 2068617320       (       command.os):00935                 FCC     ' has '
F315 00               (       command.os):00936                 FCB     $00
F316 FCDCCF           (       command.os):00937                 LDD     >TEMP2                            ;GET DISK SIZE
F319 BDE471           (       command.os):00938                 JSR     WRDEC                             ;DISPLAY IN DECIMAL
F31C BDE541           (       command.os):00939                 JSR     WRLIN                             ;OUTPUT MESSAGE
F31F 20626C6F636B732C (       command.os):00940                 FCC     ' blocks, '
     20
F328 00               (       command.os):00941                 FCB     $00
F329 FCDCCD           (       command.os):00942                 LDD     >TEMP1                            ;GET FREE BLOCKS
F32C BDE471           (       command.os):00943                 JSR     WRDEC                             ;OUTPUT IN DECIMAL
F32F BDE571           (       command.os):00944                 JSR     WRMSG                             ;OUTPUT MESSAGE
F332 2066726565       (       command.os):00945                 FCC     ' free'
F337 00               (       command.os):00946                 FCB     $00
F338 39               (       command.os):00947                 RTS
                      (       command.os):00948         ;*
                      (       command.os):00949         ;* CALCULATE # FREE SECTORS ON DISK
                      (       command.os):00950         ;*
F339                  (       command.os):00951         CALFRE
F339 3430             (       command.os):00952                 PSHS    X,Y
F33B BDE705           (       command.os):00953                 JSR     CURSIZ                            ;GET DRIVE SIZE
F33E FDDCCF           (       command.os):00954                 STD     >TEMP2                            ;SAVE # BLOCKS
F341 1F02             (       command.os):00955                 TFR     D,Y                               ;SAVE IT
F343 4F               (       command.os):00956                 CLRA
F344 5F               (       command.os):00957                 CLRB
F345 FDDCCD           (       command.os):00958                 STD     >TEMP1                            ;SAVE COUNT
F348 C601             (       command.os):00959                 LDB     #LNKSEC                           ;GET LINK SECTORS
F34A                  (       command.os):00960         DISF1
F34A FDDCCB           (       command.os):00961                 STD     >TEMP                             ;CURRENT SECTOR
F34D BDE5EF           (       command.os):00962                 JSR     RDWRK                             ;READ IT
F350                  (       command.os):00963         DISF2
F350 EC81             (       command.os):00964                 LDD     ,X++                              ;GET SECTOR ID
F352 2607             (       command.os):00965                 BNE     DISF3                             ;USED
F354 5C               (       command.os):00966                 INCB                                      ;GET A ONE
F355 F3DCCD           (       command.os):00967                 ADDD    >TEMP1                            ;ADVANCE COUNT
F358 FDDCCD           (       command.os):00968                 STD     >TEMP1                            ;RESAVE COUNT
F35B                  (       command.os):00969         DISF3
F35B 313F             (       command.os):00970                 LEAY    -1,Y                              ;REDUCE BY ONE
F35D 270D             (       command.os):00971                 BEQ     DISF4                             ;ALL DONE
F35F 8CE000           (       command.os):00972                 CMPX    #WRKSPC+512                       ;ARE WE OVER
F362 25EC             (       command.os):00973                 BLO     DISF2                             ;NO, ITS OK
F364 FCDCCB           (       command.os):00974                 LDD     >TEMP                             ;GET SECTOR
F367 C30001           (       command.os):00975                 ADDD    #1                                ;ADVANCE
F36A 20DE             (       command.os):00976                 BRA     DISF1
F36C                  (       command.os):00977         DISF4
F36C FCDCCD           (       command.os):00978                 LDD     >TEMP1                            ;RECOVER IT
F36F 1A04             (       command.os):00979                 ORCC    #4
F371 35B0             (       command.os):00980                 PULS    X,Y,PC
                      (       command.os):00981         ;* 'SET' OPERAND TABLES
F373                  (       command.os):00982         SETTAB
F373 83               (       command.os):00983                 FCB     $83
F374 4D657373616765   (       command.os):00984                 FCC     'Message'
F37B 83               (       command.os):00985                 FCB     $83
F37C 4465627567       (       command.os):00986                 FCC     'Debug'
F381 82               (       command.os):00987                 FCB     $82
F382 5472616365       (       command.os):00988                 FCC     'Trace'
F387 83               (       command.os):00989                 FCB     $83
F388 44454641554C54   (       command.os):00990                 FCC     'DEFAULT'
F38F 82               (       command.os):00991                 FCB     $82
F390 53595354454D     (       command.os):00992                 FCC     'SYSTEM'
F396 82               (       command.os):00993                 FCB     $82
F397 46494C45         (       command.os):00994                 FCC     'FILE'
F39B 82               (       command.os):00995                 FCB     $82
F39C 4452495645       (       command.os):00996                 FCC     'DRIVE'
F3A1 83               (       command.os):00997                 FCB     $83
F3A2 4D454D4F5259     (       command.os):00998                 FCC     'MEMORY'
F3A8 82               (       command.os):00999                 FCB     $82
F3A9 434F4E534F4C45   (       command.os):01000                 FCC     'CONSOLE'
F3B0 82               (       command.os):01001                 FCB     $82
F3B1 46524545         (       command.os):01002                 FCC     'FREE'
F3B5 80               (       command.os):01003                 FCB     $80
                      (       command.os):01004         ;* 'SET' OPERAND HANDLERS
F3B6                  (       command.os):01005         SETADR
F3B6 F0FC             (       command.os):01006                 FDB     STFLAG                            ;MESSAGE
F3B8 F0FC             (       command.os):01007                 FDB     STFLAG                            ;DEBUG
F3BA F0FC             (       command.os):01008                 FDB     STFLAG                            ;TRACE
F3BC F004             (       command.os):01009                 FDB     SET0                              ;DEFAULT
F3BE F013             (       command.os):01010                 FDB     SET1                              ;SYSTEM
F3C0 F032             (       command.os):01011                 FDB     SET2                              ;FILE
F3C2 F088             (       command.os):01012                 FDB     SET3                              ;DRIVE
F3C4 F0C0             (       command.os):01013                 FDB     SET4                              ;MEMORY
F3C6 F0D4             (       command.os):01014                 FDB     SET5                              ;CONSOLE
F3C8 E2AB             (       command.os):01015                 FDB     BADOPR                            ;FREE
F3CA E2AB             (       command.os):01016                 FDB     BADOPR                            ;INVALID
                      (       command.os):01017         ;* 'SHOW' OPERAND HANDLERS
F3CC                  (       command.os):01018         SHOADR
F3CC F27D             (       command.os):01019                 FDB     SHFLAG                            ;MESSAGE
F3CE F27D             (       command.os):01020                 FDB     SHFLAG                            ;DEBUG
F3D0 F27D             (       command.os):01021                 FDB     SHFLAG                            ;TRACE
F3D2 F137             (       command.os):01022                 FDB     SHOW0                             ;DEFAULT
F3D4 F13C             (       command.os):01023                 FDB     SHOW1                             ;SYSTEM
F3D6 F160             (       command.os):01024                 FDB     SHOW2                             ;FILE
F3D8 F200             (       command.os):01025                 FDB     SHOW3                             ;DRIVE
F3DA F29B             (       command.os):01026                 FDB     SHOW4                             ;MEMORY
F3DC F26A             (       command.os):01027                 FDB     SHOW5                             ;CONSOLE
F3DE F2F3             (       command.os):01028                 FDB     SHOW6                             ;FREE
F3E0 E2AB             (       command.os):01029                 FDB     BADOPR                            ;INVALID
                      (       command.os):01030         ;* 'SET FILE' OPTIONS
F3E2                  (       command.os):01031         SFTAB
F3E2 81               (       command.os):01032                 FCB     $81
F3E3 4C4F41445F414444 (       command.os):01033                 FCC     'LOAD_ADDRESS'
     52455353
F3EF 81               (       command.os):01034                 FCB     $81
F3F0 50524F5445435449 (       command.os):01035                 FCC     'PROTECTION'
     4F4E
F3FA 80               (       command.os):01036                 FCB     $80
                      (       command.os):01037         ;* 'INITIALIZE' OPTIONS
F3FB                  (       command.os):01038         INITAB
F3FB 81               (       command.os):01039                 FCB     $81
F3FC 496E7465726C6561 (       command.os):01040                 FCC     'Interleave'
     7665
F406 81               (       command.os):01041                 FCB     $81
F407 4469726563746F72 (       command.os):01042                 FCC     'Directory extension'
     7920657874656E73
     696F6E
                      (       command.os):01043         ;* 'SET DISK' OPTIONS
F41A                  (       command.os):01044         SDTAB
F41A 81               (       command.os):01045                 FCB     $81
F41B 41646472657373   (       command.os):01046                 FCC     'Address'
F422 81               (       command.os):01047                 FCB     $81
F423 43796C696E646572 (       command.os):01048                 FCC     'Cylinders'
     73
F42C 81               (       command.os):01049                 FCB     $81
F42D 4865616473       (       command.os):01050                 FCC     'Heads'
F432 81               (       command.os):01051                 FCB     $81
F433 536563746F72732F (       command.os):01052                 FCC     'Sectors/Track'
     547261636B
F440 80               (       command.os):01053                 FCB     $80
                      (       command.os):01054         ;* FLAG ON/OFF TABLE
F441                  (       command.os):01055         OOTAB
F441 82               (       command.os):01056                 FCB     $82
F442 4F4646           (       command.os):01057                 FCC     'OFF'
F445 82               (       command.os):01058                 FCB     $82
F446 4F4E             (       command.os):01059                 FCC     'ON'
F448 80               (       command.os):01060                 FCB     $80
                      (       command.os):01061         ;* 'SET CONSOLE' OPTIONS
F449                  (       command.os):01062         IOTAB
F449 81               (       command.os):01063                 FCB     $81
F44A 496E707574       (       command.os):01064                 FCC     'Input'
F44F 81               (       command.os):01065                 FCB     $81
F450 4F7574707574     (       command.os):01066                 FCC     'Output'
F456 80               (       command.os):01067                 FCB     $80
                      (        cubix.asm):01227                 INCLUDE comfile.os                        ;BATCH FILE PROCESSOR
                      (       comfile.os):00001         ;*
                      (       comfile.os):00002         ;* CUBIX Command (batch) file processor
                      (       comfile.os):00003         ;*
                      (       comfile.os):00004         ;* END OF FILE ON COMMAND FILE
F457                  (       comfile.os):00005         CMDEOF
F457 3506             (       comfile.os):00006                 PULS    A,B
F459 FDDCE6           (       comfile.os):00007                 STD     >CMDSTK
F45C B6DCE8           (       comfile.os):00008                 LDA     >CMDRC
F45F 39               (       comfile.os):00009                 RTS
                      (       comfile.os):00010         ;*
                      (       comfile.os):00011         ;* COMMAND FILE PROCESSOR
                      (       comfile.os):00012         ;*
F460                  (       comfile.os):00013         COMFIL
F460 3121             (       comfile.os):00014                 LEAY    1,Y                               ;SKIP '@'
F462 B7DCCD           (       comfile.os):00015                 STA     >TEMP1                            ;INDICATE NOT IMPLIED
F465                  (       comfile.os):00016         CMDEX
F465 BDE3A3           (       comfile.os):00017                 JSR     GETDIR                            ;GET DIRECTORY
F468 BDE291           (       comfile.os):00018                 JSR     NAMGET                            ;GET NAME
F46B CC4000           (       comfile.os):00019                 LDD     #$4000                            ;'@'
F46E ED81             (       comfile.os):00020                 STD     ,X++                              ;SET IT
F470 6F80             (       comfile.os):00021                 CLR     ,X+                               ;ZERO LAST
F472 BDE64C           (       comfile.os):00022                 JSR     LOCERR                            ;LOOK IT UP
                      (       comfile.os):00023         ;* START UP COMMAND FILE DIR ENT(X)
F475                  (       comfile.os):00024         COMGO
F475 A68817           (       comfile.os):00025                 LDA     DATTR,X                           ;GET PROTS
F478 8520             (       comfile.os):00026                 BITA    #EPERM                            ;CAN WE EXECUTE?
F47A 1027F422         (       comfile.os):00027                 LBEQ    PROERR                            ;NO, ERROR
F47E B6DCB7           (       comfile.os):00028                 LDA     >FDRIVE                           ;GET COMMAND FILE DRIVE
F481 B7DCE1           (       comfile.os):00029                 STA     >CMDDRV                           ;SAVE IT
F484 EC8813           (       comfile.os):00030                 LDD     DDADR,X                           ;GET ADDRESS
F487 FDDCE2           (       comfile.os):00031                 STD     >CMDSEC                           ;SAVE COMMAND SECTOR
F48A 4F               (       comfile.os):00032                 CLRA
F48B 5F               (       comfile.os):00033                 CLRB
F48C FDDCE4           (       comfile.os):00034                 STD     >CMDOFF                           ;SAVE COMMAND FILE OFFSET
F48F FCDCE6           (       comfile.os):00035                 LDD     >CMDSTK                           ;GET COMMAND STACK
F492 3406             (       comfile.os):00036                 PSHS    A,B                               ;SAVE OLD STACK
F494 7FDCE8           (       comfile.os):00037                 CLR     >CMDRC                            ;CLEAR RETURN CODE
F497 10BEDCCF         (       comfile.os):00038                 LDY     >TEMP2                            ;RESTORE COMMAND LINE POINTER
F49B BDF59A           (       comfile.os):00039                 JSR     SAVPRM                            ;SAVE PARAMETERS
F49E                  (       comfile.os):00040         NEWLIN
F49E 8EDC00           (       comfile.os):00041                 LDX     #INBUFF                           ;PT TO BUFFER
F4A1                  (       comfile.os):00042         REDCHR
F4A1 BDF60E           (       comfile.os):00043                 JSR     RCCHR                             ;READ CHAR FROM CMD FILE
F4A4 27B1             (       comfile.os):00044                 BEQ     CMDEOF                            ;END OF FILE
F4A6 813F             (       comfile.os):00045                 CMPA    #'?'                              ;PARM?
F4A8 262D             (       comfile.os):00046                 BNE     NOMAC                             ;NOPE
F4AA BDF60E           (       comfile.os):00047                 JSR     RCCHR                             ;GET CHAR
F4AD 8030             (       comfile.os):00048                 SUBA    #'0'                              ;CONVERT
F4AF 8109             (       comfile.os):00049                 CMPA    #9                                ;OVER
F4B1 2308             (       comfile.os):00050                 BLS     PAROK                             ;OK
F4B3 C63F             (       comfile.os):00051                 LDB     #'?'
F4B5 E780             (       comfile.os):00052                 STB     ,X+
F4B7 8B30             (       comfile.os):00053                 ADDA    #'0'
F4B9 201C             (       comfile.os):00054                 BRA     NOMAC                             ;NOT VAR
                      (       comfile.os):00055         ;* PARAMETER SUB TO PERFORM
F4BB                  (       comfile.os):00056         PAROK
F4BB 1F89             (       comfile.os):00057                 TFR     A,B                               ;COPY
F4BD 108EDCED         (       comfile.os):00058                 LDY     #CMDBUF                           ;POINT TO BUFFER
F4C1                  (       comfile.os):00059         PAR1
F4C1 BDE4CF           (       comfile.os):00060                 JSR     SKIP                              ;ADVANCE
F4C4 5A               (       comfile.os):00061                 DECB                                      ;REDUCE COUNT
F4C5 2B07             (       comfile.os):00062                 BMI     PAR3                              ;WE HAVE IT
F4C7                  (       comfile.os):00063         PAR2
F4C7 BDE4DC           (       comfile.os):00064                 JSR     TSTERM                            ;KEEP LOOKING
F4CA 26FB             (       comfile.os):00065                 BNE     PAR2                              ;KEEP LOOKING
F4CC 20F3             (       comfile.os):00066                 BRA     PAR1                              ;CONTINUE
F4CE                  (       comfile.os):00067         PAR3
F4CE BDE4DC           (       comfile.os):00068                 JSR     TSTERM                            ;IS THIS
F4D1 27CE             (       comfile.os):00069                 BEQ     REDCHR                            ;YES, QUIT
F4D3 A780             (       comfile.os):00070                 STA     ,X+                               ;SAVE
F4D5 20F7             (       comfile.os):00071                 BRA     PAR3
                      (       comfile.os):00072         ;* EXECUTE COMMAND
F4D7                  (       comfile.os):00073         NOMAC
F4D7 A780             (       comfile.os):00074                 STA     ,X+                               ;CLEAR IT
F4D9 810D             (       comfile.os):00075                 CMPA    #$0D                              ;END OF LINE?
F4DB 26C4             (       comfile.os):00076                 BNE     REDCHR
F4DD 108EDC00         (       comfile.os):00077                 LDY     #INBUFF                           ;POINT TO BUFFER
F4E1 7DDCA4           (       comfile.os):00078                 TST     >TRCFLG                           ;TEST FOR TRACE ON
F4E4 2717             (       comfile.os):00079                 BEQ     GOCMD                             ;NO, DON'T TRACE
F4E6 862A             (       comfile.os):00080                 LDA     #'*'
F4E8 BDE58D           (       comfile.os):00081                 JSR     PUTCHR                            ;FAKE DOS PROMPT
F4EB 1F21             (       comfile.os):00082                 TFR     Y,X                               ;COPY
F4ED                  (       comfile.os):00083         TRAC1
F4ED A680             (       comfile.os):00084                 LDA     ,X+
F4EF 2709             (       comfile.os):00085                 BEQ     TRAC2
F4F1 810D             (       comfile.os):00086                 CMPA    #$0D
F4F3 2705             (       comfile.os):00087                 BEQ     TRAC2
F4F5 BDE58D           (       comfile.os):00088                 JSR     PUTCHR
F4F8 20F3             (       comfile.os):00089                 BRA     TRAC1
F4FA                  (       comfile.os):00090         TRAC2
F4FA BDE57B           (       comfile.os):00091                 JSR     LFCR
F4FD                  (       comfile.os):00092         GOCMD
F4FD BDE4CF           (       comfile.os):00093                 JSR     SKIP                              ;ADVANCE
F500 813F             (       comfile.os):00094                 CMPA    #'?'                              ;COMMAND CODE
F502 2659             (       comfile.os):00095                 BNE     EXDCOM                            ;NO, SKIP IT
F504 ECA1             (       comfile.os):00096                 LDD     ,Y++                              ;GET OPERAND
F506 BDE4CF           (       comfile.os):00097                 JSR     SKIP
                      (       comfile.os):00098         ;* '?O' OUTPUT LINE
F509 C14F             (       comfile.os):00099                 CMPB    #'O'                              ;OUTPUT?
F50B 2704             (       comfile.os):00100                 BEQ     CMPR
                      (       comfile.os):00101         ;* '?P' ONTPUT LINE - CR
F50D C150             (       comfile.os):00102                 CMPB    #'P'                              ;PRINT?
F50F 2616             (       comfile.os):00103                 BNE     RCOND                             ;CONDITIONAL
F511                  (       comfile.os):00104         CMPR
F511 A6A0             (       comfile.os):00105                 LDA     ,Y+                               ;GET LINE
F513 2709             (       comfile.os):00106                 BEQ     CMPR1
F515 810D             (       comfile.os):00107                 CMPA    #$0D
F517 2705             (       comfile.os):00108                 BEQ     CMPR1
F519 BDE58D           (       comfile.os):00109                 JSR     PUTCHR
F51C 20F3             (       comfile.os):00110                 BRA     CMPR
F51E                  (       comfile.os):00111         CMPR1
F51E C14F             (       comfile.os):00112                 CMPB    #'O'                              ;OUTPUT?
F520 2766             (       comfile.os):00113                 BEQ     CMDRT1                            ;NO LFCR
F522 BDE57B           (       comfile.os):00114                 JSR     LFCR
F525 2061             (       comfile.os):00115                 BRA     CMDRT1                            ;BACK
                      (       comfile.os):00116         ;* '?F' EXECUTE ON LAST COMMAND FAILED
F527                  (       comfile.os):00117         RCOND
F527 C146             (       comfile.os):00118                 CMPB    #'F'                              ;?F?
F529 2607             (       comfile.os):00119                 BNE     RSUCC                             ;NO
F52B B6DCE8           (       comfile.os):00120                 LDA     >CMDRC                            ;GET RC
F52E 2758             (       comfile.os):00121                 BEQ     CMDRT1                            ;RETURN
F530 20CB             (       comfile.os):00122                 BRA     GOCMD                             ;EXECUTE THIS
                      (       comfile.os):00123         ;* '?S' EXECUTE ON LAST COMMAND SUCESSFUL
F532                  (       comfile.os):00124         RSUCC
F532 C153             (       comfile.os):00125                 CMPB    #'S'                              ;?S?
F534 2603             (       comfile.os):00126                 BNE     CSRC                              ;NO, TRY EXIT
F536 5F               (       comfile.os):00127                 CLRB
F537 2009             (       comfile.os):00128                 BRA     TSTRET                            ;PEFORM TEST
                      (       comfile.os):00129         ;* '?R' EXECUTE ON SPECIFIC RETURN CODE
F539                  (       comfile.os):00130         CSRC
F539 C152             (       comfile.os):00131                 CMPB    #'R'                              ;?R?
F53B 260C             (       comfile.os):00132                 BNE     CEXIT                             ;TRY EXIT
F53D BDE404           (       comfile.os):00133                 JSR     GETNUM                            ;GET VALUE
F540 1F10             (       comfile.os):00134                 TFR     X,D                               ;COPY
F542                  (       comfile.os):00135         TSTRET
F542 F1DCE8           (       comfile.os):00136                 CMPB    >CMDRC                            ;WUZ THIS IT?
F545 2641             (       comfile.os):00137                 BNE     CMDRT1                            ;NO, DONT EXECUTE
F547 20B4             (       comfile.os):00138                 BRA     GOCMD                             ;DO IT
                      (       comfile.os):00139         ;* '?E' EXIT COMMAND FILE
F549                  (       comfile.os):00140         CEXIT
F549 C145             (       comfile.os):00141                 CMPB    #'E'                              ;EXIT
F54B 263E             (       comfile.os):00142                 BNE     CMDIN                             ;NO, TRY SET VARIABLES
F54D BDE4CF           (       comfile.os):00143                 JSR     SKIP                              ;ANY OPERANDS
F550 2708             (       comfile.os):00144                 BEQ     CEXI                              ;NO
F552 BDE404           (       comfile.os):00145                 JSR     GETNUM                            ;GT VALUE
F555 1F10             (       comfile.os):00146                 TFR     X,D                               ;COPY
F557 F7DCE8           (       comfile.os):00147                 STB     >CMDRC                            ;SET IT
F55A                  (       comfile.os):00148         CEXI
F55A 7EF457           (       comfile.os):00149                 JMP     CMDEOF                            ;END OF FILE
                      (       comfile.os):00150         ;* EXECUTE DOS COMMAND
F55D                  (       comfile.os):00151         EXDCOM
F55D BEDCE4           (       comfile.os):00152                 LDX     >CMDOFF                           ;GET OFFSET
F560 FCDCE2           (       comfile.os):00153                 LDD     >CMDSEC                           ;GET SECTOR
F563 3416             (       comfile.os):00154                 PSHS    A,B,X                             ;SAVE
F565 B6DCE1           (       comfile.os):00155                 LDA     >CMDDRV                           ;GET DRIVE
F568 3402             (       comfile.os):00156                 PSHS    A                                 ;SAVE
F56A 10FFDCE6         (       comfile.os):00157                 STS     >CMDSTK                           ;SET STACK
F56E BDE1C0           (       comfile.os):00158                 JSR     EXECMD                            ;EXECUTE
F571                  (       comfile.os):00159         CMDRET
F571 2601             (       comfile.os):00160                 BNE     CMDRT0
F573 4F               (       comfile.os):00161                 CLRA
F574                  (       comfile.os):00162         CMDRT0
F574 B7DCE8           (       comfile.os):00163                 STA     >CMDRC                            ;SET RC
F577 10FEDCE6         (       comfile.os):00164                 LDS     >CMDSTK                           ;GET STACK
F57B 3502             (       comfile.os):00165                 PULS    A                                 ;RESTORE DRIVE
F57D B7DCE1           (       comfile.os):00166                 STA     >CMDDRV                           ;RESAVE
F580 3516             (       comfile.os):00167                 PULS    A,B,X                             ;RESTORE VARS
F582 FDDCE2           (       comfile.os):00168                 STD     >CMDSEC                           ;RESET SECTOR
F585 BFDCE4           (       comfile.os):00169                 STX     >CMDOFF                           ;RESET OFFSET
F588                  (       comfile.os):00170         CMDRT1
F588 7EF49E           (       comfile.os):00171                 JMP     NEWLIN                            ;LFCR & RETURN
                      (       comfile.os):00172         ;* '?=' SET COMMAND FILE VARIABLES
F58B                  (       comfile.os):00173         CMDIN
F58B C13D             (       comfile.os):00174                 CMPB    #'='
F58D 2707             (       comfile.os):00175                 BEQ     SETVAR                            ;SET THEM
                      (       comfile.os):00176         ;* '?I' INPUT NEW PARMS
F58F C149             (       comfile.os):00177                 CMPB    #'I'                              ;NEW PARMS?
F591 2618             (       comfile.os):00178                 BNE     CHAIN                             ;NO, TRY CHAIN
F593 BDE498           (       comfile.os):00179                 JSR     GLINE                             ;GET LINE
F596                  (       comfile.os):00180         SETVAR
F596 8D02             (       comfile.os):00181                 BSR     SAVPRM                            ;SAVE THEM
F598 20EE             (       comfile.os):00182                 BRA     CMDRT1                            ;CONTINUE
                      (       comfile.os):00183         ;* SAVE COMMAND LINE PARAMETERS IN BUFFER
F59A                  (       comfile.os):00184         SAVPRM
F59A 3410             (       comfile.os):00185                 PSHS    X                                 ;SAVE REGS
F59C 8EDCED           (       comfile.os):00186                 LDX     #CMDBUF                           ;POINT TO IT
F59F                  (       comfile.os):00187         SAVP1
F59F A6A0             (       comfile.os):00188                 LDA     ,Y+                               ;GET IT
F5A1 A780             (       comfile.os):00189                 STA     ,X+                               ;WRITE IT
F5A3 2704             (       comfile.os):00190                 BEQ     SAVP2                             ;END
F5A5 810D             (       comfile.os):00191                 CMPA    #$0D                              ;OK?
F5A7 26F6             (       comfile.os):00192                 BNE     SAVP1                             ;KEEP GOING
F5A9                  (       comfile.os):00193         SAVP2
F5A9 3590             (       comfile.os):00194                 PULS    X,PC                              ;GO HOME
                      (       comfile.os):00195         ;* '?@' CHAIN TO NEW CMD FILE
F5AB                  (       comfile.os):00196         CHAIN
F5AB C140             (       comfile.os):00197                 CMPB    #'@'
F5AD 2608             (       comfile.os):00198                 BNE     CMDSKP
F5AF 3506             (       comfile.os):00199                 PULS    A,B                               ;RESTORE STACK
F5B1 FDDCE6           (       comfile.os):00200                 STD     >CMDSTK                           ;RESET SAVED STACK
F5B4 7EF465           (       comfile.os):00201                 JMP     CMDEX                             ;EXECUTE IT
                      (       comfile.os):00202         ;* '?A' ADVANCE LINES
F5B7                  (       comfile.os):00203         CMDSKP
F5B7 C141             (       comfile.os):00204                 CMPB    #'A'                              ;?A?
F5B9 2613             (       comfile.os):00205                 BNE     CMDKEY                            ;CONTINUE
F5BB BDE404           (       comfile.os):00206                 JSR     GETNUM                            ;GET # TO SKIP
F5BE 3001             (       comfile.os):00207                 LEAX    1,X                               ;ADVANCE
F5C0                  (       comfile.os):00208         LOCLP
F5C0 301F             (       comfile.os):00209                 LEAX    -1,X                              ;REDUCE COUNT
F5C2 27C4             (       comfile.os):00210                 BEQ     CMDRT1                            ;NEW LINE
F5C4                  (       comfile.os):00211         LOCCR
F5C4 8D48             (       comfile.os):00212                 BSR     RCCHR                             ;READ A CHAR
F5C6 2792             (       comfile.os):00213                 BEQ     CEXI                              ;END OF FILE
F5C8 810D             (       comfile.os):00214                 CMPA    #$0D                              ;END OF LINE?
F5CA 26F8             (       comfile.os):00215                 BNE     LOCCR                             ;NO, KEEP LOOKING
F5CC 20F2             (       comfile.os):00216                 BRA     LOCLP                             ;DO THEM ALL
                      (       comfile.os):00217         ;* '?K' READ SINGLE KEY
F5CE                  (       comfile.os):00218         CMDKEY
F5CE C14B             (       comfile.os):00219                 CMPB    #'K'                              ;?K?
F5D0 2608             (       comfile.os):00220                 BNE     CMDCMP                            ;NO, TRY COMPARE
F5D2 BDE5CD           (       comfile.os):00221                 JSR     GETCHR                            ;GET SINGLE KEY
F5D5 B7DCE8           (       comfile.os):00222                 STA     >CMDRC                            ;SAVE RETURN CODE
F5D8 2031             (       comfile.os):00223                 BRA     CMDRT2                            ;EXIT
                      (       comfile.os):00224         ;* '??' COMPARE STRINGS
F5DA                  (       comfile.os):00225         CMDCMP
F5DA C13F             (       comfile.os):00226                 CMPB    #'?'                              ;???
F5DC 262D             (       comfile.os):00227                 BNE     CMDRT2                            ;IGNORE
F5DE BDE4CF           (       comfile.os):00228                 JSR     SKIP                              ;TEST FOR EOL
F5E1 2716             (       comfile.os):00229                 BEQ     CMDC3                             ;FAIL
F5E3 1F21             (       comfile.os):00230                 TFR     Y,X                               ;SAVE PTR
F5E5                  (       comfile.os):00231         CMDC1
F5E5 A6A0             (       comfile.os):00232                 LDA     ,Y+                               ;GET CHAR
F5E7 810D             (       comfile.os):00233                 CMPA    #$0D                              ;CR?
F5E9 270E             (       comfile.os):00234                 BEQ     CMDC3                             ;FAIL
F5EB 8120             (       comfile.os):00235                 CMPA    #' '                              ;SPACE?
F5ED 26F6             (       comfile.os):00236                 BNE     CMDC1                             ;KEEP LOOKING
F5EF                  (       comfile.os):00237         CMDC2
F5EF A680             (       comfile.os):00238                 LDA     ,X+                               ;GET CHAR
F5F1 8120             (       comfile.os):00239                 CMPA    #' '                              ;SPACE?
F5F3 2708             (       comfile.os):00240                 BEQ     CMDC4                             ;END
F5F5 A1A0             (       comfile.os):00241                 CMPA    ,Y+                               ;ARE THEY SAME?
F5F7 27F6             (       comfile.os):00242                 BEQ     CMDC2                             ;YES, A-OK
F5F9                  (       comfile.os):00243         CMDC3
F5F9 86FF             (       comfile.os):00244                 LDA     #255                              ;RETURN CODE
F5FB 200B             (       comfile.os):00245                 BRA     CMDC6                             ;QUIT
F5FD                  (       comfile.os):00246         CMDC4
F5FD A6A0             (       comfile.os):00247                 LDA     ,Y+                               ;GET CHAR FROM SOURCE
F5FF 810D             (       comfile.os):00248                 CMPA    #$0D                              ;PASS?
F601 2704             (       comfile.os):00249                 BEQ     CMDC5                             ;YES
F603 8120             (       comfile.os):00250                 CMPA    #' '                              ;SPACE
F605 26F2             (       comfile.os):00251                 BNE     CMDC3                             ;NO, FAIL
F607                  (       comfile.os):00252         CMDC5
F607 4F               (       comfile.os):00253                 CLRA                                      ;ZERO RETURN CODE
F608                  (       comfile.os):00254         CMDC6
F608 B7DCE8           (       comfile.os):00255                 STA     >CMDRC                            ;SAVE RETURN CODE
F60B                  (       comfile.os):00256         CMDRT2
F60B 7EF49E           (       comfile.os):00257                 JMP     NEWLIN                            ;NEXT LINE
                      (       comfile.os):00258         ;* READ A CHARACTER FROM THE COMMAND FILE
F60E                  (       comfile.os):00259         RCCHR
F60E 3410             (       comfile.os):00260                 PSHS    X                                 ;SAVE X
F610 B6DCE1           (       comfile.os):00261                 LDA     >CMDDRV                           ;GET CMD FILE DRIVE
F613 B7DCEB           (       comfile.os):00262                 STA     >SDRIVE                           ;SET DRIVE
F616 FCDCE4           (       comfile.os):00263                 LDD     >CMDOFF                           ;GET OFFSET
F619                  (       comfile.os):00264         RCC1
F619 10830200         (       comfile.os):00265                 CMPD    #512                              ;OVER?
F61D 250D             (       comfile.os):00266                 BLO     RCC2                              ;ITS OK
F61F FCDCE2           (       comfile.os):00267                 LDD     >CMDSEC                           ;GET SECTOR
F622 BDE5D2           (       comfile.os):00268                 JSR     FNDLNK                            ;LOOK UP LINK
F625 271E             (       comfile.os):00269                 BEQ     RCC3                              ;END
F627 FDDCE2           (       comfile.os):00270                 STD     >CMDSEC                           ;RESAVE
F62A 4F               (       comfile.os):00271                 CLRA    ZERO OFFSET
F62B 5F               (       comfile.os):00272                 CLRB    FOR READ
F62C                  (       comfile.os):00273         RCC2
F62C 8EDE00           (       comfile.os):00274                 LDX     #WRKSPC                           ;POINT TO IT
F62F 308B             (       comfile.os):00275                 LEAX    D,X                               ;OFFSET
F631 C30001           (       comfile.os):00276                 ADDD    #1                                ;ADVANCE
F634 FDDCE4           (       comfile.os):00277                 STD     >CMDOFF                           ;RESAVE
F637 3410             (       comfile.os):00278                 PSHS    X                                 ;SAVE REGS
F639 FCDCE2           (       comfile.os):00279                 LDD     >CMDSEC                           ;GET SECTOR
F63C BDE5EF           (       comfile.os):00280                 JSR     RDWRK                             ;READ IT
F63F 3510             (       comfile.os):00281                 PULS    X                                 ;RESTORE
F641 A680             (       comfile.os):00282                 LDA     ,X+                               ;GET CHAR
F643 81FF             (       comfile.os):00283                 CMPA    #$FF                              ;END OF FILE
F645                  (       comfile.os):00284         RCC3
F645 3590             (       comfile.os):00285                 PULS    X,PC
                      (        cubix.asm):01228         ;*
                      (        cubix.asm):01229         ;* MISC SYSTEM CALLS
                      (        cubix.asm):01230         ;*
                      (        cubix.asm):01231         ;* QUERY CONSOLE INPUT DEVICE
F647                  (        cubix.asm):01232         REDIN
F647 B6DC6C           (        cubix.asm):01233                 LDA     >CONIN                            ;LOAD DEVICE INPUT VECTOR
F64A 2020             (        cubix.asm):01234                 BRA     RETZ                              ;RETURN SUCCESS
                      (        cubix.asm):01235         ;* QUERY CONSOLE OUTPUT DEVICE
F64C                  (        cubix.asm):01236         REDOUT
F64C B6DC6D           (        cubix.asm):01237                 LDA     >CONOUT                           ;LOAD DEVICE OUTPUT VECTOR
F64F 201B             (        cubix.asm):01238                 BRA     RETZ                              ;RETURN SUCCESS
                      (        cubix.asm):01239         ;* SET CONSOLE INPUT DEVICE
F651                  (        cubix.asm):01240         SETIN
F651 3404             (        cubix.asm):01241                 PSHS    B                                 ;SAVE REGISTER
F653 F6DC6C           (        cubix.asm):01242                 LDB     >CONIN                            ;LOAD OLD INPUT DEVICE
F656 B7DC6C           (        cubix.asm):01243                 STA     >CONIN                            ;SAVE NEW INPUT DEVICE
F659 2008             (        cubix.asm):01244                 BRA     REEXG                             ;SWAP & RETURN
                      (        cubix.asm):01245         ;* SET CONSOLE OUTPUT DEVICE
F65B                  (        cubix.asm):01246         SETOUT
F65B 3404             (        cubix.asm):01247                 PSHS    B                                 ;SAVE REGISTER
F65D F6DC6D           (        cubix.asm):01248                 LDB     >CONOUT                           ;LOAD OLD OUTPUT DEVICE
F660 B7DC6D           (        cubix.asm):01249                 STA     >CONOUT                           ;SAVE NEW OUTPUT DEVICE
F663                  (        cubix.asm):01250         REEXG
F663 1F98             (        cubix.asm):01251                 TFR     B,A                               ;COPY OLD DEVICE ID TO 'A'
F665 1A04             (        cubix.asm):01252                 ORCC    #4                                ;SET 'Z' CODE
F667 3584             (        cubix.asm):01253                 PULS    B,PC                              ;RESTORE & RETURN
                      (        cubix.asm):01254         ;* SELECT DISK DRIVE
F669                  (        cubix.asm):01255         SELDRV
F669 B7DCEB           (        cubix.asm):01256                 STA     >SDRIVE                           ;SELECT ACTIVE DISK DRIVE
F66C                  (        cubix.asm):01257         RETZ
F66C 1A04             (        cubix.asm):01258                 ORCC    #4                                ;SET 'Z' CODE
F66E 39               (        cubix.asm):01259                 RTS
                      (        cubix.asm):01260         ;* QUERY DEVICE VECTOR
F66F                  (        cubix.asm):01261         QVECT
F66F 3440             (        cubix.asm):01262                 PSHS    U                                 ;SAVE REGISTER
F671 CEDC6E           (        cubix.asm):01263                 LDU     #DITAB                            ;POINT TO TABLE
F674 48               (        cubix.asm):01264                 LSLA                                      ;X2 FOR WORD ENTRIES
F675 ECC6             (        cubix.asm):01265                 LDD     A,U                               ;GET VECTOR
F677 200C             (        cubix.asm):01266                 BRA     RETZ1                             ;AND EXIT
                      (        cubix.asm):01267         ;* SET DEVICE VECTOR
F679                  (        cubix.asm):01268         SVECT
F679 3440             (        cubix.asm):01269                 PSHS    U                                 ;SAVE REGISTER
F67B CEDC6E           (        cubix.asm):01270                 LDU     #DITAB                            ;POINT TO TABLE
F67E 48               (        cubix.asm):01271                 LSLA                                      ;X2  FOR WORD ENTRIES
F67F 33C6             (        cubix.asm):01272                 LEAU    A,U                               ;OFFSET TO ENTRY
F681 ECC4             (        cubix.asm):01273                 LDD     ,U                                ;GET OLD VECTOR VALUE
F683 AFC4             (        cubix.asm):01274                 STX     ,U                                ;SET NEW VECTOR VALUE
F685                  (        cubix.asm):01275         RETZ1
F685 1A04             (        cubix.asm):01276                 ORCC    #4                                ;SET 'Z' CODE
F687 35C0             (        cubix.asm):01277                 PULS    U,PC                              ;RESTORE & RETURN
                      (        cubix.asm):01278         ;*
                      (        cubix.asm):01279         ;* PERFORMS 16 BIT MULTIPLICATION (D=X*D)
                      (        cubix.asm):01280         ;*
F689                  (        cubix.asm):01281         MUL16
F689 3416             (        cubix.asm):01282                 PSHS    D,X                               ;SAVE PARAMETERS
F68B A661             (        cubix.asm):01283                 LDA     1,S
F68D E663             (        cubix.asm):01284                 LDB     3,S
F68F 3D               (        cubix.asm):01285                 MUL
F690 3406             (        cubix.asm):01286                 PSHS    A,B                               ;RESAVE
F692 A662             (        cubix.asm):01287                 LDA     2,S
F694 E665             (        cubix.asm):01288                 LDB     5,S
F696 3D               (        cubix.asm):01289                 MUL
F697 EBE4             (        cubix.asm):01290                 ADDB    ,S
F699 E7E4             (        cubix.asm):01291                 STB     ,S
F69B A663             (        cubix.asm):01292                 LDA     3,S
F69D E664             (        cubix.asm):01293                 LDB     4,S
F69F 3D               (        cubix.asm):01294                 MUL
F6A0 EBE4             (        cubix.asm):01295                 ADDB    ,S
F6A2 E7E4             (        cubix.asm):01296                 STB     ,S
F6A4 3506             (        cubix.asm):01297                 PULS    A,B                               ;GET RESULT
F6A6 3264             (        cubix.asm):01298                 LEAS    4,S                               ;SKIP CRAP
F6A8 39               (        cubix.asm):01299                 RTS
                      (        cubix.asm):01300         ;*
                      (        cubix.asm):01301         ;* PERFORMS 16 BIT DIVISION. (X=X/D, D=REMAINDER)
                      (        cubix.asm):01302         ;*
F6A9                  (        cubix.asm):01303         DIV16
F6A9 3416             (        cubix.asm):01304                 PSHS    D,X
F6AB CC0000           (        cubix.asm):01305                 LDD     #0
F6AE 8E0011           (        cubix.asm):01306                 LDX     #17
F6B1                  (        cubix.asm):01307         DIV1
F6B1 1CFE             (        cubix.asm):01308                 ANDCC   #$FE
F6B3                  (        cubix.asm):01309         DIV2
F6B3 6963             (        cubix.asm):01310                 ROL     3,S
F6B5 6962             (        cubix.asm):01311                 ROL     2,S
F6B7 301F             (        cubix.asm):01312                 LEAX    -1,X
F6B9 270D             (        cubix.asm):01313                 BEQ     DIV3
F6BB 59               (        cubix.asm):01314                 ROLB
F6BC 49               (        cubix.asm):01315                 ROLA
F6BD 10A3E4           (        cubix.asm):01316                 CMPD    ,S
F6C0 25EF             (        cubix.asm):01317                 BLO     DIV1
F6C2 A3E4             (        cubix.asm):01318                 SUBD    ,S
F6C4 1A01             (        cubix.asm):01319                 ORCC    #1
F6C6 20EB             (        cubix.asm):01320                 BRA     DIV2
F6C8                  (        cubix.asm):01321         DIV3
F6C8 3262             (        cubix.asm):01322                 LEAS    2,S
F6CA 3590             (        cubix.asm):01323                 PULS    X,PC
                      (        cubix.asm):01324         ;* DISK DRIVERS
F6CC                  (        cubix.asm):01325         FORMAT
F6CC AD9FDC94         (        cubix.asm):01326                 JSR     [XFORMAT]
F6D0                  (        cubix.asm):01327         HOME
F6D0 6F44             (        cubix.asm):01328                 CLR     CYL,U                             ;CYLINDER 0
F6D2 6F45             (        cubix.asm):01329                 CLR     HEAD,U                            ;HEAD 0
F6D4 6F46             (        cubix.asm):01330                 CLR     SEC,U                             ;SECTOR 0
F6D6 6E9FDC8E         (        cubix.asm):01331                 JMP     [XHOME]
F6DA                  (        cubix.asm):01332         RDSEC
F6DA 6E9FDC90         (        cubix.asm):01333                 JMP     [XRDSEC]
F6DE                  (        cubix.asm):01334         WRSEC
F6DE 6E9FDC92         (        cubix.asm):01335                 JMP     [XWRSEC]
                      (        cubix.asm):01336         ;* INTERRUPT HANDLERS
F6E2                  (        cubix.asm):01337         SWI
F6E2 6E9FDC96         (        cubix.asm):01338                 JMP     [SWIVEC]
F6E6                  (        cubix.asm):01339         SWI2
F6E6 6E9FDC98         (        cubix.asm):01340                 JMP     [SWI2VEC]
F6EA                  (        cubix.asm):01341         SWI3
F6EA 6E9FDC9A         (        cubix.asm):01342                 JMP     [SWI3VEC]
F6EE                  (        cubix.asm):01343         IRQ
F6EE 6E9FDC9C         (        cubix.asm):01344                 JMP     [IRQVEC]
F6F2                  (        cubix.asm):01345         FIRQ
F6F2 6E9FDC9E         (        cubix.asm):01346                 JMP     [FIRQVEC]
F6F6                  (        cubix.asm):01347         NMI
F6F6 6E9FDCA0         (        cubix.asm):01348                 JMP     [NMIVEC]
                      (        cubix.asm):01349         ;* STRINGS & MESSAGES
F6FA                  (        cubix.asm):01350         IPLFILE
F6FA 535441525455502E (        cubix.asm):01351                 FCC     'STARTUP.*'
     2A
F703 00               (        cubix.asm):01352                 FCB     $00
F704                  (        cubix.asm):01353         UNCMD
F704 556E7265636F676E (        cubix.asm):01354                 FCC     'Unrecognized command'
     697A656420636F6D
     6D616E64
F718 00               (        cubix.asm):01355                 FCB     $00
F719                  (        cubix.asm):01356         BADOPM
F719 4F706572616E6420 (        cubix.asm):01357                 FCC     'Operand missing or invalid'
     6D697373696E6720
     6F7220696E76616C
     6964
F733 00               (        cubix.asm):01358                 FCB     $00
F734                  (        cubix.asm):01359         NOTMSG
F734 46696C65206E6F74 (        cubix.asm):01360                 FCC     'File not found'
     20666F756E64
F742 00               (        cubix.asm):01361                 FCB     $00
F743                  (        cubix.asm):01362         EXIMSG
F743 46696C6520616C72 (        cubix.asm):01363                 FCC     'File already exists'
     6561647920657869
     737473
F756 00               (        cubix.asm):01364                 FCB     $00
F757                  (        cubix.asm):01365         NOSMSG
F757 496E737566666963 (        cubix.asm):01366                 FCC     'Insufficent disk space'
     656E74206469736B
     207370616365
F76D 00               (        cubix.asm):01367                 FCB     $00
F76E                  (        cubix.asm):01368         OREMSG
F76E 46696C65206E6F74 (        cubix.asm):01369                 FCC     'File not open for read'
     206F70656E20666F
     722072656164
F784 00               (        cubix.asm):01370                 FCB     $00
F785                  (        cubix.asm):01371         OWEMSG
F785 46696C65206E6F74 (        cubix.asm):01372                 FCC     'File not open for write'
     206F70656E20666F
     72207772697465
F79C 00               (        cubix.asm):01373                 FCB     $00
F79D                  (        cubix.asm):01374         PROMSG
F79D 46696C652070726F (        cubix.asm):01375                 FCC     'File protection violation'
     74656374696F6E20
     76696F6C6174696F
     6E
F7B6 00               (        cubix.asm):01376                 FCB     $00
F7B7                  (        cubix.asm):01377         DEVMSG
F7B7 496E76616C696420 (        cubix.asm):01378                 FCC     'Invalid device'
     646576696365
F7C5 00               (        cubix.asm):01379                 FCB     $00
F7C6                  (        cubix.asm):01380         DNLMSG
F7C6 446F776E6C6F6164 (        cubix.asm):01381                 FCC     'Download format error'
     20666F726D617420
     6572726F72
F7DB 00               (        cubix.asm):01382                 FCB     $00
                      (        cubix.asm):01383         ;* COMMAND NAME TABLE
F7DC                  (        cubix.asm):01384         CMDNAM
F7DC 84               (        cubix.asm):01385                 FCB     $84
F7DD 464F524D4154     (        cubix.asm):01386                 FCC     'FORMAT'
F7E3 82               (        cubix.asm):01387                 FCB     $82
F7E4 52454144         (        cubix.asm):01388                 FCC     'READ'
F7E8 82               (        cubix.asm):01389                 FCB     $82
F7E9 5752495445       (        cubix.asm):01390                 FCC     'WRITE'
F7EE 82               (        cubix.asm):01391                 FCB     $82
F7EF 46494C4553       (        cubix.asm):01392                 FCC     'FILES'
F7F4 82               (        cubix.asm):01393                 FCB     $82
F7F5 435245415445     (        cubix.asm):01394                 FCC     'CREATE'
F7FB 83               (        cubix.asm):01395                 FCB     $83
F7FC 44454C455445     (        cubix.asm):01396                 FCC     'DELETE'
F802 82               (        cubix.asm):01397                 FCB     $82
F803 4C4F4144         (        cubix.asm):01398                 FCC     'LOAD'
F807 82               (        cubix.asm):01399                 FCB     $82
F808 53415645         (        cubix.asm):01400                 FCC     'SAVE'
F80C 82               (        cubix.asm):01401                 FCB     $82
F80D 52554E           (        cubix.asm):01402                 FCC     'RUN'
F810 82               (        cubix.asm):01403                 FCB     $82
F811 52455455524E     (        cubix.asm):01404                 FCC     'RETURN'
F817 82               (        cubix.asm):01405                 FCB     $82
F818 534554           (        cubix.asm):01406                 FCC     'SET'
F81B 82               (        cubix.asm):01407                 FCB     $82
F81C 53484F57         (        cubix.asm):01408                 FCC     'SHOW'
F820 82               (        cubix.asm):01409                 FCB     $82
F821 444F574E4C4F4144 (        cubix.asm):01410                 FCC     'DOWNLOAD'
F829 82               (        cubix.asm):01411                 FCB     $82
F82A 434F4E4E454354   (        cubix.asm):01412                 FCC     'CONNECT'
F831 80               (        cubix.asm):01413                 FCB     $80
                      (        cubix.asm):01414         ;* COMMAND ADDRESS TABLE
F832                  (        cubix.asm):01415         CMDADR
F832 EBF1             (        cubix.asm):01416                 FDB     INIT
F834 ECFA             (        cubix.asm):01417                 FDB     CREAD
F836 ED2A             (        cubix.asm):01418                 FDB     CWRITE
F838 ED5A             (        cubix.asm):01419                 FDB     FILES
F83A ED7E             (        cubix.asm):01420                 FDB     CREFIL
F83C ED95             (        cubix.asm):01421                 FDB     DELFIL
F83E EE48             (        cubix.asm):01422                 FDB     LODFIL
F840 EE79             (        cubix.asm):01423                 FDB     SAVFIL
F842 E1EA             (        cubix.asm):01424                 FDB     RUN
F844 EEDA             (        cubix.asm):01425                 FDB     RETURN
F846 EFF3             (        cubix.asm):01426                 FDB     SET
F848 F12B             (        cubix.asm):01427                 FDB     SHOW
F84A EF01             (        cubix.asm):01428                 FDB     DNLD
F84C EFCF             (        cubix.asm):01429                 FDB     CNCT
     000E             (        cubix.asm):01430         NUMCMD          EQU (*-CMDADR)/2                  ;NUMBER OF COMMANDS
                      (        cubix.asm):01431         ;* APPLICATION PROGRAM INTERFACE ADDRESS TABLE
F84E                  (        cubix.asm):01432         SSRTAB
F84E E19F             (        cubix.asm):01433                 FDB     REENT                             ;00-DOS RE-ENTRY
                      (        cubix.asm):01434         ;* PARAM. & LINE INPUT
F850 E498             (        cubix.asm):01435                 FDB     GLINE                             ;01-GET LINE/PROMPT
F852 E495             (        cubix.asm):01436                 FDB     GLFCR                             ;02-GET LINE/NEW LINE
F854 E49D             (        cubix.asm):01437                 FDB     GLNOP                             ;03-GET LINE/NO PROMPT
F856 E4CF             (        cubix.asm):01438                 FDB     SKIP                              ;04-SKIP TO NEXT NON-BLANK, 'Z' IF EOL
F858 E4DC             (        cubix.asm):01439                 FDB     TSTERM                            ;05-GET CHR(Y+), TEST FOR TERMINATOR
F85A E449             (        cubix.asm):01440                 FDB     GETDEC                            ;06-GET DECIMAL NUMBER
F85C E40F             (        cubix.asm):01441                 FDB     GETHEX                            ;07-GET HEX NUMBER
F85E E404             (        cubix.asm):01442                 FDB     GETNUM                            ;08-GET DECIMAL OR HEX VALUE
F860 E36A             (        cubix.asm):01443                 FDB     GETNAM                            ;09-GET FILENAME
F862 E363             (        cubix.asm):01444                 FDB     GETVAL                            ;10-GET & INSURE SINGLE FILE
F864 E289             (        cubix.asm):01445                 FDB     GETSNA                            ;11-GET FILENAME/NO TYPE
F866 E30D             (        cubix.asm):01446                 FDB     GETSYS                            ;12-GET FILENAME/NO TYPE/DEFAULT SYSTEM
F868 E310             (        cubix.asm):01447                 FDB     GETSDI                            ;13-GET FILENAME/NO TYPE/DEFAULT(X)
F86A E3A3             (        cubix.asm):01448                 FDB     GETDIR                            ;14-GET DIRECTORY NAME
F86C E3A6             (        cubix.asm):01449                 FDB     GETDIR1                           ;15-GET DIRECTORY, DEFAULT(X)
F86E E3F2             (        cubix.asm):01450                 FDB     GETDRV                            ;16-GET DRIVE ID
F870 F061             (        cubix.asm):01451                 FDB     GETATR                            ;17-GET ATTRIBUTES
F872 E4F8             (        cubix.asm):01452                 FDB     TLOOK                             ;18-TABLE LOOKUP
F874 E316             (        cubix.asm):01453                 FDB     COMNAM                            ;19-COMPARE NAMES
F876 E34F             (        cubix.asm):01454                 FDB     VALID                             ;20-TEST FOR VALID AS SINGLE?
                      (        cubix.asm):01455         ;* CONSOLE OUTPUT
F878 E585             (        cubix.asm):01456                 FDB     SPACE                             ;21-OUTPUT SPACE
F87A E57B             (        cubix.asm):01457                 FDB     LFCR                              ;22-OUTPUT LFCR
F87C E567             (        cubix.asm):01458                 FDB     WRSTR                             ;23-OUTPUT STRING(X)
F87E E541             (        cubix.asm):01459                 FDB     WRLIN                             ;24-OUTPUT STRING(PC)/NO LFCR
F880 E571             (        cubix.asm):01460                 FDB     WRMSG                             ;25-OUTPUT STRING(PC)/LFCR
F882 E471             (        cubix.asm):01461                 FDB     WRDEC                             ;26-OUTPUT WORD(D) DECIMAL
F884 E538             (        cubix.asm):01462                 FDB     WRHEXW                            ;27-OUTPUT WORD(D) IN HEX
F886 E54D             (        cubix.asm):01463                 FDB     WRHEX                             ;28-OUTPUT BYTE(A) IN HEX
F888 E55B             (        cubix.asm):01464                 FDB     HOUT                              ;29-OUTPUT NIBBLE(A) IN HEX
F88A E6CA             (        cubix.asm):01465                 FDB     SHOSAV                            ;30-DISPLAY SAVED FILENAME
F88C E6DD             (        cubix.asm):01466                 FDB     SHONAM                            ;31-DISPLAY FILENAME(X)
F88E F24C             (        cubix.asm):01467                 FDB     SHOTAB                            ;32-SHOW TABLE(X) ENTRY(A)
                      (        cubix.asm):01468         ;* SERIAL DEVICE I/O
F890 E58D             (        cubix.asm):01469                 FDB     PUTCHR                            ;33-OUTPUT CHAR(A)
F892 E5CD             (        cubix.asm):01470                 FDB     GETCHR                            ;34-GET A CHAR
F894 E5C6             (        cubix.asm):01471                 FDB     TSTCHR                            ;35-TEST FOR CHAR
F896 E594             (        cubix.asm):01472                 FDB     WRDEV                             ;36-OUTPUT CHAR(A) TO DEVICE(B)
F898 E5AF             (        cubix.asm):01473                 FDB     RDDEV                             ;37-GET CHAR FROM DEVICE(B)
F89A E5B4             (        cubix.asm):01474                 FDB     TSTDEV                            ;38-TEST FOR CHAR FROM DEV(B)
F89C F647             (        cubix.asm):01475                 FDB     REDIN                             ;39-READ INPUT DEVICE NUMBER
F89E F64C             (        cubix.asm):01476                 FDB     REDOUT                            ;40-READ OUTPUT DEVICE NUMBER
F8A0 F651             (        cubix.asm):01477                 FDB     SETIN                             ;41-SET INPUT DEVICE
F8A2 F65B             (        cubix.asm):01478                 FDB     SETOUT                            ;42-SET OUTPUT DEVICE
                      (        cubix.asm):01479         ;* CANNED ERROR MESSAGES
F8A4 E2AB             (        cubix.asm):01480                 FDB     BADOPR                            ;43-OPERAND MISSING OR INVALID
F8A6 E650             (        cubix.asm):01481                 FDB     NOTFND                            ;44-FILE NOT FOUND
F8A8 E8A0             (        cubix.asm):01482                 FDB     PROERR                            ;45-PROTECTION VIOLATION
F8AA E8A9             (        cubix.asm):01483                 FDB     ORERR                             ;46-FILE NOT OPEN FOR READ
F8AC E91D             (        cubix.asm):01484                 FDB     OWERR                             ;47-FILE NOT OPEN FOR WRITE
F8AE E723             (        cubix.asm):01485                 FDB     FEXISTS                           ;48-FILE ALREADY EXISTS
F8B0 E7C6             (        cubix.asm):01486                 FDB     NOSPAC                            ;49-INSUFFICENT DISK SPACE
F8B2 E5A7             (        cubix.asm):01487                 FDB     BADDEV                            ;50-INVALID DEVICE
F8B4 EFA1             (        cubix.asm):01488                 FDB     LODERR                            ;51-DOWNLOAD FORMAT ERROR
F8B6 E656             (        cubix.asm):01489                 FDB     FILERR                            ;52-ISSUE ERROR MSG(Y) FOR SAVED FILE
                      (        cubix.asm):01490         ;* FILE I/O
F8B8 EE3C             (        cubix.asm):01491                 FDB     BLOAD                             ;53-LOAD COMPLETE FILE TO MEMORY
F8BA EE71             (        cubix.asm):01492                 FDB     BSAVE                             ;54-SAVE COMPLETE FILE FROM MEMORY
F8BC E7FF             (        cubix.asm):01493                 FDB     OPENR                             ;55-OPEN A FILE FOR READ
F8BE E8DB             (        cubix.asm):01494                 FDB     OPENW                             ;56-OPEN A FILE FOR WRITE
F8C0 E963             (        cubix.asm):01495                 FDB     CLOSE                             ;57-CLOSE A FILE
F8C2 E86C             (        cubix.asm):01496                 FDB     READB                             ;58-READ BLOCK FROM FILE
F8C4 E821             (        cubix.asm):01497                 FDB     READC                             ;59-READ CHAR FROM FILE
F8C6 E925             (        cubix.asm):01498                 FDB     WRITEB                            ;60-WRITE A BLOCK TO FILE
F8C8 E8FE             (        cubix.asm):01499                 FDB     WRITEC                            ;61-WRITE A CHAR TO FILE
F8CA E8B6             (        cubix.asm):01500                 FDB     REWIND                            ;62-RESET FILE TO BEGINNING
F8CC E9B2             (        cubix.asm):01501                 FDB     SEEKREL                           ;63-SEEK RELATIVE POSITION IN FILE
F8CE E9AF             (        cubix.asm):01502                 FDB     SEEKABS                           ;64-SEEK ABSOLUTE LOCATION IN FILE
F8D0 EA00             (        cubix.asm):01503                 FDB     FTELL                             ;65-RETURN POSITION IN FILE
F8D2 EA2C             (        cubix.asm):01504                 FDB     SUSPEND                           ;66-SUSPEND FILE OPERATIONS
F8D4 EA7E             (        cubix.asm):01505                 FDB     RESUME                            ;67-RESUME FILE OPERATIONS
                      (        cubix.asm):01506         ;* FILE SYSTEM MAINTAINENCE
F8D6 E685             (        cubix.asm):01507                 FDB     LOCDIR                            ;68-LOCATE FILE IN DIRECTORY, NO ERROR/MESSAGE
F8D8 E64C             (        cubix.asm):01508                 FDB     LOCERR                            ;69-LOCATE FILE IN DIR/ISSUE ERROR IF NOT FOUND
F8DA E896             (        cubix.asm):01509                 FDB     LOCRED                            ;70-LOCATE FILE WITH INTENT TO READ
F8DC E8C4             (        cubix.asm):01510                 FDB     LOCWRI                            ;71-LOCATE FILE WITH INTENT TO WRITE
F8DE E717             (        cubix.asm):01511                 FDB     CREATE                            ;72-CREATE A FILE
F8E0 ED98             (        cubix.asm):01512                 FDB     DELETE                            ;73-DELETE A FILE
F8E2 F00C             (        cubix.asm):01513                 FDB     SETDEF                            ;74-SET DEFAULT DIRECTORY
F8E4 F01E             (        cubix.asm):01514                 FDB     SETCMD                            ;75-SET COMMAND DIRECTORY
F8E6 F669             (        cubix.asm):01515                 FDB     SELDRV                            ;76-SET CURRENT OS DRIVE
F8E8 E5D2             (        cubix.asm):01516                 FDB     FNDLNK                            ;77-LOCATE LINK FOR SECTOR
F8EA EE60             (        cubix.asm):01517                 FDB     LCHAIN                            ;78-LOAD CHAIN OF SECTOR TO MEMORY
F8EC E79D             (        cubix.asm):01518                 FDB     FRESEC                            ;79-ALLOCATE A FREE SECTOR
F8EE EDB1             (        cubix.asm):01519                 FDB     UNCHAIN                           ;80-RELEASE SECTOR CHAIN
F8F0 E708             (        cubix.asm):01520                 FDB     DRVSIZ                            ;81-CALCULATE SIZE OF DISK(A)
F8F2 E705             (        cubix.asm):01521                 FDB     CURSIZ                            ;82-CALCULATE SIZE OF CURRENT DISK
F8F4 F339             (        cubix.asm):01522                 FDB     CALFRE                            ;83-CALCULATE # FREE SECTORS ON DISK
F8F6 E5EF             (        cubix.asm):01523                 FDB     RDWRK                             ;84-READ WORK SECTOR INTO DOS
F8F8 E794             (        cubix.asm):01524                 FDB     CHGWRK                            ;85-INDICATE WORK SECTOR CHANGED
F8FA E626             (        cubix.asm):01525                 FDB     WRTST                             ;86-WRITE WORK SECTOR IF UPDATED
F8FC E62B             (        cubix.asm):01526                 FDB     WRWRK                             ;87-WRITE WORK SECTOR UNCONDITIONALLY
F8FE E616             (        cubix.asm):01527                 FDB     PURGE                             ;88-CLEAR WORK SECTOR & FORCE READ
F900 EAFC             (        cubix.asm):01528                 FDB     GETCTL1                           ;89-GET CONTROL BLOCK
F902 EAF9             (        cubix.asm):01529                 FDB     GETCTL                            ;90-GET CTRL BLK FOR SELECTED
F904 EAB2             (        cubix.asm):01530                 FDB     SECTOR                            ;91-SET UP CTRL-BLOCK FROM DISK ID
F906 EAD2             (        cubix.asm):01531                 FDB     RDISK                             ;92-READ SECTOR(D) TO MEM(X) FROM DISK
F908 EB05             (        cubix.asm):01532                 FDB     WDISK                             ;93-WRITE SECTOR(D) FROM MEM(X) TO DISK
F90A E6A9             (        cubix.asm):01533                 FDB     DISDIR                            ;94-DISPLAY DISK DIRECTORY
                      (        cubix.asm):01534         ;* DIRECT DISK ACCESS
F90C E004             (        cubix.asm):01535                 FDB     DOINIT                            ;95-INIT HARDWARE
F90E F6D0             (        cubix.asm):01536                 FDB     HOME                              ;96-HOME HEAD ON DISK
F910 F6DA             (        cubix.asm):01537                 FDB     RDSEC                             ;97-READ SECTOR FROM TRACK
F912 F6DE             (        cubix.asm):01538                 FDB     WRSEC                             ;98-WRITE SECTOR FROM TRACK
F914 F6CC             (        cubix.asm):01539                 FDB     FORMAT                            ;99-FORMAT DISK
                      (        cubix.asm):01540         ;* MISC DOS ROUTINES
F916 E1C0             (        cubix.asm):01541                 FDB     EXECMD                            ;100-EXECUTE DOS COMMAND
F918 E1B5             (        cubix.asm):01542                 FDB     TMPENT                            ;101-TEMPORARY DOS ENTRY
F91A F66F             (        cubix.asm):01543                 FDB     QVECT                             ;102-QUERY DEVICE VECTOR
F91C F679             (        cubix.asm):01544                 FDB     SVECT                             ;103-SET DEVICE VECTOR
F91E F10F             (        cubix.asm):01545                 FDB     SETFLG                            ;104-SET FLAG
F920 F115             (        cubix.asm):01546                 FDB     CLRFLG                            ;105-CLEAR FLAG
F922 F59A             (        cubix.asm):01547                 FDB     SAVPRM                            ;106-SET COMMAND FILE PARAMETERS
F924 F689             (        cubix.asm):01548                 FDB     MUL16                             ;107-16 BIT MULTIPLY (D=X*D)
F926 F6A9             (        cubix.asm):01549                 FDB     DIV16                             ;108-16 BIT DIVISION (X=X/D, D=REMAINDER)
F928 E08A             (        cubix.asm):01550                 FDB     DMPREG                            ;109-DISPLAY REGISTERS
F92A EF49             (        cubix.asm):01551                 FDB     DNLDEV                            ;110-DOWNLOAD FROM DEVICE
     006F             (        cubix.asm):01552         NUMSSR          EQU (*-SSRTAB)/2                  ;# SSR'S IMPLEMENTED
                      (        cubix.asm):01553         ;*
                      (        cubix.asm):01554         ;* HARDWARE DEPENDANT I/O DRIVERS
                      (        cubix.asm):01555         ;*
                      (        cubix.asm):01556                 IFDEF   nhyodyne
                      (        cubix.asm):01557                 INCLUDE ../nhyodyne/drivers.asm
                      (../nhyodyne/drive):00001         ;       TITLE   I/O DRIVERS
                      (../nhyodyne/drive):00002         ;***************************************************************
                      (../nhyodyne/drive):00003         ;*     Sample I/O drivers for the CUBIX operating system.      *
                      (../nhyodyne/drive):00004         ;*-------------------------------------------------------------*
                      (../nhyodyne/drive):00005         ;* The drivers are designed to deal with four 6551 type serial *
                      (../nhyodyne/drive):00006         ;* devices, and a 765 type floppy disk controller controlling  *
                      (../nhyodyne/drive):00007         ;* up to four standard 40 track single or double sided floppy  *
                      (../nhyodyne/drive):00008         ;* diskette drives.                                            *
                      (../nhyodyne/drive):00009         ;*-------------------------------------------------------------*
                      (../nhyodyne/drive):00010         ;* Although these drivers are fully functional and may be used *
                      (../nhyodyne/drive):00011         ;* in a port of the system, their primary purpose is intended  *
                      (../nhyodyne/drive):00012         ;* to be as an example of CUBIX to I/O driver interfaceing. As *
                      (../nhyodyne/drive):00013         ;* such the device control side of the drivers (Which will be  *
                      (../nhyodyne/drive):00014         ;* VERY system specific) has been kept very simple and easy to *
                      (../nhyodyne/drive):00015         ;* follow. In particular, no interrupt lines are used, and all *
                      (../nhyodyne/drive):00016         ;* I/O operations are accomplished via software polling.       *
                      (../nhyodyne/drive):00017         ;*-------------------------------------------------------------*
                      (../nhyodyne/drive):00018         ;*             Copyright 1983-2004 Dave Dunfield               *
                      (../nhyodyne/drive):00019         ;***************************************************************
                      (../nhyodyne/drive):00020         ;*
                      (../nhyodyne/drive):00021         ;* CUBIX SYSTEM ADDRESSES
                      (../nhyodyne/drive):00022         ;*
     E99F             (../nhyodyne/drive):00023         DRIVERS         EQU $E99F               FIRST FREE LOCATION IN ROM
                      (../nhyodyne/drive):00024         ;* $E99F FOR NO VDU, $E09F FOR VDU
                      (../nhyodyne/drive):00025         
                      (../nhyodyne/drive):00026         ;*
                      (../nhyodyne/drive):00027         ;* DISK CONTROL BLOCK FORMAT
                      (../nhyodyne/drive):00028         ;*
                      (../nhyodyne/drive):00029         ;       ORG     0
                      (../nhyodyne/drive):00030         ;DRIVE  RMB     1               DRIVE ID (ADDRESS)
                      (../nhyodyne/drive):00031         ;NCYL   RMB     1               NUMBER OF CYLINDERS
                      (../nhyodyne/drive):00032         ;NHEAD  RMB     1               NUMBER OF HEADS
                      (../nhyodyne/drive):00033         ;NSEC   RMB     1               NUMBER OF SECTORS/TRACK
                      (../nhyodyne/drive):00034         ;CYL    RMB     1               CURRENT CYLINDER
                      (../nhyodyne/drive):00035         ;HEAD   RMB     1               CURRENT HEAD
                      (../nhyodyne/drive):00036         ;SEC    RMB     1               CURRENT SECTOR
                      (../nhyodyne/drive):00037         ;*
                      (../nhyodyne/drive):00038         ;*
                      (../nhyodyne/drive):00039         ;* INITIALIZE SYSTEM HARDWARE. ON ENTRY 'Y'
                      (../nhyodyne/drive):00040         ;* POINTS TO SYSTEM TABLE TO BE FILLED IN.
                      (../nhyodyne/drive):00041         ;*
                      (../nhyodyne/drive):00042         ;* INITIALIZE CUBIX SYSTEM TABLE
F92C                  (../nhyodyne/drive):00043         HWINIT
F92C 8EFF09           (../nhyodyne/drive):00044                 LDX     #RITAB                            ;POINT TO OUR TABLE
F92F C667             (../nhyodyne/drive):00045                 LDB     #RISIZ                            ;SIZE OF TABLE
F931                  (../nhyodyne/drive):00046         HWIN1
F931 A680             (../nhyodyne/drive):00047                 LDA     ,X+                               ;GET A BYTE FROM TABLE
F933 A7A0             (../nhyodyne/drive):00048                 STA     ,Y+                               ;WRITE IT TO CUBIX RAM
F935 5A               (../nhyodyne/drive):00049                 DECB                                      ;REDUCE COUNT
F936 26F9             (../nhyodyne/drive):00050                 BNE     HWIN1                             ;MOVE ENTIRE TABLE
                      (../nhyodyne/drive):00051         
F938 BDF95A           (../nhyodyne/drive):00052                 JSR     SERIALINIT
F93B BDF987           (../nhyodyne/drive):00053                 JSR     PPIDE_INIT
                      (../nhyodyne/drive):00054         ;*      JSR     SETUPDRIVE
F93E 39               (../nhyodyne/drive):00055                 RTS
                      (../nhyodyne/drive):00056         
                      (../nhyodyne/drive):00057         ;* NULL DEVICE DRIVERS
F93F                  (../nhyodyne/drive):00058         RDNULL
F93F 86FF             (../nhyodyne/drive):00059                 LDA     #$FF                              ;INDICATE NO CHARACTER
F941                  (../nhyodyne/drive):00060         WRNULL
F941 39               (../nhyodyne/drive):00061                 RTS     IGNORE OPERATION
                      (../nhyodyne/drive):00062         
                      (../nhyodyne/drive):00063         ;*
                      (../nhyodyne/drive):00064         ;* FORMAT DISK ('U' POINTS TO DCB), INTERLEAVE FACTOR IN 'A'
                      (../nhyodyne/drive):00065         ;*
F942                  (../nhyodyne/drive):00066         DFORMAT
                      (../nhyodyne/drive):00067         ;*      LDAA    DRIVE,U                 ; GET DRIVE
                      (../nhyodyne/drive):00068         ;*      CMPA    #$01                    ; DRIVE B?
                      (../nhyodyne/drive):00069         ;*      BNE     NOTFDB                  ;
                      (../nhyodyne/drive):00070         ;*      JMP     FORMFL                  ; DIRECT ATTACHED FLOPPY FORMAT
                      (../nhyodyne/drive):00071         ;*NOTFDB:
F942 39               (../nhyodyne/drive):00072                 RTS
                      (../nhyodyne/drive):00073         
                      (../nhyodyne/drive):00074         ;*
                      (../nhyodyne/drive):00075         ;* HOME HEAD ON DRIVE ('U' POINTS TO DCB)
                      (../nhyodyne/drive):00076         ;*
F943                  (../nhyodyne/drive):00077         DHOME
                      (../nhyodyne/drive):00078         ;*      LDAA    DRIVE,U                 ; GET DRIVE
                      (../nhyodyne/drive):00079         ;*      CMPA    #$01                    ; DRIVE A?
                      (../nhyodyne/drive):00080         ;*      BNE     NOTHDB                  ;
                      (../nhyodyne/drive):00081         ;*      LDAA    #$00
                      (../nhyodyne/drive):00082         ;*      JMP     SETTRACK                ; DIRECT ATTACHED FLOPPY HOME
                      (../nhyodyne/drive):00083         ;*NOTHDB:
F943 8603             (../nhyodyne/drive):00084                 LDA     #$03                              ; HOME DISK
                      (../nhyodyne/drive):00085         ;       JSR     ECB_OUTCHAR             ;
                      (../nhyodyne/drive):00086         ;       LDA     DRIVE,U                 ; GET DRIVE
                      (../nhyodyne/drive):00087         ;       JSR     ECB_ENC_OUTCHAR         ; SEND TO Z80
F945 39               (../nhyodyne/drive):00088                 RTS
                      (../nhyodyne/drive):00089         
                      (../nhyodyne/drive):00090         
                      (../nhyodyne/drive):00091         ;*
                      (../nhyodyne/drive):00092         ;* READ A SECTOR, FROM DISK ('U' POINTS TO DCB) TO MEMORY(X)
                      (../nhyodyne/drive):00093         ;*
F946                  (../nhyodyne/drive):00094         DRDSEC
                      (../nhyodyne/drive):00095         ;*      JSR     SEGDISPLAY
                      (../nhyodyne/drive):00096         
F946 A6C4             (../nhyodyne/drive):00097                 LDA     DRIVE,U                           ; GET DRIVE
                      (../nhyodyne/drive):00098         ;*      CMPA    #$00                    ; DRIVE A?
                      (../nhyodyne/drive):00099         ;*      BNE     NOTRDA                  ;
                      (../nhyodyne/drive):00100         ;JMP    Z80RDRIVE               ; USE Z80 A:
                      (../nhyodyne/drive):00101         ;*NOTRDA
                      (../nhyodyne/drive):00102         ;*      CMPA    #$01                    ; DRIVE B?
                      (../nhyodyne/drive):00103         ;*      BNE     NOTRDB                  ;
                      (../nhyodyne/drive):00104         ;*      JMP     READFL                  ; USE DIRECT ATTACHED FLOPPY
                      (../nhyodyne/drive):00105         ;*NOTRDB
                      (../nhyodyne/drive):00106         ;*      CMPA    #$02                    ; DRIVE C?
                      (../nhyodyne/drive):00107         ;*      BNE     NOTRDC                  ;
                      (../nhyodyne/drive):00108         ;*      JMP     Z80RDRIVE               ; USE Z80 C:
                      (../nhyodyne/drive):00109         ;*NOTRDC
F948 8103             (../nhyodyne/drive):00110                 CMPA    #$03                              ; DRIVE D?
F94A 2603             (../nhyodyne/drive):00111                 BNE     NOTRDD                            ;
F94C 7EFA8C           (../nhyodyne/drive):00112                 JMP     IDE_READ_SECTOR                   ; USE DIRECT ATTACHED IDE
F94F                  (../nhyodyne/drive):00113         NOTRDD
F94F 39               (../nhyodyne/drive):00114                 RTS
                      (../nhyodyne/drive):00115         
                      (../nhyodyne/drive):00116         
                      (../nhyodyne/drive):00117         ;*
                      (../nhyodyne/drive):00118         ;* WRITE A SECTOR TO DISK ('U' POINTS TO DCB) FROM MEMORY(X)
                      (../nhyodyne/drive):00119         ;*
F950                  (../nhyodyne/drive):00120         DWRSEC
                      (../nhyodyne/drive):00121         ;*      JSR     SEGDISPLAY
F950 A6C4             (../nhyodyne/drive):00122                 LDA     DRIVE,U                           ; GET DRIVE
                      (../nhyodyne/drive):00123         ;*      CMPA    #$00                    ; DRIVE A?
                      (../nhyodyne/drive):00124         ;*      BNE     NOTWDA                  ;
                      (../nhyodyne/drive):00125         ;       JMP     Z80WDRIVE               ; USE Z80 A:
                      (../nhyodyne/drive):00126         ;*NOTWDA
                      (../nhyodyne/drive):00127         ;*      CMPA    #$01                    ; DRIVE B?
                      (../nhyodyne/drive):00128         ;*      BNE     NOTWDB                  ;
                      (../nhyodyne/drive):00129         ;*      JMP     WRITEFL                 ; USE DIRECT ATTACHED FLOPPY
                      (../nhyodyne/drive):00130         ;*NOTWDB
                      (../nhyodyne/drive):00131         ;*      CMPA    #$02                    ; DRIVE C?
                      (../nhyodyne/drive):00132         ;*      BNE     NOTWDC                  ;
                      (../nhyodyne/drive):00133         ;*      JMP     Z80WDRIVE               ; USE Z80 C:
                      (../nhyodyne/drive):00134         ;*NOTWDC
F952 8103             (../nhyodyne/drive):00135                 CMPA    #$03                              ; DRIVE D?
F954 2603             (../nhyodyne/drive):00136                 BNE     NOTWDD                            ;
F956 7EFAAC           (../nhyodyne/drive):00137                 JMP     IDE_WRITE_SECTOR                  ; USE DIRECT ATTACHED IDE
F959                  (../nhyodyne/drive):00138         NOTWDD
F959 39               (../nhyodyne/drive):00139                 RTS
                      (../nhyodyne/drive):00140         
                      (../nhyodyne/drive):00141         
                      (../nhyodyne/drive):00142                 INCLUDE ../nhyodyne/cubix_serial.asm
                      (../nhyodyne/cubix):00001         ;__SERIAL DRIVERS________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00002         ;
                      (../nhyodyne/cubix):00003         ;       CUBIX serial drivers for 6809 IO card
                      (../nhyodyne/cubix):00004         ;
                      (../nhyodyne/cubix):00005         ;       Entry points:
                      (../nhyodyne/cubix):00006         ;               SERIALINIT  - called during OS init
                      (../nhyodyne/cubix):00007         ;               RDSER1      - read a byte from serial port ('A' POINTS TO BYTE)
                      (../nhyodyne/cubix):00008         ;               WRSER1      - write a byte from serial port  ('A' POINTS TO BYTE)
                      (../nhyodyne/cubix):00009         ;________________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00010         ;
                      (../nhyodyne/cubix):00011         ;*
                      (../nhyodyne/cubix):00012         ;*        HARDWARE I/O ADDRESSES
                      (../nhyodyne/cubix):00013         ;*
                      (../nhyodyne/cubix):00014         ; UART 16C550 SERIAL
     FE68             (../nhyodyne/cubix):00015         UART0           EQU $FE68                         ; DATA IN/OUT
     FE69             (../nhyodyne/cubix):00016         UART1           EQU $FE69                         ; CHECK RX
     FE6A             (../nhyodyne/cubix):00017         UART2           EQU $FE6A                         ; INTERRUPTS
     FE6B             (../nhyodyne/cubix):00018         UART3           EQU $FE6B                         ; LINE CONTROL
     FE6C             (../nhyodyne/cubix):00019         UART4           EQU $FE6C                         ; MODEM CONTROL
     FE6D             (../nhyodyne/cubix):00020         UART5           EQU $FE6D                         ; LINE STATUS
     FE6E             (../nhyodyne/cubix):00021         UART6           EQU $FE6E                         ; MODEM STATUS
     FE6F             (../nhyodyne/cubix):00022         UART7           EQU $FE6F                         ; SCRATCH REG.
                      (../nhyodyne/cubix):00023         
                      (../nhyodyne/cubix):00024         
                      (../nhyodyne/cubix):00025         ;__SERIALINIT____________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00026         ;
                      (../nhyodyne/cubix):00027         ;       INITIALIZE SERIAL PORTS
                      (../nhyodyne/cubix):00028         ;________________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00029         ;
F95A                  (../nhyodyne/cubix):00030         SERIALINIT:
                      (../nhyodyne/cubix):00031         ; these are all set by CP/M prior to activating the 6809 card. If 6809 is the primary CPU, these need to be set
                      (../nhyodyne/cubix):00032         ;       LDA             #$80            ;
                      (../nhyodyne/cubix):00033         ;       STA             UART3           ; SET DLAB FLAG
                      (../nhyodyne/cubix):00034         ;       LDA             #12                     ; SET TO 12 = 9600 BAUD
                      (../nhyodyne/cubix):00035         ;       STA             UART0           ; save baud rate
                      (../nhyodyne/cubix):00036         ;       LDA             #00                     ;
                      (../nhyodyne/cubix):00037         ;       STA             UART1           ;
                      (../nhyodyne/cubix):00038         ;       LDA             #03                     ;
                      (../nhyodyne/cubix):00039         ;       STA             UART3           ; SET 8 BIT DATA, 1 STOPBIT
                      (../nhyodyne/cubix):00040         ;       STA             UART4           ;
F95A 39               (../nhyodyne/cubix):00041                 RTS
                      (../nhyodyne/cubix):00042         
                      (../nhyodyne/cubix):00043         
                      (../nhyodyne/cubix):00044         
                      (../nhyodyne/cubix):00045         ;__WRSER1________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00046         ;
                      (../nhyodyne/cubix):00047         ;       WRITE CHARACTER(A) TO UART
                      (../nhyodyne/cubix):00048         ;________________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00049         ;
F95B                  (../nhyodyne/cubix):00050         WRSER1
F95B 3404             (../nhyodyne/cubix):00051                 PSHS    B
                      (../nhyodyne/cubix):00052         !
F95D F6FE6D           (../nhyodyne/cubix):00053                 LDB     UART5                             ; READ LINE STATUS REGISTER
F960 C420             (../nhyodyne/cubix):00054                 ANDB    #$20                              ; TEST IF UART IS READY TO SEND (BIT 5)
F962 C100             (../nhyodyne/cubix):00055                 CMPB    #$00
F964 27F7             (../nhyodyne/cubix):00056                 BEQ     <                                 ; IF NOT REPEAT
F966 B7FE68           (../nhyodyne/cubix):00057                 STA     UART0                             ; THEN WRITE THE CHAR TO UART
F969 3584             (../nhyodyne/cubix):00058                 PULS    B,PC
                      (../nhyodyne/cubix):00059         
                      (../nhyodyne/cubix):00060         ;__RDSER1________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00061         ;
                      (../nhyodyne/cubix):00062         ;       READ CHARACTER FROM UART TO (A)
                      (../nhyodyne/cubix):00063         ;________________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00064         ;
F96B                  (../nhyodyne/cubix):00065         RDSER1
F96B B6FE6D           (../nhyodyne/cubix):00066                 LDA     UART5                             ; READ LINE STATUS REGISTER
F96E 8401             (../nhyodyne/cubix):00067                 ANDA    #$01                              ; TEST IF DATA IN RECEIVE BUFFER
F970 8100             (../nhyodyne/cubix):00068                 CMPA    #$00
F972 2706             (../nhyodyne/cubix):00069                 BEQ     RDSER1N                           ; NO DATA
F974 B6FE68           (../nhyodyne/cubix):00070                 LDA     UART0                             ; THEN READ THE CHAR FROM THE UART
F977 1A04             (../nhyodyne/cubix):00071                 ORCC    #%00000100                        ; SET 'Z'
F979 39               (../nhyodyne/cubix):00072                 RTS
F97A                  (../nhyodyne/cubix):00073         RDSER1N
F97A 86FF             (../nhyodyne/cubix):00074                 LDA     #$FF                              ;
F97C 39               (../nhyodyne/cubix):00075                 RTS                                       ;
                      (../nhyodyne/drive):00143                 INCLUDE ../nhyodyne/cubix_ide.asm
                      (../nhyodyne/cubix):00001         ;__IDE DRIVERS___________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00002         ;
                      (../nhyodyne/cubix):00003         ;       CUBIX IDE disk drivers for direct attached disk-io card
                      (../nhyodyne/cubix):00004         ;
                      (../nhyodyne/cubix):00005         ;       Entry points:
                      (../nhyodyne/cubix):00006         ;               PPIDE_INIT      - CALLED DURING OS INIT
                      (../nhyodyne/cubix):00007         ;               IDE_READ_SECTOR  - read a sector from drive  ('U' POINTS TO DCB, X TO MEMORY)
                      (../nhyodyne/cubix):00008         ;               IDE_WRITE_SECTOR - write a sector to drive   ('U' POINTS TO DCB, X TO MEMORY)
                      (../nhyodyne/cubix):00009         ;________________________________________________________________________________________________________________________________
                      (../nhyodyne/cubix):00010         ;
     FE60             (../nhyodyne/cubix):00011         PPIDE_PPI       = $FE60                           ; PORT A
                      (../nhyodyne/cubix):00012         ;
     FE60             (../nhyodyne/cubix):00013         PPIDELO         = PPIDE_PPI+0                     ; LSB
     FE61             (../nhyodyne/cubix):00014         PPIDEHI         = PPIDE_PPI+1                     ; MSB
     FE62             (../nhyodyne/cubix):00015         PPIDECNTRL      = PPIDE_PPI+2                     ; CONTROL SIGNALS
     FE63             (../nhyodyne/cubix):00016         PPIDEPPIC       = PPIDE_PPI+3                     ; CONTROL BYTE PPI 82C55
                      (../nhyodyne/cubix):00017         
     0001             (../nhyodyne/cubix):00018         PPIDE_A0_LINE   = $01                             ;DIRECT FROM 8255 TO IDE INTERFACE
     0002             (../nhyodyne/cubix):00019         PPIDE_A1_LINE   = $02                             ;DIRECT FROM 8255 TO IDE INTERFACE
     0004             (../nhyodyne/cubix):00020         PPIDE_A2_LINE   = $04                             ;DIRECT FROM 8255 TO IDE INTERFACE
     0008             (../nhyodyne/cubix):00021         PPIDE_CS0_LINE  = $08                             ;INVERTER BETWEEN 8255 AND IDE INTERFACE
     0010             (../nhyodyne/cubix):00022         PPIDE_CS1_LINE  = $10                             ;INVERTER BETWEEN 8255 AND IDE INTERFACE
     0020             (../nhyodyne/cubix):00023         PPIDE_WR_LINE   = $20                             ;INVERTER BETWEEN 8255 AND IDE INTERFACE
     0040             (../nhyodyne/cubix):00024         PPIDE_RD_LINE   = $40                             ;INVERTER BETWEEN 8255 AND IDE INTERFACE
     0080             (../nhyodyne/cubix):00025         PPIDE_RST_LINE  = $80                             ;INVERTER BETWEEN 8255 AND IDE INTERFACE
                      (../nhyodyne/cubix):00026         
     0008             (../nhyodyne/cubix):00027         PPIDE_DATA      = PPIDE_CS0_LINE
     0009             (../nhyodyne/cubix):00028         PPIDE_ERR       = PPIDE_CS0_LINE+PPIDE_A0_LINE
     000A             (../nhyodyne/cubix):00029         PPIDE_SEC_CNT   = PPIDE_CS0_LINE+PPIDE_A1_LINE
     000B             (../nhyodyne/cubix):00030         PPIDE_LBALOW    = PPIDE_CS0_LINE+PPIDE_A1_LINE+PPIDE_A0_LINE
     000C             (../nhyodyne/cubix):00031         PPIDE_LBAMID    = PPIDE_CS0_LINE+PPIDE_A2_LINE
     000D             (../nhyodyne/cubix):00032         PPIDE_LBAHI     = PPIDE_CS0_LINE+PPIDE_A2_LINE+PPIDE_A0_LINE
     000E             (../nhyodyne/cubix):00033         PPIDE_DEVICE    = PPIDE_CS0_LINE+PPIDE_A2_LINE+PPIDE_A1_LINE
     000F             (../nhyodyne/cubix):00034         PPIDE_COMMAND   = PPIDE_CS0_LINE+PPIDE_A2_LINE+PPIDE_A1_LINE+PPIDE_A0_LINE
     000F             (../nhyodyne/cubix):00035         PPIDE_STATUS    = PPIDE_CS0_LINE+PPIDE_A2_LINE+PPIDE_A1_LINE+PPIDE_A0_LINE
     0016             (../nhyodyne/cubix):00036         PPIDE_CONTROL   = PPIDE_CS1_LINE+PPIDE_A2_LINE+PPIDE_A1_LINE
     0017             (../nhyodyne/cubix):00037         PPIDE_ASTATUS   = PPIDE_CS1_LINE+PPIDE_A2_LINE+PPIDE_A1_LINE+PPIDE_A0_LINE
                      (../nhyodyne/cubix):00038         
                      (../nhyodyne/cubix):00039         
                      (../nhyodyne/cubix):00040         ;IDE COMMAND CONSTANTS.  THESE SHOULD NEVER CHANGE.
     0010             (../nhyodyne/cubix):00041         PPIDE_CMD_RECAL = $10
     0020             (../nhyodyne/cubix):00042         PPIDE_CMD_READ  = $20
     0030             (../nhyodyne/cubix):00043         PPIDE_CMD_WRITE = $30
     0091             (../nhyodyne/cubix):00044         PPIDE_CMD_INIT  = $91
     00EC             (../nhyodyne/cubix):00045         PPIDE_CMD_ID    = $EC
     00E0             (../nhyodyne/cubix):00046         PPIDE_CMD_SPINDOWN = $E0
     00E1             (../nhyodyne/cubix):00047         PPIDE_CMD_SPINUP = $E1
                      (../nhyodyne/cubix):00048         
                      (../nhyodyne/cubix):00049         
     0092             (../nhyodyne/cubix):00050         PPRD_IDE_8255   = %10010010                       ;IDE_8255_CTL OUT, IDE_8255_LSB/MSB INPUT
     0080             (../nhyodyne/cubix):00051         PPWR_IDE_8255   = %10000000                       ;ALL THREE PORTS OUTPUT
                      (../nhyodyne/cubix):00052         
                      (../nhyodyne/cubix):00053         ;ALLOCATE THE FOLLOWING DATA AREAS TO UNUSED RAM SPACE
F97D                  (../nhyodyne/cubix):00054         DEBCYLL:
F97D 00               (../nhyodyne/cubix):00055                 .BYTE   0                                 ; DEBLOCKED CYLINDER LSB
F97E                  (../nhyodyne/cubix):00056         DEBCYLM:
F97E 00               (../nhyodyne/cubix):00057                 .BYTE   0                                 ; DEBLOCKED CYLINDER MSB
F97F                  (../nhyodyne/cubix):00058         DEBSEHD:
F97F 00               (../nhyodyne/cubix):00059                 .BYTE   0                                 ; DEBLOCKED SECTOR AND HEAD (HS)
F980                  (../nhyodyne/cubix):00060         PPIDETMP:
F980 00               (../nhyodyne/cubix):00061                 .BYTE   0                                 ; TEMP
F981                  (../nhyodyne/cubix):00062         PPIDELOTMP:
F981 00               (../nhyodyne/cubix):00063                 .BYTE   0
F982                  (../nhyodyne/cubix):00064         PPIDECOMMAND:
F982 00               (../nhyodyne/cubix):00065                 .BYTE   0
F983                  (../nhyodyne/cubix):00066         PPIDETIMEOUT:
F983 0000             (../nhyodyne/cubix):00067                 .BYTE   $00,$00
F985                  (../nhyodyne/cubix):00068         PPIDEWORKVAR:
F985 0000             (../nhyodyne/cubix):00069                 .BYTE   $00,$00
     0400             (../nhyodyne/cubix):00070         HSTBUF          = $0400
                      (../nhyodyne/cubix):00071         
                      (../nhyodyne/cubix):00072         ;__PPIDE_INIT_________________________________________________________________________________________
                      (../nhyodyne/cubix):00073         ;
                      (../nhyodyne/cubix):00074         ;  INIT AND DISPLAY IDE INFO
                      (../nhyodyne/cubix):00075         ;____________________________________________________________________________________________________
                      (../nhyodyne/cubix):00076         ;
F987                  (../nhyodyne/cubix):00077         PPIDE_INIT:
F987 BDE57B           (../nhyodyne/cubix):00078                 JSR     LFCR                              ; AND CRLF
F98A BDE57B           (../nhyodyne/cubix):00079                 JSR     LFCR                              ; AND CRLF
F98D 8EFBD0           (../nhyodyne/cubix):00080                 LDX     #MESSAGE1
F990 BDE567           (../nhyodyne/cubix):00081                 JSR     WRSTR                             ; DO PROMPT
F993 BDE57B           (../nhyodyne/cubix):00082                 JSR     LFCR                              ; AND CRLF
F996 BDFA7E           (../nhyodyne/cubix):00083                 JSR     IDE_PPIDETECT                     ; TEST FOR PPI HARDWARE
F999 261A             (../nhyodyne/cubix):00084                 BNE     IDE_ABORT                         ; BAIL OUT IF NOT THERE
                      (../nhyodyne/cubix):00085         ;
F99B 8EFBD8           (../nhyodyne/cubix):00086                 LDX     #MESSAGE2
F99E BDE567           (../nhyodyne/cubix):00087                 JSR     WRSTR                             ; DO PROMPT
F9A1 CCFE60           (../nhyodyne/cubix):00088                 LDD     #PPIDE_PPI                        ; GET BASE PORT
F9A4 FDF985           (../nhyodyne/cubix):00089                 STD     PPIDEWORKVAR
F9A7 BDE538           (../nhyodyne/cubix):00090                 JSR     WRHEXW                            ; PRINT BASE PORT
                      (../nhyodyne/cubix):00091         ;
F9AA BDFAD1           (../nhyodyne/cubix):00092                 JSR     PPIDE_RESET                       ; RESET THE BUS
F9AD BDF9DB           (../nhyodyne/cubix):00093                 JSR     PPIDE_PROBE                       ; DETECT AN ATA DEVICE, ABORT IF NOT FOUND
F9B0 2503             (../nhyodyne/cubix):00094                 BCS     IDE_ABORT
F9B2 7EF9BE           (../nhyodyne/cubix):00095                 JMP     IDE_PRINT_INFO
F9B5                  (../nhyodyne/cubix):00096         IDE_ABORT:
F9B5 8EFBDF           (../nhyodyne/cubix):00097                 LDX     #MESSAGE3
F9B8 BDE567           (../nhyodyne/cubix):00098                 JSR     WRSTR                             ; DO PROMPT
F9BB 7EF9D7           (../nhyodyne/cubix):00099                 JMP     IDE_INITA
F9BE                  (../nhyodyne/cubix):00100         IDE_PRINT_INFO:
F9BE BDE57B           (../nhyodyne/cubix):00101                 JSR     LFCR                              ; AND CRLF
F9C1 8EFBEC           (../nhyodyne/cubix):00102                 LDX     #MESSAGE4
F9C4 BDE567           (../nhyodyne/cubix):00103                 JSR     WRSTR                             ; DO PROMPT
F9C7 8600             (../nhyodyne/cubix):00104                 LDA     #$00
F9C9 BDFA1C           (../nhyodyne/cubix):00105                 JSR     IDE_READ_INFO                     ; GET DRIVE INFO, ABORT IF ERROR
F9CC 8EFBFD           (../nhyodyne/cubix):00106                 LDX     #MESSAGE5
F9CF BDE567           (../nhyodyne/cubix):00107                 JSR     WRSTR                             ; DO PROMPT
F9D2 8601             (../nhyodyne/cubix):00108                 LDA     #$01
F9D4 BDFA1C           (../nhyodyne/cubix):00109                 JSR     IDE_READ_INFO                     ; GET DRIVE INFO, ABORT IF ERROR
F9D7                  (../nhyodyne/cubix):00110         IDE_INITA:
F9D7 BDE57B           (../nhyodyne/cubix):00111                 JSR     LFCR                              ; AND CRLF
F9DA 39               (../nhyodyne/cubix):00112                 RTS                                       ; DONE
                      (../nhyodyne/cubix):00113         ;
                      (../nhyodyne/cubix):00114         ;__PPIDE_PROBE_______________________________________________________________________________________
                      (../nhyodyne/cubix):00115         ;
                      (../nhyodyne/cubix):00116         ;  PROBE FOR IDE HARDWARE
                      (../nhyodyne/cubix):00117         ;____________________________________________________________________________________________________
                      (../nhyodyne/cubix):00118         ;
F9DB                  (../nhyodyne/cubix):00119         PPIDE_PROBE:
                      (../nhyodyne/cubix):00120         ;
                      (../nhyodyne/cubix):00121         ; BELOW TESTS FOR EXISTENCE OF AN IDE CONTROLLER ON THE
                      (../nhyodyne/cubix):00122         ; PPIDE INTERFACE.  WE WRITE A VALUE OF ZERO FIRST SO THAT
                      (../nhyodyne/cubix):00123         ; THE PPI BUS HOLD WILL RETURN A VALUE OF ZERO IF THERE IS
                      (../nhyodyne/cubix):00124         ; NOTHING CONNECTED TO PPI PORT A.  THEN WE READ THE STATUS
                      (../nhyodyne/cubix):00125         ; REGISTER.  IF AN IDE CONTROLLER IS THERE, IT SHOULD ALWAYS
                      (../nhyodyne/cubix):00126         ; RETURN SOMETHING OTHER THAN ZERO.  IF AN IDE CONTROLLER IS
                      (../nhyodyne/cubix):00127         ; THERE, THEN THE VALUE WRITTEN TO PPI PORT A IS IGNORED
                      (../nhyodyne/cubix):00128         ; BECAUSE THE WRITE SIGNAL IS NEVER PULSED.
                      (../nhyodyne/cubix):00129         
F9DB 8600             (../nhyodyne/cubix):00130                 LDA     #$00
F9DD B7FE60           (../nhyodyne/cubix):00131                 STA     PPIDELO                           ; PPI PORT A, DATALO
                      (../nhyodyne/cubix):00132         
F9E0 BDFAE8           (../nhyodyne/cubix):00133                 JSR     IDE_WAIT_NOT_BUSY                 ; WAIT FOR BUSY TO CLEAR
F9E3 2534             (../nhyodyne/cubix):00134                 BCS     PPIDE_PROBE_FAIL                  ; IF TIMEOUT, REPORT NO IDE PRESENT
F9E5 860F             (../nhyodyne/cubix):00135                 LDA     #PPIDE_STATUS                     ; GET STATUS
F9E7 BDFB6C           (../nhyodyne/cubix):00136                 JSR     IDE_READ
F9EA C440             (../nhyodyne/cubix):00137                 ANDB    #%01000000
F9EC C100             (../nhyodyne/cubix):00138                 CMPB    #$00
F9EE 2729             (../nhyodyne/cubix):00139                 BEQ     PPIDE_PROBE_FAIL                  ; IF NOT RDY BIT (BIT 6) THEN REPORT NO IDE PRESENT
                      (../nhyodyne/cubix):00140         
                      (../nhyodyne/cubix):00141         ; CHECK SIGNATURE
F9F0 860A             (../nhyodyne/cubix):00142                 LDA     #PPIDE_SEC_CNT
F9F2 BDFB6C           (../nhyodyne/cubix):00143                 JSR     IDE_READ
F9F5 C101             (../nhyodyne/cubix):00144                 CMPB    #$01
F9F7 2620             (../nhyodyne/cubix):00145                 BNE     PPIDE_PROBE_FAIL                  ; IF NOT '01' THEN REPORT NO IDE PRESENT
F9F9 860B             (../nhyodyne/cubix):00146                 LDA     #PPIDE_LBALOW
F9FB BDFB6C           (../nhyodyne/cubix):00147                 JSR     IDE_READ
F9FE C101             (../nhyodyne/cubix):00148                 CMPB    #$01
FA00 2617             (../nhyodyne/cubix):00149                 BNE     PPIDE_PROBE_FAIL                  ; IF NOT '01' THEN REPORT NO IDE PRESENT
FA02 860C             (../nhyodyne/cubix):00150                 LDA     #PPIDE_LBAMID
FA04 BDFB6C           (../nhyodyne/cubix):00151                 JSR     IDE_READ
FA07 C100             (../nhyodyne/cubix):00152                 CMPB    #$00
FA09 260E             (../nhyodyne/cubix):00153                 BNE     PPIDE_PROBE_FAIL                  ; IF NOT '00' THEN REPORT NO IDE PRESENT
FA0B 860D             (../nhyodyne/cubix):00154                 LDA     #PPIDE_LBAHI
FA0D BDFB6C           (../nhyodyne/cubix):00155                 JSR     IDE_READ
FA10 C100             (../nhyodyne/cubix):00156                 CMPB    #$00
FA12 2605             (../nhyodyne/cubix):00157                 BNE     PPIDE_PROBE_FAIL                  ; IF NOT '00' THEN REPORT NO IDE PRESENT
FA14 1CFE             (../nhyodyne/cubix):00158                 CLC
FA16 7EFA1B           (../nhyodyne/cubix):00159                 JMP     PPIDE_PROBE_SUCCESS
FA19                  (../nhyodyne/cubix):00160         PPIDE_PROBE_FAIL:
                      (../nhyodyne/cubix):00161         
FA19 1A01             (../nhyodyne/cubix):00162                 SEC
FA1B                  (../nhyodyne/cubix):00163         PPIDE_PROBE_SUCCESS:
FA1B 39               (../nhyodyne/cubix):00164                 RTS                                       ; DONE, NOTE THAT A=0 AND Z IS SET
                      (../nhyodyne/cubix):00165         
                      (../nhyodyne/cubix):00166         ;*__IDE_READ_INFO___________________________________________________________________________________
                      (../nhyodyne/cubix):00167         ;*
                      (../nhyodyne/cubix):00168         ;*  READ IDE INFORMATION
                      (../nhyodyne/cubix):00169         ;*      CARRY SET ON ERROR
                      (../nhyodyne/cubix):00170         ;*      A=MST/SLV
                      (../nhyodyne/cubix):00171         ;*____________________________________________________________________________________________________
FA1C                  (../nhyodyne/cubix):00172         IDE_READ_INFO:
                      (../nhyodyne/cubix):00173         ; SET DRIVE BIT
FA1C C60E             (../nhyodyne/cubix):00174                 LDB     #PPIDE_DEVICE
FA1E F7F982           (../nhyodyne/cubix):00175                 STB     PPIDECOMMAND
FA21 8401             (../nhyodyne/cubix):00176                 ANDA    #$01                              ; ONLY WANT THE 1 BIT (MST/SLV)
FA23 48               (../nhyodyne/cubix):00177                 ASLA                                      ; SHIFT 4
FA24 48               (../nhyodyne/cubix):00178                 ASLA                                      ;
FA25 48               (../nhyodyne/cubix):00179                 ASLA                                      ;
FA26 48               (../nhyodyne/cubix):00180                 ASLA                                      ;
FA27 8AE0             (../nhyodyne/cubix):00181                 ORA     #$E0                              ; E0=MST  F0=SLV
FA29 1F89             (../nhyodyne/cubix):00182                 TFR     A,B
FA2B 8600             (../nhyodyne/cubix):00183                 LDA     #$00
FA2D BDFB95           (../nhyodyne/cubix):00184                 JSR     IDE_WRITE
FA30 BDFAE8           (../nhyodyne/cubix):00185                 JSR     IDE_WAIT_NOT_BUSY                 ;MAKE SURE DRIVE IS READY
FA33 2537             (../nhyodyne/cubix):00186                 BCS     IDE_READ_INFO_ABORT
FA35 860F             (../nhyodyne/cubix):00187                 LDA     #PPIDE_COMMAND                    ;SELECT IDE REGISTER
FA37 B7F982           (../nhyodyne/cubix):00188                 STA     PPIDECOMMAND
FA3A CC00EC           (../nhyodyne/cubix):00189                 LDD     #PPIDE_CMD_ID
FA3D BDFB95           (../nhyodyne/cubix):00190                 JSR     IDE_WRITE                         ;ASK THE DRIVE TO READ IT
FA40 BDFB0F           (../nhyodyne/cubix):00191                 JSR     IDE_WAIT_DRQ                      ;WAIT UNTIL IT'S GOT THE DATA
FA43 2527             (../nhyodyne/cubix):00192                 BCS     IDE_READ_INFO_ABORT
FA45 8E0400           (../nhyodyne/cubix):00193                 LDX     #HSTBUF
FA48 BDFB3D           (../nhyodyne/cubix):00194                 JSR     IDE_READ_BUFFER                   ; GRAB THE 256 WORDS FROM THE BUFFER
FA4B 8EFC0E           (../nhyodyne/cubix):00195                 LDX     #MESSAGE6
FA4E BDE567           (../nhyodyne/cubix):00196                 JSR     WRSTR
FA51 B6047B           (../nhyodyne/cubix):00197                 LDA     HSTBUF+123
FA54 BDE54D           (../nhyodyne/cubix):00198                 JSR     WRHEX
FA57 B6047A           (../nhyodyne/cubix):00199                 LDA     HSTBUF+122
FA5A BDE54D           (../nhyodyne/cubix):00200                 JSR     WRHEX
FA5D B60479           (../nhyodyne/cubix):00201                 LDA     HSTBUF+121
FA60 BDE54D           (../nhyodyne/cubix):00202                 JSR     WRHEX
FA63 B60478           (../nhyodyne/cubix):00203                 LDA     HSTBUF+120
FA66 BDE54D           (../nhyodyne/cubix):00204                 JSR     WRHEX
FA69 7EFA78           (../nhyodyne/cubix):00205                 JMP     IDE_READ_INFO_OK
FA6C                  (../nhyodyne/cubix):00206         IDE_READ_INFO_ABORT:
FA6C 8EFBDF           (../nhyodyne/cubix):00207                 LDX     #MESSAGE3
FA6F BDE567           (../nhyodyne/cubix):00208                 JSR     WRSTR                             ;DO PROMPT
FA72 BDE57B           (../nhyodyne/cubix):00209                 JSR     LFCR                              ;AND CRLF
FA75 1A01             (../nhyodyne/cubix):00210                 SEC
FA77 39               (../nhyodyne/cubix):00211                 RTS                                       ;
FA78                  (../nhyodyne/cubix):00212         IDE_READ_INFO_OK:
FA78 BDE57B           (../nhyodyne/cubix):00213                 JSR     LFCR                              ; AND CRLF
FA7B 1CFE             (../nhyodyne/cubix):00214                 CLC
FA7D 39               (../nhyodyne/cubix):00215                 RTS
                      (../nhyodyne/cubix):00216         
                      (../nhyodyne/cubix):00217         
                      (../nhyodyne/cubix):00218         ;__IDE_PPIDETECT____________________________________________________________________________________
                      (../nhyodyne/cubix):00219         ;
                      (../nhyodyne/cubix):00220         ;  PROBE FOR PPI HARDWARE
                      (../nhyodyne/cubix):00221         ;____________________________________________________________________________________________________
                      (../nhyodyne/cubix):00222         ;
FA7E                  (../nhyodyne/cubix):00223         IDE_PPIDETECT:
                      (../nhyodyne/cubix):00224         ;
                      (../nhyodyne/cubix):00225         ; TEST FOR PPI EXISTENCE
                      (../nhyodyne/cubix):00226         ; WE SETUP THE PPI TO WRITE, THEN WRITE A VALUE OF ZERO
                      (../nhyodyne/cubix):00227         ; TO PORT A (DATALO), THEN READ IT BACK.  IF THE PPI IS THERE
                      (../nhyodyne/cubix):00228         ; THEN THE BUS HOLD CIRCUITRY WILL READ BACK THE ZERO. SINCE
                      (../nhyodyne/cubix):00229         ; WE ARE IN WRITE MODE, AN IDE CONTROLLER WILL NOT BE ABLE TO
                      (../nhyodyne/cubix):00230         ; INTERFERE WITH THE VALUE BEING READ.
FA7E BDFBC2           (../nhyodyne/cubix):00231                 JSR     SET_PPI_WR
                      (../nhyodyne/cubix):00232         ;
FA81 8600             (../nhyodyne/cubix):00233                 LDA     #$00                              ; VALUE ZERO
FA83 B7FE60           (../nhyodyne/cubix):00234                 STA     PPIDELO                           ; PUSH VALUE TO PORT
FA86 B6FE60           (../nhyodyne/cubix):00235                 LDA     PPIDELO                           ; GET PORT VALUE
FA89 8100             (../nhyodyne/cubix):00236                 CMPA    #$00
FA8B 39               (../nhyodyne/cubix):00237                 RTS                                       ; AND RETURN
                      (../nhyodyne/cubix):00238         ;
                      (../nhyodyne/cubix):00239         
                      (../nhyodyne/cubix):00240         
                      (../nhyodyne/cubix):00241         ;*__IDE_READ_SECTOR___________________________________________________________________________________
                      (../nhyodyne/cubix):00242         ;*
                      (../nhyodyne/cubix):00243         ;*  READ IDE SECTOR (IN LBA) INTO BUFFER
                      (../nhyodyne/cubix):00244         ;*
                      (../nhyodyne/cubix):00245         ;*____________________________________________________________________________________________________
FA8C                  (../nhyodyne/cubix):00246         IDE_READ_SECTOR:
FA8C BDFAE8           (../nhyodyne/cubix):00247                 JSR     IDE_WAIT_NOT_BUSY                 ;MAKE SURE DRIVE IS READY
FA8F 2518             (../nhyodyne/cubix):00248                 BCS     IDE_READ_SECTOR_ERROR             ; IF TIMEOUT, REPORT NO IDE PRESENT
FA91                  (../nhyodyne/cubix):00249         IDE_READ_SECTOR_1:
FA91 BDFC11           (../nhyodyne/cubix):00250                 JSR     IDE_SETUP_LBA                     ;TELL IT WHICH SECTOR WE WANT
FA94 860F             (../nhyodyne/cubix):00251                 LDA     #PPIDE_COMMAND                    ;SELECT IDE REGISTER
FA96 B7F982           (../nhyodyne/cubix):00252                 STA     PPIDECOMMAND
FA99 CC0020           (../nhyodyne/cubix):00253                 LDD     #PPIDE_CMD_READ
FA9C BDFB95           (../nhyodyne/cubix):00254                 JSR     IDE_WRITE                         ; ASK THE DRIVE TO READ IT
FA9F BDFB0F           (../nhyodyne/cubix):00255                 JSR     IDE_WAIT_DRQ                      ; WAIT UNTIL IT'S GOT THE DATA
FAA2 2505             (../nhyodyne/cubix):00256                 BCS     IDE_READ_SECTOR_ERROR             ; IF TIMEOUT, REPORT NO IDE PRESENT
FAA4 BDFB3D           (../nhyodyne/cubix):00257                 JSR     IDE_READ_BUFFER                   ; GRAB THE 256 WORDS FROM THE BUFFER
FAA7 4F               (../nhyodyne/cubix):00258                 CLRA                                      ; ZERO = 1 ON RETURN = OPERATION OK
FAA8 39               (../nhyodyne/cubix):00259                 RTS
FAA9                  (../nhyodyne/cubix):00260         IDE_READ_SECTOR_ERROR:
FAA9 8602             (../nhyodyne/cubix):00261                 LDA     #$02                              ; SET ERROR CONDITION
FAAB 39               (../nhyodyne/cubix):00262                 RTS
                      (../nhyodyne/cubix):00263         
                      (../nhyodyne/cubix):00264         ;*__IDE_WRITE_SECTOR__________________________________________________________________________________
                      (../nhyodyne/cubix):00265         ;*
                      (../nhyodyne/cubix):00266         ;*  WRITE IDE SECTOR (IN LBA) FROM BUFFER
                      (../nhyodyne/cubix):00267         ;*
                      (../nhyodyne/cubix):00268         ;*____________________________________________________________________________________________________
FAAC                  (../nhyodyne/cubix):00269         IDE_WRITE_SECTOR:
FAAC BDFAE8           (../nhyodyne/cubix):00270                 JSR     IDE_WAIT_NOT_BUSY                 ;MAKE SURE DRIVE IS READY
FAAF 251D             (../nhyodyne/cubix):00271                 BCS     IDE_WRITE_SECTOR_ERROR            ; IF TIMEOUT, REPORT NO IDE PRESENT
FAB1 BDFC11           (../nhyodyne/cubix):00272                 JSR     IDE_SETUP_LBA                     ;TELL IT WHICH SECTOR WE WANT
FAB4 860F             (../nhyodyne/cubix):00273                 LDA     #PPIDE_COMMAND
FAB6 B7F982           (../nhyodyne/cubix):00274                 STA     PPIDECOMMAND
FAB9 CC0030           (../nhyodyne/cubix):00275                 LDD     #PPIDE_CMD_WRITE
FABC BDFB95           (../nhyodyne/cubix):00276                 JSR     IDE_WRITE                         ;TELL DRIVE TO WRITE A SECTOR
FABF BDFB0F           (../nhyodyne/cubix):00277                 JSR     IDE_WAIT_DRQ                      ;WAIT UNIT IT WANTS THE DATA
FAC2 250A             (../nhyodyne/cubix):00278                 BCS     IDE_WRITE_SECTOR_ERROR            ; IF TIMEOUT, REPORT NO IDE PRESENT
FAC4 BDFB53           (../nhyodyne/cubix):00279                 JSR     IDE_WRITE_BUFFER                  ;GIVE THE DATA TO THE DRIVE
FAC7 BDFAE8           (../nhyodyne/cubix):00280                 JSR     IDE_WAIT_NOT_BUSY                 ;WAIT UNTIL THE WRITE IS COMPLETE
FACA 2502             (../nhyodyne/cubix):00281                 BCS     IDE_WRITE_SECTOR_ERROR            ; IF TIMEOUT, REPORT NO IDE PRESENT
FACC 4F               (../nhyodyne/cubix):00282                 CLRA                                      ; ZERO = 1 ON RETURN = OPERATION OK
FACD 39               (../nhyodyne/cubix):00283                 RTS
FACE                  (../nhyodyne/cubix):00284         IDE_WRITE_SECTOR_ERROR:
FACE 8602             (../nhyodyne/cubix):00285                 LDA     #$02
FAD0 39               (../nhyodyne/cubix):00286                 RTS
                      (../nhyodyne/cubix):00287         
                      (../nhyodyne/cubix):00288         ;*__PPIDE_RESET____________________________________________________________________________________
                      (../nhyodyne/cubix):00289         ;*
                      (../nhyodyne/cubix):00290         ;*  SOFT RESET IDE CHANNEL
                      (../nhyodyne/cubix):00291         ;*
                      (../nhyodyne/cubix):00292         ;*____________________________________________________________________________________________________
FAD1                  (../nhyodyne/cubix):00293         PPIDE_RESET:
                      (../nhyodyne/cubix):00294         ;       PRTDBG "IDE RESET$"
FAD1 8680             (../nhyodyne/cubix):00295                 LDA     #PPIDE_RST_LINE
FAD3 B7FE62           (../nhyodyne/cubix):00296                 STA     PPIDECNTRL                        ; ASSERT RST LINE ON IDE INTERFACE
                      (../nhyodyne/cubix):00297         
FAD6 108E0100         (../nhyodyne/cubix):00298                 LDY     #$0100
                      (../nhyodyne/cubix):00299         ;       PRTDBG "IDE RESET DELAY$"
FADA                  (../nhyodyne/cubix):00300         RST_DLY:
FADA 313F             (../nhyodyne/cubix):00301                 DEY
FADC 108C0000         (../nhyodyne/cubix):00302                 CMPY    #$0000
FAE0 26F8             (../nhyodyne/cubix):00303                 BNE     RST_DLY
FAE2 8600             (../nhyodyne/cubix):00304                 LDA     #$00
FAE4 B7FE62           (../nhyodyne/cubix):00305                 STA     PPIDECNTRL                        ; DEASSERT RST LINE ON IDE INTERFACE
                      (../nhyodyne/cubix):00306         
                      (../nhyodyne/cubix):00307         ; IF A DSKYNG IS ACTIVE AND IS ON THE SAME PPI PORT AS THE PPISDa:a BEING
                      (../nhyodyne/cubix):00308         ; RESET, THEN THE DSKYNG WILL ALSO BE RESET.  SO, THE DSKY IS ALSO INITIALIZED.
                      (../nhyodyne/cubix):00309         ;    IF      USEDSKYNG = 1
                      (../nhyodyne/cubix):00310         ;        JSR     DSKY_REINIT
                      (../nhyodyne/cubix):00311         ;        ENDC
                      (../nhyodyne/cubix):00312         
FAE7 39               (../nhyodyne/cubix):00313                 RTS
                      (../nhyodyne/cubix):00314         
                      (../nhyodyne/cubix):00315         
                      (../nhyodyne/cubix):00316         ;*__IDE_WAIT_NOT_BUSY_______________________________________________________________________________
                      (../nhyodyne/cubix):00317         ;*
                      (../nhyodyne/cubix):00318         ;*  WAIT FOR IDE CHANNEL TO BECOME READY
                      (../nhyodyne/cubix):00319         ;*
                      (../nhyodyne/cubix):00320         ;*____________________________________________________________________________________________________
FAE8                  (../nhyodyne/cubix):00321         IDE_WAIT_NOT_BUSY:
FAE8 3406             (../nhyodyne/cubix):00322                 PSHS    A,B
FAEA 8600             (../nhyodyne/cubix):00323                 LDA     #$00
FAEC B7F983           (../nhyodyne/cubix):00324                 STA     PPIDETIMEOUT
FAEF B7F984           (../nhyodyne/cubix):00325                 STA     PPIDETIMEOUT+1
FAF2                  (../nhyodyne/cubix):00326         IDE_WAIT_NOT_BUSY1:
FAF2 860F             (../nhyodyne/cubix):00327                 LDA     #PPIDE_STATUS                     ;WAIT FOR RDY BIT TO BE SET
FAF4 BDFB6C           (../nhyodyne/cubix):00328                 JSR     IDE_READ
FAF7 C480             (../nhyodyne/cubix):00329                 ANDB    #$80
FAF9 270F             (../nhyodyne/cubix):00330                 BEQ     IDE_WAIT_NOT_BUSY2
FAFB 7CF983           (../nhyodyne/cubix):00331                 INC     PPIDETIMEOUT
FAFE 26F2             (../nhyodyne/cubix):00332                 BNE     IDE_WAIT_NOT_BUSY1
FB00 7CF984           (../nhyodyne/cubix):00333                 INC     PPIDETIMEOUT+1
FB03 26ED             (../nhyodyne/cubix):00334                 BNE     IDE_WAIT_NOT_BUSY1
FB05 1A01             (../nhyodyne/cubix):00335                 SEC
FB07 7EFB0C           (../nhyodyne/cubix):00336                 JMP     IDE_WAIT_NOT_BUSY3
FB0A                  (../nhyodyne/cubix):00337         IDE_WAIT_NOT_BUSY2:
FB0A 1CFE             (../nhyodyne/cubix):00338                 CLC
FB0C                  (../nhyodyne/cubix):00339         IDE_WAIT_NOT_BUSY3:
FB0C 3586             (../nhyodyne/cubix):00340                 PULS    PC,A,B
FB0E 39               (../nhyodyne/cubix):00341                 RTS
                      (../nhyodyne/cubix):00342         
                      (../nhyodyne/cubix):00343         ;*__IDE_WAIT_DRQ______________________________________________________________________________________
                      (../nhyodyne/cubix):00344         ;*
                      (../nhyodyne/cubix):00345         ;*      WAIT FOR THE DRIVE TO BE READY TO TRANSFER DATA.
                      (../nhyodyne/cubix):00346         ;*
                      (../nhyodyne/cubix):00347         ;*____________________________________________________________________________________________________
FB0F                  (../nhyodyne/cubix):00348         IDE_WAIT_DRQ:
FB0F 3426             (../nhyodyne/cubix):00349                 PSHS    A,B,Y
FB11 8600             (../nhyodyne/cubix):00350                 LDA     #$00
FB13 B7F983           (../nhyodyne/cubix):00351                 STA     PPIDETIMEOUT
FB16 B7F984           (../nhyodyne/cubix):00352                 STA     PPIDETIMEOUT+1
FB19                  (../nhyodyne/cubix):00353         IDE_WAIT_DRQ1:
FB19 860F             (../nhyodyne/cubix):00354                 LDA     #PPIDE_STATUS                     ;WAIT FOR DRQ BIT TO BE SET
FB1B BDFB6C           (../nhyodyne/cubix):00355                 JSR     IDE_READ
FB1E C488             (../nhyodyne/cubix):00356                 ANDB    #%10001000                        ; MASK OFF BUSY(7) AND DRQ(3)
FB20 C108             (../nhyodyne/cubix):00357                 CMPB    #%00001000                        ; WE WANT BUSY(7) TO BE 0 AND DRQ (3) TO BE 1
FB22 2715             (../nhyodyne/cubix):00358                 BEQ     IDE_WAIT_DRQ2
FB24 C401             (../nhyodyne/cubix):00359                 ANDB    #%00000001                        ; IS ERROR?
FB26 C101             (../nhyodyne/cubix):00360                 CMPB    #%00000001                        ;
FB28 270A             (../nhyodyne/cubix):00361                 BEQ     IDE_WAIT_DRQE
FB2A 7CF983           (../nhyodyne/cubix):00362                 INC     PPIDETIMEOUT
FB2D 26EA             (../nhyodyne/cubix):00363                 BNE     IDE_WAIT_DRQ1
FB2F 7CF984           (../nhyodyne/cubix):00364                 INC     PPIDETIMEOUT+1
FB32 26E5             (../nhyodyne/cubix):00365                 BNE     IDE_WAIT_DRQ1
FB34                  (../nhyodyne/cubix):00366         IDE_WAIT_DRQE:
FB34 1A01             (../nhyodyne/cubix):00367                 SEC
FB36 7EFB3B           (../nhyodyne/cubix):00368                 JMP     IDE_WAIT_DRQ3
FB39                  (../nhyodyne/cubix):00369         IDE_WAIT_DRQ2:
FB39 1CFE             (../nhyodyne/cubix):00370                 CLC
FB3B                  (../nhyodyne/cubix):00371         IDE_WAIT_DRQ3:
FB3B 35A6             (../nhyodyne/cubix):00372                 PULS    PC,A,B,Y
                      (../nhyodyne/cubix):00373         
                      (../nhyodyne/cubix):00374         
                      (../nhyodyne/cubix):00375         
                      (../nhyodyne/cubix):00376         ;*__IDE_READ_BUFFER___________________________________________________________________________________
                      (../nhyodyne/cubix):00377         ;*
                      (../nhyodyne/cubix):00378         ;*  READ IDE BUFFER LITTLE ENDIAN
                      (../nhyodyne/cubix):00379         ;*
                      (../nhyodyne/cubix):00380         ;*____________________________________________________________________________________________________
FB3D                  (../nhyodyne/cubix):00381         IDE_READ_BUFFER:
FB3D 108E0100         (../nhyodyne/cubix):00382                 LDY     #$0100                            ; INDEX
FB41                  (../nhyodyne/cubix):00383         IDEBUFRD:
FB41 8608             (../nhyodyne/cubix):00384                 LDA     #PPIDE_DATA
FB43 BDFB6F           (../nhyodyne/cubix):00385                 JSR     IDE_READ_NO_SETUP
FB46 E780             (../nhyodyne/cubix):00386                 STB     ,X+                               ; 'ID DRIVE' IDE RESPONSE IS LITTLE ENDIAN FORMAT
FB48 A780             (../nhyodyne/cubix):00387                 STA     ,X+                               ; 'ID DRIVE' IDE RESPONSE IS LITTLE ENDIAN FORMAT
FB4A 313F             (../nhyodyne/cubix):00388                 DEY
FB4C 108C0000         (../nhyodyne/cubix):00389                 CMPY    #$0000                            ;
FB50 26EF             (../nhyodyne/cubix):00390                 BNE     IDEBUFRD                          ;
FB52 39               (../nhyodyne/cubix):00391                 RTS                                       ;
                      (../nhyodyne/cubix):00392         
                      (../nhyodyne/cubix):00393         ;*__IDE_WRITE_BUFFER___________________________________________________________________________________
                      (../nhyodyne/cubix):00394         ;*
                      (../nhyodyne/cubix):00395         ;*  WRITE IDE BUFFER LITTLE ENDIAN
                      (../nhyodyne/cubix):00396         ;*
                      (../nhyodyne/cubix):00397         ;*____________________________________________________________________________________________________
FB53                  (../nhyodyne/cubix):00398         IDE_WRITE_BUFFER:
FB53 108E0100         (../nhyodyne/cubix):00399                 LDY     #$0100                            ; INDEX
FB57                  (../nhyodyne/cubix):00400         IDEBUFWT:
FB57 8608             (../nhyodyne/cubix):00401                 LDA     #PPIDE_DATA
FB59 B7F982           (../nhyodyne/cubix):00402                 STA     PPIDECOMMAND
FB5C E680             (../nhyodyne/cubix):00403                 LDB     ,X+                               ; SECTORS ARE BIG ENDIAN
FB5E A680             (../nhyodyne/cubix):00404                 LDA     ,X+                               ; SECTORS ARE BIG ENDIAN
FB60 313F             (../nhyodyne/cubix):00405                 DEY                                       ;
FB62 BDFB95           (../nhyodyne/cubix):00406                 JSR     IDE_WRITE
FB65 108C0000         (../nhyodyne/cubix):00407                 CMPY    #$0000                            ;
FB69 26EC             (../nhyodyne/cubix):00408                 BNE     IDEBUFWT                          ;
FB6B 39               (../nhyodyne/cubix):00409                 RTS                                       ;
                      (../nhyodyne/cubix):00410         
                      (../nhyodyne/cubix):00411         
                      (../nhyodyne/cubix):00412         ;-------------------------------------------------------------------------------
                      (../nhyodyne/cubix):00413         
                      (../nhyodyne/cubix):00414         ; LOW LEVEL I/O TO THE DRIVE.  THESE ARE THE ROUTINES THAT TALK
                      (../nhyodyne/cubix):00415         ; DIRECTLY TO THE DRIVE, VIA THE 8255 CHIP.  NORMALLY A MAIN
                      (../nhyodyne/cubix):00416         ; PROGRAM WOULD NOT CALL TO THESE.
                      (../nhyodyne/cubix):00417         
                      (../nhyodyne/cubix):00418         ;DO A READ BUS CYCLE TO THE DRIVE, USING THE 8255.
                      (../nhyodyne/cubix):00419         ;INPUT A = IDE REGSITER ADDRESS
                      (../nhyodyne/cubix):00420         ;OUTPUT D = WORD READ FROM IDE DRIVE
FB6C                  (../nhyodyne/cubix):00421         IDE_READ:
FB6C BDFBB4           (../nhyodyne/cubix):00422                 JSR     SET_PPI_RD                        ; SETUP FOR A READ CYCLE
FB6F                  (../nhyodyne/cubix):00423         IDE_READ_NO_SETUP:
FB6F B7FE62           (../nhyodyne/cubix):00424                 STA     PPIDECNTRL                        ;DRIVE ADDRESS ONTO CONTROL LINES
FB72 8A40             (../nhyodyne/cubix):00425                 ORA     #PPIDE_RD_LINE                    ; ASSERT RD PIN
FB74 B7FE62           (../nhyodyne/cubix):00426                 STA     PPIDECNTRL
FB77 3402             (../nhyodyne/cubix):00427                 PSHS    A
FB79 F6FE60           (../nhyodyne/cubix):00428                 LDB     PPIDELO                           ; READ LOWER BYTE
FB7C B6FE61           (../nhyodyne/cubix):00429                 LDA     PPIDEHI                           ; READ UPPER BYTE
FB7F B7F981           (../nhyodyne/cubix):00430                 STA     PPIDELOTMP
FB82 3502             (../nhyodyne/cubix):00431                 PULS    A                                 ; RESTORE REGISTER VALUE
FB84 B7FE62           (../nhyodyne/cubix):00432                 STA     PPIDECNTRL                        ;DRIVE ADDRESS ONTO CONTROL LINES
FB87 8840             (../nhyodyne/cubix):00433                 EORA    #PPIDE_RD_LINE                    ; ASSERT RD PIN
FB89 B7FE62           (../nhyodyne/cubix):00434                 STA     PPIDECNTRL
FB8C 8600             (../nhyodyne/cubix):00435                 LDA     #$00
FB8E B7FE62           (../nhyodyne/cubix):00436                 STA     PPIDECNTRL                        ;DEASSERT ALL CONTROL PINS
FB91 B6F981           (../nhyodyne/cubix):00437                 LDA     PPIDELOTMP
FB94 39               (../nhyodyne/cubix):00438                 RTS
                      (../nhyodyne/cubix):00439         
                      (../nhyodyne/cubix):00440         
                      (../nhyodyne/cubix):00441         
                      (../nhyodyne/cubix):00442         ;DO A WRITE BUS CYCLE TO THE DRIVE, VIA THE 8255
                      (../nhyodyne/cubix):00443         ;INPUT PPIDECOMMAND = IDE REGISTER ADDRESS
                      (../nhyodyne/cubix):00444         ;INPUT REGISTER D = WORD TO WRITE
                      (../nhyodyne/cubix):00445         ;
                      (../nhyodyne/cubix):00446         
FB95                  (../nhyodyne/cubix):00447         IDE_WRITE:
FB95 BDFBC2           (../nhyodyne/cubix):00448                 JSR     SET_PPI_WR                        ; SETUP FOR A WRITE CYCLE
FB98 F7FE60           (../nhyodyne/cubix):00449                 STB     PPIDELO                           ; WRITE LOWER BYTE
FB9B B7FE61           (../nhyodyne/cubix):00450                 STA     PPIDEHI                           ; WRITE UPPER BYTE
FB9E B6F982           (../nhyodyne/cubix):00451                 LDA     PPIDECOMMAND
FBA1 B7FE62           (../nhyodyne/cubix):00452                 STA     PPIDECNTRL                        ;DRIVE ADDRESS ONTO CONTROL LINES
FBA4 8A20             (../nhyodyne/cubix):00453                 ORA     #PPIDE_WR_LINE                    ; ASSERT WRITE PIN
FBA6 B7FE62           (../nhyodyne/cubix):00454                 STA     PPIDECNTRL
FBA9 8820             (../nhyodyne/cubix):00455                 EORA    #PPIDE_WR_LINE                    ; DE ASSERT WR PIN
FBAB B7FE62           (../nhyodyne/cubix):00456                 STA     PPIDECNTRL
FBAE 8600             (../nhyodyne/cubix):00457                 LDA     #$00
FBB0 B7FE62           (../nhyodyne/cubix):00458                 STA     PPIDECNTRL                        ;DEASSERT ALL CONTROL PINS
FBB3 39               (../nhyodyne/cubix):00459                 RTS
                      (../nhyodyne/cubix):00460         
                      (../nhyodyne/cubix):00461         
                      (../nhyodyne/cubix):00462         ;-----------------------------------------------------------------------------------
                      (../nhyodyne/cubix):00463         ; PPI SETUP ROUTINE TO CONFIGURE THE APPROPRIATE PPI MODE
                      (../nhyodyne/cubix):00464         ;
                      (../nhyodyne/cubix):00465         ;------------------------------------------------------------------------------------
                      (../nhyodyne/cubix):00466         
FBB4                  (../nhyodyne/cubix):00467         SET_PPI_RD:
FBB4 3402             (../nhyodyne/cubix):00468                 PSHS    A
FBB6 8600             (../nhyodyne/cubix):00469                 LDA     #$00
FBB8 B7FE62           (../nhyodyne/cubix):00470                 STA     PPIDECNTRL                        ;DEASSERT ALL CONTROL PINS
FBBB 8692             (../nhyodyne/cubix):00471                 LDA     #PPRD_IDE_8255
FBBD B7FE63           (../nhyodyne/cubix):00472                 STA     PPIDEPPIC                         ;CONFIG 8255 CHIP, READ MODE
FBC0 3582             (../nhyodyne/cubix):00473                 PULS    A,PC
                      (../nhyodyne/cubix):00474         
FBC2                  (../nhyodyne/cubix):00475         SET_PPI_WR:
FBC2 3402             (../nhyodyne/cubix):00476                 PSHS    A
FBC4 8600             (../nhyodyne/cubix):00477                 LDA     #$00
FBC6 B7FE62           (../nhyodyne/cubix):00478                 STA     PPIDECNTRL                        ;DEASSERT ALL CONTROL PINS
FBC9 8680             (../nhyodyne/cubix):00479                 LDA     #PPWR_IDE_8255
FBCB B7FE63           (../nhyodyne/cubix):00480                 STA     PPIDEPPIC                         ;CONFIG 8255 CHIP, WRITE MODE
FBCE 3582             (../nhyodyne/cubix):00481                 PULS    A,PC
                      (../nhyodyne/cubix):00482         
                      (../nhyodyne/cubix):00483         
FBD0                  (../nhyodyne/cubix):00484         MESSAGE1
FBD0 5050494445203A   (../nhyodyne/cubix):00485                 FCC     "PPIDE :"
FBD7 00               (../nhyodyne/cubix):00486                 FCB     00
FBD8                  (../nhyodyne/cubix):00487         MESSAGE2
FBD8 20494F3D3078     (../nhyodyne/cubix):00488                 FCC     " IO=0x"
FBDE 00               (../nhyodyne/cubix):00489                 FCB     00
FBDF                  (../nhyodyne/cubix):00490         MESSAGE3
FBDF 204E4F5420505245 (../nhyodyne/cubix):00491                 FCC     " NOT PRESENT"
     53454E54
FBEB 00               (../nhyodyne/cubix):00492                 FCB     00
FBEC                  (../nhyodyne/cubix):00493         MESSAGE4
FBEC 205050494445303A (../nhyodyne/cubix):00494                 FCC     " PPIDE0: BLOCKS="
     20424C4F434B533D
FBFC 00               (../nhyodyne/cubix):00495                 FCB     00
FBFD                  (../nhyodyne/cubix):00496         MESSAGE5
FBFD 205050494445313A (../nhyodyne/cubix):00497                 FCC     " PPIDE1: BLOCKS="
     20424C4F434B533D
FC0D 00               (../nhyodyne/cubix):00498                 FCB     00
FC0E                  (../nhyodyne/cubix):00499         MESSAGE6
FC0E 3078             (../nhyodyne/cubix):00500                 FCC     "0x"
FC10 00               (../nhyodyne/cubix):00501                 FCB     00
                      (../nhyodyne/cubix):00502         
                      (../nhyodyne/cubix):00503         
                      (../nhyodyne/cubix):00504         ;*__IDE_SETUP_LBA_____________________________________________________________________________________
                      (../nhyodyne/cubix):00505         ;*
                      (../nhyodyne/cubix):00506         ;*
                      (../nhyodyne/cubix):00507         ;        SETUP   LBA DATA
                      (../nhyodyne/cubix):00508         ;*
                      (../nhyodyne/cubix):00509         ;*____________________________________________________________________________________________________
FC11                  (../nhyodyne/cubix):00510         IDE_SETUP_LBA:
FC11 3406             (../nhyodyne/cubix):00511                 PSHS    D
                      (../nhyodyne/cubix):00512         ;            IF      USEDSKYNG = 1
                      (../nhyodyne/cubix):00513         ;       PRTDBG "DSKY OUTPUT 1$"
                      (../nhyodyne/cubix):00514         ;                LDA     CURDRV
                      (../nhyodyne/cubix):00515         ;                STA     DSKY_HEXBUF
                      (../nhyodyne/cubix):00516         ;                LDA     HEAD,U
                      (../nhyodyne/cubix):00517         ;                STA     DSKY_HEXBUF+1
                      (../nhyodyne/cubix):00518         ;                LDA     CYL,U
                      (../nhyodyne/cubix):00519         ;                STA     DSKY_HEXBUF+2
                      (../nhyodyne/cubix):00520         ;                LDA     SEC,U
                      (../nhyodyne/cubix):00521         ;                STA     DSKY_HEXBUF+3
                      (../nhyodyne/cubix):00522         ;                JSR     DSKY_BIN2SEG
                      (../nhyodyne/cubix):00523         ;                JSR     DSKY_SHOW
                      (../nhyodyne/cubix):00524         ;                ENDC
FC13 860E             (../nhyodyne/cubix):00525                 LDA     #PPIDE_DEVICE
FC15 B7F982           (../nhyodyne/cubix):00526                 STA     PPIDECOMMAND
FC18 8600             (../nhyodyne/cubix):00527                 LDA     #$00
FC1A E6C4             (../nhyodyne/cubix):00528                 LDB     DRIVE,U
FC1C C401             (../nhyodyne/cubix):00529                 ANDB    #$01                              ; only want drive cfg
FC1E 58               (../nhyodyne/cubix):00530                 ASLB                                      ; SHIFT 4
FC1F 58               (../nhyodyne/cubix):00531                 ASLB                                      ;
FC20 58               (../nhyodyne/cubix):00532                 ASLB                                      ;
FC21 58               (../nhyodyne/cubix):00533                 ASLB                                      ;
FC22 CAE0             (../nhyodyne/cubix):00534                 ORB     #$E0                              ; E0=MST  F0=SLV
FC24 BDFB95           (../nhyodyne/cubix):00535                 JSR     IDE_WRITE
                      (../nhyodyne/cubix):00536         
FC27 860D             (../nhyodyne/cubix):00537                 LDA     #PPIDE_LBAHI
FC29 B7F982           (../nhyodyne/cubix):00538                 STA     PPIDECOMMAND
FC2C 8600             (../nhyodyne/cubix):00539                 LDA     #$00
FC2E E645             (../nhyodyne/cubix):00540                 LDB     HEAD,U
FC30 BDFB95           (../nhyodyne/cubix):00541                 JSR     IDE_WRITE
                      (../nhyodyne/cubix):00542         
FC33 860C             (../nhyodyne/cubix):00543                 LDA     #PPIDE_LBAMID
FC35 B7F982           (../nhyodyne/cubix):00544                 STA     PPIDECOMMAND
FC38 8600             (../nhyodyne/cubix):00545                 LDA     #$00
FC3A E644             (../nhyodyne/cubix):00546                 LDB     CYL,U                             ;
FC3C BDFB95           (../nhyodyne/cubix):00547                 JSR     IDE_WRITE
                      (../nhyodyne/cubix):00548         
FC3F 860B             (../nhyodyne/cubix):00549                 LDA     #PPIDE_LBALOW
FC41 B7F982           (../nhyodyne/cubix):00550                 STA     PPIDECOMMAND
FC44 8600             (../nhyodyne/cubix):00551                 LDA     #$00
FC46 E646             (../nhyodyne/cubix):00552                 LDB     SEC,U                             ;
FC48 BDFB95           (../nhyodyne/cubix):00553                 JSR     IDE_WRITE
                      (../nhyodyne/cubix):00554         
FC4B 860A             (../nhyodyne/cubix):00555                 LDA     #PPIDE_SEC_CNT
FC4D B7F982           (../nhyodyne/cubix):00556                 STA     PPIDECOMMAND
FC50 8600             (../nhyodyne/cubix):00557                 LDA     #$00
FC52 C601             (../nhyodyne/cubix):00558                 LDB     #$01
FC54 BDFB95           (../nhyodyne/cubix):00559                 JSR     IDE_WRITE
FC57 3586             (../nhyodyne/cubix):00560                 PULS    D,PC
                      (../nhyodyne/drive):00144         ;*      include CUBIXOS\CUBFLP.asm      FLOPPY I/O DRIVERS
                      (../nhyodyne/drive):00145         ;*      include CUBIXOS\CUBDSKY.asm     DSKY I/O DRIVERS
                      (../nhyodyne/drive):00146         ;*      include CUBIXOS\CUBVDU.asm      DSKY VDU DRIVERS
                      (../nhyodyne/drive):00147         
                      (../nhyodyne/drive):00148         
                      (../nhyodyne/drive):00149         
                      (../nhyodyne/drive):00150                 ORG     $FF00
                      (../nhyodyne/drive):00151         ;
                      (../nhyodyne/drive):00152         ; DISK COMMAND BLOCK
                      (../nhyodyne/drive):00153         ;
                      (../nhyodyne/drive):00154         ;* IGNORE ANY UNUSED INTERRUPTS
FF00                  (../nhyodyne/drive):00155         IGNORE
FF00 3B               (../nhyodyne/drive):00156                 RTI
                      (../nhyodyne/drive):00157         ;* RESULT CODES FOR FDC OPERATIONS
FF01                  (../nhyodyne/drive):00158         RESTAB
FF01 0300020000030401 (../nhyodyne/drive):00159                 FCB     3,0,2,0,0,3,4,1
                      (../nhyodyne/drive):00160         ;*
                      (../nhyodyne/drive):00161         ;* INITIALIZATION TABLE FOR CUBIX RAM
                      (../nhyodyne/drive):00162         ;*
     FF09             (../nhyodyne/drive):00163         RITAB           EQU *
                      (../nhyodyne/drive):00164         ;* DEFAULT DRIVE CHARACTISTICS
FF09 00500209000000   (../nhyodyne/drive):00165                 FCB     0,80,2,9,0,0,0                    ;ADR 0, 80 CYL, 2 HEAD, 9 SEC/TRK
FF10 01FF01FF000000   (../nhyodyne/drive):00166                 FCB     1,255,1,255,0,0,0                 ;ADR 1, 255 CYL, 1 HEAD, 255 SEC/TRK
FF17 02FF01FF000000   (../nhyodyne/drive):00167                 FCB     2,255,1,255,0,0,0                 ;ADR 2, 255 CYL, 1 HEAD, 255 SEC/TRK
FF1E 03FF01FF000000   (../nhyodyne/drive):00168                 FCB     3,255,1,255,0,0,0                 ;ADR 4, 255 CYL, 1 HEAD, 255 SEC/TRK
                      (../nhyodyne/drive):00169         ;* CONSOLE DEVICE ASSIGNMENTS
FF25 01               (../nhyodyne/drive):00170                 FCB     1                                 ;CONSOLE INPUT DEVICE
FF26 01               (../nhyodyne/drive):00171                 FCB     1                                 ;CONSOLE OUTPUT DEVICE
                      (../nhyodyne/drive):00172         ;* SERIAL DEVICE DRIVERS
FF27 F93FF96B00000000 (../nhyodyne/drive):00173                 FDB     RDNULL,RDSER1,0,0,0,0,0,0
     0000000000000000
FF37 F941F95B00000000 (../nhyodyne/drive):00174                 FDB     WRNULL,WRSER1,0,0,0,0,0,0
     0000000000000000
                      (../nhyodyne/drive):00175         ;* DISK DEVICE DRIVERS
FF47 F943F946F950F942 (../nhyodyne/drive):00176                 FDB     DHOME,DRDSEC,DWRSEC,DFORMAT
                      (../nhyodyne/drive):00177         ;* 6809 HARDWARE VECTORS
FF4F E00B             (../nhyodyne/drive):00178                 FDB     SSR                               ;SWI VECTOR (USED FOR SSRS)
FF51 FF00             (../nhyodyne/drive):00179                 FDB     IGNORE                            ;SWI2 VECTOR
FF53 FF00             (../nhyodyne/drive):00180                 FDB     IGNORE                            ;SWI3 VECTOR
FF55 FF00             (../nhyodyne/drive):00181                 FDB     IGNORE                            ;IRQ  VECTOR
FF57 FF00             (../nhyodyne/drive):00182                 FDB     IGNORE                            ;FIRQ VECTOR
FF59 FF00             (../nhyodyne/drive):00183                 FDB     IGNORE                            ;NMI VECTOR
                      (../nhyodyne/drive):00184         ;* MISC FLAGS & VARIABLES
FF5B FF               (../nhyodyne/drive):00185                 FCB     $FF                               ;ERROR MESSAGES ENABLED
FF5C 00               (../nhyodyne/drive):00186                 FCB     0                                 ;TRACE DISABLED
FF5D 00               (../nhyodyne/drive):00187                 FCB     0                                 ;DEBUG DISABLED
FF5E 03               (../nhyodyne/drive):00188                 FCB     3                                 ;DEFAULT DRIVE (A)
FF5F 4D41494E         (../nhyodyne/drive):00189                 FCC     'MAIN'                            ;DEFAULT DIRECTORY
FF63 00000000         (../nhyodyne/drive):00190                 FCB     0,0,0,0                           ;(FILLER)
FF67 03               (../nhyodyne/drive):00191                 FCB     3                                 ;SYSTEM DRIVE (A)
FF68 53595354454D     (../nhyodyne/drive):00192                 FCC     'SYSTEM'                          ;SYSTEM DIRECTORY
FF6E 0000             (../nhyodyne/drive):00193                 FCB     0,0                               ;(FILLER)
     0067             (../nhyodyne/drive):00194         RISIZ           EQU *-RITAB                       ;SIZE OF INITILAIZED RAM
                      (../nhyodyne/drive):00195         ;
                      (        cubix.asm):01558                 ENDIF
                      (        cubix.asm):01559         ;*
                      (        cubix.asm):01560         ;* INTERRUPT VECTORS
                      (        cubix.asm):01561         ;*
                      (        cubix.asm):01562                 IFNDEF  test
                      (        cubix.asm):01563                 ORG     $FFF2                             ;VECTORS GO HERE
FFF2 F6EA             (        cubix.asm):01564                 FDB     SWI3
FFF4 F6E6             (        cubix.asm):01565                 FDB     SWI2
FFF6 F6F2             (        cubix.asm):01566                 FDB     FIRQ
FFF8 F6EE             (        cubix.asm):01567                 FDB     IRQ
FFFA F6E2             (        cubix.asm):01568                 FDB     SWI
FFFC F6F6             (        cubix.asm):01569                 FDB     NMI
FFFE E108             (        cubix.asm):01570                 FDB     BEGIN                             ;RESET - COLD START OF SYSTEM
                      (        cubix.asm):01571                 ENDIF

Symbol Table:
[ G] ATRTAB                           F080
[ G] BADCMD                           E247
[ G] BADDEV                           E5A7
[ G] BADOP1                           E3E6
[ G] BADOP2                           E389
[ G] BADOP3                           F075
[ G] BADOPM                           F719
[ G] BADOPR                           E2AB
[ G] BEGIN                            E108
[ G] BLOAD                            EE3C
[ G] BRET                             E34C
[ G] BSAVE                            EE71
[ G] CALFRE                           F339
[ G] CEND                             E333
[ G] CEXI                             F55A
[ G] CEXIT                            F549
[ G] CHAIN                            F5AB
[ G] CHGDRV                           F09B
[ G] CHGWRK                           E794
[ G] CLO0                             E978
[ G] CLO1                             E97C
[ G] CLO2                             E98B
[ G] CLO3                             E98F
[ G] CLO4                             E9A4
[ G] CLOC1                            E8CE
[ G] CLOC2                            E8D5
[ G] CLOSE                            E963
[ G] CLRFLG                           F115
[ G] CMD                              E180
[ G] CMDADR                           F832
[ G] CMDBUF                           DCED
[ G] CMDC1                            F5E5
[ G] CMDC2                            F5EF
[ G] CMDC3                            F5F9
[ G] CMDC4                            F5FD
[ G] CMDC5                            F607
[ G] CMDC6                            F608
[ G] CMDCMP                           F5DA
[ G] CMDDRV                           DCE1
[ G] CMDEOF                           F457
[ G] CMDEX                            F465
[ G] CMDGO                            E1B0
[ G] CMDIN                            F58B
[ G] CMDKEY                           F5CE
[ G] CMDNAM                           F7DC
[ G] CMDOFF                           DCE4
[ G] CMDRC                            DCE8
[ G] CMDRET                           F571
[ G] CMDRT0                           F574
[ G] CMDRT1                           F588
[ G] CMDRT2                           F60B
[ G] CMDSEC                           DCE2
[ G] CMDSKP                           F5B7
[ G] CMDSTK                           DCE6
[ G] CMPR                             F511
[ G] CMPR1                            F51E
[ G] CNC1                             EFD5
[ G] CNC2                             EFE6
[ G] CNCT                             EFCF
[ G] COMFIL                           F460
[ G] COMGO                            F475
[ G] COMNAM                           E316
[ G] COMX                             E335
[ G] CONIN                            DC6C
[ G] CONOUT                           DC6D
[ G] CRD1                             ED15
[ G] CRD2                             ED1B
[ G] CRE1                             E72C
[ G] CRE2                             E734
[ G] CRE3                             E739
[ G] CRE5                             E765
[ G] CRE6                             E76F
[ G] CRE7                             E777
[ G] CREAD                            ECFA
[ G] CREATE                           E717
[ G] CREF1                            ED92
[ G] CREFIL                           ED7E
[ G] CSIZE                            0007
[ G] CSRC                             F539
[ G] CURSIZ                           E705
[ G] CWR1                             ED45
[ G] CWR2                             ED4B
[ G] CWRITE                           ED2A
[ G] CYL                              0004
[ G] DATTR                            0017
[ G] DBGFLG                           DCA3
[ G] DBGSSR                           E040
[ G] DCTRL                            DC50
[ G] DDADR                            0013
[ G] DEBCYLL                          F97D
[ G] DEBCYLM                          F97E
[ G] DEBSEHD                          F97F
[ G] DECDIG                           E453
[ G] DEFATR                           00F0
[ G] DEFDIR                           DCA6
[ G] DEFDRV                           DCA5
[ G] DELETE                           ED98
[ G] DELFIL                           ED95
[ G] DETAB                            EB9B
[ G] DEVMSG                           F7B7
[ G] DFORMAT                          F942
[ G] DHOME                            F943
[ G] DIGOK                            E42C
[ G] DIRSEC                           0000
[ G] DISDIR                           E6A9
[ G] DISF1                            F34A
[ G] DISF2                            F350
[ G] DISF3                            F35B
[ G] DISF4                            F36C
[ G] DISP8                            E6F8
[ G] DISPX                            E6FA
[SG] dist                             0001
[ G] DITAB                            DC6E
[ G] DIV1                             F6B1
[ G] DIV16                            F6A9
[ G] DIV2                             F6B3
[ G] DIV3                             F6C8
[ G] DMPREG                           E08A
[ G] DMPREG1                          E08D
[ G] DNAME                            0008
[ G] DNL0                             EF14
[ G] DNL1                             EF4C
[ G] DNL2                             EF5F
[ G] DNL3                             EF8A
[ G] DNL4                             EFBB
[ G] DNLD                             EF01
[ G] DNLDEV                           EF49
[ G] DNLEND                           EF2E
[ G] DNLMSG                           F7C6
[ G] DNLRTS                           EEFF
[ G] DOINIT                           E004
[ G] DOSKCM                           E1B9
[ G] DOTAB                            DC7E
[ G] DPERM                            0010
[ G] DPREFIX                          0000
[ G] DRADR                            0015
[ G] DRDSEC                           F946
[ G] DRIVE                            0000
[ G] DRIVERS                          E99F
[ G] DRVSIZ                           E708
[ G] DSHFT                            E434
[ G] DTYPE                            0010
[ G] DWRSEC                           F950
[ G] EOF                              E8B1
[ G] EPERM                            0020
[ G] ERRCNT                           DCEC
[ G] ERRM1                            E2C3
[ G] ERRM2                            E2C8
[ G] ERRM3                            E2D9
[ G] ERRM4                            E2DE
[ G] ERRMRC                           E2B0
[ G] ERRRET                           E2EB
[ G] EX1                              F2A8
[ G] EX2                              F2AD
[ G] EX3                              F2B4
[ G] EX4                              F2BB
[ G] EX5                              F2C8
[ G] EX6                              F2D2
[ G] EX7                              F2DC
[ G] EX8                              F2DE
[ G] EX9                              F2F1
[ G] EXDCOM                           F55D
[ G] EXE                              E217
[ G] EXE1                             E22F
[ G] EXE2                             E232
[ G] EXE3                             E24E
[ G] EXE4                             E26F
[ G] EXE5                             E27B
[ G] EXECMD                           E1C0
[ G] EXIMSG                           F743
[ G] FDRIVE                           DCB7
[ G] FEXISTS                          E723
[ G] FIL1                             ED5F
[ G] FIL2                             ED7B
[ G] FILERR                           E656
[ G] FILES                            ED5A
[ G] FILFND                           E6A8
[ G] FIRQ                             F6F2
[ G] FIRQVEC                          DC9E
[ G] FNAME                            DCC0
[ G] FNDF1                            E7D4
[ G] FNDF2                            E7DD
[ G] FNDF3                            E7DF
[ G] FNDFRE                           E7CE
[ G] FNDLNK                           E5D2
[ G] FORMAT                           F6CC
[ G] FRES1                            E7BD
[ G] FRES2                            E7BF
[ G] FRESEC                           E79D
[ G] FTEL1                            EA0D
[ G] FTEL2                            EA1B
[ G] FTELL                            EA00
[ G] FTYPE                            DCC8
[ G] GETA1                            F064
[ G] GETA2                            F06E
[ G] GETA3                            F078
[ G] GETA4                            F07E
[ G] GETATR                           F061
[ G] GETBYT                           EFAF
[ G] GETCHR                           E5CD
[ G] GETCTL                           EAF9
[ G] GETCTL1                          EAFC
[ G] GETD1                            E3BB
[ G] GETD2                            E3C4
[ G] GETD3                            E3DA
[ G] GETD4                            E3E9
[ G] GETD5                            E3F0
[ G] GETDEC                           E449
[ G] GETDEV                           F0EF
[ G] GETDIR                           E3A3
[ G] GETDIR1                          E3A6
[ G] GETDRV                           E3F2
[ G] GETDRV1                          E3F5
[ G] GETDV                            E450
[ G] GETHEX                           E40F
[ G] GETHV                            E414
[ G] GETL1                            E417
[ G] GETN1                            EFCE
[ G] GETNAM                           E36A
[ G] GETNIB                           EFBC
[ G] GETNUM                           E404
[ G] GETSDI                           E310
[ G] GETSN0                           E28C
[ G] GETSN1                           E293
[ G] GETSN2                           E2A1
[ G] GETSNA                           E289
[ G] GETSYS                           E30D
[ G] GETVAL                           E363
[ G] GF1                              E36E
[ G] GF2                              E37F
[ G] GF3                              E38C
[ G] GFNAM                            E36C
[ G] GFTYP                            E37B
[ G] GLFCR                            E495
[ G] GLINE                            E498
[ G] GLINE1                           E4A1
[ G] GLINE2                           E4B2
[ G] GLINE3                           E4BD
[ G] GLNOP                            E49D
[ G] GOCMD                            F4FD
[ G] GOFLG                            F118
[ G] GOPAD                            E29E
[ G] GRTS                             E5EE
[ G] HDE                              EB2A
[ G] HDE1                             EB47
[ G] HDE2                             EB81
[ G] HDE3                             EB86
[ G] HDE4                             EB90
[ G] HEAD                             0005
[ G] HELLO                            E112
[ G] HEXEND                           E444
[ G] HOME                             F6D0
[ G] HOUT                             E55B
[ G] HSTBUF                           0400
[ G] HWIN1                            F931
[ G] HWINIT                           F92C
[ G] IDE_ABORT                        F9B5
[ G] IDE_INITA                        F9D7
[ G] IDE_PPIDETECT                    FA7E
[ G] IDE_PRINT_INFO                   F9BE
[ G] IDE_READ                         FB6C
[ G] IDE_READ_BUFFER                  FB3D
[ G] IDE_READ_INFO                    FA1C
[ G] IDE_READ_INFO_ABORT              FA6C
[ G] IDE_READ_INFO_OK                 FA78
[ G] IDE_READ_NO_SETUP                FB6F
[ G] IDE_READ_SECTOR                  FA8C
[ G] IDE_READ_SECTOR_1                FA91
[ G] IDE_READ_SECTOR_ERROR            FAA9
[ G] IDE_SETUP_LBA                    FC11
[ G] IDE_WAIT_DRQ                     FB0F
[ G] IDE_WAIT_DRQ1                    FB19
[ G] IDE_WAIT_DRQ2                    FB39
[ G] IDE_WAIT_DRQ3                    FB3B
[ G] IDE_WAIT_DRQE                    FB34
[ G] IDE_WAIT_NOT_BUSY                FAE8
[ G] IDE_WAIT_NOT_BUSY1               FAF2
[ G] IDE_WAIT_NOT_BUSY2               FB0A
[ G] IDE_WAIT_NOT_BUSY3               FB0C
[ G] IDE_WRITE                        FB95
[ G] IDE_WRITE_BUFFER                 FB53
[ G] IDE_WRITE_SECTOR                 FAAC
[ G] IDE_WRITE_SECTOR_ERROR           FACE
[ G] IDEBUFRD                         FB41
[ G] IDEBUFWT                         FB57
[ G] IGNORE                           FF00
[ G] INBUFF                           DC00
[ G] INI00                            EC03
[ G] INI01                            EC1D
[ G] INI02                            EC25
[ G] INI1                             EC30
[ G] INI10                            ECEC
[ G] INI2                             EC81
[ G] INI3                             EC9F
[ G] INI4                             ECAC
[ G] INI5                             ECB9
[ G] INI6                             ECC3
[ G] INI7                             ECCF
[ G] INI8                             ECD9
[ G] INI9                             ECE0
[ G] INIT                             EBF1
[ G] INITAB                           F3FB
[ G] INVSSR                           E05E
[ G] IOTAB                            F449
[ G] IPLFILE                          F6FA
[ G] IRAM                             DC50
[ G] IRQ                              F6EE
[ G] IRQVEC                           DC9C
[ G] LCHAIN                           EE60
[ G] LFCR                             E57B
[ G] LNKSEC                           0001
[ G] LOCCR                            F5C4
[ G] LOCDIR                           E685
[ G] LOCERR                           E64C
[ G] LOCFIL                           E691
[ G] LOCLP                            F5C0
[ G] LOCRED                           E896
[ G] LOCSEC                           E68E
[ G] LOCWRI                           E8C4
[ G] LODERR                           EFA1
[ G] LODF1                            EE5E
[ G] LODFIL                           EE48
[ G] MBASE                            E002
[ G] MESSAGE1                         FBD0
[ G] MESSAGE2                         FBD8
[ G] MESSAGE3                         FBDF
[ G] MESSAGE4                         FBEC
[ G] MESSAGE5                         FBFD
[ G] MESSAGE6                         FC0E
[ G] MOVD1                            F029
[ G] MOVDIR                           F023
[ G] MSGFLG                           DCA2
[ G] MUL16                            F689
[ G] MULD1                            EDCF
[ G] MULD2                            EDD2
[ G] MULD3                            EE2B
[ G] MULD4                            EE3B
[ G] MULD5                            EDF1
[ G] MULDEL                           EDCC
[ G] NAMGET                           E291
[ G] NCYL                             0001
[ G] NDEV                             0008
[ G] NDSK                             0004
[ G] NEWLIN                           F49E
[ G] NHEAD                            0002
[SG] nhyodyne                         0001
[ G] NMI                              F6F6
[ G] NMIVEC                           DCA0
[ G] NOEMSG                           E2E9
[ G] NOFMSG                           E67E
[ G] NOMAC                            F4D7
[ G] NOSHO                            E6B0
[ G] NOSMSG                           F757
[ G] NOSPAC                           E7C6
[ G] NOSUSP                           EEE3
[ G] NOTFND                           E650
[ G] NOTMSG                           F734
[ G] NOTNUL                           E323
[ G] NOTRDD                           F94F
[ G] NOTWDD                           F959
[ G] NSEC                             0003
[ G] NULCMD                           E1E9
[ G] NUMCMD                           000E
[ G] NUMFLG                           0003
[ G] NUMSSR                           006F
[ G] ODRIVE                           0001
[ G] OFIRST                           0002
[ G] OKRET                            EE70
[ G] OLDSTK                           DCE9
[ G] OLSTSEC                          0006
[ G] OOFFSET                          0008
[ G] OOTAB                            F441
[ G] OPENR                            E7FF
[ G] OPENW                            E8DB
[ G] OREMSG                           F76E
[ G] ORERR                            E8A9
[ G] OSECTOR                          0004
[ G] OSIZ                             000A
[ G] OTYPE                            0000
[ G] OWEMSG                           F785
[ G] OWERR                            E91D
[ G] PAD                              E39C
[ G] PAR1                             F4C1
[ G] PAR2                             F4C7
[ G] PAR3                             F4CE
[ G] PAROK                            F4BB
[ G] PPIDE_A0_LINE                    0001
[ G] PPIDE_A1_LINE                    0002
[ G] PPIDE_A2_LINE                    0004
[ G] PPIDE_ASTATUS                    0017
[ G] PPIDE_CMD_ID                     00EC
[ G] PPIDE_CMD_INIT                   0091
[ G] PPIDE_CMD_READ                   0020
[ G] PPIDE_CMD_RECAL                  0010
[ G] PPIDE_CMD_SPINDOWN               00E0
[ G] PPIDE_CMD_SPINUP                 00E1
[ G] PPIDE_CMD_WRITE                  0030
[ G] PPIDE_COMMAND                    000F
[ G] PPIDE_CONTROL                    0016
[ G] PPIDE_CS0_LINE                   0008
[ G] PPIDE_CS1_LINE                   0010
[ G] PPIDE_DATA                       0008
[ G] PPIDE_DEVICE                     000E
[ G] PPIDE_ERR                        0009
[ G] PPIDE_INIT                       F987
[ G] PPIDE_LBAHI                      000D
[ G] PPIDE_LBALOW                     000B
[ G] PPIDE_LBAMID                     000C
[ G] PPIDE_PPI                        FE60
[ G] PPIDE_PROBE                      F9DB
[ G] PPIDE_PROBE_FAIL                 FA19
[ G] PPIDE_PROBE_SUCCESS              FA1B
[ G] PPIDE_RD_LINE                    0040
[ G] PPIDE_RESET                      FAD1
[ G] PPIDE_RST_LINE                   0080
[ G] PPIDE_SEC_CNT                    000A
[ G] PPIDE_STATUS                     000F
[ G] PPIDE_WR_LINE                    0020
[ G] PPIDECNTRL                       FE62
[ G] PPIDECOMMAND                     F982
[ G] PPIDEHI                          FE61
[ G] PPIDELO                          FE60
[ G] PPIDELOTMP                       F981
[ G] PPIDEPPIC                        FE63
[ G] PPIDETIMEOUT                     F983
[ G] PPIDETMP                         F980
[ G] PPIDEWORKVAR                     F985
[ G] PPRD_IDE_8255                    0092
[ G] PPWR_IDE_8255                    0080
[ G] PREFIX                           DCB8
[ G] PROERR                           E8A0
[ G] PROMSG                           F79D
[ G] PURGE                            E616
[ G] PURGE1                           E618
[ G] PUTCHR                           E58D
[ G] QVECT                            F66F
[ G] RAM                              DC00
[ G] RCBOP                            0001
[ G] RCC1                             F619
[ G] RCC2                             F62C
[ G] RCC3                             F645
[ G] RCCHR                            F60E
[ G] RCCMD                            00FF
[ G] RCDEV                            000A
[ G] RCDNL                            000B
[ G] RCDSK                            0009
[ G] RCEOF                            0006
[ G] RCEXI                            0007
[ G] RCNOS                            0008
[ G] RCNOTF                           0002
[ G] RCOND                            F527
[ G] RCORE                            0004
[ G] RCOWE                            0005
[ G] RCPRO                            0003
[ G] RCRET                            E18C
[ G] RDDEV                            E5AF
[ G] RDDLC                            EFA9
[ G] RDISK                            EAD2
[ G] RDNULL                           F93F
[ G] RDONE                            EAF7
[ G] RDSEC                            F6DA
[ G] RDSER1                           F96B
[ G] RDSER1N                          F97A
[ G] RDW1                             E604
[ G] RDWRK                            E5EF
[ G] READB                            E86C
[ G] READC                            E821
[ G] REC1                             E840
[ G] REC2                             E85A
[ G] REDCHR                           F4A1
[ G] REDIN                            F647
[ G] REDOUT                           F64C
[ G] REENT                            E19F
[ G] REEXG                            F663
[ G] RESTAB                           FF01
[ G] RESU1                            EA9A
[ G] RESU2                            EA9F
[ G] RESU3                            EAAA
[ G] RESUME                           EA7E
[ G] RETNZ                            E360
[ G] RETURN                           EEDA
[ G] RETZ                             F66C
[ G] RETZ1                            F685
[ G] REWIND                           E8B6
[ G] RISIZ                            0067
[ G] RITAB                            FF09
[ G] RNXT                             E343
[ G] RNXT1                            E345
[ G] ROM                              E000
[ G] ROMCHK                           E000
[ G] RPERM                            0080
[ G] RRTS                             E614
[ G] RST_DLY                          FADA
[ G] RSUCC                            F532
[ G] RTRY1                            EAD9
[ G] RTRY2                            EADD
[ G] RUN                              E1EA
[ G] RUN1                             E1ED
[ G] RUN2                             E1F8
[ G] SAVB                             DCD5
[ G] SAVDRV                           DCDA
[ G] SAVF1                            EE88
[ G] SAVF2                            EE95
[ G] SAVF3                            EEC6
[ G] SAVFIL                           EE79
[ G] SAVP1                            F59F
[ G] SAVP2                            F5A9
[ G] SAVPRM                           F59A
[ G] SAVSTK                           DCDB
[ G] SAVX                             DCD6
[ G] SAVY                             DCD8
[ G] SDC1                             F14E
[ G] SDC2                             F155
[ G] SDCMD                            F13F
[ G] SDRIVE                           DCEB
[ G] SDTAB                            F41A
[ G] SEC                              0006
[ G] SEC1                             EAC0
[ G] SEC2                             EACA
[ G] SECTOR                           EAB2
[ G] SEEK1                            E9C4
[ G] SEEK2                            E9E4
[ G] SEEK3                            E9F7
[ G] SEEKABS                          E9AF
[ G] SEEKREL                          E9B2
[ G] SELDRV                           F669
[ G] SERIALINIT                       F95A
[ G] SET                              EFF3
[ G] SET0                             F004
[ G] SET1                             F013
[ G] SET2                             F032
[ G] SET3                             F088
[ G] SET4                             F0C0
[ G] SET5                             F0D4
[ G] SET_PPI_RD                       FBB4
[ G] SET_PPI_WR                       FBC2
[ G] SETADR                           F3B6
[ G] SETCMD                           F01E
[ G] SETDEF                           F00C
[ G] SETF0                            F038
[ G] SETF1                            F04F
[ G] SETF2                            F059
[ G] SETFLG                           F10F
[ G] SETIN                            F651
[ G] SETOUT                           F65B
[ G] SETTAB                           F373
[ G] SETVAR                           F596
[ G] SFTAB                            F3E2
[ G] SH21                             F1BE
[ G] SH22                             F1C6
[ G] SH23                             F1D3
[ G] SHFLAG                           F27D
[ G] SHOADR                           F3CC
[ G] SHODRA                           F23C
[ G] SHODRB                           F242
[ G] SHODRV                           F203
[ G] SHOFIL                           E6C3
[ G] SHOME                            E6AB
[ G] SHON1                            E6DF
[ G] SHONAM                           E6DD
[ G] SHOOFF                           F293
[ G] SHOSAV                           E6CA
[ G] SHOT1                            F24F
[ G] SHOT2                            F25A
[ G] SHOT3                            F263
[ G] SHOT4                            F266
[ G] SHOTAB                           F24C
[ G] SHOW                             F12B
[ G] SHOW0                            F137
[ G] SHOW1                            F13C
[ G] SHOW2                            F160
[ G] SHOW3                            F200
[ G] SHOW4                            F29B
[ G] SHOW5                            F26A
[ G] SHOW6                            F2F3
[ G] SHRT                             E701
[ G] SKIP                             E4CF
[ G] SKRTS                            E4DB
[ G] SPACE                            E585
[ G] SPC1                             E589
[ G] SSR                              E00B
[ G] SSRTAB                           F84E
[ G] ST1                              F0C3
[ G] STACK                            DE00
[ G] STFLAG                           F0FC
[ G] SUSP1                            EA64
[ G] SUSP2                            EA6F
[ G] SUSPEND                          EA2C
[ G] SVECT                            F679
[ G] SWI                              F6E2
[ G] SWI2                             F6E6
[ G] SWI2VEC                          DC98
[ G] SWI3                             F6EA
[ G] SWI3VEC                          DC9A
[ G] SWIVEC                           DC96
[ G] SYSDIR                           DCAF
[ G] SYSDRV                           DCAE
[ G] TEMP                             DCCB
[ G] TEMP1                            DCCD
[ G] TEMP2                            DCCF
[ G] TEMP3                            DCD1
[ G] TEMP4                            DCD3
[ G] TLOOK                            E4F8
[ G] TLOOK1                           E4FB
[ G] TLOOK2                           E50A
[ G] TLOOK3                           E527
[ G] TLOOK4                           E52C
[ G] TLOOK5                           E52E
[ G] TLOOK6                           E533
[ G] TLOOKE                           F0B6
[ G] TMPENT                           E1B5
[ G] TOUPPER                          E4ED
[ G] TRAC1                            F4ED
[ G] TRAC2                            F4FA
[ G] TRCFLG                           DCA4
[ G] TRET                             E4EC
[ G] TSTCHR                           E5C6
[ G] TSTDE1                           E5B6
[ G] TSTDEV                           E5B4
[ G] TSTE1                            E4E8
[ G] TSTERM                           E4DC
[ G] TSTRET                           F542
[ G] UART0                            FE68
[ G] UART1                            FE69
[ G] UART2                            FE6A
[ G] UART3                            FE6B
[ G] UART4                            FE6C
[ G] UART5                            FE6D
[ G] UART6                            FE6E
[ G] UART7                            FE6F
[ G] UNC1                             EDC5
[ G] UNCHAIN                          EDB1
[ G] UNCMD                            F704
[ G] USREND                           DFFF
[ G] USRRAM                           2000
[ G] VALCHR                           E396
[ G] VALID                            E34F
[ G] VALTST                           E356
[ G] WDISK                            EB05
[ G] WPERM                            0040
[ G] WRB1                             E94D
[ G] WRC1                             E90E
[ G] WRDE1                            E479
[ G] WRDE2                            E488
[ G] WRDEC                            E471
[ G] WRDEC8                           E470
[ G] WRDEV                            E594
[ G] WRDEV1                           E596
[ G] WRHEX                            E54D
[ G] WRHEXW                           E538
[ G] WRITEB                           E925
[ G] WRITEC                           E8FE
[ G] WRKCHG                           DCDD
[ G] WRKDRV                           DCDE
[ G] WRKSEC                           DCDF
[ G] WRKSPC                           DE00
[ G] WRLIN                            E541
[ G] WRMSG                            E571
[ G] WRNULL                           F941
[ G] WRSEC                            F6DE
[ G] WRSER1                           F95B
[ G] WRST1                            E569
[ G] WRST2                            E58B
[ G] WRSTR                            E567
[ G] WRTST                            E626
[ G] WRWRK                            E62B
[ G] WTRY1                            EB0C
[ G] WTRY2                            EB10
[ G] XFORMAT                          DC94
[ G] XHOME                            DC8E
[ G] XRDSEC                           DC90
[ G] XWRSEC                           DC92
[ G] ZERORC                           E306
