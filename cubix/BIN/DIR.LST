DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 1

0000                         1  *
0000                         2  * SYSTEM MEMORY LOCATIONS FOR USE BY APPLICATION PROGRAMS
0000                         3  *
2000                         4  OSRAM	EQU	$2000		USER APPLICATION RAM STARTS HEDE
DBFF                         5  OSEND	EQU	$DBFF		LAST LOCATION OF USER (NON-SYSTEM) RAM
D000                         6  OSUTIL	EQU	$D000		RAM FOR UTILITY PROGRAM USAGE
0000                         7  *
0000                         8  *
0000                         9  * DIR: Enhanced directory display utility
0000                        10  *
0000                        11  * Copyright 1983-2005 Dave Dunfield
0000                        12  * All rights reserved.
0000                        13  *
0018                        14  TSIZ	EQU	24		SIZE OF DIR TABLE
0000                        15  DIRLOC	EQU	0		STARTING DIRECTORY LOCATION
2000                        16  	ORG	OSRAM
2000  81 3F                 17  DIR	CMPA	#'?'		QUERY OPERAND?
2002  26 3F                 18  	BNE	QUAL		NO, LOOK FOR QUALIFIERS
2004  3F                    19  	SWI			SOFTWARE INTERRUPT TO DOS
2005  19                    20  	FCB	25		SYSTEM REQUEST NUMBER
2006  55 73 65 3A 20 44 +   21  	FCC	'Use: DIR[/DISK/LOAD/SIZE/TOTAL/NOHEADER/PROT]'
2033  20 5B 3C 64 69 72 +   22  	FCCZ	' [<directory>]'
2042  39                    23  	RTS
2043                        24  * PARSE	FOR COMMAND QUALIFIERS
2043  A6 A4                 25  QUAL	LDA	,Y		GET CHAR FROM COMMAND LINE
2045  81 2F                 26  	CMPA	#'/'		IS IT A QUALIFIER?
2047  26 44                 27  	BNE	MAIN		NO, CONTINUE WITH MAIN PROGRAM
2049  30 8D 02 F0           28  	LEAX	QTABLE,PCR	POINT TO QUALIFIER TABLE
204D  3F                    29  	SWI			SOFTWARE INTERRUPT TO DOS
204E  12                    30  	FCB	18		SYSTEM REQUEST NUMBER
204F  C1 06                 31  	CMPB	#QMAX		IS IT IN RANGE
2051  24 08                 32  	BHS	QERR		IF SO, IT'S INVALID
2053  30 8D 03 10           33  	LEAX	QFLAGS,PCR	POINT TO QUALIFIER FLAGS
2057  6F 85                 34  	CLR	B,X		SET THE FLAG
2059  20 E8                 35  	BRA	QUAL		LOOK FOR ANOTHER QUALIFIER
205B  3F                    36  QERR	SWI			SOFTWARE INTERRUPT TO DOS
205C  18                    37  	FCB	24		SYSTEM REQUEST NUMBER
205D  49 6E 76 61 6C 69 +   38  	FCCZ	/Invalid qualifier: '/
2072  A6 A0                 39  	LDA	,Y+		GET CHARACTER
2074  3F                    40  DSQU1	SWI			SOFTWARE INTERRUPT TO DOS
2075  21                    41  	FCB	33		SYSTEM REQUEST NUMBER
2076  A6 A0                 42  	LDA	,Y+		GET NEXT CHAR
2078  27 0C                 43  	BEQ	GOABO		NULL IS DELIMITER
207A  81 2F                 44  	CMPA	#'/'		START OF ANOTHER QUALIFIER?
207C  27 08                 45  	BEQ	GOABO		IF SO, QUIT
207E  81 20                 46  	CMPA	#' '		SPACE?
2080  27 04                 47  	BEQ	GOABO		IF SO, QUIT
2082  81 0D                 48  	CMPA	#$0D		END OF LINE?
2084  26 EE                 49  	BNE	DSQU1		NO, KEEP DUMPING
2086  3F                    50  GOABO	SWI			SOFTWARE INTERRUPT TO DOS
2087  19                    51  	FCB	25		SYSTEM REQUEST NUMBER
2088  27 00                 52  	FCB	$27,0		CHARACTERS TO DISPLAY
208A  86 01                 53  	LDA	#1		INVALID OPERAND RETURN CODE
208C  39                    54  	RTS
208D                        55  * FIRST	GET PARAMETERS,	AND ADJUST FOR DEFAULTS
208D  B6 23 69              56  MAIN	LDA	SIZE		SEE IF '/SIZE' SPECIFIED
2090  B4 23 6A              57  	ANDA	RUNADR		OR '/RUNADR'
2093  B4 23 6B              58  	ANDA	DSKADR		OR '/DISKADR'
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 2

2096  B4 23 6C              59  	ANDA	ATTR		OR '/ATTRIBUTES'
2099  B7 23 6D              60  	STA	INFO		IF SO, SET INFORMATION MODE (SINGLE COLUMN)
209C  3F                    61  	SWI			SOFTWARE INTERRUPT TO DOS
209D  04                    62  	FCB	4		SYSTEM REQUEST NUMBER
209E  27 2D                 63  	BEQ	DEFPRM		NONE, USE DEFAULT
20A0  34 20                 64  	PSHS	Y		SAVE OPERAND POINTER
20A2  3F                    65  ADVP	SWI			SOFTWARE INTERRUPT TO DOS
20A3  05                    66  	FCB	5		SYSTEM REQUEST NUMBER
20A4  27 23                 67  	BEQ	ADVP2		END OF LINE ?
20A6  81 5D                 68  	CMPA	#']'		END OF DIRECTORY
20A8  27 0A                 69  	BEQ	ADVP1		IF SO, MABY HAFTA INSERT *.*
20AA  81 3A                 70  	CMPA	#':'		END OF OPRAND?
20AC  26 F4                 71  	BNE	ADVP		IF SO, OK
20AE  A6 A4                 72  	LDA	,Y		GET NEXT
20B0  81 5B                 73  	CMPA	#'['		DIRECTORY?
20B2  27 EE                 74  	BEQ	ADVP		ALLOW IT
20B4                        75  * END OF DIRECTORY SPECIFICATION, SEE IF FILE SPEC SUPPLIED
20B4  A6 A4                 76  ADVP1	LDA	,Y		GETR NEXT CHAR
20B6  27 08                 77  	BEQ	ADVP3		IF END, INSERT DEFAULT
20B8  81 0D                 78  	CMPA	#$0D		END OF LINE?
20BA  27 04                 79  	BEQ	ADVP3		YES, INSERT DEFAULT
20BC  81 20                 80  	CMPA	#' '		END OF OPERAND?
20BE  26 09                 81  	BNE	ADVP2		NO, FILE SPEC MUST BE SUPPLIED
20C0  8E 23 31              82  ADVP3	LDX	#DEFNAM		POINT TO DEFAULT FILENAME
20C3  A6 80                 83  ADVP4	LDA	,X+		GET CHAR FROM DEFAULT
20C5  A7 A0                 84  	STA	,Y+		APPEND TO OPERAND
20C7  26 FA                 85  	BNE	ADVP4		CONTINUE TILL ALL MOVED
20C9                        86  * OPERAND IS OK, GET NAME AND BEGIN SCANNING DIRECTORY
20C9  35 20                 87  ADVP2	PULS	Y		RESTORE POINTER TO OPERAND
20CB  20 04                 88  	BRA	SUPPRM		PROCESS PARAMETER
20CD                        89  * NO OPERAND WAS SUPPLIED, POINT TO DEFAULT (ALL FILES)
20CD  10 8E 23 31           90  DEFPRM	LDY	#DEFNAM		POINT TO DEFAULT OPERAND
20D1  3F                    91  SUPPRM	SWI			SOFTWARE INTERRUPT TO DOS
20D2  09                    92  	FCB	9		SYSTEM REQUEST NUMBER
20D3  10 26 02 1F           93  	LBNE	ABORT		OPERAND WAS INVALID, QUIT
20D7  A6 1F                 94  	LDA	-1,X		GET DRIVE
20D9  B7 23 7F              95  	STA	DRIVE		SAVE IT
20DC  3F                    96  	SWI			SOFTWARE INTERRUPT TO DOS
20DD  4C                    97  	FCB	76		SYSTEM REQUEST NUMBER
20DE                        98  * INITIALIZE RAM TABLE
20DE  86 FF                 99  	LDA	#$FF		INDICATE END OF TABLE
20E0  B7 25 80             100  	STA	RAM+512		PLACE AT BEGINNING OF TABLE
20E3                       101  * OPEN DIRECTORY, AND START READING
20E3  CC 00 00             102  	LDD	#DIRLOC		DIRECTORY STARTS HERE
20E6  FD 23 7D             103  RDSEC	STD	SECTOR		SAVE CURRENT DIRECTORY SECTOR
20E9  8E 23 80             104  	LDX	#RAM		POINT TO WORK AREA
20EC  3F                   105  	SWI			SOFTWARE INTERRUPT TO DOS
20ED  5C                   106  	FCB	92		SYSTEM REQUEST NUMBER
20EE  10 26 02 04          107  	LBNE	ABORT		DISK ERROR, QUIT
20F2                       108  * TEST THIS DIRECTORY ENTRY FOR	MATCH
20F2  A6 84                109  RDENT	LDA	,X		GET FIRST CHAR
20F4  27 47                110  	BEQ	NXTENT		UNUSED ENTRY, SKIP
20F6  3F                   111  	SWI			SOFTWARE INTERRUPT TO DOS
20F7  13                   112  	FCB	19		SYSTEM REQUEST NUMBER
20F8  26 43                113  	BNE	NXTENT		NO, SKIP
20FA                       114  * NAME MATCHES,	INSERT INTO TABLE
20FA  10 8E 25 80          115  	LDY	#RAM+512	POINT TO TABLE
20FE  34 30                116  INSNAM	PSHS	X,Y		SAVE TABLE AND DIRECTORY POINTERS
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 3

2100  A6 A4                117  	LDA	,Y		TEST FOR END OF TABLE
2102  2B 14                118  	BMI	INSERT		YES, INSERT HERE
2104  C6 13                119  	LDB	#19		COMPARE 19 CHARS (FULL NAME)
2106  A6 80                120  CMPNAM	LDA	,X+		GET CHAR FROM DIRECTORY
2108  A1 A0                121  	CMPA	,Y+		COMPARE WITH TABLE ENTRY
210A  25 0C                122  	BLO	INSERT		LESS, INSERT NAME HERE
210C  26 03                123  	BNE	CMPN1		MUST BE HIGHER, SKIP THIS ENT
210E  5A                   124  	DECB			REDUCE COUNT
210F  26 F5                125  	BNE	CMPNAM		KEEP GOING
2111                       126  * ENTRY	WAS NOT	LESS THAN THIS ONE, TRY	NEXT
2111  35 30                127  CMPN1	PULS	X,Y		RESTORE TABLE AND DIRECTORY POINTERS
2113  31 A8 18             128  	LEAY	TSIZ,Y		ADVANCE TO NEXT TABLE ENTRY
2116  20 E6                129  	BRA	INSNAM		PERFORM TEST AGAIN
2118                       130  * INSERT NAME HERE
2118  AE 62                131  INSERT	LDX	2,S		GET TABLE POINTER
211A  A6 80                132  INS1	LDA	,X+		TEST FOR END OF TABLE
211C  2B 05                133  	BMI	INS15		YES, WE FOUND END
211E  30 88 17             134  	LEAX	TSIZ-1,X	ADVANCE REMAINDER OF ENTRY
2121  20 F7                135  	BRA	INS1		AND KEEP LOOKING FOR IT
2123  31 88 18             136  INS15	LEAY	TSIZ,X		ADVANCE EXTRA SPACE FOR NEW ENTRY
2126  A6 82                137  INS2	LDA	,-X		GET CHAR FROM OLD
2128  A7 A2                138  	STA	,-Y		SAVE IN NEW POSITION
212A  AC 62                139  	CMPX	2,S		ARE WE AT INSERT POSITION YET?
212C  22 F8                140  	BHI	INS2		NO, KEEP MOVEING
212E  35 30                141  	PULS	X,Y		RESTORE TABLE AND DIRECTORY POINTERS
2130  34 10                142  	PSHS	X		SAVE DIRECTORY POSITION
2132  C6 18                143  	LDB	#TSIZ		MOVE # CHARS (DIR ENT)
2134  A6 80                144  INS3	LDA	,X+		GET CHAR FROM DIRECTORY
2136  A7 A0                145  	STA	,Y+		SAVE IN TABLE
2138  5A                   146  	DECB			REDUCE COUNT
2139  26 F9                147  	BNE	INS3		MOCE ENTIRE NAME
213B  35 10                148  	PULS	X		RESTORE DIRECTORY POSITION
213D                       149  * ADVANCE TO NEXT DIRECTORY ENTRY, AND TEST IT
213D  30 88 20             150  NXTENT	LEAX	32,X		ADVANCE TO NEXT ENTRY
2140  8C 25 80             151  	CMPX	#RAM+512	ARE WE OVER THE SECTOR LIMIT
2143  25 AD                152  	BLO	RDENT		NO, TEST THIS ONE
2145  FC 23 7D             153  	LDD	SECTOR		GET SECTOR NUMBER BACK
2148  3F                   154  	SWI			SOFTWARE INTERRUPT TO DOS
2149  4D                   155  	FCB	77		SYSTEM REQUEST NUMBER
214A  26 9A                156  	BNE	RDSEC		IF MORE, KEEP LOOKING
214C                       157  * WE HAVE ALL MATCHING NAMES IN	TABLE, NOW DISPLAY IT
214C  10 8E 25 80          158  	LDY	#RAM+512	POINT TO TABLE
2150  7F 23 76             159  DISP0	CLR	XPOS		STARTS AT COLUMN NUMBER 0
2153  A6 A4                160  DISP1	LDA	,Y		GET CHAR FROM TABLE
2155  10 2B 01 57          161  	LBMI	DISPEND		END OF TABLE, QUIT
2159  34 20                162  	PSHS	Y		SAVE POINTER
215B  B6 23 68             163  	LDA	NOHEAD		DO WE HAVE HEADERS?
215E  27 5D                164  	BEQ	DIROK		NO, DISPLAY NORMALLY
2160  C6 08                165  	LDB	#8		COMPARE 8 CHARS
2162  8E 23 6E             166  	LDX	#SAVDIR		POINT TO SAVED DIRECTORY NAME
2165  A6 80                167  CMPDIR	LDA	,X+		GET CHAR FROM SAVED
2167  A1 A0                168  	CMPA	,Y+		SAME AS OURS?
2169  26 05                169  	BNE	DISPDIR		NO, NEW DIRECTORY
216B  5A                   170  	DECB			REDUCE COUNT
216C  26 F7                171  	BNE	CMPDIR		KEEP TESTING TILL DUN
216E  20 4D                172  	BRA	DIROK		NO HEADER TO DISPLAY, (SAME DIR)
2170                       173  * DISPLAY DIRECTORY HEADER
2170  FC 23 77             174  DISPDIR	LDD	NDIR		GET DIRECTORY COUNT
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 4

2173  27 03                175  	BEQ	DISPD9		FIRST ONE, DON'T DISPLAY TOTALS
2175  17 01 8C             176  	LBSR	FSUM		DISPAY FILE TOTAL SUMMARY
2178  FC 23 77             177  DISPD9	LDD	NDIR		GET NUMBER AGAIN
217B  C3 00 01             178  	ADDD	#1		INCREMENT
217E  FD 23 77             179  	STD	NDIR		RESAVE
2181  4F                   180  	CLRA			GET A ZERO
2182  5F                   181  	CLRB			16 BYTE ZERO
2183  FD 23 79             182  	STD	FTOTAL		CLEAR INTERMEDIATE FILE TOTALS
2186  17 01 9E             183  	LBSR	LFCR		NEW LINE
2189  3F                   184  	SWI			SOFTWARE INTERRUPT TO DOS
218A  18                   185  	FCB	24		SYSTEM REQUEST NUMBER
218B  44 69 72 65 63 74 +  186  	FCCZ	'Directory '
2196  B6 23 7F             187  	LDA	>DRIVE		GET DRIVE
2199  8B 41                188  	ADDA	#'A'
219B  3F                   189  	SWI			SOFTWARE INTERRUPT TO DOS
219C  21                   190  	FCB	33		SYSTEM REQUEST NUMBER
219D  3F                   191  	SWI			SOFTWARE INTERRUPT TO DOS
219E  18                   192  	FCB	24		SYSTEM REQUEST NUMBER
219F  3A 5B 00             193  	FCCZ	':['		INFO
21A2  C6 08                194  	LDB	#8		DISPAY MAX 8 CHARS
21A4  10 AE E4             195  	LDY	,S		GET POINTER TO ENTRY BACK
21A7  8E 23 6E             196  	LDX	#SAVDIR		POINT TO SAVED DIRECTORY
21AA  A6 A0                197  DISPD1	LDA	,Y+		GET CHAR FROM ENTRY
21AC  A7 80                198  	STA	,X+		SAVE IN NEW SAVED DIRECTORY NAME
21AE  27 02                199  	BEQ	DISPD2		DON'T DISPLAY ZERO PADS
21B0  3F                   200  	SWI			SOFTWARE INTERRUPT TO DOS
21B1  21                   201  	FCB	33		SYSTEM REQUEST NUMBER
21B2  5A                   202  DISPD2	DECB			REDUCE COUNT
21B3  26 F5                203  	BNE	DISPD1		KEEP DISPLAYING
21B5  3F                   204  	SWI			SOFTWARE INTERRUPT TO DOS
21B6  19                   205  	FCB	25		SYSTEM REQUEST NUMBER
21B7  5D 0A 00             206  	FCB	']',$0A,0
21BA  7F 23 76             207  	CLR	XPOS		START IN COLUMN ZERO
21BD  35 20                208  DIROK	PULS	Y		RESTORE FILE POINTER
21BF  FC 23 79             209  	LDD	FTOTAL		GET FILE TOTAL
21C2  C3 00 01             210  	ADDD	#1		INCREMENT
21C5  FD 23 79             211  	STD	FTOTAL		RESAVE
21C8  FC 23 7B             212  	LDD	GTOTAL		GET GRAND TOTAL
21CB  C3 00 01             213  	ADDD	#1		INCREMENT
21CE  FD 23 7B             214  	STD	GTOTAL		RESAVE
21D1  B6 23 67             215  	LDA	TOTAL		ARE WE ASKING FOR '/TOTAL'S ONLY?
21D4  27 3F                216  	BEQ	TOTON		IF SO, DON'T DISPLAY NAME
21D6  8E 00 17             217  	LDX	#23		DEFAULT SPACEING FOR '/NOHEAD'
21D9  B6 23 68             218  	LDA	NOHEAD		IS '/NOHEAD' IN EFFECT?
21DC  27 3D                219  	BEQ	NOH1		IF SO, DISPLAY SEPERATE DIRECTORY HEADER
21DE  31 28                220  	LEAY	8,Y		ADVANCE PAST DIRECTORY
21E0  30 18                221  	LEAX	-8,X		REDUCE FIELD WIDTH FOR FILENAME
21E2  B6 23 6D             222  	LDA	INFO		ARE WE DISPLAYING INFORMATION WITH FILES?
21E5  27 49                223  	BEQ	NOH15		IF SO, DON'T DISPLAY NAME IN COLUMNS
21E7                       224  * DISPLAY FILENAMES IN SHORT FORM (COLUMNS)
21E7  8E 00 0E             225  	LDX	#14		FIELD WIDTH FOR COLUMN DISPLAY
21EA  C6 08                226  	LDB	#8		SIZE OF FILENAME
21EC  17 01 09             227  	LBSR	DISPB		DISPLAY FILENAME
21EF  86 2E                228  	LDA	#'.'		SEPERATOR FOR TYPE
21F1  3F                   229  	SWI			SOFTWARE INTERRUPT TO DOS
21F2  21                   230  	FCB	33		SYSTEM REQUEST NUMBER
21F3  C6 03                231  	LDB	#3		SIZE OF FILETYPE
21F5  17 01 00             232  	LBSR	DISPB		DISPLAY FILETYPE
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 5

21F8  31 25                233  	LEAY	TSIZ-19,Y	SKIP EXTRA INFO
21FA                       234  * FILL WITH SPACES TO NEXT COLUMN
21FA  7C 23 76             235  	INC	XPOS		ADVANCE COLUMN NUMBER
21FD  B6 23 76             236  	LDA	XPOS		GET COLUMN NUMBER
2200  81 05                237  	CMPA	#5		ARE WE OVER?
2202  24 0B                238  	BHS	DISPN		IF SO, GO TO A NEW LINE
2204  86 20                239  SPAC1	LDA	#' '		GET SPACE
2206  3F                   240  	SWI			SOFTWARE INTERRUPT TO DOS
2207  21                   241  	FCB	33		SYSTEM REQUEST NUMBER
2208  30 1F                242  	LEAX	-1,X		REDUCE FIELD WIDTH
220A  26 F8                243  	BNE	SPAC1		FILL FIELD
220C  16 FF 44             244  	LBRA	DISP1		DISPLAY NEXT ENTRY
220F  17 01 1C             245  DISPN	LBSR	LFCR1		PERFORM LINE-FEED, CARRIAGE RETURN
2212  16 FF 3B             246  	LBRA	DISP0		DISPLAY NEXT ENTRY, AT COLUMN ZERO
2215                       247  * ONLY TOTALS ARE BEING	DISPLAYED, DON'T GIVE HIM THE NAMES
2215  31 A8 18             248  TOTON	LEAY	TSIZ,Y		ADVANCE TO NEXT ENTRY
2218  16 FF 38             249  	LBRA	DISP1		CHECK NEXT ENTRY
221B                       250  * NOHEAD IS IN EFFECT, DISPLAY DIRECTORY PREFIX
221B  B6 23 7F             251  NOH1	LDA	>DRIVE
221E  8B 41                252  	ADDA	#'A'
2220  3F                   253  	SWI			SOFTWARE INTERRUPT TO DOS
2221  21                   254  	FCB	33		SYSTEM REQUEST NUMBER
2222  3F                   255  	SWI			SOFTWARE INTERRUPT TO DOS
2223  18                   256  	FCB	24		SYSTEM REQUEST NUMBER
2224  3A 5B 00             257  	FCCZ	':['
2227  C6 08                258  	LDB	#8		SIZE OF DIRECTORY NAME
2229  17 00 CC             259  	LBSR	DISPB		DISPLAY DIRECTORY NAME
222C  86 5D                260  	LDA	#']'		DIRECTORY END CHARACTER
222E  3F                   261  	SWI			SOFTWARE INTERRUPT TO DOS
222F  21                   262  	FCB	33		SYSTEM REQUEST NUMBER
2230                       263  * DISPLAY FILENAME, AND	ANY INFO REQUESTED
2230  C6 08                264  NOH15	LDB	#8		SIZE OF FILENAME
2232  17 00 C3             265  	LBSR	DISPB		DISPLAY FILENAME
2235  86 2E                266  	LDA	#'.'		FILENAME SEPERATOR
2237  3F                   267  	SWI			SOFTWARE INTERRUPT TO DOS
2238  21                   268  	FCB	33		SYSTEM REQUEST NUMBER
2239  C6 03                269  	LDB	#3		SIZE OF FILETYPE
223B  17 00 BA             270  	LBSR	DISPB		DISPLAY FILETYPE
223E  B6 23 6D             271  	LDA	INFO		TEST FOR INFO TO DISPLAY
2241  26 68                272  	BNE	NOSIZ		NO, DISPLAY NEXT FILENAME
2243                       273  * PAD WITH SPACES
2243  86 20                274  NOH2	LDA	#' '		GET SPACE
2245  3F                   275  	SWI			SOFTWARE INTERRUPT TO DOS
2246  21                   276  	FCB	33		SYSTEM REQUEST NUMBER
2247  30 1F                277  	LEAX	-1,X		REDUCE COUNT
2249  26 F8                278  	BNE	NOH2		FILL FIELD
224B                       279  * TEST FOR '/RUNADR' DISPLAY
224B  B6 23 6A             280  	LDA	RUNADR		DO WE WISH TO DISPLAY RUNADDRESS
224E  26 0C                281  	BNE	NORUN		NO, DON'T DISPLAY
2250  EC 22                282  	LDD	2,Y		GET RUN ADDRESS
2252  3F                   283  	SWI			SOFTWARE INTERRUPT TO DOS
2253  1B                   284  	FCB	27		SYSTEM REQUEST NUMBER
2254  3F                   285  	SWI			SOFTWARE INTERRUPT TO DOS
2255  18                   286  	FCB	24		SYSTEM REQUEST NUMBER
2256  20 20 20 20 20 00    287  	FCCZ	'     '		SPACES
225C                       288  * TEST FOR '/DSKADR' DISPLAY
225C  B6 23 6B             289  NORUN	LDA	DSKADR		DO WE WANT DISK ADDRESS DISPLAYED
225F  26 0C                290  	BNE	NODSK		NO, DON'T DISPLAY
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 6

2261  EC A4                291  	LDD	,Y		GET DISK ADDRESS
2263  3F                   292  	SWI			SOFTWARE INTERRUPT TO DOS
2264  1B                   293  	FCB	27		SYSTEM REQUEST NUMBER
2265  3F                   294  	SWI			SOFTWARE INTERRUPT TO DOS
2266  18                   295  	FCB	24		SYSTEM REQUEST NUMBER
2267  20 20 20 20 20 00    296  	FCCZ	'     '		SPACES
226D                       297  * TEST FOR '/ATTRIBUTES' DISPLAY
226D  B6 23 6C             298  NODSK	LDA	ATTR		ATTRIBUTES
2270  26 20                299  	BNE	NOATTR		NO
2272  E6 24                300  	LDB	4,Y		GET ATTRIBUTES
2274  8E 23 35             301  	LDX	#ATRTAB		PT TO TABLE
2277  86 09                302  	LDA	#9		FLAGS
2279  B7 23 76             303  	STA	XPOS		SAVE IT
227C  5D                   304  NODS1	TSTB			ANY LEFT
227D  27 0C                305  	BEQ	NODS2		NO
227F  A6 80                306  	LDA	,X+		GET CHAR
2281  58                   307  	LSLB			SHIFT IT
2282  24 F8                308  	BCC	NODS1		NONE
2284  7A 23 76             309  	DEC	XPOS		INDICATE CHAR OUT
2287  3F                   310  	SWI			SOFTWARE INTERRUPT TO DOS
2288  21                   311  	FCB	33		SYSTEM REQUEST NUMBER
2289  20 F1                312  	BRA	NODS1		CONTINUE
228B  3F                   313  NODS2	SWI			SOFTWARE INTERRUPT TO DOS
228C  15                   314  	FCB	21		SYSTEM REQUEST NUMBER
228D  7A 23 76             315  	DEC	XPOS		REDUCE
2290  26 F9                316  	BNE	NODS2		MORE, KEEP GOING
2292                       317  * TEST FOR '/SIZE' DISPLAY
2292  B6 23 69             318  NOATTR	LDA	SIZE		DO WE WISH TO DISPLAY SIZE?
2295  26 14                319  	BNE	NOSIZ		NO, DON'T DISPLAY
2297  34 20                320  	PSHS	Y		SAVE POINTER TO ENTRY
2299  EC A4                321  	LDD	,Y		GET DISK ADDRESS
229B  10 8E 00 00          322  	LDY	#0		START WITH SIZE OF ZERO
229F                       323  * TRAVERSE LINK	CHAIN, DETERMINING SIZE	OF FILE
229F  31 21                324  SIZ1	LEAY	1,Y		INCREMENT SIZE BY ONE SECTOR
22A1  3F                   325  	SWI			SOFTWARE INTERRUPT TO DOS
22A2  4D                   326  	FCB	77		SYSTEM REQUEST NUMBER
22A3  26 FA                327  	BNE	SIZ1		KEEP TRAVERSING
22A5  1F 20                328  	TFR	Y,D		COPY SIZE TO D FOR DISPLAY
22A7  3F                   329  	SWI			SOFTWARE INTERRUPT TO DOS
22A8  1A                   330  	FCB	26		SYSTEM REQUEST NUMBER
22A9  35 20                331  	PULS	Y		RESTORE POINTER TO ENTRY
22AB  31 25                332  NOSIZ	LEAY	TSIZ-19,Y	SKIP INFO
22AD  16 FF 5F             333  	LBRA	DISPN		DISPLAY NEXT ENTRY
22B0                       334  * END OF RAM TABLE, DISPLAY CLOSING SUMMARIES
22B0  17 00 51             335  DISPEND	LBSR	FSUM		DISPLAY FILE SUMMARY FOR LAST DIRECTORY
22B3  FC 23 77             336  	LDD	NDIR		FIND OUT HOW MANY DIRECTORIES WE HIT
22B6  10 83 00 01          337  	CMPD	#1		WAS THERE MORE THAN ONE?
22BA  23 39                338  	BLS	DISPEX		NO, SKIP GRAND TOTAL
22BC  3F                   339  	SWI			SOFTWARE INTERRUPT TO DOS
22BD  18                   340  	FCB	24		SYSTEM REQUEST NUMBER
22BE  0A 0D                341  	FCB	$0A,$0D		NEW LINE
22C0  47 72 61 6E 64 20 +  342  	FCCZ	'Grand total of '
22D0  FC 23 77             343  	LDD	NDIR		GET NUMBER OF DIRECTORIES
22D3  3F                   344  	SWI			SOFTWARE INTERRUPT TO DOS
22D4  1A                   345  	FCB	26		SYSTEM REQUEST NUMBER
22D5  3F                   346  	SWI			SOFTWARE INTERRUPT TO DOS
22D6  18                   347  	FCB	24		SYSTEM REQUEST NUMBER
22D7  20 64 69 72 65 63 +  348  	FCCZ	' directories, '
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 7

22E6  FC 23 7B             349  	LDD	GTOTAL		GET GRAND TOTAL OF FILES
22E9  3F                   350  	SWI			SOFTWARE INTERRUPT TO DOS
22EA  1A                   351  	FCB	26		SYSTEM REQUEST NUMBER
22EB  3F                   352  	SWI			SOFTWARE INTERRUPT TO DOS
22EC  19                   353  	FCB	25		SYSTEM REQUEST NUMBER
22ED  20 66 69 6C 65 73 +  354  	FCCZ	' files.'
22F5  4F                   355  DISPEX	CLRA			ZERO RETURN CODE
22F6  3F                   356  ABORT	SWI			SOFTWARE INTERRUPT TO DOS
22F7  00                   357  	FCB	0		SYSTEM REQUEST NUMBER
22F8                       358  * *** SUBROUTINES ***
22F8                       359  *
22F8                       360  * DISPLAY ENTRY	FOR MAX	CHARS IN B, DECREMENT FIELD POSITION (IN X)
22F8  A6 A0                361  DISPB	LDA	,Y+		GET CHAR FROM ENTRY
22FA  27 04                362  	BEQ	DISPB1		END OF ENTRY, QUIT
22FC  3F                   363  	SWI			SOFTWARE INTERRUPT TO DOS
22FD  21                   364  	FCB	33		SYSTEM REQUEST NUMBER
22FE  30 1F                365  	LEAX	-1,X		REDUCE FIELD POSITION
2300  5A                   366  DISPB1	DECB			REDUCE COUNT OF ENTRY SIZE
2301  26 F5                367  	BNE	DISPB		KEEP TRYING
2303  39                   368  	RTS
2304                       369  * SUMMARISE FILES
2304  7D 23 67             370  FSUM	TST	TOTAL		ARE WE DISPLAYING TOTAL
2307  27 02                371  	BEQ	FSUM1		IS SO, SKIP EXTRA LFCR
2309  8D 1C                372  	BSR	LFCR		NEW LINE
230B  3F                   373  FSUM1	SWI			SOFTWARE INTERRUPT TO DOS
230C  18                   374  	FCB	24		SYSTEM REQUEST NUMBER
230D  54 6F 74 61 6C 20 +  375  	FCCZ	'Total of '
2317  FC 23 79             376  	LDD	FTOTAL		GET TOTAL
231A  3F                   377  	SWI			SOFTWARE INTERRUPT TO DOS
231B  1A                   378  	FCB	26		SYSTEM REQUEST NUMBER
231C  3F                   379  	SWI			SOFTWARE INTERRUPT TO DOS
231D  19                   380  	FCB	25		SYSTEM REQUEST NUMBER
231E  20 66 69 6C 65 73 +  381  	FCCZ	' files.'
2326  39                   382  	RTS
2327                       383  * LFCR ROUTINE
2327  8D 05                384  LFCR	BSR	LFCR1		DISPLAY NEW LINE
2329  B6 23 76             385  	LDA	XPOS		TEST FOR AT COLUMN ZERO
232C  27 02                386  	BEQ	LFCRE		IF SO, ALL DONE
232E  3F                   387  LFCR1	SWI			SOFTWARE INTERRUPT TO DOS
232F  16                   388  	FCB	22		SYSTEM REQUEST NUMBER
2330  39                   389  LFCRE	RTS
2331                       390  * PREDEFINED STRINGS
2331  2A 2E 2A 00          391  DEFNAM	FCCZ	'*.*'		DEFAULT FILENAME OPERAND
2335  52 57 45 44 3F 3F +  392  ATRTAB	FCC	'RWED????'	ATTRIBUTE TABLE
233D                       393  * TABLE	OF VALID QUALIFIERS
233D  82                   394  QTABLE	FCB	$82
233E  2F 54 4F 54 41 4C    395  	FCC	'/TOTAL'	DISPLAY TOTALS ONLY
2344  82                   396  	FCB	$82
2345  2F 4E 4F 48 45 41 +  397  	FCC	'/NOHEADER'	NO DIRECTORY HEADER
234E  82                   398  	FCB	$82
234F  2F 53 49 5A 45       399  	FCC	'/SIZE'		DISPLAY FILE SIZE
2354  82                   400  	FCB	$82
2355  2F 4C 4F 41 44       401  	FCC	'/LOAD'		DISPLAY FILE RUN ADDRESS
235A  82                   402  	FCB	$82
235B  2F 44 49 53 4B       403  	FCC	'/DISK'		DISPLAY FILE DISK ADDRESS
2360  82                   404  	FCB	$82
2361  2F 50 52 4F 54       405  	FCC	'/PROT'
2366  80                   406  	FCB	$80		END OF TABLE
DUNFIELD 6809 ASSEMBLER: D:DIR                                        PAGE: 8

0006                       407  QMAX	EQU	6		# QUALIFIERS
2367                       408  * QUALIFIER FLAGS
2367                       409  QFLAGS	EQU	*
2367  FF                   410  TOTAL	FCB	$FF		TOTAL ONLY FLAG
2368  FF                   411  NOHEAD	FCB	$FF		NO DIR. HEADER FLAG
2369  FF                   412  SIZE	FCB	$FF		DISPLAY SIZE FLAG
236A  FF                   413  RUNADR	FCB	$FF		DISPLAY RUN ADDRESS FLAG
236B  FF                   414  DSKADR	FCB	$FF		DISPLAY DISK ADDRESS FLAG
236C  FF                   415  ATTR	FCB	$FF		DISPLAY FILE ATTRIBUTES
236D  FF                   416  INFO	FCB	$FF		0 IF ANY INFO PRINTING
236E  00 00 00 00 00 00 +  417  SAVDIR	FCB	0,0,0,0,0,0,0,0
2376  00                   418  XPOS	FCB	0		OUTPUT COLUMN INDICATOR
2377  00 00                419  NDIR	FDB	0		NUMBER OF DIRECTORIES FOUND
2379  00 00                420  FTOTAL	FDB	0		INTERMEDIATE FILE TOTALS
237B  00 00                421  GTOTAL	FDB	0		GRAND FILE COUNT TOTAL
237D                       422  SECTOR	RMB	2		SAVED CURRENT DIRECTORY SECTOR
237F                       423  DRIVE	RMB	1		DOS DRIVE
2380                       424  RAM	EQU	*		FREE RAM
