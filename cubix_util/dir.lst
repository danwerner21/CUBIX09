                      (          dir.asm):00001         ;*
                      (          dir.asm):00002         ;* DIR: Enhanced directory display utility
                      (          dir.asm):00003         ;*
                      (          dir.asm):00004         ;* Copyright 1983-2005 Dave Dunfield
                      (          dir.asm):00005         ;* All rights reserved.
                      (          dir.asm):00006         ;*
     2000             (          dir.asm):00007         OSRAM           = $2000       APPLICATION RAM AREA
     DBFF             (          dir.asm):00008         OSEND           = $DBFF       END OF GENERAL RAM
     D000             (          dir.asm):00009         OSUTIL          = $D000       UTILITY ADDRESS SPACE
     0018             (          dir.asm):00010         TSIZ            = 24                              ;SIZE OF DIR TABLE
     0000             (          dir.asm):00011         DIRLOC          = 0                               ;STARTING DIRECTORY LOCATION
                      (          dir.asm):00012                 ORG     OSRAM
2000                  (          dir.asm):00013         DIR
2000 813F             (          dir.asm):00014                 CMPA    #'?'                              ;QUERY OPERAND?
2002 263F             (          dir.asm):00015                 BNE     QUAL                              ;NO, LOOK FOR QUALIFIERS
2004 3F               (          dir.asm):00016                 SWI
2005 19               (          dir.asm):00017                 FCB     25
2006 5573653A20444952 (          dir.asm):00018                 FCC     'Use: DIR[/DISK/LOAD/SIZE/TOTAL/NOHEADER/PROT]'
     5B2F4449534B2F4C
     4F41442F53495A45
     2F544F54414C2F4E
     4F4845414445522F
     50524F545D
2033 205B3C6469726563 (          dir.asm):00019                 FCN     ' [<directory>]'
     746F72793E5D00
2042 39               (          dir.asm):00020                 RTS
                      (          dir.asm):00021         ;* PARSE        FOR COMMAND QUALIFIERS
2043                  (          dir.asm):00022         QUAL
2043 A6A4             (          dir.asm):00023                 LDA     ,Y                                ;GET CHAR FROM COMMAND LINE
2045 812F             (          dir.asm):00024                 CMPA    #'/'                              ;IS IT A QUALIFIER?
2047 2643             (          dir.asm):00025                 BNE     MAIN                              ;NO, CONTINUE WITH MAIN PROGRAM
2049 308D02EF         (          dir.asm):00026                 LEAX    QTABLE,PCR      POINT TO QUALIFIER TABLE
204D 3F               (          dir.asm):00027                 SWI
204E 12               (          dir.asm):00028                 FCB     18                                ;LOOK IT UP
204F C106             (          dir.asm):00029                 CMPB    #QMAX                             ;IS IT IN RANGE
2051 2408             (          dir.asm):00030                 BHS     QERR                              ;IF SO, IT'S INVALID
2053 308D030F         (          dir.asm):00031                 LEAX    QFLAGS,PCR      POINT TO QUALIFIER FLAGS
2057 6F85             (          dir.asm):00032                 CLR     B,X                               ;SET THE FLAG
2059 20E8             (          dir.asm):00033                 BRA     QUAL                              ;LOOK FOR ANOTHER QUALIFIER
205B                  (          dir.asm):00034         QERR
205B 3F               (          dir.asm):00035                 SWI
205C 18               (          dir.asm):00036                 FCB     24                                ;DISPLAY MESSAGE
205D 496E76616C696420 (          dir.asm):00037                 FCN     'Invalid qualifier: '
     7175616C69666965
     723A2000
2071 A6A0             (          dir.asm):00038                 LDA     ,Y+                               ;GET CHARACTER
2073                  (          dir.asm):00039         DSQU1
2073 3F               (          dir.asm):00040                 SWI
2074 21               (          dir.asm):00041                 FCB     33                                ;DISPLAY
2075 A6A0             (          dir.asm):00042                 LDA     ,Y+                               ;GET NEXT CHAR
2077 270C             (          dir.asm):00043                 BEQ     GOABO                             ;NULL IS DELIMITER
2079 812F             (          dir.asm):00044                 CMPA    #'/'                              ;START OF ANOTHER QUALIFIER?
207B 2708             (          dir.asm):00045                 BEQ     GOABO                             ;IF SO, QUIT
207D 8120             (          dir.asm):00046                 CMPA    #' '                              ;SPACE?
207F 2704             (          dir.asm):00047                 BEQ     GOABO                             ;IF SO, QUIT
2081 810D             (          dir.asm):00048                 CMPA    #$0D                              ;END OF LINE?
2083 26EE             (          dir.asm):00049                 BNE     DSQU1                             ;NO, KEEP DUMPING
2085                  (          dir.asm):00050         GOABO
2085 3F               (          dir.asm):00051                 SWI
2086 19               (          dir.asm):00052                 FCB     25                                ;DISPLAY MESSAGE
2087 2700             (          dir.asm):00053                 FCB     $27,0                             ;CHARACTERS TO DISPLAY
2089 8601             (          dir.asm):00054                 LDA     #1                                ;INVALID OPERAND RETURN CODE
208B 39               (          dir.asm):00055                 RTS
                      (          dir.asm):00056         ;* FIRST        GET PARAMETERS, AND ADJUST FOR DEFAULTS
208C                  (          dir.asm):00057         MAIN
208C B62368           (          dir.asm):00058                 LDA     SIZE                              ;SEE IF '/SIZE' SPECIFIED
208F B42369           (          dir.asm):00059                 ANDA    RUNADR                            ;OR '/RUNADR'
2092 B4236A           (          dir.asm):00060                 ANDA    DSKADR                            ;OR '/DISKADR'
2095 B4236B           (          dir.asm):00061                 ANDA    ATTR                              ;OR '/ATTRIBUTES'
2098 B7236C           (          dir.asm):00062                 STA     INFO                              ;IF SO, SET INFORMATION MODE (SINGLE COLUMN)
209B 3F               (          dir.asm):00063                 SWI
209C 04               (          dir.asm):00064                 FCB     4                                 ;LOOK FOR PARAMETER
209D 272D             (          dir.asm):00065                 BEQ     DEFPRM                            ;NONE, USE DEFAULT
209F 3420             (          dir.asm):00066                 PSHS    Y                                 ;SAVE OPERAND POINTER
20A1                  (          dir.asm):00067         ADVP
20A1 3F               (          dir.asm):00068                 SWI
20A2 05               (          dir.asm):00069                 FCB     5                                 ;GET CHAR FROM OP
20A3 2723             (          dir.asm):00070                 BEQ     ADVP2                             ;END OF LINE ?
20A5 815D             (          dir.asm):00071                 CMPA    #']'                              ;END OF DIRECTORY
20A7 270A             (          dir.asm):00072                 BEQ     ADVP1                             ;IF SO, MABY HAFTA INSERT ;*.;*
20A9 813A             (          dir.asm):00073                 CMPA    #':'                              ;END OF OPRAND?
20AB 26F4             (          dir.asm):00074                 BNE     ADVP                              ;IF SO, OK
20AD A6A4             (          dir.asm):00075                 LDA     ,Y                                ;GET NEXT
20AF 815B             (          dir.asm):00076                 CMPA    #'['                              ;DIRECTORY?
20B1 27EE             (          dir.asm):00077                 BEQ     ADVP                              ;ALLOW IT
                      (          dir.asm):00078         ;* END OF DIRECTORY SPECIFICATION, SEE IF FILE SPEC SUPPLIED
20B3                  (          dir.asm):00079         ADVP1
20B3 A6A4             (          dir.asm):00080                 LDA     ,Y                                ;GETR NEXT CHAR
20B5 2708             (          dir.asm):00081                 BEQ     ADVP3                             ;IF END, INSERT DEFAULT
20B7 810D             (          dir.asm):00082                 CMPA    #$0D                              ;END OF LINE?
20B9 2704             (          dir.asm):00083                 BEQ     ADVP3                             ;YES, INSERT DEFAULT
20BB 8120             (          dir.asm):00084                 CMPA    #' '                              ;END OF OPERAND?
20BD 2609             (          dir.asm):00085                 BNE     ADVP2                             ;NO, FILE SPEC MUST BE SUPPLIED
20BF                  (          dir.asm):00086         ADVP3
20BF 8E2330           (          dir.asm):00087                 LDX     #DEFNAM                           ;POINT TO DEFAULT FILENAME
20C2                  (          dir.asm):00088         ADVP4
20C2 A680             (          dir.asm):00089                 LDA     ,X+                               ;GET CHAR FROM DEFAULT
20C4 A7A0             (          dir.asm):00090                 STA     ,Y+                               ;APPEND TO OPERAND
20C6 26FA             (          dir.asm):00091                 BNE     ADVP4                             ;CONTINUE TILL ALL MOVED
                      (          dir.asm):00092         ;* OPERAND IS OK, GET NAME AND BEGIN SCANNING DIRECTORY
20C8                  (          dir.asm):00093         ADVP2
20C8 3520             (          dir.asm):00094                 PULS    Y                                 ;RESTORE POINTER TO OPERAND
20CA 2004             (          dir.asm):00095                 BRA     SUPPRM                            ;PROCESS PARAMETER
                      (          dir.asm):00096         ;* NO OPERAND WAS SUPPLIED, POINT TO DEFAULT (ALL FILES)
20CC                  (          dir.asm):00097         DEFPRM
20CC 108E2330         (          dir.asm):00098                 LDY     #DEFNAM                           ;POINT TO DEFAULT OPERAND
20D0                  (          dir.asm):00099         SUPPRM
20D0 3F               (          dir.asm):00100                 SWI
20D1 09               (          dir.asm):00101                 FCB     9                                 ;INFORM DOS OF FILENAME
20D2 1026021F         (          dir.asm):00102                 LBNE    ABORT                             ;OPERAND WAS INVALID, QUIT
20D6 A61F             (          dir.asm):00103                 LDA     -1,X                              ;GET DRIVE
20D8 B7237E           (          dir.asm):00104                 STA     DRIVE                             ;SAVE IT
20DB 3F               (          dir.asm):00105                 SWI
20DC 4C               (          dir.asm):00106                 FCB     76                                ;SELECT DRIVE
                      (          dir.asm):00107         ;* INITIALIZE RAM TABLE
20DD 86FF             (          dir.asm):00108                 LDA     #$FF                              ;INDICATE END OF TABLE
20DF B7257F           (          dir.asm):00109                 STA     RAM+512                           ;PLACE AT BEGINNING OF TABLE
                      (          dir.asm):00110         ;* OPEN DIRECTORY, AND START READING
20E2 CC0000           (          dir.asm):00111                 LDD     #DIRLOC                           ;DIRECTORY STARTS HERE
20E5                  (          dir.asm):00112         RDSEC
20E5 FD237C           (          dir.asm):00113                 STD     SECTOR                            ;SAVE CURRENT DIRECTORY SECTOR
20E8 8E237F           (          dir.asm):00114                 LDX     #RAM                              ;POINT TO WORK AREA
20EB 3F               (          dir.asm):00115                 SWI
20EC 5C               (          dir.asm):00116                 FCB     92                                ;READ SECTOR
20ED 10260204         (          dir.asm):00117                 LBNE    ABORT                             ;DISK ERROR, QUIT
                      (          dir.asm):00118         ;* TEST THIS DIRECTORY ENTRY FOR        MATCH
20F1                  (          dir.asm):00119         RDENT
20F1 A684             (          dir.asm):00120                 LDA     ,X                                ;GET FIRST CHAR
20F3 2747             (          dir.asm):00121                 BEQ     NXTENT                            ;UNUSED ENTRY, SKIP
20F5 3F               (          dir.asm):00122                 SWI
20F6 13               (          dir.asm):00123                 FCB     19                                ;DUZ IT MATCH STORED FILENAME?
20F7 2643             (          dir.asm):00124                 BNE     NXTENT                            ;NO, SKIP
                      (          dir.asm):00125         ;* NAME MATCHES,        INSERT INTO TABLE
20F9 108E257F         (          dir.asm):00126                 LDY     #RAM+512        POINT TO TABLE
20FD                  (          dir.asm):00127         INSNAM
20FD 3430             (          dir.asm):00128                 PSHS    X,Y                               ;SAVE TABLE AND DIRECTORY POINTERS
20FF A6A4             (          dir.asm):00129                 LDA     ,Y                                ;TEST FOR END OF TABLE
2101 2B14             (          dir.asm):00130                 BMI     INSERT                            ;YES, INSERT HERE
2103 C613             (          dir.asm):00131                 LDB     #19                               ;COMPARE 19 CHARS (FULL NAME)
2105                  (          dir.asm):00132         CMPNAM
2105 A680             (          dir.asm):00133                 LDA     ,X+                               ;GET CHAR FROM DIRECTORY
2107 A1A0             (          dir.asm):00134                 CMPA    ,Y+                               ;COMPARE WITH TABLE ENTRY
2109 250C             (          dir.asm):00135                 BLO     INSERT                            ;LESS, INSERT NAME HERE
210B 2603             (          dir.asm):00136                 BNE     CMPN1                             ;MUST BE HIGHER, SKIP THIS ENT
210D 5A               (          dir.asm):00137                 DECB                                      ;     REDUCE COUNT
210E 26F5             (          dir.asm):00138                 BNE     CMPNAM                            ;KEEP GOING
                      (          dir.asm):00139         ;* ENTRY        WAS NOT LESS THAN THIS ONE, TRY NEXT
2110                  (          dir.asm):00140         CMPN1
2110 3530             (          dir.asm):00141                 PULS    X,Y                               ;RESTORE TABLE AND DIRECTORY POINTERS
2112 31A818           (          dir.asm):00142                 LEAY    TSIZ,Y                            ;ADVANCE TO NEXT TABLE ENTRY
2115 20E6             (          dir.asm):00143                 BRA     INSNAM                            ;PERFORM TEST AGAIN
                      (          dir.asm):00144         ;* INSERT NAME HERE
2117                  (          dir.asm):00145         INSERT
2117 AE62             (          dir.asm):00146                 LDX     2,S                               ;GET TABLE POINTER
2119                  (          dir.asm):00147         INS1
2119 A680             (          dir.asm):00148                 LDA     ,X+                               ;TEST FOR END OF TABLE
211B 2B05             (          dir.asm):00149                 BMI     INS15                             ;YES, WE FOUND END
211D 308817           (          dir.asm):00150                 LEAX    TSIZ-1,X        ADVANCE REMAINDER OF ENTRY
2120 20F7             (          dir.asm):00151                 BRA     INS1                              ;AND KEEP LOOKING FOR IT
2122                  (          dir.asm):00152         INS15
2122 318818           (          dir.asm):00153                 LEAY    TSIZ,X                            ;ADVANCE EXTRA SPACE FOR NEW ENTRY
2125                  (          dir.asm):00154         INS2
2125 A682             (          dir.asm):00155                 LDA     ,-X                               ;GET CHAR FROM OLD
2127 A7A2             (          dir.asm):00156                 STA     ,-Y                               ;SAVE IN NEW POSITION
2129 AC62             (          dir.asm):00157                 CMPX    2,S                               ;ARE WE AT INSERT POSITION YET?
212B 22F8             (          dir.asm):00158                 BHI     INS2                              ;NO, KEEP MOVEING
212D 3530             (          dir.asm):00159                 PULS    X,Y                               ;RESTORE TABLE AND DIRECTORY POINTERS
212F 3410             (          dir.asm):00160                 PSHS    X                                 ;SAVE DIRECTORY POSITION
2131 C618             (          dir.asm):00161                 LDB     #TSIZ                             ;MOVE # CHARS (DIR ENT)
2133                  (          dir.asm):00162         INS3
2133 A680             (          dir.asm):00163                 LDA     ,X+                               ;GET CHAR FROM DIRECTORY
2135 A7A0             (          dir.asm):00164                 STA     ,Y+                               ;SAVE IN TABLE
2137 5A               (          dir.asm):00165                 DECB                                      ;     REDUCE COUNT
2138 26F9             (          dir.asm):00166                 BNE     INS3                              ;MOCE ENTIRE NAME
213A 3510             (          dir.asm):00167                 PULS    X                                 ;RESTORE DIRECTORY POSITION
                      (          dir.asm):00168         ;* ADVANCE TO NEXT DIRECTORY ENTRY, AND TEST IT
213C                  (          dir.asm):00169         NXTENT
213C 308820           (          dir.asm):00170                 LEAX    32,X                              ;ADVANCE TO NEXT ENTRY
213F 8C257F           (          dir.asm):00171                 CMPX    #RAM+512        ARE WE OVER THE SECTOR LIMIT
2142 25AD             (          dir.asm):00172                 BLO     RDENT                             ;NO, TEST THIS ONE
2144 FC237C           (          dir.asm):00173                 LDD     SECTOR                            ;GET SECTOR NUMBER BACK
2147 3F               (          dir.asm):00174                 SWI
2148 4D               (          dir.asm):00175                 FCB     77                                ;FIND NEXT LINK
2149 269A             (          dir.asm):00176                 BNE     RDSEC                             ;IF MORE, KEEP LOOKING
                      (          dir.asm):00177         ;* WE HAVE ALL MATCHING NAMES IN        TABLE, NOW DISPLAY IT
214B 108E257F         (          dir.asm):00178                 LDY     #RAM+512        POINT TO TABLE
214F                  (          dir.asm):00179         DISP0
214F 7F2375           (          dir.asm):00180                 CLR     XPOS                              ;STARTS AT COLUMN NUMBER 0
2152                  (          dir.asm):00181         DISP1
2152 A6A4             (          dir.asm):00182                 LDA     ,Y                                ;GET CHAR FROM TABLE
2154 102B0157         (          dir.asm):00183                 LBMI    DISPEND                           ;END OF TABLE, QUIT
2158 3420             (          dir.asm):00184                 PSHS    Y                                 ;SAVE POINTER
215A B62367           (          dir.asm):00185                 LDA     NOHEAD                            ;DO WE HAVE HEADERS?
215D 275D             (          dir.asm):00186                 BEQ     DIROK                             ;NO, DISPLAY NORMALLY
215F C608             (          dir.asm):00187                 LDB     #8                                ;COMPARE 8 CHARS
2161 8E236D           (          dir.asm):00188                 LDX     #SAVDIR                           ;POINT TO SAVED DIRECTORY NAME
2164                  (          dir.asm):00189         CMPDIR
2164 A680             (          dir.asm):00190                 LDA     ,X+                               ;GET CHAR FROM SAVED
2166 A1A0             (          dir.asm):00191                 CMPA    ,Y+                               ;SAME AS OURS?
2168 2605             (          dir.asm):00192                 BNE     DISPDIR                           ;NO, NEW DIRECTORY
216A 5A               (          dir.asm):00193                 DECB                                      ;     REDUCE COUNT
216B 26F7             (          dir.asm):00194                 BNE     CMPDIR                            ;KEEP TESTING TILL DUN
216D 204D             (          dir.asm):00195                 BRA     DIROK                             ;NO HEADER TO DISPLAY, (SAME DIR)
                      (          dir.asm):00196         ;* DISPLAY DIRECTORY HEADER
216F                  (          dir.asm):00197         DISPDIR
216F FC2376           (          dir.asm):00198                 LDD     NDIR                              ;GET DIRECTORY COUNT
2172 2703             (          dir.asm):00199                 BEQ     DISPD9                            ;FIRST ONE, DON'T DISPLAY TOTALS
2174 17018C           (          dir.asm):00200                 LBSR    FSUM                              ;DISPAY FILE TOTAL SUMMARY
2177                  (          dir.asm):00201         DISPD9
2177 FC2376           (          dir.asm):00202                 LDD     NDIR                              ;GET NUMBER AGAIN
217A C30001           (          dir.asm):00203                 ADDD    #1                                ;INCREMENT
217D FD2376           (          dir.asm):00204                 STD     NDIR                              ;RESAVE
2180 4F               (          dir.asm):00205                 CLRA                                      ;     GET A ZERO
2181 5F               (          dir.asm):00206                 CLRB                                      ;     16 BYTE ZERO
2182 FD2378           (          dir.asm):00207                 STD     FTOTAL                            ;CLEAR INTERMEDIATE FILE TOTALS
2185 17019E           (          dir.asm):00208                 LBSR    LFCR                              ;NEW LINE
2188 3F               (          dir.asm):00209                 SWI
2189 18               (          dir.asm):00210                 FCB     24                                ;OUTPUT MESSAGE
218A 4469726563746F72 (          dir.asm):00211                 FCN     'Directory '
     792000
2195 B6237E           (          dir.asm):00212                 LDA     >DRIVE                            ;GET DRIVE
2198 8B41             (          dir.asm):00213                 ADDA    #'A'
219A 3F               (          dir.asm):00214                 SWI
219B 21               (          dir.asm):00215                 FCB     33                                ;OUTPUT
219C 3F               (          dir.asm):00216                 SWI
219D 18               (          dir.asm):00217                 FCB     24                                ;OUTPUT MESSAGE
219E 3A5B00           (          dir.asm):00218                 FCN     ':['                              ;INFO
21A1 C608             (          dir.asm):00219                 LDB     #8                                ;DISPAY MAX 8 CHARS
21A3 10AEE4           (          dir.asm):00220                 LDY     ,S                                ;GET POINTER TO ENTRY BACK
21A6 8E236D           (          dir.asm):00221                 LDX     #SAVDIR                           ;POINT TO SAVED DIRECTORY
21A9                  (          dir.asm):00222         DISPD1
21A9 A6A0             (          dir.asm):00223                 LDA     ,Y+                               ;GET CHAR FROM ENTRY
21AB A780             (          dir.asm):00224                 STA     ,X+                               ;SAVE IN NEW SAVED DIRECTORY NAME
21AD 2702             (          dir.asm):00225                 BEQ     DISPD2                            ;DON'T DISPLAY ZERO PADS
21AF 3F               (          dir.asm):00226                 SWI
21B0 21               (          dir.asm):00227                 FCB     33                                ;DISPLAY ON TERMINAL
21B1                  (          dir.asm):00228         DISPD2
21B1 5A               (          dir.asm):00229                 DECB                                      ;     REDUCE COUNT
21B2 26F5             (          dir.asm):00230                 BNE     DISPD1                            ;KEEP DISPLAYING
21B4 3F               (          dir.asm):00231                 SWI
21B5 19               (          dir.asm):00232                 FCB     25                                ;DISPLAY MESSAGE
21B6 5D0A00           (          dir.asm):00233                 FCB     ']',$0A,0
21B9 7F2375           (          dir.asm):00234                 CLR     XPOS                              ;START IN COLUMN ZERO
21BC                  (          dir.asm):00235         DIROK
21BC 3520             (          dir.asm):00236                 PULS    Y                                 ;RESTORE FILE POINTER
21BE FC2378           (          dir.asm):00237                 LDD     FTOTAL                            ;GET FILE TOTAL
21C1 C30001           (          dir.asm):00238                 ADDD    #1                                ;INCREMENT
21C4 FD2378           (          dir.asm):00239                 STD     FTOTAL                            ;RESAVE
21C7 FC237A           (          dir.asm):00240                 LDD     GTOTAL                            ;GET GRAND TOTAL
21CA C30001           (          dir.asm):00241                 ADDD    #1                                ;INCREMENT
21CD FD237A           (          dir.asm):00242                 STD     GTOTAL                            ;RESAVE
21D0 B62366           (          dir.asm):00243                 LDA     TOTAL                             ;ARE WE ASKING FOR '/TOTAL'S ONLY?
21D3 273F             (          dir.asm):00244                 BEQ     TOTON                             ;IF SO, DON'T DISPLAY NAME
21D5 8E0017           (          dir.asm):00245                 LDX     #23                               ;DEFAULT SPACEING FOR '/NOHEAD'
21D8 B62367           (          dir.asm):00246                 LDA     NOHEAD                            ;IS '/NOHEAD' IN EFFECT?
21DB 273D             (          dir.asm):00247                 BEQ     NOH1                              ;IF SO, DISPLAY SEPERATE DIRECTORY HEADER
21DD 3128             (          dir.asm):00248                 LEAY    8,Y                               ;ADVANCE PAST DIRECTORY
21DF 3018             (          dir.asm):00249                 LEAX    -8,X                              ;REDUCE FIELD WIDTH FOR FILENAME
21E1 B6236C           (          dir.asm):00250                 LDA     INFO                              ;ARE WE DISPLAYING INFORMATION WITH FILES?
21E4 2749             (          dir.asm):00251                 BEQ     NOH15                             ;IF SO, DON'T DISPLAY NAME IN COLUMNS
                      (          dir.asm):00252         ;* DISPLAY FILENAMES IN SHORT FORM (COLUMNS)
21E6 8E000E           (          dir.asm):00253                 LDX     #14                               ;FIELD WIDTH FOR COLUMN DISPLAY
21E9 C608             (          dir.asm):00254                 LDB     #8                                ;SIZE OF FILENAME
21EB 170109           (          dir.asm):00255                 LBSR    DISPB                             ;DISPLAY FILENAME
21EE 862E             (          dir.asm):00256                 LDA     #'.'                              ;SEPERATOR FOR TYPE
21F0 3F               (          dir.asm):00257                 SWI
21F1 21               (          dir.asm):00258                 FCB     33                                ;DISPLAY
21F2 C603             (          dir.asm):00259                 LDB     #3                                ;SIZE OF FILETYPE
21F4 170100           (          dir.asm):00260                 LBSR    DISPB                             ;DISPLAY FILETYPE
21F7 3125             (          dir.asm):00261                 LEAY    TSIZ-19,Y       SKIP EXTRA INFO
                      (          dir.asm):00262         ;* FILL WITH SPACES TO NEXT COLUMN
21F9 7C2375           (          dir.asm):00263                 INC     XPOS                              ;ADVANCE COLUMN NUMBER
21FC B62375           (          dir.asm):00264                 LDA     XPOS                              ;GET COLUMN NUMBER
21FF 8105             (          dir.asm):00265                 CMPA    #5                                ;ARE WE OVER?
2201 240B             (          dir.asm):00266                 BHS     DISPN                             ;IF SO, GO TO A NEW LINE
2203                  (          dir.asm):00267         SPAC1
2203 8620             (          dir.asm):00268                 LDA     #' '                              ;GET SPACE
2205 3F               (          dir.asm):00269                 SWI
2206 21               (          dir.asm):00270                 FCB     33                                ;DISPLAY
2207 301F             (          dir.asm):00271                 LEAX    -1,X                              ;REDUCE FIELD WIDTH
2209 26F8             (          dir.asm):00272                 BNE     SPAC1                             ;FILL FIELD
220B 16FF44           (          dir.asm):00273                 LBRA    DISP1                             ;DISPLAY NEXT ENTRY
220E                  (          dir.asm):00274         DISPN
220E 17011C           (          dir.asm):00275                 LBSR    LFCR1                             ;PERFORM LINE-FEED, CARRIAGE RETURN
2211 16FF3B           (          dir.asm):00276                 LBRA    DISP0                             ;DISPLAY NEXT ENTRY, AT COLUMN ZERO
                      (          dir.asm):00277         ;* ONLY TOTALS ARE BEING        DISPLAYED, DON'T GIVE HIM THE NAMES
2214                  (          dir.asm):00278         TOTON
2214 31A818           (          dir.asm):00279                 LEAY    TSIZ,Y                            ;ADVANCE TO NEXT ENTRY
2217 16FF38           (          dir.asm):00280                 LBRA    DISP1                             ;CHECK NEXT ENTRY
                      (          dir.asm):00281         ;* NOHEAD IS IN EFFECT, DISPLAY DIRECTORY PREFIX
221A                  (          dir.asm):00282         NOH1
221A B6237E           (          dir.asm):00283                 LDA     >DRIVE
221D 8B41             (          dir.asm):00284                 ADDA    #'A'
221F 3F               (          dir.asm):00285                 SWI
2220 21               (          dir.asm):00286                 FCB     33                                ;OUTPUT DRIVE
2221 3F               (          dir.asm):00287                 SWI
2222 18               (          dir.asm):00288                 FCB     24
2223 3A5B00           (          dir.asm):00289                 FCN     ':['
2226 C608             (          dir.asm):00290                 LDB     #8                                ;SIZE OF DIRECTORY NAME
2228 1700CC           (          dir.asm):00291                 LBSR    DISPB                             ;DISPLAY DIRECTORY NAME
222B 865D             (          dir.asm):00292                 LDA     #']'                              ;DIRECTORY END CHARACTER
222D 3F               (          dir.asm):00293                 SWI
222E 21               (          dir.asm):00294                 FCB     33
                      (          dir.asm):00295         ;* DISPLAY FILENAME, AND        ANY INFO R=ESTED
222F                  (          dir.asm):00296         NOH15
222F C608             (          dir.asm):00297                 LDB     #8                                ;SIZE OF FILENAME
2231 1700C3           (          dir.asm):00298                 LBSR    DISPB                             ;DISPLAY FILENAME
2234 862E             (          dir.asm):00299                 LDA     #'.'                              ;FILENAME SEPERATOR
2236 3F               (          dir.asm):00300                 SWI
2237 21               (          dir.asm):00301                 FCB     33                                ;DISPLAY
2238 C603             (          dir.asm):00302                 LDB     #3                                ;SIZE OF FILETYPE
223A 1700BA           (          dir.asm):00303                 LBSR    DISPB                             ;DISPLAY FILETYPE
223D B6236C           (          dir.asm):00304                 LDA     INFO                              ;TEST FOR INFO TO DISPLAY
2240 2668             (          dir.asm):00305                 BNE     NOSIZ                             ;NO, DISPLAY NEXT FILENAME
                      (          dir.asm):00306         ;* PAD WITH SPACES
2242                  (          dir.asm):00307         NOH2
2242 8620             (          dir.asm):00308                 LDA     #' '                              ;GET SPACE
2244 3F               (          dir.asm):00309                 SWI
2245 21               (          dir.asm):00310                 FCB     33                                ;DISPLAY
2246 301F             (          dir.asm):00311                 LEAX    -1,X                              ;REDUCE COUNT
2248 26F8             (          dir.asm):00312                 BNE     NOH2                              ;FILL FIELD
                      (          dir.asm):00313         ;* TEST FOR '/RUNADR' DISPLAY
224A B62369           (          dir.asm):00314                 LDA     RUNADR                            ;DO WE WISH TO DISPLAY RUNADDRESS
224D 260C             (          dir.asm):00315                 BNE     NORUN                             ;NO, DON'T DISPLAY
224F EC22             (          dir.asm):00316                 LDD     2,Y                               ;GET RUN ADDRESS
2251 3F               (          dir.asm):00317                 SWI
2252 1B               (          dir.asm):00318                 FCB     27                                ;DISPLAY IN HEX
2253 3F               (          dir.asm):00319                 SWI
2254 18               (          dir.asm):00320                 FCB     24                                ;DISPLAY MESSAGE
2255 202020202000     (          dir.asm):00321                 FCN     '     '                           ;SPACES
                      (          dir.asm):00322         ;* TEST FOR '/DSKADR' DISPLAY
225B                  (          dir.asm):00323         NORUN
225B B6236A           (          dir.asm):00324                 LDA     DSKADR                            ;DO WE WANT DISK ADDRESS DISPLAYED
225E 260C             (          dir.asm):00325                 BNE     NODSK                             ;NO, DON'T DISPLAY
2260 ECA4             (          dir.asm):00326                 LDD     ,Y                                ;GET DISK ADDRESS
2262 3F               (          dir.asm):00327                 SWI
2263 1B               (          dir.asm):00328                 FCB     27                                ;DISPLAY
2264 3F               (          dir.asm):00329                 SWI
2265 18               (          dir.asm):00330                 FCB     24                                ;DISPLAY MESSAGE
2266 202020202000     (          dir.asm):00331                 FCN     '     '                           ;SPACES
                      (          dir.asm):00332         ;* TEST FOR '/ATTRIBUTES' DISPLAY
226C                  (          dir.asm):00333         NODSK
226C B6236B           (          dir.asm):00334                 LDA     ATTR                              ;ATTRIBUTES
226F 2620             (          dir.asm):00335                 BNE     NOATTR                            ;NO
2271 E624             (          dir.asm):00336                 LDB     4,Y                               ;GET ATTRIBUTES
2273 8E2334           (          dir.asm):00337                 LDX     #ATRTAB                           ;PT TO TABLE
2276 8609             (          dir.asm):00338                 LDA     #9                                ;FLAGS
2278 B72375           (          dir.asm):00339                 STA     XPOS                              ;SAVE IT
227B                  (          dir.asm):00340         NODS1
227B 5D               (          dir.asm):00341                 TSTB                                      ;     ANY LEFT
227C 270C             (          dir.asm):00342                 BEQ     NODS2                             ;NO
227E A680             (          dir.asm):00343                 LDA     ,X+                               ;GET CHAR
2280 58               (          dir.asm):00344                 LSLB                                      ;     SHIFT IT
2281 24F8             (          dir.asm):00345                 BCC     NODS1                             ;NONE
2283 7A2375           (          dir.asm):00346                 DEC     XPOS                              ;INDICATE CHAR OUT
2286 3F               (          dir.asm):00347                 SWI
2287 21               (          dir.asm):00348                 FCB     33                                ;OUTPUT
2288 20F1             (          dir.asm):00349                 BRA     NODS1                             ;CONTINUE
228A                  (          dir.asm):00350         NODS2
228A 3F               (          dir.asm):00351                 SWI
228B 15               (          dir.asm):00352                 FCB     21                                ;DISPLAY SPACE
228C 7A2375           (          dir.asm):00353                 DEC     XPOS                              ;REDUCE
228F 26F9             (          dir.asm):00354                 BNE     NODS2                             ;MORE, KEEP GOING
                      (          dir.asm):00355         ;* TEST FOR '/SIZE' DISPLAY
2291                  (          dir.asm):00356         NOATTR
2291 B62368           (          dir.asm):00357                 LDA     SIZE                              ;DO WE WISH TO DISPLAY SIZE?
2294 2614             (          dir.asm):00358                 BNE     NOSIZ                             ;NO, DON'T DISPLAY
2296 3420             (          dir.asm):00359                 PSHS    Y                                 ;SAVE POINTER TO ENTRY
2298 ECA4             (          dir.asm):00360                 LDD     ,Y                                ;GET DISK ADDRESS
229A 108E0000         (          dir.asm):00361                 LDY     #0                                ;START WITH SIZE OF ZERO
                      (          dir.asm):00362         ;* TRAVERSE LINK        CHAIN, DETERMINING SIZE OF FILE
229E                  (          dir.asm):00363         SIZ1
229E 3121             (          dir.asm):00364                 LEAY    1,Y                               ;INCREMENT SIZE BY ONE SECTOR
22A0 3F               (          dir.asm):00365                 SWI
22A1 4D               (          dir.asm):00366                 FCB     77                                ;LOOK FOR NEXT CHAIN
22A2 26FA             (          dir.asm):00367                 BNE     SIZ1                              ;KEEP TRAVERSING
22A4 1F20             (          dir.asm):00368                 TFR     Y,D                               ;COPY SIZE TO D FOR DISPLAY
22A6 3F               (          dir.asm):00369                 SWI
22A7 1A               (          dir.asm):00370                 FCB     26                                ;DISPLAY IN DECIMAL
22A8 3520             (          dir.asm):00371                 PULS    Y                                 ;RESTORE POINTER TO ENTRY
22AA                  (          dir.asm):00372         NOSIZ
22AA 3125             (          dir.asm):00373                 LEAY    TSIZ-19,Y       SKIP INFO
22AC 16FF5F           (          dir.asm):00374                 LBRA    DISPN                             ;DISPLAY NEXT ENTRY
                      (          dir.asm):00375         ;* END OF RAM TABLE, DISPLAY CLOSING SUMMARIES
22AF                  (          dir.asm):00376         DISPEND
22AF 170051           (          dir.asm):00377                 LBSR    FSUM                              ;DISPLAY FILE SUMMARY FOR LAST DIRECTORY
22B2 FC2376           (          dir.asm):00378                 LDD     NDIR                              ;FIND OUT HOW MANY DIRECTORIES WE HIT
22B5 10830001         (          dir.asm):00379                 CMPD    #1                                ;WAS THERE MORE THAN ONE?
22B9 2339             (          dir.asm):00380                 BLS     DISPEX                            ;NO, SKIP GRAND TOTAL
22BB 3F               (          dir.asm):00381                 SWI
22BC 18               (          dir.asm):00382                 FCB     24                                ;DISPLAY MESSAGE
22BD 0A0D             (          dir.asm):00383                 FCB     $0A,$0D                           ;NEW LINE
22BF 4772616E6420746F (          dir.asm):00384                 FCN     'Grand total of '
     74616C206F662000
22CF FC2376           (          dir.asm):00385                 LDD     NDIR                              ;GET NUMBER OF DIRECTORIES
22D2 3F               (          dir.asm):00386                 SWI
22D3 1A               (          dir.asm):00387                 FCB     26                                ;DISPLAY IN DECIMAL
22D4 3F               (          dir.asm):00388                 SWI
22D5 18               (          dir.asm):00389                 FCB     24                                ;DISPLAY MESSAGE
22D6 206469726563746F (          dir.asm):00390                 FCN     ' directories, '
     726965732C2000
22E5 FC237A           (          dir.asm):00391                 LDD     GTOTAL                            ;GET GRAND TOTAL OF FILES
22E8 3F               (          dir.asm):00392                 SWI
22E9 1A               (          dir.asm):00393                 FCB     26                                ;DISPLAY IN DECIMAL
22EA 3F               (          dir.asm):00394                 SWI
22EB 19               (          dir.asm):00395                 FCB     25                                ;DISPLAY MESSAGE
22EC 2066696C65732E00 (          dir.asm):00396                 FCN     ' files.'
22F4                  (          dir.asm):00397         DISPEX
22F4 4F               (          dir.asm):00398                 CLRA                                      ;     ZERO RETURN CODE
22F5                  (          dir.asm):00399         ABORT
22F5 3F               (          dir.asm):00400                 SWI
22F6 00               (          dir.asm):00401                 FCB     0                                 ;RETURN TO DOS
                      (          dir.asm):00402         ;*   *** SUBROUTINES ***
                      (          dir.asm):00403         ;*
                      (          dir.asm):00404         ;* DISPLAY ENTRY        FOR MAX CHARS IN B, DECREMENT FIELD POSITION (IN X)
22F7                  (          dir.asm):00405         DISPB
22F7 A6A0             (          dir.asm):00406                 LDA     ,Y+                               ;GET CHAR FROM ENTRY
22F9 2704             (          dir.asm):00407                 BEQ     DISPB1                            ;END OF ENTRY, QUIT
22FB 3F               (          dir.asm):00408                 SWI
22FC 21               (          dir.asm):00409                 FCB     33                                ;DISPLAY
22FD 301F             (          dir.asm):00410                 LEAX    -1,X                              ;REDUCE FIELD POSITION
22FF                  (          dir.asm):00411         DISPB1
22FF 5A               (          dir.asm):00412                 DECB                                      ;     REDUCE COUNT OF ENTRY SIZE
2300 26F5             (          dir.asm):00413                 BNE     DISPB                             ;KEEP TRYING
2302 39               (          dir.asm):00414                 RTS
                      (          dir.asm):00415         ;* SUMMARISE FILES
2303                  (          dir.asm):00416         FSUM
2303 7D2366           (          dir.asm):00417                 TST     TOTAL                             ;ARE WE DISPLAYING TOTAL
2306 2702             (          dir.asm):00418                 BEQ     FSUM1                             ;IS SO, SKIP EXTRA LFCR
2308 8D1C             (          dir.asm):00419                 BSR     LFCR                              ;NEW LINE
230A                  (          dir.asm):00420         FSUM1
230A 3F               (          dir.asm):00421                 SWI
230B 18               (          dir.asm):00422                 FCB     24                                ;DISPLAY MESSAGE
230C 546F74616C206F66 (          dir.asm):00423                 FCN     'Total of '
     2000
2316 FC2378           (          dir.asm):00424                 LDD     FTOTAL                            ;GET TOTAL
2319 3F               (          dir.asm):00425                 SWI
231A 1A               (          dir.asm):00426                 FCB     26                                ;OUTPUT NUMBER
231B 3F               (          dir.asm):00427                 SWI
231C 19               (          dir.asm):00428                 FCB     25                                ;DISPLAY MESSAGE
231D 2066696C65732E00 (          dir.asm):00429                 FCN     ' files.'
2325 39               (          dir.asm):00430                 RTS
                      (          dir.asm):00431         ;* LFCR ROUTINE
2326                  (          dir.asm):00432         LFCR
2326 8D05             (          dir.asm):00433                 BSR     LFCR1                             ;DISPLAY NEW LINE
2328 B62375           (          dir.asm):00434                 LDA     XPOS                              ;TEST FOR AT COLUMN ZERO
232B 2702             (          dir.asm):00435                 BEQ     LFCRE                             ;IF SO, ALL DONE
232D                  (          dir.asm):00436         LFCR1
232D 3F               (          dir.asm):00437                 SWI
232E 16               (          dir.asm):00438                 FCB     22                                ;LFCR
232F                  (          dir.asm):00439         LFCRE
232F 39               (          dir.asm):00440                 RTS
                      (          dir.asm):00441         ;* PREDEFINED STRINGS
2330                  (          dir.asm):00442         DEFNAM
2330 2A2E2A00         (          dir.asm):00443                 FCN     '*.*'                             ;DEFAULT FILENAME OPERAND
2334                  (          dir.asm):00444         ATRTAB
2334 525745443F3F3F3F (          dir.asm):00445                 FCC     'RWED????'      ATTRIBUTE TABLE
                      (          dir.asm):00446         ;* TABLE        OF VALID QUALIFIERS
233C                  (          dir.asm):00447         QTABLE
233C 82               (          dir.asm):00448                 FCB     $82
233D 2F544F54414C     (          dir.asm):00449                 FCC     '/TOTAL'        DISPLAY TOTALS ONLY
2343 82               (          dir.asm):00450                 FCB     $82
2344 2F4E4F4845414445 (          dir.asm):00451                 FCC     '/NOHEADER'     NO DIRECTORY HEADER
     52
234D 82               (          dir.asm):00452                 FCB     $82
234E 2F53495A45       (          dir.asm):00453                 FCC     '/SIZE'                           ;DISPLAY FILE SIZE
2353 82               (          dir.asm):00454                 FCB     $82
2354 2F4C4F4144       (          dir.asm):00455                 FCC     '/LOAD'                           ;DISPLAY FILE RUN ADDRESS
2359 82               (          dir.asm):00456                 FCB     $82
235A 2F4449534B       (          dir.asm):00457                 FCC     '/DISK'                           ;DISPLAY FILE DISK ADDRESS
235F 82               (          dir.asm):00458                 FCB     $82
2360 2F50524F54       (          dir.asm):00459                 FCC     '/PROT'
2365 80               (          dir.asm):00460                 FCB     $80                               ;END OF TABLE
     0006             (          dir.asm):00461         QMAX            = 6                               ;# QUALIFIERS
                      (          dir.asm):00462         ;* QUALIFIER FLAGS
     2366             (          dir.asm):00463         QFLAGS          = *
2366                  (          dir.asm):00464         TOTAL
2366 FF               (          dir.asm):00465                 FCB     $FF                               ;TOTAL ONLY FLAG
2367                  (          dir.asm):00466         NOHEAD
2367 FF               (          dir.asm):00467                 FCB     $FF                               ;NO DIR. HEADER FLAG
2368                  (          dir.asm):00468         SIZE
2368 FF               (          dir.asm):00469                 FCB     $FF                               ;DISPLAY SIZE FLAG
2369                  (          dir.asm):00470         RUNADR
2369 FF               (          dir.asm):00471                 FCB     $FF                               ;DISPLAY RUN ADDRESS FLAG
236A                  (          dir.asm):00472         DSKADR
236A FF               (          dir.asm):00473                 FCB     $FF                               ;DISPLAY DISK ADDRESS FLAG
236B                  (          dir.asm):00474         ATTR
236B FF               (          dir.asm):00475                 FCB     $FF                               ;DISPLAY FILE ATTRIBUTES
236C                  (          dir.asm):00476         INFO
236C FF               (          dir.asm):00477                 FCB     $FF                               ;0 IF ANY INFO PRINTING
236D                  (          dir.asm):00478         SAVDIR
236D 0000000000000000 (          dir.asm):00479                 FCB     0,0,0,0,0,0,0,0
2375                  (          dir.asm):00480         XPOS
2375 00               (          dir.asm):00481                 FCB     0                                 ;OUTPUT COLUMN INDICATOR
2376                  (          dir.asm):00482         NDIR
2376 0000             (          dir.asm):00483                 FDB     0                                 ;NUMBER OF DIRECTORIES FOUND
2378                  (          dir.asm):00484         FTOTAL
2378 0000             (          dir.asm):00485                 FDB     0                                 ;INTERMEDIATE FILE TOTALS
237A                  (          dir.asm):00486         GTOTAL
237A 0000             (          dir.asm):00487                 FDB     0                                 ;GRAND FILE COUNT TOTAL
237C                  (          dir.asm):00488         SECTOR
237C                  (          dir.asm):00489                 RMB     2                                 ;SAVED CURRENT DIRECTORY SECTOR
237E                  (          dir.asm):00490         DRIVE
237E                  (          dir.asm):00491                 RMB     1                                 ;DOS DRIVE
     237F             (          dir.asm):00492         RAM             = *                               ;FREE RAM

Symbol Table:
[ G] ABORT                            22F5
[ G] ADVP                             20A1
[ G] ADVP1                            20B3
[ G] ADVP2                            20C8
[ G] ADVP3                            20BF
[ G] ADVP4                            20C2
[ G] ATRTAB                           2334
[ G] ATTR                             236B
[ G] CMPDIR                           2164
[ G] CMPN1                            2110
[ G] CMPNAM                           2105
[ G] DEFNAM                           2330
[ G] DEFPRM                           20CC
[ G] DIR                              2000
[ G] DIRLOC                           0000
[ G] DIROK                            21BC
[ G] DISP0                            214F
[ G] DISP1                            2152
[ G] DISPB                            22F7
[ G] DISPB1                           22FF
[ G] DISPD1                           21A9
[ G] DISPD2                           21B1
[ G] DISPD9                           2177
[ G] DISPDIR                          216F
[ G] DISPEND                          22AF
[ G] DISPEX                           22F4
[ G] DISPN                            220E
[ G] DRIVE                            237E
[ G] DSKADR                           236A
[ G] DSQU1                            2073
[ G] FSUM                             2303
[ G] FSUM1                            230A
[ G] FTOTAL                           2378
[ G] GOABO                            2085
[ G] GTOTAL                           237A
[ G] INFO                             236C
[ G] INS1                             2119
[ G] INS15                            2122
[ G] INS2                             2125
[ G] INS3                             2133
[ G] INSERT                           2117
[ G] INSNAM                           20FD
[ G] LFCR                             2326
[ G] LFCR1                            232D
[ G] LFCRE                            232F
[ G] MAIN                             208C
[ G] NDIR                             2376
[ G] NOATTR                           2291
[ G] NODS1                            227B
[ G] NODS2                            228A
[ G] NODSK                            226C
[ G] NOH1                             221A
[ G] NOH15                            222F
[ G] NOH2                             2242
[ G] NOHEAD                           2367
[ G] NORUN                            225B
[ G] NOSIZ                            22AA
[ G] NXTENT                           213C
[ G] OSEND                            DBFF
[ G] OSRAM                            2000
[ G] OSUTIL                           D000
[ G] QERR                             205B
[ G] QFLAGS                           2366
[ G] QMAX                             0006
[ G] QTABLE                           233C
[ G] QUAL                             2043
[ G] RAM                              237F
[ G] RDENT                            20F1
[ G] RDSEC                            20E5
[ G] RUNADR                           2369
[ G] SAVDIR                           236D
[ G] SECTOR                           237C
[ G] SIZ1                             229E
[ G] SIZE                             2368
[ G] SPAC1                            2203
[ G] SUPPRM                           20D0
[ G] TOTAL                            2366
[ G] TOTON                            2214
[ G] TSIZ                             0018
[ G] XPOS                             2375
