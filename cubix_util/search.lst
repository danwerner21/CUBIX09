                      (       search.asm):00001         ;*
                      (       search.asm):00002         ;* SEARCH: Global file search for text or binary strings
                      (       search.asm):00003         ;*
                      (       search.asm):00004         ;* Copyright 1983-2005 Dave Dunfield
                      (       search.asm):00005         ;* All rights reserved.
                      (       search.asm):00006         ;*
                      (       search.asm):00007         ;* DIRECTORY STRUCTURE
     2000             (       search.asm):00008         OSRAM           = $2000                           ;APPLICATION RAM AREA
     DBFF             (       search.asm):00009         OSEND           = $DBFF                           ;END OF GENERAL RAM
     D000             (       search.asm):00010         OSUTIL          = $D000                           ;UTILITY ADDRESS SPACE
                      (       search.asm):00011                 ORG     0
0000                  (       search.asm):00012         DPREFIX
0000                  (       search.asm):00013                 RMB     8
0008                  (       search.asm):00014         DNAME
0008                  (       search.asm):00015                 RMB     8
0010                  (       search.asm):00016         DTYPE
0010                  (       search.asm):00017                 RMB     3
0013                  (       search.asm):00018         DDADR
0013                  (       search.asm):00019                 RMB     2
0015                  (       search.asm):00020         DRADR
0015                  (       search.asm):00021                 RMB     2
0017                  (       search.asm):00022         DATTR
0017                  (       search.asm):00023                 RMB     1
                      (       search.asm):00024         ;* FILE ATTRIBUTES
     0080             (       search.asm):00025         RPERM=%10000000
     0040             (       search.asm):00026         WPERM=%01000000
     0020             (       search.asm):00027         EPERM=%00100000
     0010             (       search.asm):00028         DPERM=%00010000
                      (       search.asm):00029         ;*
     0000             (       search.asm):00030         DIRLOC=0                                          ;DIRECTORY STARTS HERE
                      (       search.asm):00031         ;*
                      (       search.asm):00032                 ORG     OSUTIL                            ;UTILITY SPACE
D000                  (       search.asm):00033         SEARCH
D000 813F             (       search.asm):00034                 CMPA    #'?'                              ;QUERY REQUEST?
D002 2642             (       search.asm):00035                 BNE     QUAL                              ;NO, LOOK FOR QUALIFIERS
D004 3F               (       search.asm):00036                 SWI
D005 19               (       search.asm):00037                 FCB     25
D006 5573653A20534541 (       search.asm):00038                 FCC     'Use: SEARCH[/BINARY/CASE/HEX/TOTAL]'
     5243485B2F42494E
     4152592F43415345
     2F4845582F544F54
     414C5D
D029 203C66696C657370 (       search.asm):00039                 FCN     ' <filespec> <search string>'
     65633E203C736561
     7263682073747269
     6E673E00
D045 39               (       search.asm):00040                 RTS
                      (       search.asm):00041         ;* PERFORM SEARCH
                      (       search.asm):00042         ;* PARSE FOR COMMAND QUALIFIERS
D046                  (       search.asm):00043         QUAL
D046 A6A4             (       search.asm):00044                 LDA     ,Y                                ;GET CHAR FROM COMMAND LINE
D048 812F             (       search.asm):00045                 CMPA    #'/'                              ;IS IT A QUALIFIER?
D04A 2676             (       search.asm):00046                 BNE     MAIN                              ;NO, DO PGM
D04C 308D0295         (       search.asm):00047                 LEAX    QTABLE,PCR      POINT TO QUALIFIER TABLE
D050 3F               (       search.asm):00048                 SWI
D051 12               (       search.asm):00049                 FCB     18                                ;LOOK IT UP
D052 C104             (       search.asm):00050                 CMPB    #QMAX                             ;IS IT IN RANGE
D054 2408             (       search.asm):00051                 BHS     QERR                              ;IF SO, IT'S INVALID
D056 308D02A6         (       search.asm):00052                 LEAX    QFLAGS,PCR      POINT TO QUALIFIER FLAGS
D05A 6F85             (       search.asm):00053                 CLR     B,X                               ;SET THE FLAG
D05C 20E8             (       search.asm):00054                 BRA     QUAL                              ;LOOK FOR ANOTHER QUALIFIER
D05E                  (       search.asm):00055         QERR
D05E 3F               (       search.asm):00056                 SWI
D05F 18               (       search.asm):00057                 FCB     24                                ;DISPLAY MESSAGE
D060 496E76616C696420 (       search.asm):00058                 FCN     /Invalid qualifier: '/
     7175616C69666965
     723A202700
D075 A6A0             (       search.asm):00059                 LDA     ,Y+                               ;GET CHARACTER
D077 A6A0             (       search.asm):00060                 LDA     ,Y+                               ;GET CHARACTER
D079 A6A0             (       search.asm):00061                 LDA     ,Y+                               ;GET CHARACTER
D07B A6A0             (       search.asm):00062                 LDA     ,Y+                               ;GET CHARACTER
D07D A6A0             (       search.asm):00063                 LDA     ,Y+                               ;GET CHARACTER
D07F A6A0             (       search.asm):00064                 LDA     ,Y+                               ;GET CHARACTER
D081 A6A0             (       search.asm):00065                 LDA     ,Y+                               ;GET CHARACTER
D083 A6A0             (       search.asm):00066                 LDA     ,Y+                               ;GET CHARACTER
D085 A6A0             (       search.asm):00067                 LDA     ,Y+                               ;GET CHARACTER
D087 A6A0             (       search.asm):00068                 LDA     ,Y+                               ;GET CHARACTER
D089 A6A0             (       search.asm):00069                 LDA     ,Y+                               ;GET CHARACTER
D08B A6A0             (       search.asm):00070                 LDA     ,Y+                               ;GET CHARACTER
D08D A6A0             (       search.asm):00071                 LDA     ,Y+                               ;GET CHARACTER
D08F A6A0             (       search.asm):00072                 LDA     ,Y+                               ;GET CHARACTER
D091 A6A0             (       search.asm):00073                 LDA     ,Y+                               ;GET CHARACTER
D093 A6A0             (       search.asm):00074                 LDA     ,Y+                               ;GET CHARACTER
D095 A6A0             (       search.asm):00075                 LDA     ,Y+                               ;GET CHARACTER
D097 A6A0             (       search.asm):00076                 LDA     ,Y+                               ;GET CHARACTER
D099 A6A0             (       search.asm):00077                 LDA     ,Y+                               ;GET CHARACTER
D09B A6A0             (       search.asm):00078                 LDA     ,Y+                               ;GET CHARACTER
D09D A6A0             (       search.asm):00079                 LDA     ,Y+                               ;GET CHARACTER
D09F A6A0             (       search.asm):00080                 LDA     ,Y+                               ;GET CHARACTER
D0A1 A6A0             (       search.asm):00081                 LDA     ,Y+                               ;GET CHARACTER
D0A3 A6A0             (       search.asm):00082                 LDA     ,Y+                               ;GET CHARACTER
D0A5 A6A0             (       search.asm):00083                 LDA     ,Y+                               ;GET CHARACTER
D0A7                  (       search.asm):00084         DSQU1
D0A7 3F               (       search.asm):00085                 SWI
D0A8 21               (       search.asm):00086                 FCB     33                                ;DISPLAY
D0A9 A6A0             (       search.asm):00087                 LDA     ,Y+                               ;GET NEXT CHAR
D0AB 270C             (       search.asm):00088                 BEQ     GOABO                             ;NULL IS DELIMITER
D0AD 812F             (       search.asm):00089                 CMPA    #'/'                              ;START OF ANOTHER QUALIFIER?
D0AF 2708             (       search.asm):00090                 BEQ     GOABO                             ;IF SO, QUIT
D0B1 8120             (       search.asm):00091                 CMPA    #' '                              ;SPACE?
D0B3 2704             (       search.asm):00092                 BEQ     GOABO                             ;IF SO, QUIT
D0B5 810D             (       search.asm):00093                 CMPA    #$0D                              ;END OF LINE?
D0B7 26EE             (       search.asm):00094                 BNE     DSQU1                             ;NO, KEEP DUMPING
D0B9                  (       search.asm):00095         GOABO
D0B9 3F               (       search.asm):00096                 SWI
D0BA 19               (       search.asm):00097                 FCB     25                                ;DISPLAY MESSAGE
D0BB 2700             (       search.asm):00098                 FCB     $27,0                             ;CHARACTERS TO DISPLAY
D0BD 8601             (       search.asm):00099                 LDA     #1                                ;INVALID OPERAND RETURN CODE
D0BF 1600B7           (       search.asm):00100                 LBRA    ABORT                             ;GIVE UP
                      (       search.asm):00101         ;* MAIN PROGRAM
D0C2                  (       search.asm):00102         MAIN
D0C2 3F               (       search.asm):00103                 SWI
D0C3 09               (       search.asm):00104                 FCB     9                                 ;GET PATTERN
D0C4 102600B1         (       search.asm):00105                 LBNE    ABORT                             ;BAD, GIVE UP
D0C8 A61F             (       search.asm):00106                 LDA     -1,X                              ;GET DRIVE
D0CA 3F               (       search.asm):00107                 SWI
D0CB 4C               (       search.asm):00108                 FCB     76                                ;Select this drive
D0CC CED317           (       search.asm):00109                 LDU     #BUFFER                           ;POINT TO BUFFER
D0CF 7FD30E           (       search.asm):00110                 CLR     BUFSIZ                            ;BUFFER SIZE INDICATOR
D0D2 7DD300           (       search.asm):00111                 TST     HEX                               ;IS STRING HEX
D0D5 2613             (       search.asm):00112                 BNE     STRIN                             ;NO, INPUT A STRING
                      (       search.asm):00113         ;* INPUT HEX BYTES TO SEARCH FOR
D0D7                  (       search.asm):00114         HEXIN
D0D7 3F               (       search.asm):00115                 SWI
D0D8 07               (       search.asm):00116                 FCB     7                                 ;GET HEX NUMBER
D0D9 1026009C         (       search.asm):00117                 LBNE    ABORT                             ;INVALID, QUIT
D0DD 1F10             (       search.asm):00118                 TFR     X,D                               ;COPY
D0DF E7C0             (       search.asm):00119                 STB     ,U+                               ;SAVE IT
D0E1 7CD30E           (       search.asm):00120                 INC     BUFSIZ                            ;ADVANCE SIZE
D0E4 3F               (       search.asm):00121                 SWI
D0E5 04               (       search.asm):00122                 FCB     4                                 ;MORE OPERANDS?
D0E6 26EF             (       search.asm):00123                 BNE     HEXIN                             ;GET NEXT OPERAND
D0E8 2024             (       search.asm):00124                 BRA     GOTOP                             ;WE HAVE OEPRAND
                      (       search.asm):00125         ;* INPUT A STRING VALUE
D0EA                  (       search.asm):00126         STRIN
D0EA 3F               (       search.asm):00127                 SWI
D0EB 04               (       search.asm):00128                 FCB     4                                 ;GET VALUE
D0EC 271B             (       search.asm):00129                 BEQ     BADSTR                            ;ITS BAD
D0EE 3121             (       search.asm):00130                 LEAY    1,Y                               ;SKIP IT
D0F0 B7D308           (       search.asm):00131                 STA     TEMP                              ;SAVE
D0F3 A1A4             (       search.asm):00132                 CMPA    ,Y                                ;NULL STRING?
D0F5 2712             (       search.asm):00133                 BEQ     BADSTR                            ;ITS BAD
D0F7                  (       search.asm):00134         STR1
D0F7 A6A0             (       search.asm):00135                 LDA     ,Y+                               ;GET CHAR FROM STRING
D0F9 270E             (       search.asm):00136                 BEQ     BADSTR                            ;ITS BAD
D0FB B1D308           (       search.asm):00137                 CMPA    TEMP                              ;ARE WE AT END?
D0FE 270E             (       search.asm):00138                 BEQ     GOTOP                             ;WE HAVE IT
D100 7CD30E           (       search.asm):00139                 INC     BUFSIZ                            ;ADVANCE
D103 A7C0             (       search.asm):00140                 STA     ,U+                               ;SAVE
D105 810D             (       search.asm):00141                 CMPA    #$0D                              ;CR?
D107 26EE             (       search.asm):00142                 BNE     STR1                              ;NO, ITS OK
                      (       search.asm):00143         ;* STRING OPERAND IS INVALID
D109                  (       search.asm):00144         BADSTR
D109 3F               (       search.asm):00145                 SWI
D10A 2B               (       search.asm):00146                 FCB     43                                ;INVALID OPERAND MESSAGE
D10B 16006B           (       search.asm):00147                 LBRA    ABORT                             ;GO HOME
                      (       search.asm):00148         ;* WE HAVE SEARCH OPERAND
D10E                  (       search.asm):00149         GOTOP
D10E CC0000           (       search.asm):00150                 LDD     #DIRLOC                           ;DIRECTORY STARTS HERE
D111                  (       search.asm):00151         SCAND
D111 FDD30A           (       search.asm):00152                 STD     SECTOR                            ;SAVE DIRECTORY SECTOR
D114 8ED3B7           (       search.asm):00153                 LDX     #DIRBUF                           ;POINT TO FREE SPACE
D117 3F               (       search.asm):00154                 SWI
D118 5C               (       search.asm):00155                 FCB     92                                ;READ DISK
D119 1026005C         (       search.asm):00156                 LBNE    ABORT                             ;DISK ERROR
D11D                  (       search.asm):00157         SCAND1
D11D 3F               (       search.asm):00158                 SWI
D11E 13               (       search.asm):00159                 FCB     19                                ;DOES THIS ONE MATCH?
D11F 275A             (       search.asm):00160                 BEQ     SCANF                             ;IF SO, SCAN THE FILE
D121                  (       search.asm):00161         NXTDIR
D121 308820           (       search.asm):00162                 LEAX    32,X                              ;SKIP TO NEXT
D124 8CD5B7           (       search.asm):00163                 CMPX    #DIRBUF+512     BEYOND END?
D127 25F4             (       search.asm):00164                 BLO     SCAND1                            ;NO, WE ARE OK
D129 FCD30A           (       search.asm):00165                 LDD     SECTOR                            ;GET SECTOR NUMBER
D12C 3F               (       search.asm):00166                 SWI
D12D 4D               (       search.asm):00167                 FCB     77                                ;GET NEXT SECTOR
D12E 26E1             (       search.asm):00168                 BNE     SCAND                             ;CONTINUE IF MORE
D130 FCD304           (       search.asm):00169                 LDD     FMATCH                            ;DID ANY FILES MATCH?
D133 2742             (       search.asm):00170                 BEQ     NOMAT                             ;NO, ERROR
D135 10830001         (       search.asm):00171                 CMPD    #1                                ;SEARCHED ONLY ONE
D139 2739             (       search.asm):00172                 BEQ     SEREND                            ;IF SO, NO GRAND TOTAL
D13B 3F               (       search.asm):00173                 SWI
D13C 18               (       search.asm):00174                 FCB     24                                ;DISPLAY MSG
D13D 5365617263686564 (       search.asm):00175                 FCN     'Searched '
     2000
D147 3F               (       search.asm):00176                 SWI
D148 1A               (       search.asm):00177                 FCB     26                                ;DISPLAY
D149 3F               (       search.asm):00178                 SWI
D14A 18               (       search.asm):00179                 FCB     24                                ;DISPLAY MSG
D14B 2066696C65732C20 (       search.asm):00180                 FCN     ' files, for a total of '
     666F72206120746F
     74616C206F662000
D163 FCD306           (       search.asm):00181                 LDD     GMATCH                            ;GET GRAND TOTAL MATCHES
D166 3F               (       search.asm):00182                 SWI
D167 1A               (       search.asm):00183                 FCB     26                                ;DISPLAY
D168 3F               (       search.asm):00184                 SWI
D169 19               (       search.asm):00185                 FCB     25                                ;DISPLLY MESSAGE
D16A 206D617463686573 (       search.asm):00186                 FCN     ' matches.'
     2E00
D174                  (       search.asm):00187         SEREND
D174 4F               (       search.asm):00188                 CLRA                                      ;     ZERO RETURN CODE
D175 2002             (       search.asm):00189                 BRA     ABORT                             ;QUIT
D177                  (       search.asm):00190         NOMAT
D177 3F               (       search.asm):00191                 SWI
D178 2C               (       search.asm):00192                 FCB     44                                ;FILE NOT FOUND
D179                  (       search.asm):00193         ABORT
D179 3F               (       search.asm):00194                 SWI
D17A 00               (       search.asm):00195                 FCB     0                                 ;GO HOME
                      (       search.asm):00196         ;* MATCHING FILE WAS FOUND, SEARCH IT
D17B                  (       search.asm):00197         SCANF
D17B 3410             (       search.asm):00198                 PSHS    X                                 ;SAVE POINTER INTO ENTRY
D17D FCD304           (       search.asm):00199                 LDD     FMATCH                            ;FILE MATCH,
D180 C30001           (       search.asm):00200                 ADDD    #1                                ;INCREMENT
D183 FDD304           (       search.asm):00201                 STD     FMATCH                            ;RESAVE
D186 3F               (       search.asm):00202                 SWI
D187 18               (       search.asm):00203                 FCB     24                                ;DISPLAY MESSAGE
D188 5363616E6E696E67 (       search.asm):00204                 FCN     'Scanning file: '
     2066696C653A2000
D198 3F               (       search.asm):00205                 SWI
D199 1F               (       search.asm):00206                 FCB     31                                ;DISPLAY
D19A A68817           (       search.asm):00207                 LDA     DATTR,X                           ;GET ATTRIBUTES
D19D 8580             (       search.asm):00208                 BITA    #RPERM                            ;CAN WE READ
D19F 261D             (       search.asm):00209                 BNE     PROTOK
D1A1 3F               (       search.asm):00210                 SWI
D1A2 19               (       search.asm):00211                 FCB     25
D1A3 202D2050726F7465 (       search.asm):00212                 FCN     ' - Protection violation'
     6374696F6E207669
     6F6C6174696F6E00
D1BB 16FF63           (       search.asm):00213                 LBRA    NXTDIR                            ;GET NEXT
D1BE                  (       search.asm):00214         PROTOK
D1BE 3F               (       search.asm):00215                 SWI
D1BF 16               (       search.asm):00216                 FCB     22                                ;NEW LINE
D1C0 4F               (       search.asm):00217                 CLRA
D1C1 5F               (       search.asm):00218                 CLRB
D1C2 FDD315           (       search.asm):00219                 STD     BYTCT                             ;SAVE BYTE COUNT
D1C5 FDD311           (       search.asm):00220                 STD     NMATCH                            ;SAVE NUMBER OF MATCHES
D1C8 5C               (       search.asm):00221                 INCB
D1C9 FDD313           (       search.asm):00222                 STD     LINCT                             ;CURRENT LINE COUNTER
                      (       search.asm):00223         ;* READ SECTORS FROM FILE, AND SCAN THEM
D1CC EC8813           (       search.asm):00224                 LDD     DDADR,X                           ;GET DISK ADDRESS
D1CF                  (       search.asm):00225         SCSEC
D1CF FDD30C           (       search.asm):00226                 STD     FSEC                              ;SAVE
D1D2 8ED5B7           (       search.asm):00227                 LDX     #WRKBUF                           ;POINT TO WORK BUFFER
D1D5 BFD30F           (       search.asm):00228                 STX     WRKPTR                            ;SAVE POINTER
D1D8 3F               (       search.asm):00229                 SWI
D1D9 5C               (       search.asm):00230                 FCB     92                                ;READ SECTOR
D1DA 269D             (       search.asm):00231                 BNE     ABORT                             ;INVALID
                      (       search.asm):00232         ;* SCAN 1K SECTOR(X) FOR CONTENTS OF BUFFER
D1DC 108ED367         (       search.asm):00233                 LDY     #BUFF1                            ;POINT TO BUFFER
D1E0 F6D30E           (       search.asm):00234                 LDB     BUFSIZ                            ;GET BUFFER SIZE
                      (       search.asm):00235         ;* FILL COMPARE BUFFER FROM FILE
D1E3                  (       search.asm):00236         SCAN1
D1E3 8D79             (       search.asm):00237                 BSR     RDFIL                             ;READ FILE
D1E5 A7A0             (       search.asm):00238                 STA     ,Y+                               ;SAVE IN BUFFER
D1E7 5A               (       search.asm):00239                 DECB                                      ;     REDUCE COUNT
D1E8 26F9             (       search.asm):00240                 BNE     SCAN1                             ;CONTINUE
                      (       search.asm):00241         ;* COMPARE COMPARE BUFFER WITH FILE CONTENTS
D1EA                  (       search.asm):00242         SCAN2
D1EA 8ED317           (       search.asm):00243                 LDX     #BUFFER                           ;POINT TO BUFFER
D1ED 108ED367         (       search.asm):00244                 LDY     #BUFF1                            ;POINT TO OTHER BUFFER
D1F1 F6D30E           (       search.asm):00245                 LDB     BUFSIZ                            ;GET BUFFER SIZE
D1F4                  (       search.asm):00246         SCAN3
D1F4 A680             (       search.asm):00247                 LDA     ,X+                               ;GET CHAR FROM BUFFER
D1F6 A1A0             (       search.asm):00248                 CMPA    ,Y+                               ;COMPARE WITH OTHER
D1F8 2651             (       search.asm):00249                 BNE     SCAN4                             ;NO MATCH
D1FA 5A               (       search.asm):00250                 DECB                                      ;     REDUCE COUNT
D1FB 26F7             (       search.asm):00251                 BNE     SCAN3                             ;KEEP LOOKING
                      (       search.asm):00252         ;* STRING WAS FOUND
D1FD FCD311           (       search.asm):00253                 LDD     NMATCH                            ;GET NUMBER OF MATCHES
D200 C30001           (       search.asm):00254                 ADDD    #1                                ;ADVANCE
D203 FDD311           (       search.asm):00255                 STD     NMATCH                            ;RESAVE
D206 B6D302           (       search.asm):00256                 LDA     TOTAL                             ;IS IT TOTAL ONLY?
D209 2740             (       search.asm):00257                 BEQ     SCAN4                             ;YES, DON'T DISPLAY
D20B B6D301           (       search.asm):00258                 LDA     BINARY                            ;BINARY ONLY?
D20E 2713             (       search.asm):00259                 BEQ     BINDI                             ;IF DSO, DISPLAY OFFSET ONLY
D210 3F               (       search.asm):00260                 SWI
D211 18               (       search.asm):00261                 FCB     24                                ;DISPLAY MSG
D212 4C696E653A2000   (       search.asm):00262                 FCN     'Line: '
D219 FCD313           (       search.asm):00263                 LDD     LINCT                             ;GET LINE COUNTER
D21C 3F               (       search.asm):00264                 SWI
D21D 1A               (       search.asm):00265                 FCB     26                                ;DISPLAY
D21E 3F               (       search.asm):00266                 SWI
D21F 18               (       search.asm):00267                 FCB     24                                ;DISPLAY MSG
D220 2C2000           (       search.asm):00268                 FCN     ', '
D223                  (       search.asm):00269         BINDI
D223 3F               (       search.asm):00270                 SWI
D224 18               (       search.asm):00271                 FCB     24
D225 4F66667365743A20 (       search.asm):00272                 FCN     'Offset: '
     00
D22E F6D30E           (       search.asm):00273                 LDB     BUFSIZ                            ;GET BUFFER SIZE
D231 4F               (       search.asm):00274                 CLRA                                      ;     ZERO HIGH
D232 3406             (       search.asm):00275                 PSHS    A,B                               ;SAVE
D234 FCD315           (       search.asm):00276                 LDD     BYTCT                             ;GET BYTE COUNT
D237 A3E4             (       search.asm):00277                 SUBD    ,S                                ;CONVERT
D239 EDE4             (       search.asm):00278                 STD     ,S                                ;SAVE
D23B 3F               (       search.asm):00279                 SWI
D23C 1A               (       search.asm):00280                 FCB     26                                ;DISPLAY
D23D 3F               (       search.asm):00281                 SWI
D23E 18               (       search.asm):00282                 FCB     24                                ;DISPLAY MESSAGE
D23F 20282400         (       search.asm):00283                 FCN     ' ($'
D243 3506             (       search.asm):00284                 PULS    A,B                               ;RESTORE
D245 3F               (       search.asm):00285                 SWI
D246 1B               (       search.asm):00286                 FCB     27                                ;DISPLAY
D247 3F               (       search.asm):00287                 SWI
D248 19               (       search.asm):00288                 FCB     25                                ;DISPLAY MESSAGE
D249 2900             (       search.asm):00289                 FCN     ')'
D24B                  (       search.asm):00290         SCAN4
D24B 8ED367           (       search.asm):00291                 LDX     #BUFF1                            ;POINT TO COMPARE BUFFER
D24E F6D30E           (       search.asm):00292                 LDB     BUFSIZ                            ;GET SIZE
D251                  (       search.asm):00293         SCAN5
D251 A601             (       search.asm):00294                 LDA     1,X                               ;GET CHAR
D253 A780             (       search.asm):00295                 STA     ,X+                               ;RESAVE
D255 5A               (       search.asm):00296                 DECB                                      ;     REDUCE COUNT
D256 26F9             (       search.asm):00297                 BNE     SCAN5                             ;CONTINUE
D258 8D04             (       search.asm):00298                 BSR     RDFIL                             ;READ A CHAR
D25A A71F             (       search.asm):00299                 STA     -1,X                              ;SAVE
D25C 208C             (       search.asm):00300                 BRA     SCAN2                             ;CONTINUE
                      (       search.asm):00301         ;*
                      (       search.asm):00302         ;* RDFILE
                      (       search.asm):00303         ;*
D25E                  (       search.asm):00304         RDFIL
D25E 3414             (       search.asm):00305                 PSHS    B,X                               ;SAVE REG
D260 FCD315           (       search.asm):00306                 LDD     BYTCT                             ;GET BYTE COUNT
D263 C30001           (       search.asm):00307                 ADDD    #1                                ;ADVANCE
D266 FDD315           (       search.asm):00308                 STD     BYTCT                             ;RESAVE
D269 BED30F           (       search.asm):00309                 LDX     WRKPTR                            ;GET POINTER
D26C 8CD7B7           (       search.asm):00310                 CMPX    #WRKBUF+512     ADVANCE
D26F 2513             (       search.asm):00311                 BLO     RDFOK                             ;OK
D271 FCD30C           (       search.asm):00312                 LDD     FSEC                              ;GET FILE SECTOR
D274 3F               (       search.asm):00313                 SWI
D275 4D               (       search.asm):00314                 FCB     77                                ;NEW SECTOR?
D276 2735             (       search.asm):00315                 BEQ     FILEOF                            ;END OF FILE
D278 8ED5B7           (       search.asm):00316                 LDX     #WRKBUF                           ;SET IT UP
D27B FDD30C           (       search.asm):00317                 STD     FSEC                              ;RESAVE
D27E 3F               (       search.asm):00318                 SWI
D27F 5C               (       search.asm):00319                 FCB     92                                ;READ DISK
D280 1026FEF5         (       search.asm):00320                 LBNE    ABORT                             ;BAD
D284                  (       search.asm):00321         RDFOK
D284 A680             (       search.asm):00322                 LDA     ,X+                               ;GET CHAR
D286 2A05             (       search.asm):00323                 BPL     RDFO1                             ;NORMAL
D288 F6D301           (       search.asm):00324                 LDB     BINARY                            ;ARE WE TREATING AS BINARY
D28B 2620             (       search.asm):00325                 BNE     FILEOF                            ;NO, END OF FILE
D28D                  (       search.asm):00326         RDFO1
D28D BFD30F           (       search.asm):00327                 STX     WRKPTR                            ;RESAVE POINTER
D290 810D             (       search.asm):00328                 CMPA    #$0D                              ;NEW LINE?
D292 2608             (       search.asm):00329                 BNE     RDF1                              ;NO
D294 BED313           (       search.asm):00330                 LDX     LINCT                             ;GET LINE COUNT
D297 3001             (       search.asm):00331                 LEAX    1,X                               ;ADVANCE
D299 BFD313           (       search.asm):00332                 STX     LINCT                             ;RESAVE
D29C                  (       search.asm):00333         RDF1
D29C F6D303           (       search.asm):00334                 LDB     CASE                              ;IS LOWER CASE CONVERT ENABLED?
D29F 260A             (       search.asm):00335                 BNE     RDF2                              ;NO, SKIP IT
D2A1 8161             (       search.asm):00336                 CMPA    #$61                              ;LOWER CASE?
D2A3 2506             (       search.asm):00337                 BLO     RDF2                              ;NO, DON'T CONVERT
D2A5 817A             (       search.asm):00338                 CMPA    #$7A                              ;LOWER CASE?
D2A7 2202             (       search.asm):00339                 BHI     RDF2                              ;NO, DON'T CONVERT
D2A9 845F             (       search.asm):00340                 ANDA    #$5F                              ;CONVERT TO UPPER CASE
D2AB                  (       search.asm):00341         RDF2
D2AB 3594             (       search.asm):00342                 PULS    B,X,PC
D2AD                  (       search.asm):00343         FILEOF
D2AD 3265             (       search.asm):00344                 LEAS    5,S                               ;SKIP SAVED X AND PC
D2AF 3F               (       search.asm):00345                 SWI
D2B0 18               (       search.asm):00346                 FCB     24                                ;DISPLAY MESSAGE
D2B1 546F74616C206F66 (       search.asm):00347                 FCN     'Total of '
     2000
D2BB FCD311           (       search.asm):00348                 LDD     NMATCH                            ;GET NUMBER OF MATCHES
D2BE 3F               (       search.asm):00349                 SWI
D2BF 1A               (       search.asm):00350                 FCB     26                                ;DISPLAY IN DECIMAL
D2C0 3F               (       search.asm):00351                 SWI
D2C1 19               (       search.asm):00352                 FCB     25                                ;DISPLAY MESSAGE
D2C2 206D617463686573 (       search.asm):00353                 FCN     ' matches were found.'
     207765726520666F
     756E642E00
D2D7 FCD306           (       search.asm):00354                 LDD     GMATCH                            ;GET GRAND MATCH TOTAL
D2DA F3D311           (       search.asm):00355                 ADDD    NMATCH                            ;ADD IN THIS MATCHES
D2DD FDD306           (       search.asm):00356                 STD     GMATCH                            ;SAVE
D2E0 3510             (       search.asm):00357                 PULS    X                                 ;RESTORE POINTER
D2E2 16FE3C           (       search.asm):00358                 LBRA    NXTDIR
                      (       search.asm):00359         ;* STRINGS
D2E5                  (       search.asm):00360         QTABLE
D2E5 82               (       search.asm):00361                 FCB     $82
D2E6 2F484558         (       search.asm):00362                 FCC     '/HEX'                            ;HEX INPUT
D2EA 82               (       search.asm):00363                 FCB     $82
D2EB 2F42494E415259   (       search.asm):00364                 FCC     '/BINARY'       BINARY INPUT FILE
D2F2 82               (       search.asm):00365                 FCB     $82
D2F3 2F544F54414C     (       search.asm):00366                 FCC     '/TOTAL'        TOTAL MATCHES ONLY
D2F9 82               (       search.asm):00367                 FCB     $82
D2FA 2F43415345       (       search.asm):00368                 FCC     '/CASE'                           ;CASE CONVERSION
D2FF 80               (       search.asm):00369                 FCB     $80
     0004             (       search.asm):00370         QMAX            = 4
                      (       search.asm):00371         ;*
     D300             (       search.asm):00372         QFLAGS          = *
D300                  (       search.asm):00373         HEX
D300 FF               (       search.asm):00374                 FCB     $FF                               ;HEX INPUT STRING
D301                  (       search.asm):00375         BINARY
D301 FF               (       search.asm):00376                 FCB     $FF                               ;BINARY INPUT FILE
D302                  (       search.asm):00377         TOTAL
D302 FF               (       search.asm):00378                 FCB     $FF                               ;DISPLAY TOTALS ONLY
D303                  (       search.asm):00379         CASE
D303 FF               (       search.asm):00380                 FCB     $FF                               ;FORCE CASE CONVERSIONS
                      (       search.asm):00381         ;*
                      (       search.asm):00382         ;* LOCAL STORAGE
                      (       search.asm):00383         ;*
D304                  (       search.asm):00384         FMATCH
D304 0000             (       search.asm):00385                 FDB     0
D306                  (       search.asm):00386         GMATCH
D306 0000             (       search.asm):00387                 FDB     0
D308                  (       search.asm):00388         TEMP
D308                  (       search.asm):00389                 RMB     2
D30A                  (       search.asm):00390         SECTOR
D30A                  (       search.asm):00391                 RMB     2
D30C                  (       search.asm):00392         FSEC
D30C                  (       search.asm):00393                 RMB     2
D30E                  (       search.asm):00394         BUFSIZ
D30E                  (       search.asm):00395                 RMB     1
D30F                  (       search.asm):00396         WRKPTR
D30F                  (       search.asm):00397                 RMB     2
D311                  (       search.asm):00398         NMATCH
D311                  (       search.asm):00399                 RMB     2
D313                  (       search.asm):00400         LINCT
D313                  (       search.asm):00401                 RMB     2
D315                  (       search.asm):00402         BYTCT
D315                  (       search.asm):00403                 RMB     2
D317                  (       search.asm):00404         BUFFER
D317                  (       search.asm):00405                 RMB     80
D367                  (       search.asm):00406         BUFF1
D367                  (       search.asm):00407                 RMB     80
D3B7                  (       search.asm):00408         DIRBUF
D3B7                  (       search.asm):00409                 RMB     512
D5B7                  (       search.asm):00410         WRKBUF
D5B7                  (       search.asm):00411                 RMB     512

Symbol Table:
[ G] ABORT                            D179
[ G] BADSTR                           D109
[ G] BINARY                           D301
[ G] BINDI                            D223
[ G] BUFF1                            D367
[ G] BUFFER                           D317
[ G] BUFSIZ                           D30E
[ G] BYTCT                            D315
[ G] CASE                             D303
[ G] DATTR                            0017
[ G] DDADR                            0013
[ G] DIRBUF                           D3B7
[ G] DIRLOC                           0000
[ G] DNAME                            0008
[ G] DPERM                            0010
[ G] DPREFIX                          0000
[ G] DRADR                            0015
[ G] DSQU1                            D0A7
[ G] DTYPE                            0010
[ G] EPERM                            0020
[ G] FILEOF                           D2AD
[ G] FMATCH                           D304
[ G] FSEC                             D30C
[ G] GMATCH                           D306
[ G] GOABO                            D0B9
[ G] GOTOP                            D10E
[ G] HEX                              D300
[ G] HEXIN                            D0D7
[ G] LINCT                            D313
[ G] MAIN                             D0C2
[ G] NMATCH                           D311
[ G] NOMAT                            D177
[ G] NXTDIR                           D121
[ G] OSEND                            DBFF
[ G] OSRAM                            2000
[ G] OSUTIL                           D000
[ G] PROTOK                           D1BE
[ G] QERR                             D05E
[ G] QFLAGS                           D300
[ G] QMAX                             0004
[ G] QTABLE                           D2E5
[ G] QUAL                             D046
[ G] RDF1                             D29C
[ G] RDF2                             D2AB
[ G] RDFIL                            D25E
[ G] RDFO1                            D28D
[ G] RDFOK                            D284
[ G] RPERM                            0080
[ G] SCAN1                            D1E3
[ G] SCAN2                            D1EA
[ G] SCAN3                            D1F4
[ G] SCAN4                            D24B
[ G] SCAN5                            D251
[ G] SCAND                            D111
[ G] SCAND1                           D11D
[ G] SCANF                            D17B
[ G] SCSEC                            D1CF
[ G] SEARCH                           D000
[ G] SECTOR                           D30A
[ G] SEREND                           D174
[ G] STR1                             D0F7
[ G] STRIN                            D0EA
[ G] TEMP                             D308
[ G] TOTAL                            D302
[ G] WPERM                            0040
[ G] WRKBUF                           D5B7
[ G] WRKPTR                           D30F
